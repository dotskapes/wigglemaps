function vect(h,p,q){this.x=h;this.y=p;this.z=q?q:0;this.add=function(n){this.x+=n.x;this.y+=n.y;this.z+=n.z};this.sub=function(n){this.x-=n.x;this.y-=n.y;this.z-=n.z};this.scale=function(n){this.x*=n;this.y*=n;this.z*=n};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.normalize=function(){var n=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);0!=n&&(this.x/=n,this.y/=n,this.z/=n)};this.div=function(n){this.x/=n.x;this.y/=n.y;this.z/=n.z};this.floor=function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z)};this.zero=function(){return 0==this.x+this.y+this.z};this.dot=function(n){return this.x*n.x+this.y*n.y+this.z*n.z};this.cross=function(){throw"Need to reimplement";};this.rotate=function(n){var h=Math.cos(n);n=Math.sin(n);xp=h*this.x-n*this.y;yp=n*this.x+h*this.y;this.x=xp;this.y=yp;return this};this.clone=function(){return new vect(this.x,this.y,this.z)}}vect.scale=function(h,p){return new vect(h.x*p,h.y*p,h.z*p)};
vect.add=function(h,p){return new vect(h.x+p.x,h.y+p.y,h.z+p.z)};vect.sub=function(h,p){if(!h||!p)throw"Bad Vector";return new vect(h.x-p.x,h.y-p.y,h.z-p.z)};vect.dist=function(h,p){var q=p.x-h.x,n=p.y-h.y,s=p.z-h.z;return Math.sqrt(q*q+n*n+s*s)};vect.dir=function(h,p){var q=vect.sub(h,p);q.normalize();return q};vect.dot2d=function(h,p){return h.x*p.x+h.y*p.y};vect.cross=function(h,p){return h.x*p.y-h.y*p.x};
vect.left=function(h,p,q,n){n||(n=0);p=vect.sub(p,h);h=vect.sub(q,h);return vect.cross(p,h)>=-n};vect.intersects=function(h,p,q,n,s){s||(s=0);return vect.left(h,p,q,s)!=vect.left(h,p,n,s)&&vect.left(q,n,p,s)!=vect.left(q,n,h,s)};vect.intersect2dt=function(h,p,q,n){n=h.x*(n.y-q.y)+p.x*(q.y-n.y)+n.x*(p.y-h.y)+q.x*(h.y-p.y);return 0==n?Infinity:-(h.x*(q.y-p.y)+p.x*(h.y-q.y)+q.x*(p.y-h.y))/n};
vect.intersect2dpos=function(h,p,q,n){var s=h.x*(n.y-q.y)+p.x*(q.y-n.y)+n.x*(p.y-h.y)+q.x*(h.y-p.y);if(0==s)return Infinity;q=(h.x*(n.y-q.y)+q.x*(h.y-n.y)+n.x*(q.y-h.y))/s;p=vect.sub(p,h);p.scale(q);return vect.add(h,p)};vect.rotate=function(h,p){var q=Math.cos(p),n=Math.sin(p);xp=q*h.x-n*h.y;yp=n*h.x+q*h.y;return h=new vect(xp,yp,h.z)};
(function(){function h(a,b){for(var e in b)e in a||(a[e]=b[e])}function p(a){var b={};for(key in a)b[key]=a[key];return b}function q(a,b){for(key in b)a[key]=b[key]}function n(a,b,e){return Math.min(Math.max(a,b),e)}function s(a,b,e,c){1>=a&&1>=b&&1>=e&&1>=c?(this.r=a,this.g=b,this.b=e,this.a=c):(this.r=a/255,this.g=b/255,this.b=e/255,this.a=c/255);this.array=[this.r,this.g,this.b,this.a];this.vect=function(){return this.array};this.rgb=function(){return"rgb("+parseInt(255*this.r)+","+parseInt(255*
this.g)+","+parseInt(255*this.b)+")"}}function ua(a,b,e,c){return new s(n(a,0,1),n(b,0,1),n(e,0,1),n(c,0,1))}function W(a){var b=parseInt(a.slice(1,3),16),e=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);return new s(b,e,a,255)}function ja(a,b){return((a.charCodeAt(b)&255)<<24)+((a.charCodeAt(b+1)&255)<<16)+((a.charCodeAt(b+2)&255)<<8)+(a.charCodeAt(b+3)&255)}function H(a,b){return((a.charCodeAt(b+3)&255)<<24)+((a.charCodeAt(b+2)&255)<<16)+((a.charCodeAt(b+1)&255)<<8)+(a.charCodeAt(b)&255)}
function ea(a,b){var e=a.charCodeAt(b)&255,c=a.charCodeAt(b+1)&255,d=a.charCodeAt(b+2)&255,f=a.charCodeAt(b+3)&255,k=a.charCodeAt(b+4)&255,j=a.charCodeAt(b+5)&255,g=a.charCodeAt(b+6)&255,l=a.charCodeAt(b+7)&255,m=1-2*(l>>7),l=((l&127)<<4)+((g&240)>>4)-1023,e=(g&15)*Math.pow(2,48)+j*Math.pow(2,40)+k*Math.pow(2,32)+f*Math.pow(2,24)+d*Math.pow(2,16)+c*Math.pow(2,8)+e;return m*(1+e*Math.pow(2,-52))*Math.pow(2,l)}function fa(a,b){var e=a.charCodeAt(b)&255,c=a.charCodeAt(b+1)&255,d=a.charCodeAt(b+2)&255,
f=a.charCodeAt(b+3)&255,k=1-2*(f>>7),f=((f&127)<<1)+((d&254)>>7)-127,e=(d&127)*Math.pow(2,16)+c*Math.pow(2,8)+e;return k*(1+e*Math.pow(2,-23))*Math.pow(2,f)}function va(a,b,e,c){return[a-e,b+c,a-e,b-c,a+e,b+c,a-e,b-c,a+e,b-c,a+e,b+c]}function x(a,b,e){return 2==arguments.length?[a.x,b.y,a.x,a.y,b.x,b.y,a.x,a.y,b.x,a.y,b.x,b.y]:[a.x,b.y,e,a.x,a.y,e,b.x,b.y,e,a.x,a.y,e,b.x,a.y,e,b.x,b.y,e]}function z(a,b){if(!a)return null;var e=a.createProgram(),c=wa(a,a.VERTEX_SHADER,b+"/vert.glsl"),d=wa(a,a.FRAGMENT_SHADER,
b+"/frag.glsl");a.attachShader(e,c);a.attachShader(e,d);a.linkProgram(e);var f={},c=(c.source+d.source).match(/((uniform)|(attribute)) (\w+) (\w+)/mg),d=0;a.useProgram(e);if(c){for(var k=0;k<c.length;k++){var j=c[k].split(" ");f[j[2]]={u:j[0],type:j[1],loc:null};if("uniform"==j[0])f[j[2]].loc=a.getUniformLocation(e,j[2]);else{var g=a.getAttribLocation(e,j[2]);f[j[2]].loc=g}"sampler2D"==j[1]&&(f[j[2]].tex=d,d++)}e.get=function(a){return f[a].loc};e.data=function(c,d){var b=f[c];if(!b)throw"Could not find shader variable "+
c;if("uniform"==b.u)if("float"==b.type)a.uniform1f(b.loc,d);else if("vec2"==b.type)a.uniform2fv(b.loc,d);else if("ivec2"==b.type)a.uniform2iv(b.loc,d);else if("vec3"==b.type)a.uniform3fv(b.loc,d);else if("ivec3"==b.type)a.uniform3iv(b.loc,d);else if("vec4"==b.type)a.uniform4fv(b.loc,d);else if("ivec4"==b.type)a.uniform4iv(b.loc,d);else if("bool"==b.type)a.uniform1i(b.loc,d);else if("mat4"==b.type)a.uniformMatrix4fv(b.loc,!1,d);else if("mat3"==b.type)a.uniformMatrix3fv(b.loc,!1,d);else if("sampler2D"==
b.type)"texture"in d&&(d=d.texture()),a.activeTexture(a["TEXTURE"+b.tex]),a.bindTexture(a.TEXTURE_2D,d),a.uniform1i(b.loc,b.tex);else if("int"==b.type)a.uniform1i(b.loc,d);else throw"Unsupported Type for Shader Helper: "+b.type;else if("attribute"==b.u)a.enableVertexAttribArray(b.loc),a.bindBuffer(a.ARRAY_BUFFER,d),a.vertexAttribPointer(b.loc,d.itemSize,a.FLOAT,!1,0,0);else throw"Type: "+b.u+" Recieved";}}return e}function wa(a,b,e){var c=a.createShader(b);$.ajax({async:!1,url:e,dataType:"text",success:function(d){a.shaderSource(c,
d);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw a.getShaderInfoLog(c);c.source=d},error:function(){console.log("Could not load "+e)}});return c}function I(a,b,e){var c=a.createBuffer(),d=new Float32Array(b);a.bindBuffer(a.ARRAY_BUFFER,c);c.itemSize=e;c.numItems=b.length/e;a.bufferData(a.ARRAY_BUFFER,d,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return c}function ka(a,b,e){if(!a)return null;var c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);var d=new Float32Array(b*
e);c.itemSize=e;c.numItems=b;c.update=function(d,b){var e=new Float32Array(d);a.bindBuffer(a.ARRAY_BUFFER,c);a.bufferSubData(a.ARRAY_BUFFER,4*b,e);a.bindBuffer(a.ARRAY_BUFFER,null)};a.bufferData(a.ARRAY_BUFFER,d,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return c}function X(a,b,e){var c=a.createTexture();c.id=xa;xa++;var d=new Image;d.onload=function(){a.bindTexture(a.TEXTURE_2D,c);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);e&&e()};d.src=b;return c}function la(a,b){var e=p(b);h(e,{mag_filter:a.LINEAR,min_filter:a.LINEAR,wrap_s:a.CLAMP_TO_EDGE,wrap_t:a.CLAMP_TO_EDGE,mipmap:!1});var c=a.createTexture(),d=null;this.image=function(b){d=b;a.bindTexture(a.TEXTURE_2D,c);a.texImage2D(a.TEXTURE_2D,0,
a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e.mag_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e.min_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e.wrap_s);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e.wrap_t);e.mipmap&&a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null)};this.texture=function(){return d?c:null}}function Na(a,b){b||(b={});"center"in b||(b.center=new vect(0,0));"extents"in b||(b.extents=180);this.mat3=new Float32Array(9);
var e=a.width()/a.height();this.mat3[0]=2/b.extents;this.mat3[4]=2*e/b.extents;this.mat3[8]=1;this.mat3[6]=0;this.mat3[7]=0;this.level=1;this.project=function(c){c=new vect(2*(c.x-a.offset().left)/a.width()-1,-(2*(c.y-a.offset().top)/a.height()-1));c.x=c.x/this.mat3[0]-this.mat3[6]/this.mat3[0];c.y=c.y/this.mat3[4]-this.mat3[7]/this.mat3[4];return c};this.screen=function(c){c=new vect(c.x*this.mat3[0]+this.mat3[6],c.y*this.mat3[4]+this.mat3[7]);c.x=a.offset().left+a.width()*(c.x+1)/2;c.y=a.offset().top+
a.height()*(-c.y+1)/2;return c};this.percent=function(c){return new vect(2*((c.x-a.offset().left)/a.width())-1,-(2*((c.y-a.offset().top)/a.height())-1))};this.pixel=function(c){return new vect(a.offset().left+(c.x+1)/2*a.width(),a.offset().top+(-c.y+1)/2*a.height())};this.move=function(a){this.mat3[6]-=a.x*this.mat3[0];this.mat3[7]-=a.y*this.mat3[4]};this.position=function(a){if(!a)return new vect(-this.mat3[6]/this.mat3[0],-this.mat3[7]/this.mat3[4]);this.mat3[6]=-a.x*this.mat3[0];this.mat3[7]=-a.y*
this.mat3[4]};this.position(b.center);this.extents=function(a){b.extents=a;a=this.position();this.level=1;this.mat3[0]=2/b.extents;this.mat3[4]=2*e/b.extents;this.position(a)};this.zoom=function(a){var d=new vect(this.mat3[6]/this.mat3[0],this.mat3[7]/this.mat3[4]);this.mat3[0]*=a;this.mat3[4]*=a;this.mat3[6]=d.x*this.mat3[0];this.mat3[7]=d.y*this.mat3[4];this.level*=a};this.reset=function(){this.zoom(1/this.level)};this.reconfigure=function(){var c=this.position();this.mat3[4]/=e;e=a.width()/a.height();
this.mat3[4]*=e;this.position(c)}}function Oa(a){var b=!1,e=new vect(0,0),c=new vect(0,0),d=null,f=0;a.canvas.mousedown(function(a){e=new vect(a.clientX,a.clientY);b=!0});$(window).bind("mouseup",function(){b=!1});$(document).bind("keypress","+",function(){a.camera.zoom(1.1)});$(document).bind("keypress","-",function(){a.camera.zoom(10/11)});$(document).bind("keypress","0",function(){a.camera.reset()});a.canvas.bind("mousewheel",function(d,c){c*=0.5;0>c?(c=-1*c+1,c=1/c):c+=1;a.camera.zoom(c);d.preventDefault()});
var k=!0;this.disable=function(){k=!1};this.enable=function(){k=!0};this.update=function(j){c=new vect(R.x,R.y);if(b&&k){var g=vect.sub(a.camera.project(e),a.camera.project(c));a.camera.move(g);e=c;f=g.length()/j;d=g;d.normalize()}else 0.01<f&&d&&(a.camera.move(vect.scale(d,f*j)),f-=3*j*f)}}function Pa(a,b,e){e||(e={});h(e,{base:"default",background:new s(0,0,0,1),antialias:!0});var c=this;this.canvas=$("<canvas></canvas>").attr("id","viewer");a?($(a).append(this.canvas),this.canvas.attr("width",
$(a).width()),this.canvas.attr("height",$(a).height())):(a=window,$("body").append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height()),$(window).resize(function(){c.resize()}));this.resize=function(){c.canvas.attr("width",$(a).width());c.canvas.attr("height",$(a).height());d.viewport(0,0,c.canvas.width(),c.canvas.height());c.camera.reconfigure();for(var b=0;b<m.length;b++)m[b].resize()};var d;b=this.canvas;this.gl=d=gl=Qa?WebGLDebugUtils.makeDebugContext(b.get(0).getContext("experimental-webgl",
{alpha:!1,antialias:!0,premultipliedAlpha:!1}),function(a,c){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to "+c;}):b.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1});d.viewport(0,0,c.canvas.width(),c.canvas.height());d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.enable(d.BLEND);v||(v=z(d,w+"shaders/blur"));ya||(ya=z(d,w+"shaders/light"));var f=new J(d,6);f.create("vert",2);f.create("tex",2);b=f.alloc(6);f.write("vert",x(new vect(-1,-1),new vect(1,
1)),b,6);f.write("tex",x(new vect(0,0),new vect(1,1)),b,6);f.update();this.scene=[];this.camera=new Na(this.canvas,e);this.scroller=new Oa(this);this.pxW=1/this.canvas.attr("width");this.pxH=1/this.canvas.attr("height");this.sel=new Ra(this);this.select=function(a){a?(this.scroller.disable(),this.sel.enable()):(this.scroller.enable(),this.sel.disable())};var k=(new Date).getTime(),j=[];this.attr=function(a,c){"base"==a&&(e.base=c,l())};var g=null,l=function(){if("default"==e.base||"nasa"==e.base){var a=
p(e);q(a,{source:"file",url:ma+"/tiles/nasa_topo_bathy",levels:8,size:256});g=new ga(a)}else"ne"==e.base?(a=p(e),q(a,{source:"file",url:ma+"/tiles/NE1_HR_LC_SR_W_DR",levels:6,size:256}),g=new ga(a)):"ne1"==e.base?(a=p(e),q(a,{source:"file",url:ma+"/tiles/NE1_HR_LC",levels:6,size:256}),g=new ga(a)):g=null;g&&g.initialize(c)};l();this.enable_z=function(){d.depthFunc(d.LEQUAL);d.enable(d.DEPTH_TEST)};this.disable_z=function(){d.disable(d.DEPTH_TEST)};var m=[],r=[null];this.framebuffer=function(){var a=
d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,a);a.width=c.canvas.width();a.height=c.canvas.height();var b=d.createTexture();d.bindTexture(d.TEXTURE_2D,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,a.width,a.height,0,d.RGBA,d.UNSIGNED_BYTE,null);var e=d.createRenderbuffer();
d.bindRenderbuffer(d.RENDERBUFFER,e);d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,a.width,a.height);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,b,0);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,e);d.bindTexture(d.TEXTURE_2D,null);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null);var f={framebuffer:a,renderbuffer:e,tex:b,resize:function(){a.width=c.canvas.width();a.height=c.canvas.height();d.bindTexture(d.TEXTURE_2D,
b);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,a.width,a.height,0,d.RGBA,d.UNSIGNED_BYTE,null);d.bindRenderbuffer(d.RENDERBUFFER,e);d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,a.width,a.height);d.bindTexture(d.TEXTURE_2D,null);d.bindRenderbuffer(d.RENDERBUFFER,null)},activate:function(b){b||(b={});h(b,{blend:!0,clear:!0});r.push(a);b.blend||d.disable(d.BLEND);d.bindFramebuffer(d.FRAMEBUFFER,a);d.viewport(0,0,c.canvas.width(),c.canvas.height());b.clear&&(d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),
d.clearDepth(0))},deactivate:function(){var c=r.pop(),b=r[r.length-1];if(c!=a)throw"Non-nested use of framebuffers";d.bindFramebuffer(d.FRAMEBUFFER,b);d.enable(d.BLEND)}};m.push(f);return f};var n=this.framebuffer(),na=this.framebuffer();this.draw_blur=function(a){d.useProgram(v);na.activate({blend:!1});v.data("pos",f.get("vert"));v.data("tex_in",f.get("tex"));v.data("sampler",a);v.data("width",c.canvas.width());v.data("height",c.canvas.height());v.data("hor",!0);d.drawArrays(d.TRIANGLES,0,f.count());
na.deactivate();v.data("pos",f.get("vert"));v.data("tex_in",f.get("tex"));v.data("sampler",na.tex);v.data("width",c.canvas.width());v.data("height",c.canvas.height());v.data("hor",!1);d.drawArrays(d.TRIANGLES,0,f.count())};this.dirty=!0;var za=function(){var a=(new Date).getTime(),b=(a-k)/1E3;c.scroller.update(b);60<=j.length&&j.splice(0,1);j.push(b);for(var f=0,l=0;l<j.length;l++)f+=j[l];f/=j.length;$("#fps").text(Math.floor(1/f));k=a;d.clearColor(e.background.r,e.background.g,e.background.b,e.background.a);
d.clear(d.COLOR_BUFFER_BIT);d.clearDepth(0);a=!1;c.shade&&(a=c.shade.ready());a&&n.activate();g&&g.draw(c,b);for(l=0;l<c.scene.length;l++)c.scene[l].draw(c,b,!1);c.sel.draw(c,b);requestAnimationFrame(za)};this.read_pixel=function(a,b){d.bindFramebuffer(d.FRAMEBUFFER,c.framebuffer);var e=new Uint8Array(4),f=(a-c.canvas.position().left)/c.canvas.width(),g=(c.canvas.position().top+c.canvas.height()-b)/c.canvas.height();d.readPixels(parseInt(f*c.framebuffer.width),parseInt(g*c.framebuffer.height),1,1,
d.RGBA,d.UNSIGNED_BYTE,e);d.bindFramebuffer(d.FRAMEBUFFER,null);return e};$(document).mousemove(function(a){R.x=a.clientX;R.y=a.clientY});this.canvas.click(function(){});this.canvas.dblclick(function(){});var u=!1;this.canvas.mousedown(function(){u=!0});this.canvas.mouseup(function(){u=!1});this.canvas.mousemove(function(){if(!u){var a=c.camera.project(new vect(R.x,R.y));$.each(c.scene,function(d,b){b.update_move&&b.update_move(c,a)})}});this.canvas.mouseout(function(){$.each(c.scene,function(a,d){d.force_out&&
d.force_out(c)})});requestAnimationFrame(za)}function J(a,b){var e={},c;c=b?b:256;var d=0,f=function(a,c,d,b){a||console.log("ack");d||(d=0);b||(b=c.length);for(var e=0;e<b;e++)a[d+e]=c[e]};this.create=function(d,b){if(!b)throw"Length of buffer must be a positive integer";var f=new Float32Array(c*b),l=ka(a,c,b);e[d]={array:f,buffer:l,len:b,dirty:!1}};this.alloc=function(b){if(d+b>=c){for(var j=c;j<d+b;)j*=2;c=j;for(name in e){var g=new Float32Array(j*e[name].len),l=e[name].array,m=ka(a,c,e[name].len);
f(g,l);e[name].array=g;e[name].buffer=m;e[name].dirty=!0}}j=d;d+=b;return j};this.get=function(a){return e[a].buffer};this.write=function(a,c,d,b){f(e[a].array,c,d*e[a].len,b*e[a].len);e[a].dirty=!0};this.repeat=function(a,c,d,b){for(var m=0;m<b;m++)f(e[a].array,c,(d+m)*e[a].len,e[a].len);e[a].dirty=!0};this.count=function(){return d};this.data=function(a){return e[a].array};this.update=function(){for(name in e)e[name].dirty&&(e[name].buffer&&e[name].buffer.update(e[name].array,0),e[name].dirty=!1)}}
function Ra(a){aa||(aa=z(a.gl,w+"shaders/selbox"));var b=!1,e=!1,c=null,d=null,f=ka(a.gl,6,2),k=I(a.gl,va(0,0,1,1),2);a.canvas.bind("mousedown",function(g){b&&(show=e=!0,d=c=a.camera.percent(new vect(g.clientX,g.clientY)),f.update(x(c,d),0))});var j=function(){};this.select=function(a){j=a};$(document).bind("mouseup",function(){if(b&&e){var f=a.camera.project(a.camera.pixel(c)),l=a.camera.project(a.camera.pixel(d));if(f.x>l.x){var k=f.x;f.x=l.x;l.x=k}f.y>l.y&&(k=f.y,f.y=l.y,l.y=k);e=!1;j(new ba(f,
l))}});$(document).bind("click",function(){b&&(show=!1)});$(document).bind("mousemove",function(g){b&&e&&(d=a.camera.percent(new vect(g.clientX,g.clientY)),f.update(x(c,d),0))});this.enable=function(){b=!0};this.disable=function(){b=!1};this.draw=function(){e&&(gl.useProgram(aa),aa.data("pos",f),aa.data("edge_in",k),gl.drawArrays(gl.TRIANGLES,0,f.numItems))}}function Aa(a,b){for(;a>=b;)a-=b;for(;0>a;)a+=b;return a}function Sa(a,b,e,c){this.current=a;this.upper=b;this.lower=e;this.index=c}function Ba(a,
b){for(var e=0;e<a.length;e++)if(a[e]==b)return!0;return!1}function ia(a,b,e){if(void 0==b)throw"whoa";return 0==a[b+1].y-a[b].y?Math.min(a[b].x,a[b+1].x):a[b].x+(a[b+1].x-a[b].x)*((e-a[b].y)/(a[b+1].y-a[b].y))}function S(a,b){for(var e=0;e<a.length;e++)if(a[e]==b)return e;return!1}function C(a,b,e){return new vect(ia(b,e,b[a].y),b[a].y)}function K(a,b){if(!b)throw"eek";a.push(b.x);a.push(b.y)}function T(a,b,e){if(!b||!e||3!=e.length+b.length&&4!=e.length+b.length)throw"ahh";if(3==b.length+e.length){for(var c=
0;c<b.length;c++)K(a,b[c]);for(c=0;c<e.length;c++)K(a,e[c])}else b[1].x<b[0].x&&(c=b[0],b[0]=b[1],b[1]=c),e[1].x<e[0].x&&(c=e[0],e[0]=e[1],e[1]=c),K(a,b[0]),K(a,b[1]),K(a,e[1]),K(a,e[0]),K(a,e[1]),K(a,b[0])}function Ta(a){for(var b=[],e=0,c=[],d=0;d<a.length;d++){for(var f=0;f<a[d].length-1;f++){var k=Aa(f+1,a[d].length-1),j=Aa(f-1,a[d].length-1);b.push(new Sa(f+e,k+e,j+e,d));c.push(a[d][f])}c.push(a[d][0]);e+=a[d].length}b.sort(function(a,d){return c[a.current].y-c[d.current].y});a=[];d=[];new vect(-200,
0);new vect(200,0);e=0;e=[];j=[];for(f=0;f<b.length;f++){var g=b[f],k=Ba(a,g.lower),l=Ba(a,g.current),m,r;if(k&&!l)r=m=S(a,g.lower);else if(l&&!k)m=r=S(a,g.current);else if(k&&l)m=S(a,g.lower),r=S(a,g.current);else if(!k&&!l){a:{m=a;r=c;for(var n=c[g.current].x,h=c[g.current].y,p=0;p<m.length;p++){var u=ia(r,m[p],h);if(u>n||0==u-n&&r[m[p]].y>r[index].y){r=p;break a}}r=m.length}m=r}if(1<Math.abs(m-r)){for(k=0;k<a.length;k++);throw"Bad";}n=vect.left(c[g.lower],c[g.current],c[g.upper]);h=Math.floor(Math.min(m,
r)/2);!n&&!k&&!l?(T(j,d[h],[C(g.current,c,a[r-1]),C(g.current,c,a[r])]),d.splice(h,1,[C(g.current,c,a[r-1]),c[g.current]],[c[g.current],C(g.current,c,a[m])])):n&&!k&&!l?d.splice(h,0,[c[g.current]]):k&&!l?(T(j,d[h],[C(g.current,c,a[Math.max(m,r)-1]),c[g.current]]),d[h]=[C(g.current,c,a[Math.min(m,r)-1]),c[g.current]]):!k&&l?(T(j,d[h],[c[g.current],C(g.current,c,a[Math.min(r,m)+1])]),d[h]=[c[g.current],C(g.current,c,a[Math.max(r,m)+1])]):!n&&k&&l?(T(j,d[h],[C(g.current,c,a[Math.min(m,r)-1]),c[g.current]]),
T(j,d[h+1],[C(g.current,c,a[Math.max(m,r)+1]),c[g.current]]),d.splice(h,2,[C(g.current,c,a[Math.min(m,r)-1]),C(g.current,c,a[Math.max(m,r)+1])])):n&&(k&&l)&&(T(j,d[h],[c[g.current]]),d.splice(h,1));k&&!l?a[m]=g.current:l&&!k?a[r]=g.lower:k&&l?(a.splice(S(a,g.lower),1),a.splice(S(a,g.current),1)):!k&&!l&&(n?a.splice(m,0,g.lower,g.current):a.splice(m,0,g.current,g.lower));for(k=0;k<a.length-1;k++)if(ia(c,a[k],c[g.current].y)>ia(c,a[k+1],c[g.current].y))throw console.log("Misplaced Sweep"),"Misplace!";
}if(0<a.length)throw console.log(a),"Bad "+a.length;if(0<e.length)throw console.log(e),"Wrong";return j}function ba(a,b){this.min=a.clone();this.max=b.clone();this.contains=function(e){return a.x<=e.x&&b.x>=e.x&&a.y<=e.y&&b.y>=e.y};this.x_in=function(e){return a.x<=e.x&&b.x>=e.x};this.x_left=function(b){return a.x>=b.x};this.x_right=function(a){return b.x<=a.x};this.y_in=function(e){return a.y<=e.y&&b.y>=e.y};this.y_left=function(b){return a.y>=b.y};this.y_right=function(a){return b.y<=a.y};this.area=
function(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)};this.height=function(){return this.max.y-this.min.y};this.width=function(){return this.max.x-this.min.x};this.vertex=function(a){switch(a){case 0:return this.min.clone();case 1:return new vect(this.max.x,this.min.y);case 2:return this.max.clone();case 3:return new vect(this.min.x,this.max.y);default:throw"Index out of bounds: "+a;}};this.intersects=function(a){for(var c=0;4>c;c++)for(var d=0;4>d;d++)if(vect.intersects(this.vertex(c),
this.vertex((c+1)%4),a.vertex(d),a.vertex((d+1)%4)))return!0;return this.contains(a.min)&&this.contains(a.max)&&this.contains(new vect(a.min.x,a.max.y))&&this.contains(new vect(a.max.x,a.min.y))||a.contains(this.min)&&a.contains(this.max)&&a.contains(new vect(this.min.x,this.max.y))&&a.contains(new vect(this.max.x,this.min.y))?!0:!1};this.union=function(a){this.min.x=Math.min(this.min.x,a.min.x);this.min.y=Math.min(this.min.y,a.min.y);this.max.x=Math.max(this.max.x,a.max.x);this.max.y=Math.max(this.max.y,
a.max.y)};this.centroid=function(){return new vect((this.max.x+this.min.x)/2,(this.max.y+this.min.y)/2)};this.clone=function(){return new ba(a,b)}}function oa(a,b,e,c){this.data=a[c];this.right=this.left=null;b!=c&&(this.left=new oa(a,b,c-1,parseInt((b+(c-1))/2)));e!=c&&(this.right=new oa(a,c+1,e,parseInt((e+(c+1))/2)));this.subtree=[];for(c=b;c<=e;c++)this.subtree.push(a[c]);this.subtree.sort(function(a,c){return a.y-c.y});this.yrange=function(a,c,b){return a.y_in(this.subtree[c])&&a.y_in(this.subtree[b])};
this.subquery=function(a,c,b,e,g){if(this.yrange(c,b,e))for(c=b;c<=e;c++)a.push(this.subtree[c]);else c.y_in(this.subtree[g])&&a.push(this.subtree[g]),c.y_left(this.subtree[g])?g!=e&&this.subquery(a,c,g+1,e,parseInt((e+(g+1))/2)):(c.x_right(this.subtree[g])||g!=e&&this.subquery(a,c,g+1,e,parseInt((e+(g+1))/2)),g!=b&&this.subquery(a,c,b,g-1,parseInt((b+(g-1))/2)))};this.search=function(c,f){f.x_in(a[b])&&f.x_in(a[e])?this.subquery(c,f,0,this.subtree.length-1,parseInt((this.subtree.length-1)/2)):(f.contains(this.data)&&
c.push(this.data),f.x_left(this.data)?this.right&&this.right.search(c,f):f.x_right(this.data)?this.left&&this.left.search(c,f):(this.left&&this.left.search(c,f),this.right&&this.right.search(c,f)))}}function Ca(a){a.sort(function(a,e){return a.x-e.x});this.root=new oa(a,0,a.length-1,parseInt((a.length-1)/2));this.search=function(a,e){var c=new ba(a,e),d=[];this.root.search(d,c);return d}}function Ua(){var a={};this.style=function(b,e){if(2>arguments.length)return a[b];a[b]=e};this.bounds=function(){};
this.features=function(){};this.search=function(){};this.contains=function(){};this.append=function(){};this.style=function(){};this.mouseover=function(){};this.mouseout=function(){};this.update_move=function(){};this.force_out=function(){};this.initialize=function(b){new Va(b,a);for(var e in features)features[key].initialize()};this.draw=function(){throw"Layer has not yet been initialized";}}function Va(a){y||(y=z(a.gl,w+"shaders/point"));a=new J(initial_points);a.create("vert",2);a.create("unit",
2);a.create("color",3);a.create("alpha",1);new s(0.02,0.44,0.69,1);var b=function(){this.update=function(){};this.update_all=function(){}};this.create=function(a,c){return new b(a,c)};this.draw=function(){}}function Da(a){y||(y=z(w+"shaders/point"),Ea=X(w+"images/circle.png"));this.id=M();var b=new J(a);b.create("vert",2);b.create("unit",2);b.create("color",3);b.create("alpha",1);var e=this,c=function(a){a||(a={});a.geom||(a.geom=[]);a.attr||(a.attr={});a.style||(a.style={});this.geom=a.geom;this.attr=
a.attr;this.id=M();var c=new vect(a.geom[0][0],a.geom[0][1]);this.bounds=new ba(c.clone(),c.clone());var d,f,c=0,g={};F(g,a.style,"fill",W);F(g,a.style,"opacity",parseFloat);var j=function(){var a=g.fill;a||(a=e.style("fill"));a||(a=Wa);b.repeat("color",a.array,d,f)},k=function(){var a=g.opacity;a||(a=e.style("opacity"));a||(a=Xa);b.repeat("alpha",[a],d,f)};this.style=function(a,c){if(1==arguments.length)return g[a];g[a]=c;"fill"==a&&j();"opacity"==a&&k()};c=this.geom.length;f=6*c;d=b.alloc(f);$.each(this.geom,
function(a,c){b.repeat("vert",c,d+6*a,6);b.write("unit",Ya,d+6*a,6)});j();k()},d=null,f=0,k=!1,j={},g={};this.bounds=null;this.append=function(a){a=new c(a);for(key in a.attr)j[key]=!0;g[a.id]=a;f++;k=!0;d=null;this.bounds?this.bounds.union(a.bounds):this.bounds=a.bounds.clone();return a};this.features=function(){var a=[];for(key in g)a.push(g[key]);return new G(a)};this.attr=function(){var a=[];for(key in j)a.push(key);return a};this.search=function(a){a=d.search(a.min,a.max);var c=[];$.each(a,function(a,
b){c.push(g[b.key])});return new G(c)};this.mouseover=function(){};this.mouseout=function(){};this.click=function(){};this.style=function(a,c){if(1<arguments.length)throw"Not Implemented";return null};this.update_move=function(){};this.draw=function(a,c,e){b.update(c);if(0<f){if(k){if(!d){var j=[],h;for(h in g)$.each(g[h].geom,function(a,c){j.push({key:h,x:c[0],y:c[1]})});d=new Ca(j)}k=!1}gl.useProgram(y);y.data("screen",a.camera.mat3);y.data("pos",b.get("vert"));y.data("circle_in",b.get("unit"));
e||(y.data("color_in",b.get("color")),y.data("alpha_in",b.get("alpha")),y.data("select",e),y.data("aspect",a.canvas.width()/a.canvas.height()),y.data("pix_w",2/a.canvas.width()),y.data("rad",5),y.data("glyph",Ea),y.data("zoom",1/a.camera.level),gl.drawArrays(gl.TRIANGLES,0,b.count()))}}}function Fa(a){function b(a){a||(a={});a.geom||(a.geom=[]);a.attr||(a.attr={});a.style||(a.style={});this.geom=a.geom;this.attr=a.attr;this.id=M();var c,b,d,e=0,f=function(){var a;a="fill"in h?h.fill:l.style("fill");
j.repeat("color",a.array,c,b);a="stroke"in h?h.stroke:l.style("stroke");g.repeat("color",a.array,d,e)},k=function(){var a;a="fill-opacity"in h?h["fill-opacity"]:l.style("fill-opacity");j.repeat("alpha",[a],c,b);a="stroke-opacity"in h?h["stroke-opacity"]:l.style("stroke-opacity");g.repeat("alpha",[a],d,e)},m=new vect(Infinity,Infinity),r=new vect(-Infinity,-Infinity);$.each(this.geom,function(a,c){$.each(c,function(a,c){$.each(c,function(a,c){c[0]<m.x&&(m.x=c[0]);c[0]>r.x&&(r.x=c[0]);c[1]<m.y&&(m.y=
c[1]);c[1]>r.y&&(r.y=c[1])})})});this.bounds=new ba(m,r);this.initialize=function(){var a=[];b=0;$.each(this.geom,function(c,d){for(var e,f=0;100>f;)try{for(var g=d,j=[],k=0;k<g.length;k++){for(var l=[],m=1;m<g[k].length;m++)l.push(Ga(g[k][m][0],g[k][m][1]));l.push(j[0]);j.push(l)}e=Ta(j);break}catch(Y){f++}if(100==f)throw"Rendering Polygon Failed";b+=e.length/2;a.push(e)});var l=c=j.alloc(b);$.each(a,function(a,c){var b=c.length/2;j.write("vert",c,l,b);l+=b});d=g.count();$.each(this.geom,function(a,
c){for(a=0;a<c.length;a++)e+=6*c[a].length,Ha(g,c[a])});f();k()};var h={};F(h,a.style,"fill",W);F(h,a.style,"stroke",W);F(h,a.style,"fill-opacity",parseFloat);F(h,a.style,"stroke-opacity",parseFloat);this.style=function(a,c){if(1==arguments.length)return h[a];h[a]=c;"fill"==a&&f();"stroke"==a&&f();"fill-opacity"==a&&k();"stroke-opacity"==a&&k()}}a||(a={});a.style||(a.style={});var e,c,d,f;e="fill"in a.style?a.style.fill:new s(0.02,0.44,0.69,1);c="stroke"in a.style?a.style.stroke:new s(0.02,0.44,0.69,
1);d="fill-opacity"in a.style?a.style["fill-opacity"]:0.5;f="stroke-opacity"in a.style?a.style["stroke-opacity"]:1;var k=!1;this.id=M();var j,g,l=this,m={},r=0,h=null;this.features=function(){var a=[];for(key in m)a.push(m[key]);return new G(a)};this.search=function(a){a=h.search(a.min,a.max);var c={};$.each(a,function(a,b){c[b.key]=!0});a=[];for(var b in c)a.push(m[b]);return new G(a)};this.contains=function(a){var c=0,b=[],d;for(d in m){var e=m[d];if(e.bounds.contains(a)){c++;for(var f=0;f<e.geom.length;f++){var g=
0;$.each(e.geom[f],function(c,b){for(var d=0;d<b.length;d++){var e=(d+1)%b.length;if(0>(a.y-b[d][1])/(a.y-b[e][1])){var f=new vect(720,a.y),j=new vect(b[d][0],b[d][1]),e=new vect(b[e][0],b[e][1]);vect.intersects(a,f,j,e)&&g++}}});1==g%2&&b.push(e)}}}return new G(b)};this.aggregate=function(a,c){a.features().each(function(a,b){$.each(b.geom,function(a,d){var e=l.contains(new vect(d[0],d[1]));e&&c(e,b)})})};this.bounds=null;var n=!1;this.append=function(a){a=new b(a);this.bounds?this.bounds.union(a.bounds):
this.bounds=a.bounds.clone();m[a.id]=a;r++;n=!0;h=null;k&&a.initialize()};this.style=function(a,b){if(1<arguments.length)throw"Not Implemented";return"fill"==a?e:"stroke"==a?c:"fill-opacity"==a?d:"stroke-opacity"==a?f:null};var p=null,u=null;this.mouseover=function(a){p=a};this.mouseout=function(a){u=a};var E={};this.update_move=function(a,c){if(p||u){var b=this.contains(c),d={};b&&b.each(function(a,c){d[c.id]=c});for(var e in E)!(e in d)&&u&&u(E[e]);for(e in d)!(e in E)&&p&&p(d[e]);E=d}};this.force_out=
function(){for(var a in E)u&&u(E[a]);E={}};this.initialize=function(a){N||(N=z(a.gl,w+"shaders/poly"));t||(t=z(a.gl,w+"shaders/line"));j=new J(a.gl,1024);j.create("vert",2);j.create("color",3);j.create("alpha",1);g=new J(a.gl,1024);g.create("vert",2);g.create("norm",2);g.create("color",3);g.create("alpha",1);for(var c in m)m[c].initialize();k=!0};this.draw=function(a,c,b){if(!b){b=a.gl;j.update(c);g.update(c);if(n){var d=[],e;for(e in m)$.each(m[e].geom,function(a,c){$.each(c,function(a,c){$.each(c,
function(a,c){d.push({key:e,x:c[0],y:c[1]})})})});h=new Ca(d);n=!1}b.useProgram(N);N.data("screen",a.camera.mat3);N.data("pos",j.get("vert"));N.data("color_in",j.get("color"));N.data("alpha_in",j.get("alpha"));b.drawArrays(b.TRIANGLES,0,j.count());b.useProgram(t);t.data("screen",a.camera.mat3);t.data("pos",g.get("vert"));t.data("norm",g.get("norm"));t.data("color_in",g.get("color"));t.data("alpha_in",g.get("alpha"));t.data("px_w",2/a.canvas.width());t.data("px_h",2/a.canvas.height());b.drawArrays(b.TRIANGLES,
0,g.count())}}}function Ha(a,b){for(var e=a.alloc(6*b.length),c=0,d=function(){if(b[c]){var a=new vect(b[c][0],b[c][1]);c++;return a}return null},f=[],k=[],j=function(a,c,b,d){d?(a[b]=-c.x,a[b+1]=-c.y):(a[b]=c.x,a[b+1]=c.y)},g=function(a,c,b,d){j(a,c,0,!1);j(a,b,2,!1);j(a,c,4,d);j(a,b,6,d);j(a,c,8,d);j(a,b,10,!1)},l=d(),m=d(),h=d(),n=vect.dir(m,l).rotate(pa/2),p,q=e;m;)p=h?vect.dir(h,l).rotate(pa/2):vect.dir(m,l).rotate(pa/2),g(f,l,m,!1),g(k,n,p,!0),a.write("vert",f,q,6),a.write("norm",k,q,6),q+=
6,l=m,m=h,h=d(),n=p;return e}function qa(a){D||(D=z(w+"shaders/grid"));a||(a={});a.style||(a.style={});var b=a.lower,e=a.upper,c=a.rows,d=a.cols,f=(e.x-b.x)/d,k=(e.y-b.y)/c,j=new Float32Array(c*d),g=new Uint8Array(4*d*c),l=!1,m=new J(6);m.create("vert",2);m.create("screen",2);m.create("tex",2);var h=new vect(b.x,b.y),n=new vect(e.x,e.y),p=new vect(0,0),q=new vect(1,1),u=m.alloc(6);m.write("vert",x(h,n),u,6);m.write("screen",x(new vect(-1,-1),new vect(1,1)),u,6);m.write("tex",x(p,q),u,6);var E=gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D,E);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindTexture(gl.TEXTURE_2D,null);this.lower=function(){return b.clone()};this.upper=function(){return e.clone()};this.rows=function(){return c};this.cols=function(){return d};this.centroid=function(a,c){return new vect(b.x+
f*c+f/2,b.y+k*a+k/2)};this.get=function(a,c){return j[d*a+c]};var Y=-Infinity,ha=Infinity;this.qunatiles=function(a,c){c||(c=function(a,c){return a-c});for(var b=[],d=0;d<j.length;d++)b.push(j[d]);b.sort(c);for(var e=[-Infinity],d=1;d<a;d++){var f=parseInt(inc*d);e.push(b[f])}e.push(Infinity);return e};this.set=function(a,b,e){if(a>=c||b>=d)throw"Index Out of Bounds";j[d*a+b]=e;l=!0};this.raw_set=function(a,b){if(a>=c*d)throw"Index Out of Bounds: "+a;j[a]=b;l=!0};this.clear=function(a){for(var b=
0;b<c*d;b++)j[b]=a};var Z=null;this.draw=function(b){Z||(Z=b.framebuffer());m.update();if(l){Y=-Infinity;ha=Infinity;for(var e=0;e<c*d;e++){var f=j[e];f>Y&&(Y=f);f<ha&&(ha=f)}for(e=0;e<c*d;e++){var f=e,k=a.map(ha,Y,j[e]);g[4*f]=parseInt(255*k.r);g[4*f+1]=parseInt(255*k.g);g[4*f+2]=parseInt(255*k.b);g[4*f+3]=parseInt(255*k.a)}gl.bindTexture(gl.TEXTURE_2D,E);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,d,c,0,gl.RGBA,gl.UNSIGNED_BYTE,g);gl.bindTexture(gl.TEXTURE_2D,null);l=!1}a.style.antialias&&Z.activate({blend:!1});
gl.useProgram(D);D.data("screen",b.camera.mat3);D.data("pos",m.get("vert"));D.data("tex_in",m.get("tex"));D.data("sampler",E);e=vect.sub(b.camera.screen(n),b.camera.screen(h));D.data("width",e.x);D.data("height",-e.y);D.data("rows",c);D.data("cols",d);D.data("blur",a.blur);gl.drawArrays(gl.TRIANGLES,0,m.count());a.style.antialias&&(Z.deactivate(),b.draw_blur(Z.tex))}}function Za(a,b,e){O||(O=z(w+"shaders/raster"));this.image=X(a);var c=I(x(new vect(0,1),new vect(1,0)),2),d=I(x(b,e),2);this.draw=function(a,
b,e){e||(gl.useProgram(O),O.data("screen",a.camera.mat3),O.data("pos",d),O.data("tex_in",c),O.data("sampler",this.image),gl.drawArrays(gl.TRIANGLES,0,d.numItems))}}function ra(a){A||(A=z(w+"shaders/hillshade"));var b=$(a).find("LatLonBox"),e=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),c=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var d=!1,f=X(a,function(){d=!0});this.ready=function(){return d};
var k=I(x(new vect(0,1),new vect(1,0)),2),j=I(x(e,c),2),g=315;this.draw=function(a){if(d){for(gl.useProgram(altitude_shader);1<=g;)g-=1;altitude_shader.data("azimuth",g);altitude_shader.data("altitude",Math.PI/4/(2*Math.PI));altitude_shader.data("screen",a.camera.mat3);altitude_shader.data("pos",j);altitude_shader.data("tex_in",k);altitude_shader.data("elevation",f);a=vect.sub(a.camera.screen(c),a.camera.screen(e));altitude_shader.data("pix_w",1/a.x);altitude_shader.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,
0,j.numItems);return g}}}function ra(a){A||(A=z(w+"shaders/hillshade"));var b=$(a).find("LatLonBox"),e=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),c=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var d=!1,f=X(a,function(){d=!0});this.ready=function(){return d};var k=I(x(new vect(0,1),new vect(1,0)),2),j=I(x(e,c),2),g=315;this.draw=function(a){if(d){for(gl.useProgram(A);1<=g;)g-=1;A.data("azimuth",
g);A.data("altitude",Math.PI/4/(2*Math.PI));A.data("screen",a.camera.mat3);A.data("pos",j);A.data("tex_in",k);A.data("elevation",f);a=vect.sub(a.camera.screen(c),a.camera.screen(e));A.data("pix_w",1/a.x);A.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,j.numItems);return g}}}function ga(a){for(var b=[],e=[],c=0;c<a.levels;c++){var d=p(a);"file"==d.source&&(d.url+="/"+a.size*Math.pow(2,c+1));d.min=new vect(-180,-90);d.rows=Math.pow(2,c);d.cols=2*d.rows;d.cellsize=180/d.rows;d.z_index=1-sa-c/1E3;
d.available=e;d=new $a(d);b.push(d)}sa+=(a.levels+2)/1E3;var f=null;this.initialize=function(a){B||(B=z(a.gl,w+"shaders/tile"));f=new J(a.gl,6*ca);f.create("vert",3);f.create("tex",2);f.create("lookup",1);f.alloc(6*ca);for(var c=0;25>c;c++)e.push(new la(a.gl));for(c=0;c<b.length;c++)b[c].initialize(a);b[0].fetch_all();b[0].noexpire(!0)};this.draw=function(c,d){gl.useProgram(B);B.data("screen",c.camera.mat3);Ia=Ja=0;for(var e=Infinity,l=b[0],m,h=0;h<b.length;h++){var n=a.size*b[h].cols/b[h].size(c).x;
1>n&&(n=1/n);n<e&&(e=n,l=b[h],m=h)}for(h=m;0<=h;h--)b[h].fetch();if(l.ready())l.draw(c,d,f,0,!0);else{c.enable_z();e=0;for(h=m;0<=h;h--)e=b[h].draw(c,d,f,e,0==h);c.disable_z()}$.each(b,function(a,c){c.cull()})}}function $a(a){a||(a={});a.desaturate||(a.desaturate=0);a.darken||(a.darken=0);a.hue||(a.hue=0);a.hue_color||(a.hue_color=ua(0,0,0,1));if(!a.available){a.available=[];for(var b=0;8>b;b++)a.available.push(new la(e))}var e=null,c=a.url,d=a.min,f=a.rows,k=a.cols,j=a.cellsize;this.rows=f;this.cols=
k;for(var g={},l={},m=function(c,b){var e=new vect(d.x+c*j,d.y+b*j),f=new vect(d.x+(c+1)*j,d.y+(b+1)*j),e={vert:x(e,f,a.z_index),tex:null,i:c,j:b,id:c+k*b,ready:!1,min:e,max:f};l[c][b]=e;g[e.id]=e},b=0;b<k;b++)l[b]={};this.size=function(a){var c=a.camera.screen(d);a=a.camera.screen(vect.add(d,new vect(j*k,j*f)));c=vect.sub(a,c);c.y=Math.abs(c.y);return c};var h=!1;this.noexpire=function(a){h=a};this.cull=function(){if(!h){var c=(new Date).getTime(),b;for(b in p)if(c-p[b]>ab){var d=g[b];delete g[b];
delete l[d.i][d.j];a.available.push(d.tex);d.tex=null;d.ready=!1;delete p[b]}}};var n=function(){var a=engine.camera.project(new vect(engine.canvas.offset().left,engine.canvas.offset().top+engine.canvas.height())),c=engine.camera.project(new vect(engine.canvas.offset().left+engine.canvas.width(),engine.canvas.offset().top)),b=Math.floor((a.x-d.x)/j),e=Math.ceil((c.x-d.x)/j),a=Math.floor((a.y-d.y)/j),c=Math.ceil((c.y-d.y)/j);return{min_col:b,max_col:e,min_row:a,max_row:c}},p={};this.ready=function(){for(var a=
n(),c=Math.max(0,a.min_col);c<Math.min(k,a.max_col);c++)for(var b=Math.max(0,a.min_row);b<Math.min(f,a.max_row);b++)if(!l[c][b]||!l[c][b].ready)return!1;return!0};var q=function(b,d){if(!l[b][d].tex){var f;if("file"==a.source)f=c+"/"+l[b][d].id+".png";else if("wms"==a.source){f={service:"wms",version:"1.1.0",request:"GetMap",layers:a.layer,bbox:[l[b][d].min.x,l[b][d].min.y,l[b][d].max.x,l[b][d].max.y].join(),width:a.size,height:a.size,srs:"EPSG:4326",format:"image/png",transparent:"true"};var g=[],
k;for(k in f)g.push(k+"="+f[k]);f=c+"?"+g.join("&")}l[b][d].tex=a.available.pop();l[b][d].tex||(l[b][d].tex=new la(e));k=f;var j=l[b][d],m=new Image;m.crossOrigin="";m.onload=function(){j.tex&&(j.tex.image(m),j.ready=!0)};m.src=k}};this.fetch_all=function(){for(var a=(new Date).getTime(),c=0;c<k;c++)for(var b=0;b<f;b++)l[c][b]||m(c,b),l[c][b].tex||q(c,b),p[l[c][b].id]=a};this.fetch=function(){for(var a=n(),c=(new Date).getTime(),b=Math.max(0,a.min_col-1);b<Math.min(k,a.max_col+1);b++)for(var d=Math.max(0,
a.min_row-1);d<Math.min(f,a.max_row+1);d++)l[b][d]||m(b,d),l[b][d].tex||q(b,d),p[l[b][d].id]=c};var u=!1;this.initialize=function(a){if(u)throw"Not Implemented: Migrating Tile Layers to New Map";B||(B=z(a.gl,w+"shaders/tile"));e=a.gl;u=!0};this.draw=function(c,b,d,g,j){u||this.initialize(c);c=function(){Ia++;d.update();B.data("pos",d.get("vert"));B.data("tex_in",d.get("tex"));B.data("lookup_in",d.get("lookup"));B.data("desaturate",a.desaturate);B.data("darken",a.darken);B.data("hue",a.hue);B.data("hue_color",
a.hue_color.array);e.drawArrays(e.TRIANGLES,0,6*g)};b=n();for(var m=(new Date).getTime(),h=Math.max(0,b.min_col);h<Math.min(k,b.max_col);h++)for(var r=Math.max(0,b.min_row);r<Math.min(f,b.max_row);r++)if(l[h][r]&&l[h][r].ready&&l[h][r].tex){d.write("vert",l[h][r].vert,6*g,6);d.write("tex",x(new vect(0,0),new vect(1,1)),6*g,6);d.repeat("lookup",[g/ca+1/(2*ca)],6*g,6);p[l[h][r].id]=m;B.data("sampler"+g,l[h][r].tex);if(null==l[h][r].tex)throw"badness";g++;Ja++;g>=ca&&(c(),g=0)}j&&c();return g}}var w=
"",U=jQuery,bb=function(a){if("string"===typeof a.data){var b=a.handler,e=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var d="keypress"!==a.type&&U.hotkeys.specialKeys[a.which],f=String.fromCharCode(a.which).toLowerCase(),k="",j={};a.altKey&&"alt"!==d&&(k+="alt+");a.ctrlKey&&"ctrl"!==d&&(k+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==d)&&(k+="meta+");a.shiftKey&&"shift"!==d&&(k+="shift+");d?j[k+d]=
!0:(j[k+f]=!0,j[k+U.hotkeys.shiftNums[f]]=!0,"shift+"===k&&(j[U.hotkeys.shiftNums[f]]=!0));d=0;for(f=e.length;d<f;d++)if(j[e[d]])return b.apply(this,arguments)}}}};U.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",
107:"=",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"}};U.each(["keydown","keyup","keypress"],function(){U.event.special[this]={add:bb}});
var L=jQuery,ta=function(a){var b=a||window.event,e=[].slice.call(arguments,1),c=0,d=0,f=0;a=L.event.fix(b);a.type="mousewheel";b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);f=c;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(f=0,d=-1*c);void 0!==b.wheelDeltaY&&(f=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(d=-1*b.wheelDeltaX/120);e.unshift(a,c,d,f);return(L.event.dispatch||L.event.handle).apply(this,e)},V=["DOMMouseScroll","mousewheel"];if(L.event.fixHooks)for(var P=V.length;P;)L.event.fixHooks[V[--P]]=
L.event.mouseHooks;L.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=V.length;a;)this.addEventListener(V[--a],ta,!1);else this.onmousewheel=ta},teardown:function(){if(this.removeEventListener)for(var a=V.length;a;)this.removeEventListener(V[--a],ta,!1);else this.onmousewheel=null}};L.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});for(var Ka=0,P=["ms","moz",
"webkit","o"],da=0;da<P.length&&!window.requestAnimationFrame;++da)window.requestAnimationFrame=window[P[da]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[P[da]+"CancelAnimationFrame"]||window[P[da]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),e=Math.max(0,16-(b-Ka)),c=window.setTimeout(function(){a(b+e)},e);Ka=b+e;return c});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});
var pa=3.14159265,F=function(a,b,e,c){e in b&&(a[e]=c?c(b[e]):b[e])},Qa=!1,xa=0,ma="http://eland.ecohealthalliance.org/wigglemaps",R={x:0,y:0},v=null,ya=null,aa=null,M,La=1;M=function(){var a=La;La++;return a};var Ga;Ga=function(a,b){return new vect(a+1E-6*Math.random()-5E-7,b+1E-6*Math.random()-5E-7)};var y=null,y=null,Ea,Ya=va(0,0,1,1),Wa=new s(0.02,0.44,0.69,1),Xa=1,N=null,t,D=null,G=function(a){var b=null;this.length=a.length;this.count=function(){return a.length};this.items=function(){return a};
this.attr=function(c){return a.length?a[0].attr[c]:null};this.get=function(c){return a[c]};this.subset=function(c){for(var b=[],e=0;e<c.length;e++)b.push(a[c[e]]);return new G(b)};this.id=function(c){if(!b){b={};for(var d=0;d<a.length;d++)b[a[d].id]=a[d]}return c in b?b[c]:null};this.each=function(c){for(var b=0;b<a.length;b++)c(b,a[b]);return this};var e={">":function(a,b){return a>b},"<":function(a,b){return a<b},"==":function(a,b){return a==b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=
b}};this.select=function(c){if(c.match(/^\s*\*\s*$/))return new G(a);var b=c.match(/^\s*([^\s]+)\s*([=<>]+)\s*(([^\s])+)\s*$/);if(!b)throw"Bad Selector";c=b[1];var f=b[2],k=null,j=null;isNaN(b[3])?j=b[3]:k=parseFloat(b[3]);new_elem=[];if(j)for(b=0;b<a.length;b++)e[f](a[b].attr[c],a[b].attr[j])&&new_elem.push(a[b]);else for(b=0;b<a.length;b++)e[f](a[b].attr[c],k)&&new_elem.push(a[b]);return new G(new_elem)};this.filter=function(b){for(var d=[],e=0;e<a.length;e++)b(a[e])&&d.push(a[e]);return new G(d)};
this.quantile=function(b,d,e){a.sort(function(a,d){return a.attr[b]-d.attr[b]});var k=Math.round(d*this.length/e);d=Math.round((d-1)*this.length/e);return new G(a.slice(d,k))};this.range=function(b){for(var d=Infinity,e=-Infinity,k=0;k<a.length;k++)d>a[k].attr[b]&&(d=a[k].attr[b]),e<a[k].attr[b]&&(e=a[k].attr[b]);return{min:d,max:e}};this.style=function(b,d){if(1==arguments.length){var e=[];$.each(a,function(a,d){e.push(d.style(b))});return e}if("function"==typeof d)$.each(a,function(a,e){e.style(b,
d(e))});else{var k;a:if(null==d||void 0==d.length)k=!1;else{for(k=0;k<d.length;k++)if(!(k in d)){k=!1;break a}k=!0}k?$.each(a,function(a,e){e.style(b,d[a])}):$.each(a,function(a,e){e.style(b,d)})}return this}},O=null,A=null,Q=null,A=null,ab=1E3,sa=0,ca=8,Ja=0,Ia=0,B=null,Ma=[];window.wiggle={Map:function(a,b){this.center=function(a,b){engine.camera.position(new vect(a,b))};this.vcenter=function(a){this.center(a.x,a.y)};this.extents=function(a){engine.camera.extents(a)};this.append=function(a){a.initialize(engine);
engine.scene.push(a)};this.remove=function(a){for(var b=0;b<engine.scene.length;b++)if(engine.scene[b]==a)return engine.scene.splice(b,1),!0;return!1};this.shade=function(a){a=new ra(a);engine.shade=a};this.select=function(a){a?(engine.sel.select(a),engine.select(!0)):engine.select(!1)};this.resize=function(){engine.resize()};this.attr=function(a,b){engine.attr(a,b)};this.png=function(){var a=engine.canvas.get(0).toDataURL();$.ajax({url:"../server/export.png",type:"POST",data:a})};this.width=function(){return engine.canvas.innerWidth()};
this.height=function(){return engine.canvas.innerHeight()};var e=null;this.click=function(a){e=a};engine=new Pa(a,this,b);engine.canvas.click(function(a){e&&(a=new vect(a.pageX,a.pageY),a=engine.camera.project(a),e(a))})},layer:{PointLayer:Da,LineLayer:function(){function a(a){a||(a={});a.geom||(a.geom=[]);a.attr||(a.attr={});a.style||(a.style={});this.geom=a.geom;this.attr=a.attr;this.id=M();var b,d=0,g=function(){var a;a="stroke"in m?m.stroke:c.style("stroke");e.repeat("color",a.array,b,d)},h=function(){var a;
a="stroke-opacity"in m?m["stroke-opacity"]:c.style("stroke-opacity");e.repeat("alpha",[a],b,d)};b=e.count();Ha(e,this.geom);var d=6*this.geom.length,m={};F(m,a.style,"fill",W);F(m,a.style,"stroke",W);F(m,a.style,"fill-opacity",parseFloat);F(m,a.style,"stroke-opacity",parseFloat);this.style=function(a,b){if(1==arguments.length)return m[a];m[a]=b;"fill"==a&&g();"stroke"==a&&g();"fill-opacity"==a&&h();"stroke-opacity"==a&&h()};g();h()}var b=new s(0.02,0.44,0.69,1);t||(t=z(w+"shaders/line"));this.id=
M();var e=new J(1024);e.create("vert",2);e.create("norm",2);e.create("unit",2);e.create("color",3);e.create("alpha",1);var c=this,d=0;this.append=function(b){b=new a(b);for(key in b.attr);d++;return b};this.style=function(a,c){if(1<arguments.length)throw"Not Implemented";return"stroke"==a?b:"stroke-opacity"==a?1:null};this.draw=function(a,b){e.update(b);0<d&&(gl.useProgram(t),t.data("screen",a.camera.mat3),t.data("pos",e.get("vert")),t.data("norm",e.get("norm")),t.data("color_in",e.get("color")),
t.data("alpha_in",e.get("alpha")),t.data("px_w",2/a.canvas.width()),t.data("px_h",2/a.canvas.height()),gl.drawArrays(gl.TRIANGLES,0,e.count()))}},PolygonLayer:Fa,Grid:qa,Hillshade:ra,Elevation:function(a){Q||(Q=z(w+"shaders/elevation"));var b=$(a).find("LatLonBox"),e=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),c=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var d=X(a),f=I(x(new vect(0,
1),new vect(1,0)),2),k=I(x(e,c),2);this.draw=function(a,b,h){h||(gl.useProgram(Q),Q.data("screen",a.camera.mat3),Q.data("pos",k),Q.data("tex_in",f),Q.data("elevation",d),vect.sub(a.camera.screen(c),a.camera.screen(e)),gl.drawArrays(gl.TRIANGLES,0,k.numItems))}}},io:{Shapefile:function(a){var b=a.path;$.ajax({url:b+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(e){for(var c=[],d=100;d<e.length;)c.push(2*ja(e,d)),d+=8;$.ajax({url:b+".shp",mimeType:"text/plain; charset=x-user-defined",
success:function(b){for(var d=[],e=[],g=0;g<c.length;g++){var h=c[g];ja(b,h);ja(b,h+4);var m=h+8,n=H(b,m);if(0==n)console.log("NULL Shape");else if(1==n)n=ea(b,m+4),m=ea(b,m+12),d.push({attr:{},geom:[[n,m]]});else if(5==n){for(var n=H(b,m+36),m=H(b,m+40),p=h+52,h=h+52+4*n,q=[],s=0;s<n;s++){var u=H(b,p+4*s),t;t=s+1<n?H(b,p+4*(s+1)):m;var w=h,x=[];for(t-=1;t>=u;t--){var y=ea(b,w+16*t),z=ea(b,w+16*t+8);x.push([y,z])}q.push(x)}e.push({attr:{},geom:[q]})}else throw"Not Implemented: "+n;}if(0<d.length){var v=
new Da(d.length);$.each(d,function(a,b){v.append(b)});b=v}else 0<e.length?(v=new Fa(a),$.each(e,function(a,b){for(var c=0;100>c;)try{v.append(b),c=101}catch(d){c++}100==c&&console.log("rendering polygon failed")}),b=v):b=void 0;a.success(b)}})}})},GeoJSON:function(a){for(var b=new Ua,e=0;e<a.features.length;e++){var c=a.features[e];if("Feature"==c.type){"Point"==c.geometry.type&&b.append({type:"Point",geom:[c.geometry.coordinates],attr:c.properties});"MultiPoint"==c.geometry.type&&b.append({type:"Point",
geom:c.geometry.coordinates,attr:c.properties});if("Polygon"==c.geometry.type){for(var d=c.geometry.coordinates,f=[],h=0;h<=d.length-1;h++){for(var j=[],g=d[h].length-1;0<=g;g--)j.push(d[h][g]);f.push(j)}b.append({type:"Polygon",geom:[f],attr:c.properties})}if("MultiPolygon"==c.geometry.type){var l=[];$.each(c.geometry.coordinates,function(a,b){for(var c=[],d=0;d<=b.length-1;d++){for(var e=[],f=b[d].length-1;0<=f;f--)e.push(b[d][f]);c.push(e)}l.push(c)});b.append({type:"Polygon",geom:l,attr:c.properties})}"MultiLineString"==
c.geometry.type&&$.each(c.geometry.coordinates,function(a,d){b.append({type:"Line",geom:d,attr:c.properties})})}}return b},KML:function(a){var b=$(a).find("LatLonBox"),e=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),b=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();return new Za(w+a,e,b)},SparseGrid:function(a,b){var e=fa(a,0),c=fa(a,4),d=H(a,8),f=H(a,12),h=fa(a,16),j={};for(key in b)j[key]=
b[key];j.lower=new vect(e,c);j.upper=new vect(e+h*d,c+h*f);j.rows=f;j.cols=d;e=new qa(j);for(c=20;c<a.length;){for(var h=H(a,c),d=H(a,c+4),f=c+4,j=d,g=0;g<j;g++){var l=fa(a,f+4*g);e.raw_set(h+g,l)}c+=8+4*d}return e},AsciiGrid:function(a,b){var e=a.split("\n"),c=e.splice(0,6),d=parseInt(c[0].slice(14)),f=parseInt(c[1].slice(14)),h=parseFloat(c[2].slice(14)),j=parseFloat(c[3].slice(14)),g=parseFloat(c[4].slice(14)),c=c[5].slice(14),l={};for(key in b)l[key]=b[key];l.lower=new vect(h,j);l.upper=new vect(h+
g*d,j+g*f);l.rows=f;l.cols=d;h=new qa(l);for(j=0;j<f;j++){g=e[j].split(" ");for(l=0;l<d;l++)g[l]==c?h.set(f-1-j,l,NaN):h.set(f-1-j,l,parseFloat(g[l]))}return h},WMS:function(a){a=p(a);for(var b=["url","layer"],e=0;e<b.length;e++){var c=b[e];if(!(c in a))throw"Key "+c+" not found";}h(a,{levels:16,size:256});var b={source:"wms"},d;for(d in b)a[d]=b[d];return new ga(a)}},util:{fcolor:ua,icolor:function(a,b,e,c){return new s(n(a/255,0,1),n(b/255,0,1),n(e/255,0,1),n(c/255,0,1))}},widget:{Slider:function(a,
b,e){var c=function(a){if(a>=e)throw"Slider index out of bounds";return b.x/(e-1)*a},d=function(c){return c<=a.x?0:c>=a.x+b.x?e-1:Math.round((c-a.x)/b.x*(e-1))};this.dom=$("<div></div>").addClass("slider-container").css("position","relative").css("left",a.x).css("top",a.y).css("width",b.x).css("height",b.y);var f=!1,h=0,j=$("<div></div>").addClass("slider-box").css("position","relative").css("left",-10).css("height",b.y).css("width",20).mousedown(function(){f=!0});this.tick=function(){return h};this.count=
function(){return e};var g=function(){};this.change=function(a){g=a};var l=function(){};this.release=function(a){l=a};this.dragging=function(){return f};this.dom.append(j);this.set=function(a){a!=h&&g(a);h=a;var b=c(a);j.css("left",b-10);l(a)};$(document).bind("mouseup",function(){if(f){f=!1;var a=d(event.clientX);l(a)}});$(document).bind("mousemove",function(a){f&&(a=d(a.clientX),a!=h&&g(a),h=a,a=c(a),j.css("left",a-10))})}},ready:function(a){Ma.push(a)}};$(document).ready(function(){$('script[src*="wigglemaps"]').each(function(a,
b){var e=/wigglemaps(\.min)?\.js/;$(b).attr("src").match(e)&&(w=$(b).attr("src").replace(e,""))});$.each(Ma,function(a,b){b()})})})();
