function vect(j,l,n){this.x=j;this.y=l;this.z=n?n:0;this.add=function(j){this.x+=j.x;this.y+=j.y;this.z+=j.z};this.sub=function(j){this.x-=j.x;this.y-=j.y;this.z-=j.z};this.scale=function(j){this.x*=j;this.y*=j;this.z*=j;return this};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.normalize=function(){var j=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(0==j)return this;this.x/=j;this.y/=j;this.z/=j;return this};this.div=function(j){this.x/=j.x;this.y/=
j.y;this.z/=j.z};this.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z)};this.zero=function(){return 0==this.x+this.y+this.z};this.dot=function(j){return this.x*j.x+this.y*j.y+this.z*j.z};this.cross=function(){throw"Need to reimplement";};this.rotate=function(j){var l=Math.cos(j);j=Math.sin(j);xp=l*this.x-j*this.y;yp=j*this.x+l*this.y;this.x=xp;this.y=yp;return this};this.clone=function(){return new vect(this.x,this.y,this.z)};this.array=function(){return[this.x,
this.y]}}vect.scale=function(j,l){return new vect(j.x*l,j.y*l,j.z*l)};vect.add=function(j,l){return new vect(j.x+l.x,j.y+l.y,j.z+l.z)};vect.sub=function(j,l){if(!j||!l)throw"Bad Vector";return new vect(j.x-l.x,j.y-l.y,j.z-l.z)};vect.dist=function(j,l){var n=l.x-j.x,q=l.y-j.y,r=l.z-j.z;return Math.sqrt(n*n+q*q+r*r)};vect.dir=function(j,l){var n=vect.sub(j,l);n.normalize();return n};vect.dot2d=function(j,l){return j.x*l.x+j.y*l.y};vect.cross=function(j,l){return j.x*l.y-j.y*l.x};
vect.left=function(j,l,n,q){q||(q=0);l=vect.sub(l,j);j=vect.sub(n,j);return vect.cross(l,j)>=-q};vect.intersects=function(j,l,n,q,r){r||(r=0);return vect.left(j,l,n,r)!=vect.left(j,l,q,r)&&vect.left(n,q,l,r)!=vect.left(n,q,j,r)};vect.intersect2dt=function(j,l,n,q){q=j.x*(q.y-n.y)+l.x*(n.y-q.y)+q.x*(l.y-j.y)+n.x*(j.y-l.y);return 0==q?Infinity:-(j.x*(n.y-l.y)+l.x*(j.y-n.y)+n.x*(l.y-j.y))/q};
vect.intersect2dpos=function(j,l,n,q){var r=j.x*(q.y-n.y)+l.x*(n.y-q.y)+q.x*(l.y-j.y)+n.x*(j.y-l.y);if(0==r)return Infinity;n=(j.x*(q.y-n.y)+n.x*(j.y-q.y)+q.x*(n.y-j.y))/r;l=vect.sub(l,j);l.scale(n);return vect.add(j,l)};vect.rotate=function(j,l){var n=Math.cos(l),q=Math.sin(l);xp=n*j.x-q*j.y;yp=q*j.x+n*j.y;return j=new vect(xp,yp,j.z)};vect.normalize=function(j){j=j.clone();var l=Math.sqrt(j.x*j.x+j.y*j.y+j.z*j.z);if(0==l)return j;j.x/=l;j.y/=l;j.z/=l;return j};
(function(){function j(a,c){for(var b in c)b in a||(a[b]=c[b])}function l(a){var c={};for(key in a)c[key]=a[key];return c}function n(a,c){for(key in c)a[key]=c[key]}function q(a,c,b){return Math.min(Math.max(a,c),b)}function r(a,c,b,d){1>=a&&1>=c&&1>=b&&1>=d?(this.r=a,this.g=c,this.b=b,this.a=d):(this.r=a/255,this.g=c/255,this.b=b/255,this.a=d/255);this.array=[this.r,this.g,this.b,this.a];this.vect=function(){return this.array};this.rgb=function(){return"rgb("+parseInt(255*this.r)+","+parseInt(255*
this.g)+","+parseInt(255*this.b)+")"}}function ma(a,c,b,d){return new r(q(a,0,1),q(c,0,1),q(b,0,1),q(d,0,1))}function Fa(a){if(null==a||void 0==a.length)return!1;for(var c=0;c<a.length;c++)if(!(c in a))return!1;return!0}function ba(a,c){return((a.charCodeAt(c)&255)<<24)+((a.charCodeAt(c+1)&255)<<16)+((a.charCodeAt(c+2)&255)<<8)+(a.charCodeAt(c+3)&255)}function C(a,c){return((a.charCodeAt(c+3)&255)<<24)+((a.charCodeAt(c+2)&255)<<16)+((a.charCodeAt(c+1)&255)<<8)+(a.charCodeAt(c)&255)}function S(a,c){var b=
a.charCodeAt(c)&255,d=a.charCodeAt(c+1)&255,e=a.charCodeAt(c+2)&255,f=a.charCodeAt(c+3)&255,h=a.charCodeAt(c+4)&255,k=a.charCodeAt(c+5)&255,g=a.charCodeAt(c+6)&255,s=a.charCodeAt(c+7)&255,m=1-2*(s>>7),s=((s&127)<<4)+((g&240)>>4)-1023,b=(g&15)*Math.pow(2,48)+k*Math.pow(2,40)+h*Math.pow(2,32)+f*Math.pow(2,24)+e*Math.pow(2,16)+d*Math.pow(2,8)+b;return m*(1+b*Math.pow(2,-52))*Math.pow(2,s)}function T(a,c){var b=a.charCodeAt(c)&255,d=a.charCodeAt(c+1)&255,e=a.charCodeAt(c+2)&255,f=a.charCodeAt(c+3)&255,
h=1-2*(f>>7),f=((f&127)<<1)+((e&254)>>7)-127,b=(e&127)*Math.pow(2,16)+d*Math.pow(2,8)+b;return h*(1+b*Math.pow(2,-23))*Math.pow(2,f)}function na(a,c,b,d){return[a-b,c+d,a-b,c-d,a+b,c+d,a-b,c-d,a+b,c-d,a+b,c+d]}function w(a,c,b){return 2==arguments.length?[a.x,c.y,a.x,a.y,c.x,c.y,a.x,a.y,c.x,a.y,c.x,c.y]:[a.x,c.y,b,a.x,a.y,b,c.x,c.y,b,a.x,a.y,b,c.x,a.y,b,c.x,c.y,b]}function B(a,c){if(!a)return null;var b=a.createProgram(),d=oa(a,a.VERTEX_SHADER,c+"/vert.glsl"),e=oa(a,a.FRAGMENT_SHADER,c+"/frag.glsl");
a.attachShader(b,d);a.attachShader(b,e);a.linkProgram(b);var f={},d=(d.source+e.source).match(/((uniform)|(attribute)) (\w+) (\w+)/mg),e=0;a.useProgram(b);if(d){for(var h=0;h<d.length;h++){var k=d[h].split(" ");f[k[2]]={u:k[0],type:k[1],loc:null};if("uniform"==k[0])f[k[2]].loc=a.getUniformLocation(b,k[2]);else{var g=a.getAttribLocation(b,k[2]);f[k[2]].loc=g}"sampler2D"==k[1]&&(f[k[2]].tex=e,e++)}b.get=function(a){return f[a].loc};b.data=function(b,c){var d=f[b];if(!d)throw"Could not find shader variable "+
b;if("uniform"==d.u)if("float"==d.type)a.uniform1f(d.loc,c);else if("vec2"==d.type)a.uniform2fv(d.loc,c);else if("ivec2"==d.type)a.uniform2iv(d.loc,c);else if("vec3"==d.type)a.uniform3fv(d.loc,c);else if("ivec3"==d.type)a.uniform3iv(d.loc,c);else if("vec4"==d.type)a.uniform4fv(d.loc,c);else if("ivec4"==d.type)a.uniform4iv(d.loc,c);else if("bool"==d.type)a.uniform1i(d.loc,c);else if("mat4"==d.type)a.uniformMatrix4fv(d.loc,!1,c);else if("mat3"==d.type)a.uniformMatrix3fv(d.loc,!1,c);else if("sampler2D"==
d.type)"texture"in c&&(c=c.texture()),a.activeTexture(a["TEXTURE"+d.tex]),a.bindTexture(a.TEXTURE_2D,c),a.uniform1i(d.loc,d.tex);else if("int"==d.type)a.uniform1i(d.loc,c);else throw"Unsupported Type for Shader Helper: "+d.type;else if("attribute"==d.u)a.enableVertexAttribArray(d.loc),a.bindBuffer(a.ARRAY_BUFFER,c),a.vertexAttribPointer(d.loc,c.itemSize,a.FLOAT,!1,0,0);else throw"Type: "+d.u+" Recieved";}}return b}function oa(a,c,b){var d=a.createShader(c);$.ajax({async:!1,url:b,dataType:"text",success:function(b){a.shaderSource(d,
b);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS))throw a.getShaderInfoLog(d);d.source=b},error:function(){console.log("Could not load "+b)}});return d}function D(a,c,b){var d=a.createBuffer(),e=new Float32Array(c);a.bindBuffer(a.ARRAY_BUFFER,d);d.itemSize=b;d.numItems=c.length/b;a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return d}function ca(a,c,b){if(!a)return null;var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);var e=new Float32Array(c*
b);d.itemSize=b;d.numItems=c;d.update=function(b,c){var e=new Float32Array(b);a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferSubData(a.ARRAY_BUFFER,4*c,e);a.bindBuffer(a.ARRAY_BUFFER,null)};a.bufferData(a.ARRAY_BUFFER,e,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return d}function U(a,c,b){var d=a.createTexture();d.id=pa;pa++;var e=new Image;e.onload=function(){a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);b&&b()};e.src=c;return d}function P(a,c){var b={},d;d=c?c:256;var e=0,f=function(a,b,d,c){a||console.log("ack");d||(d=0);c||(c=b.length);for(var e=0;e<c;e++)a[d+e]=b[e]};this.create=function(c,e){if(!e)throw"Length of buffer must be a positive integer";var f=new Float32Array(d*
e),s=ca(a,d,e);b[c]={array:f,buffer:s,len:e,dirty:!1}};this.alloc=function(c){if(e+c>=d){for(var k=d;k<e+c;)k*=2;d=k;for(name in b){var g=new Float32Array(k*b[name].len),s=b[name].array,m=ca(a,d,b[name].len);f(g,s);b[name].array=g;b[name].buffer=m;b[name].dirty=!0}}k=e;e+=c;return k};this.get=function(a){return b[a].buffer};this.write=function(a,d,c,e){f(b[a].array,d,c*b[a].len,e*b[a].len);b[a].dirty=!0};this.repeat=function(a,d,c,e){for(var m=0;m<e;m++)f(b[a].array,d,(c+m)*b[a].len,b[a].len);b[a].dirty=
!0};this.count=function(){return e};this.data=function(a){return b[a].array};this.update=function(){for(name in b)b[name].dirty&&(b[name].buffer&&b[name].buffer.update(b[name].array,0),b[name].dirty=!1)}}function qa(a,c){var b=l(c);j(b,{mag_filter:a.LINEAR,min_filter:a.LINEAR,wrap_s:a.CLAMP_TO_EDGE,wrap_t:a.CLAMP_TO_EDGE,mipmap:!1});var d=a.createTexture(),e=null;this.image=function(c){e=c;a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MAG_FILTER,b.mag_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.min_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrap_s);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrap_t);b.mipmap&&a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null)};this.texture=function(){return e?d:null}}function Ga(a,c){var b=this;c||(c={});c.width&&!c.height?c.height=c.width:!c.width&&c.height&&(c.width=c.height);var d=c.preserveAspectRatio?a.height()/a.width():1;c.min?c.center=
vect.add(c.min,(new vect(c.width,c.height*d)).scale(0.5)):c.center||(c.center=new vect(0,0));var e=c.width,f=c.height,h=c.height/c.width,k=c.center.clone(),g=1;this.worldToPx=new Float32Array(9);this.pxToScreen=new Float32Array(9);this.mat3=this.worldToScreen=new Float32Array(9);this.reconfigure=function(){var d=c.preserveAspectRatio?a.height()/a.width():1,h=(new vect(e/(c.xlock?1:g),e*(f/e)*d/(c.ylock?1:g))).scale(0.5),d=vect.add(k,h),h=vect.sub(k,h),p=a.width(),j=a.height(),d=vect.sub(d,h);b.worldToPx[0]=
p/d.x;b.worldToPx[1]=0;b.worldToPx[2]=0;b.worldToPx[3]=0;b.worldToPx[4]=j/d.y;b.worldToPx[5]=0;b.worldToPx[6]=-(h.x*p)/d.x;b.worldToPx[7]=-(h.y*j)/d.y;b.worldToPx[8]=1;b.pxToScreen[0]=2/p;b.pxToScreen[1]=0;b.pxToScreen[2]=0;b.pxToScreen[3]=0;b.pxToScreen[4]=2/j;b.pxToScreen[5]=0;b.pxToScreen[6]=-1;b.pxToScreen[7]=-1;b.pxToScreen[8]=1;b.worldToScreen[0]=2/d.x;b.worldToScreen[1]=0;b.worldToScreen[2]=0;b.worldToScreen[3]=0;b.worldToScreen[4]=2/d.y;b.worldToScreen[5]=0;b.worldToScreen[6]=-2*h.x/d.x-1;
b.worldToScreen[7]=-2*h.y/d.y-1;b.worldToScreen[8]=1};this.reconfigure();this.project=function(b){b=new vect(2*(b.x-a.offset().left)/a.width()-1,-(2*(b.y-a.offset().top)/a.height()-1));b.x=b.x/this.mat3[0]-this.mat3[6]/this.mat3[0];b.y=b.y/this.mat3[4]-this.mat3[7]/this.mat3[4];return b};this.screen=function(b){b=new vect(b.x*this.mat3[0]+this.mat3[6],b.y*this.mat3[4]+this.mat3[7]);b.x=a.offset().left+a.width()*(b.x+1)/2;b.y=a.offset().top+a.height()*(-b.y+1)/2;return b};this.percent=function(b){return new vect(2*
((b.x-a.offset().left)/a.width())-1,-(2*((b.y-a.offset().top)/a.height())-1))};this.pixel=function(b){return new vect(a.offset().left+(b.x+1)/2*a.width(),a.offset().top+(-b.y+1)/2*a.height())};this.move=function(a){k.add(a);this.reconfigure()};this.zoom=function(a){if(void 0===a)return g;g=a;this.reconfigure()};this.position=function(a,b){if(void 0===a)return k.clone();k=void 0===b?a.clone():new vect(a,b);this.reconfigure()};this.reset=function(){g=1;this.reconfigure()};a.resize(function(){b.reconfigure()});
this.extents=function(a){e=a;f=a*h;g=1;this.reconfigure()};this.size=function(){var b=c.preserveAspectRatio?a.height()/a.width():1;return new vect(e/(c.xlock?1:g),e*(f/e)*b/(c.ylock?1:g))}}function Ha(a,c){var b=!1,d=new vect(0,0),e=new vect(0,0),f=null,h=0;a.canvas.mousedown(function(a){d=new vect(a.clientX,a.clientY);b=!0});$(window).bind("mouseup",function(){b=!1});$(document).bind("keypress","+",function(){a.camera.zoom(1.1)});$(document).bind("keypress","-",function(){a.camera.zoom(10/11)});
$(document).bind("keypress","0",function(){a.camera.reset()});a.canvas.bind("mousewheel",function(b,d){d*=0.5;0>d?(d=-1*d+1,d=1/d):d+=1;var c=a.camera.zoom();a.camera.zoom(c*d);g();b.preventDefault()});var k=!0;this.disable=function(){k=!1};this.enable=function(){k=!0};this.update=function(c){e=new vect(V.x,V.y);var m=!1,p;b&&k?(m=vect.sub(a.camera.project(d),a.camera.project(e)),p=a.camera.position(),p=vect.add(p,m),a.camera.position(p),d=e,h=m.length()/c,f=m,f.normalize(),m=!0):0.01<h&&f&&(m=vect.scale(f,
h*c),p=a.camera.position(),p=vect.add(p,m),a.camera.position(p),h-=3*c*h,m=!0);m&&g()};var g=function(){if(c.worldMin&&c.worldMax){var b=a.camera.position(),b=a.camera.size(),d=c.worldMax.x-c.worldMin.x;b.x>d&&(b=b.x*a.camera.zoom(),a.camera.zoom(d/b));a.camera.position();b=a.camera.size();d=c.worldMax.y-c.worldMin.y;b.y>d&&(b=b.y*a.camera.zoom(),a.camera.zoom(d/b))}var b=a.camera.position(),d=a.camera.size().scale(0.5),e=!1;c.worldMin&&(b.x-d.x<c.worldMin.x&&(b.x=c.worldMin.x+d.x),b.y-d.y<c.worldMin.y&&
(b.y=c.worldMin.y+d.y),e=!0);c.worldMax&&(b.x+d.x>c.worldMax.x&&(b.x=c.worldMax.x-d.x),b.y+d.y>c.worldMax.y&&(b.y=c.worldMax.y-d.y),e=!0);e&&a.camera.position(b)}}function da(a,c){this.style_map={};this.geom=a;var b={};this.updateMany=function(a){for(var b in a)this.updateOne(b,a[value])};this.updateOne=function(a,c){if(void 0===c)throw"No value for style defined";if(b[a]!=c&&(b[a]=c,a in this.style_map))this.style_map[a](c)};this.updateDefault=function(a){var b=c(a);this.updateOne(a,b)};this.update=
function(a,b){"string"==typeof a?void 0===b?this.updateDefault(a):this.updateOne(a,b):this.updateMany(a)};this.keys=function(){var a={};for(key in this.style_map)a[key]=!0;return a};this.updateAll=function(){for(var a in this.style_map)this.updateDefault(a)}}function ea(a){this.engine=a;this.views=[];this.update=function(a){for(var b=0;b<views.length;b++)this.views[b].update(a)};this.View=function(){throw"Attempt to call abstract function";};this.create=function(a,b){var d=new this.View(a,b);this.views.push(d);
d.updateAll();return d};this.draw=function(){throw"Attempt to call abstract function";}}function Ia(a,c){ea.call(this,a,c);a.shaders.point||(a.shaders.point=B(a.gl,y+"shaders/point"));var b=a.shaders.point,d=10,e=new P(a.gl,Ja);e.create("vert",2);e.create("unit",2);e.create("stroke_width",1);e.create("rad",1);e.create("fill_color",3);e.create("fill",1);e.create("stroke_color",3);e.create("stroke",1);e.create("alpha",1);this.View=function(a,b){da.call(this,a,b);var c,g;this.style_map={fill:function(a){"none"==
a?e.repeat("fill",[-0.75],c,g):(e.repeat("fill",[0.75],c,g),e.repeat("fill_color",a.array,c,g))},opacity:function(a){e.repeat("alpha",[a],c,g)},radius:function(a){a>d&&(d=a);e.repeat("rad",[a],c,g)},stroke:function(a){"none"==a?e.repeat("stroke",[-0.75],c,g):(e.repeat("stroke",[0.75],c,g),e.repeat("stroke_color",a.array,c,g))},"stroke-width":function(a){e.repeat("stroke_width",[a],c,g)}};g=6*a.length;c=e.alloc(g);$.each(a,function(a,b){e.repeat("vert",b,c+6*a,6);e.write("unit",Ka,c+6*a,6)})};this.draw=
function(){var c=a.gl;e.update();c.useProgram(b);b.data("screen",a.camera.mat3);b.data("pos",e.get("vert"));b.data("circle_in",e.get("unit"));b.data("color_in",e.get("fill_color"));b.data("stroke_color_in",e.get("stroke_color"));b.data("alpha_in",e.get("alpha"));b.data("fill_in",e.get("fill"));b.data("stroke_in",e.get("stroke"));b.data("aspect",a.canvas.width()/a.canvas.height());b.data("pix_w",2/a.canvas.width());b.data("rad",e.get("rad"));b.data("stroke_width_in",e.get("stroke_width"));b.data("max_rad",
d);c.drawArrays(c.TRIANGLES,0,e.count())}}function La(a,c){for(var b=6*c.length,d=a.alloc(b),e=[-1,1,-1,-1,1,-1,-1,1,1,-1,1,1],f=0,h=function(){if(c[f]){var a=new vect(c[f][0],c[f][1]);f++;return a}return null},k=null,g=h(),s=h(),m=[],p=[],j=[];g;)m.push(k||vect.add(g,vect.sub(g,s))),p.push(g),j.push(s||vect.add(g,vect.sub(g,k))),k=g,g=s,s=h();currentIndex=d;d=function(b,c,d){a.write("prev",b.array(),currentIndex,1);a.write("current",c.array(),currentIndex,1);a.write("next",d.array(),currentIndex,
1);currentIndex++};for(h=1;h<c.length;h++)a.write("unit",e,currentIndex,6),d(m[h-1],p[h-1],j[h-1]),d(j[h-1],p[h-1],m[h-1]),d(j[h],p[h],m[h]),d(m[h-1],p[h-1],j[h-1]),d(j[h],p[h],m[h]),d(m[h],p[h],j[h]);return b}function W(a){ea.call(this,a);a.shaders.line||(a.shaders.line=B(a.gl,y+"shaders/line"));var c=a.shaders.line,b=new P(a.gl,1024);b.create("prev",2);b.create("current",2);b.create("next",2);b.create("unit",2);b.create("width",1);b.create("color",3);b.create("alpha",1);this.View=function(a,c){da.call(this,
a,c);var f=b.count(),h=0;this.style_map={stroke:function(a){b.repeat("color",a.array,f,h)},"stroke-opacity":function(a){b.repeat("alpha",[a],f,h)},"stroke-width":function(a){b.repeat("width",[a],f,h)}};$.each(a,function(a,c){for(a=0;a<c.length;a++)h+=La(b,c[a])})};this.draw=function(){var d=a.gl;b.update();d.useProgram(c);c.data("world",a.camera.worldToPx);c.data("screen",a.camera.pxToScreen);c.data("prev",b.get("prev"));c.data("current",b.get("current"));c.data("next",b.get("next"));c.data("color_in",
b.get("color"));c.data("alpha_in",b.get("alpha"));c.data("circle_in",b.get("unit"));c.data("width",b.get("width"));c.data("px_w",2/a.canvas.width());c.data("px_h",2/a.canvas.height());d.drawArrays(d.TRIANGLES,0,b.count())}}function Ma(a){ea.call(this,a);a.shaders.polygon||(a.shaders.polygon=B(a.gl,y+"shaders/poly"));var c=a.shaders.polygon,b=new P(a.gl,Na);b.create("vert",2);b.create("color",3);b.create("alpha",1);this.View=function(a,c){da.call(this,a,c);var f,h;this.style_map={fill:function(a){b.repeat("color",
a.array,f,h)},"fill-opacity":function(a){b.repeat("alpha",[a],f,h)}};var k=[];h=0;$.each(a,function(a,b){for(var c,d=0;100>d;)try{for(var e=b,f=[],g=[],j=0;j<e.length;j++){var l=[];if(3>=e[j].length)g.push(e[j]);else for(var v=1;v<e[j].length;v++)l.push(ra(e[j][v][0],e[j][v][1]));l.push(f[0]);f.push(l)}for(var n=Oa(f),v=0;v<g.length;v++)n.push(g[v][0][0]),n.push(g[v][0][1]),n.push(g[v][1][0]),n.push(g[v][1][1]),n.push(g[v][2][0]),n.push(g[v][2][1]);c=n;break}catch(q){d++}100==d&&(console.log("Rendering Polygon Failed: Skipping Interior"),
c=[]);h+=c.length/2;k.push(c)});var g=f=b.alloc(h);$.each(k,function(a,c){var d=c.length/2;b.write("vert",c,g,d);g+=d})};this.draw=function(){var d=a.gl;b.update();d.useProgram(c);c.data("screen",a.camera.mat3);c.data("pos",b.get("vert"));c.data("color_in",b.get("color"));c.data("alpha_in",b.get("alpha"));d.drawArrays(d.TRIANGLES,0,b.count())}}function sa(a,c,b){var d=this;E.manage(c);E.linkParent(a,c);this.renderers={};this.views={};var e=function(b,e){var k=z.derivedStyle(b,c,a,e);d.views[b.id].update(e,
k)};c.features().each(function(f,h){var k;k=h.type in a.Renderers?h.type:"default";k in d.renderers||(d.renderers[k]=new a.Renderers[k](a,c,b));k=d.renderers[k].create(b.geomFunc(h),function(b){return function(d){return z.derivedStyle(b,c,a,d)}}(h));d.views[h.id]=k;E.manage(h);E.linkParent(c,h);E.addEventHandler(h,"style",e)});this.draw=function(a,b){for(var c in this.renderers)this.renderers[c].draw(b)}}function ta(a,c){var b=this;j(c,{background:new r(0,0,0,1)});this.type="Engine";this.id=J();this.canvas=
$("<canvas></canvas>").attr("id","viewer");var d=null;a?($(a).append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height())):(a=window,$("body").append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height()),$(window).resize(function(){b.resize()}));var e=[];this.resize=function(){this.canvas.attr("width",$(a).width());this.canvas.attr("height",$(a).height());d.viewport(0,0,this.canvas.width(),this.canvas.height());this.camera.reconfigure();
for(var b=0;b<e.length;b++)e[b].resize()};var f=this.canvas;this.gl=d=Pa?WebGLDebugUtils.makeDebugContext(f.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1}),function(a,b){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to "+b;}):f.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1});d.viewport(0,0,this.canvas.width(),this.canvas.height());d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.enable(d.BLEND);this.camera=
new Ga(this.canvas,c);this.scroller=new Ha(this,c);this.extents=function(a){this.camera.extents(a)};this.center=function(a,b){void 0===b?this.camera.position(a):this.camera.position(new vect(a,b))};this.pxW=1/this.canvas.attr("width");this.pxH=1/this.canvas.attr("height");this.Renderers={};this.Queriers={};this.renderers={};this.views={};this.styles={};this.defaultStyle=function(a,b){var c;a in this.styles&&(c=this.styles[a][b]);if(null===c||void 0===c)c=this.styles["default"][b];return null===c||
void 0===c?null:c};E.manage(this);this.search=function(a,b){return this.queriers[a.id].boxSearch(b)};this.style=function(a,b,c){void 0===this.styles[a.id]&&(this.styles[a.id]={});if(void 0===c)return void 0!==this.styles[a.id][b]?this.styles[a.id][b]:null;this.styles[a.id][b]=c;a.id in this.views?this.views[a.id].update(b):a.id in this.renderers&&$.each(this.renderers[a.id],function(a,b){b.update()})};var h=new Qa(this);this.select=function(a){h.select(a)};var k=!1;this.enableSelect=function(){this.scroller.disable();
h.enable();k=!0};this.disableSelect=function(){this.scroller.enable();h.disable();k=!1};var g=(new Date).getTime(),s=[],m,p=this;m=function(){p.draw()};this.shaders={};this.scene=[];this.queriers={};this.draw=function(){var a=(new Date).getTime(),e=(a-g)/1E3;this.scroller.update(e);60<=s.length&&s.splice(0,1);s.push(e);for(var f=0,p=0;p<s.length;p++)f+=s[p];f/=s.length;$("#fps").text(Math.floor(1/f));g=a;d.clearColor(c.background.r,c.background.g,c.background.b,c.background.a);d.clear(d.COLOR_BUFFER_BIT);
d.clearDepth(0);$.each(this.scene,function(a,c){c.draw(b,e)});requestAnimationFrame(m);k&&h.draw(this,e)};this.enableZ=function(){d.depthFunc(d.LEQUAL);d.enable(d.DEPTH_TEST)};this.disableZ=function(){d.disable(d.DEPTH_TEST)};requestAnimationFrame(m)}function Qa(a){var c=B(a.gl,y+"shaders/selbox"),b=!1,d=!1,e=null,f=null,h=ca(a.gl,6,2),k=D(a.gl,na(0,0,1,1),2);a.canvas.bind("mousedown",function(c){b&&(show=d=!0,f=e=a.camera.percent(new vect(c.clientX,c.clientY)),h.update(w(e,f),0))});var g=function(){};
this.select=function(a){g=a};$(document).bind("mouseup",function(){if(b&&d){var c=a.camera.project(a.camera.pixel(e)),h=a.camera.project(a.camera.pixel(f));if(c.x>h.x){var k=c.x;c.x=h.x;h.x=k}c.y>h.y&&(k=c.y,c.y=h.y,h.y=k);d=!1;g(new K(c,h))}});$(document).bind("click",function(){b&&(show=!1)});$(document).bind("mousemove",function(c){b&&d&&(f=a.camera.percent(new vect(c.clientX,c.clientY)),h.update(w(e,f),0))});this.enable=function(){b=!0};this.disable=function(){b=!1};this.draw=function(a){a=a.gl;
d&&(a.useProgram(c),c.data("pos",h),c.data("edge_in",k),a.drawArrays(a.TRIANGLES,0,h.numItems))}}function ua(a,c){for(;a>=c;)a-=c;for(;0>a;)a+=c;return a}function Ra(a,c,b,d){this.current=a;this.upper=c;this.lower=b;this.index=d}function va(a,c){for(var b=0;b<a.length;b++)if(a[b]==c)return!0;return!1}function X(a,c,b){if(void 0==c)throw"whoa";return 0==a[c+1].y-a[c].y?Math.min(a[c].x,a[c+1].x):a[c].x+(a[c+1].x-a[c].x)*((b-a[c].y)/(a[c+1].y-a[c].y))}function L(a,c){for(var b=0;b<a.length;b++)if(a[b]==
c)return b;return!1}function x(a,c,b){return new vect(X(c,b,c[a].y),c[a].y)}function F(a,c){if(!c)throw"eek";a.push(c.x);a.push(c.y)}function M(a,c,b){if(!c||!b||3!=b.length+c.length&&4!=b.length+c.length)throw"ahh";if(3==c.length+b.length){for(var d=0;d<c.length;d++)F(a,c[d]);for(d=0;d<b.length;d++)F(a,b[d])}else c[1].x<c[0].x&&(d=c[0],c[0]=c[1],c[1]=d),b[1].x<b[0].x&&(d=b[0],b[0]=b[1],b[1]=d),F(a,c[0]),F(a,c[1]),F(a,b[1]),F(a,b[0]),F(a,b[1]),F(a,c[0])}function Oa(a){for(var c=[],b=0,d=[],e=0;e<
a.length;e++){for(var f=0;f<a[e].length-1;f++){var h=ua(f+1,a[e].length-1),k=ua(f-1,a[e].length-1);c.push(new Ra(f+b,h+b,k+b,e));d.push(a[e][f])}d.push(a[e][0]);b+=a[e].length}c.sort(function(a,b){return d[a.current].y-d[b.current].y});a=[];e=[];new vect(-200,0);new vect(200,0);b=0;b=[];k=[];for(f=0;f<c.length;f++){var g=c[f],h=va(a,g.lower),s=va(a,g.current),m,p;if(h&&!s)p=m=L(a,g.lower);else if(s&&!h)m=p=L(a,g.current);else if(h&&s)m=L(a,g.lower),p=L(a,g.current);else if(!h&&!s){a:{m=a;p=d;for(var j=
d[g.current].x,l=d[g.current].y,n=0;n<m.length;n++){var q=X(p,m[n],l);if(q>j||0==q-j&&p[m[n]].y>p[index].y){p=n;break a}}p=m.length}m=p}if(1<Math.abs(m-p)){for(h=0;h<a.length;h++);throw"Bad";}j=vect.left(d[g.lower],d[g.current],d[g.upper]);l=Math.floor(Math.min(m,p)/2);!j&&!h&&!s?(M(k,e[l],[x(g.current,d,a[p-1]),x(g.current,d,a[p])]),e.splice(l,1,[x(g.current,d,a[p-1]),d[g.current]],[d[g.current],x(g.current,d,a[m])])):j&&!h&&!s?e.splice(l,0,[d[g.current]]):h&&!s?(M(k,e[l],[x(g.current,d,a[Math.max(m,
p)-1]),d[g.current]]),e[l]=[x(g.current,d,a[Math.min(m,p)-1]),d[g.current]]):!h&&s?(M(k,e[l],[d[g.current],x(g.current,d,a[Math.min(p,m)+1])]),e[l]=[d[g.current],x(g.current,d,a[Math.max(p,m)+1])]):!j&&h&&s?(M(k,e[l],[x(g.current,d,a[Math.min(m,p)-1]),d[g.current]]),M(k,e[l+1],[x(g.current,d,a[Math.max(m,p)+1]),d[g.current]]),e.splice(l,2,[x(g.current,d,a[Math.min(m,p)-1]),x(g.current,d,a[Math.max(m,p)+1])])):j&&(h&&s)&&(M(k,e[l],[d[g.current]]),e.splice(l,1));h&&!s?a[m]=g.current:s&&!h?a[p]=g.lower:
h&&s?(a.splice(L(a,g.lower),1),a.splice(L(a,g.current),1)):!h&&!s&&(j?a.splice(m,0,g.lower,g.current):a.splice(m,0,g.current,g.lower));for(h=0;h<a.length-1;h++)if(X(d,a[h],d[g.current].y)>X(d,a[h+1],d[g.current].y))throw console.log("Misplaced Sweep"),"Misplace!";}if(0<a.length)throw console.log(a),"Bad "+a.length;if(0<b.length)throw console.log(b),"Wrong";return k}function K(a,c){this.min=a.clone();this.max=c.clone();this.contains=function(b){return a.x<=b.x&&c.x>=b.x&&a.y<=b.y&&c.y>=b.y};this.x_in=
function(b){return a.x<=b.x&&c.x>=b.x};this.x_left=function(b){return a.x>=b.x};this.x_right=function(a){return c.x<=a.x};this.y_in=function(b){return a.y<=b.y&&c.y>=b.y};this.y_left=function(b){return a.y>=b.y};this.y_right=function(a){return c.y<=a.y};this.area=function(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)};this.height=function(){return this.max.y-this.min.y};this.width=function(){return this.max.x-this.min.x};this.vertex=function(a){switch(a){case 0:return this.min.clone();case 1:return new vect(this.max.x,
this.min.y);case 2:return this.max.clone();case 3:return new vect(this.min.x,this.max.y);default:throw"Index out of bounds: "+a;}};this.intersects=function(a){for(var c=0;4>c;c++)for(var e=0;4>e;e++)if(vect.intersects(this.vertex(c),this.vertex((c+1)%4),a.vertex(e),a.vertex((e+1)%4)))return!0;return this.contains(a.min)&&this.contains(a.max)&&this.contains(new vect(a.min.x,a.max.y))&&this.contains(new vect(a.max.x,a.min.y))||a.contains(this.min)&&a.contains(this.max)&&a.contains(new vect(this.min.x,
this.max.y))&&a.contains(new vect(this.max.x,this.min.y))?!0:!1};this.union=function(a){this.min.x=Math.min(this.min.x,a.min.x);this.min.y=Math.min(this.min.y,a.min.y);this.max.x=Math.max(this.max.x,a.max.x);this.max.y=Math.max(this.max.y,a.max.y)};this.centroid=function(){return new vect((this.max.x+this.min.x)/2,(this.max.y+this.min.y)/2)};this.clone=function(){return new K(a,c)}}function ha(a,c,b,d){this.data=a[d];this.right=this.left=null;c!=d&&(this.left=new ha(a,c,d-1,parseInt((c+(d-1))/2)));
b!=d&&(this.right=new ha(a,d+1,b,parseInt((b+(d+1))/2)));this.subtree=[];for(d=c;d<=b;d++)this.subtree.push(a[d]);this.subtree.sort(function(a,b){return a.y-b.y});this.yrange=function(a,b,c){return a.y_in(this.subtree[b])&&a.y_in(this.subtree[c])};this.subquery=function(a,b,c,d,g){if(this.yrange(b,c,d))for(b=c;b<=d;b++)a.push(this.subtree[b]);else b.y_in(this.subtree[g])&&a.push(this.subtree[g]),b.y_left(this.subtree[g])?g!=d&&this.subquery(a,b,g+1,d,parseInt((d+(g+1))/2)):(b.x_right(this.subtree[g])||
g!=d&&this.subquery(a,b,g+1,d,parseInt((d+(g+1))/2)),g!=c&&this.subquery(a,b,c,g-1,parseInt((c+(g-1))/2)))};this.search=function(d,f){f.x_in(a[c])&&f.x_in(a[b])?this.subquery(d,f,0,this.subtree.length-1,parseInt((this.subtree.length-1)/2)):(f.contains(this.data)&&d.push(this.data),f.x_left(this.data)?this.right&&this.right.search(d,f):f.x_right(this.data)?this.left&&this.left.search(d,f):(this.left&&this.left.search(d,f),this.right&&this.right.search(d,f)))}}function Y(a){a.sort(function(a,b){return a.x-
b.x});0<a.length?this.root=new ha(a,0,a.length-1,parseInt((a.length-1)/2)):null==this.root;this.search=function(a){if(!this.root)return[];a=a.clone();var b=[];this.root.search(b,a);return b}}function wa(a){var c=new vect(Infinity,Infinity),b=new vect(-Infinity,-Infinity);$.each(a,function(a,e){$.each(e,function(a,d){$.each(d,function(a,d){d[0]<c.x&&(c.x=d[0]);d[0]>b.x&&(b.x=d[0]);d[1]<c.y&&(c.y=d[1]);d[1]>b.y&&(b.y=d[1])})})});return new K(c,b)}function Z(a){a||(a={});this.id=J();this.type="Layer";
var c={};if(a.style)throw"Not Implemeneted";this.style=function(a,b,c){var d;!a||"Engine"==a.type?(d=a,a=b,b=c):d=null;if(void 0===b)return z.getStyle(this,d,a);z.setStyle(this,d,a,b);return this};this.bounds=null;this.features=function(){var a=[],b;for(b in c)a.push(c[b]);return new t(a)};var b={};this.properties=function(){var a=[],c;for(c in b)a.push(c);return a};this.numeric=function(){var a=[],c;for(c in b)b[c]&&a.push(c);return a};var d={};this.attr=function(a,b){if(2>arguments.length)return void 0!==
d[a]?d[a]:null;d[a]=b};this.fixed=!1;this.append=function(a){if(this.fixed)throw"Layers are currently immutable once added to a map";var d=new Sa[a.type](a,this);c[d.id]=d;this.bounds?this.bounds.union(d.bounds):this.bounds=d.bounds.clone();for(var e in a.attr)b[e]=void 0===b[e]?isNaN(a.attr[e])?!1:!0:!isNaN(a.attr[e])&&b[e]?!0:!1;dirty=!0;return d};var e=null,f=null;this.mouseover=function(a){e=a};this.mouseout=function(a){f=a};var h={};this.update_move=function(a,b){if(e||f){var c=this.map_contains(a,
b),d={};c&&c.each(function(a,b){d[b.id]=b});for(var p in h)!(p in d)&&f&&f(h[p]);for(p in d)!(p in h)&&e&&e(d[p]);h=d}};this.force_out=function(){for(var a in h)f&&f(h[a]);h={}}}function ia(a){A||(A=B(engine.gl,y+"shaders/grid"));a||(a={});a.style||(a.style={});var c=a.lower,b=a.upper,d=a.rows,e=a.cols,f=(b.x-c.x)/e,h=(b.y-c.y)/d,k=new Float32Array(d*e),g=new Uint8Array(4*e*d),j=!1,m=new P(engine.gl,6);m.create("vert",2);m.create("screen",2);m.create("tex",2);var p=new vect(c.x,c.y),l=new vect(b.x,
b.y),n=new vect(0,0),q=new vect(1,1),fa=m.alloc(6);m.write("vert",w(p,l),fa,6);m.write("screen",w(new vect(-1,-1),new vect(1,1)),fa,6);m.write("tex",w(n,q),fa,6);var ga=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,ga);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindTexture(gl.TEXTURE_2D,
null);this.lower=function(){return c.clone()};this.upper=function(){return b.clone()};this.rows=function(){return d};this.cols=function(){return e};this.centroid=function(a,b){return new vect(c.x+f*b+f/2,c.y+h*a+h/2)};this.get=function(a,b){return k[e*a+b]};var r=-Infinity,v=Infinity;this.qunatiles=function(a,b){b||(b=function(a,b){return a-b});for(var c=[],d=0;d<k.length;d++)c.push(k[d]);c.sort(b);for(var e=[-Infinity],d=1;d<a;d++){var f=parseInt(inc*d);e.push(c[f])}e.push(Infinity);return e};this.set=
function(a,b,c){if(a>=d||b>=e)throw"Index Out of Bounds";k[e*a+b]=c;j=!0};this.raw_set=function(a,b){if(a>=d*e)throw"Index Out of Bounds: "+a;k[a]=b;j=!0};this.clear=function(a){for(var b=0;b<d*e;b++)k[b]=a};this.initialize=function(){};var t=null;this.draw=function(b){t||(t=b.framebuffer());m.update();if(j){r=-Infinity;v=Infinity;for(var c=0;c<d*e;c++){var f=k[c];f>r&&(r=f);f<v&&(v=f)}for(c=0;c<d*e;c++){var f=c,h=a.map(v,r,k[c]);g[4*f]=parseInt(255*h.r);g[4*f+1]=parseInt(255*h.g);g[4*f+2]=parseInt(255*
h.b);g[4*f+3]=parseInt(255*h.a)}gl.bindTexture(gl.TEXTURE_2D,ga);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,d,0,gl.RGBA,gl.UNSIGNED_BYTE,g);gl.bindTexture(gl.TEXTURE_2D,null);j=!1}a.style.antialias&&t.activate({blend:!1});gl.useProgram(A);A.data("screen",b.camera.mat3);A.data("pos",m.get("vert"));A.data("tex_in",m.get("tex"));A.data("sampler",ga);c=vect.sub(b.camera.screen(l),b.camera.screen(p));A.data("width",c.x);A.data("height",-c.y);A.data("rows",d);A.data("cols",e);A.data("blur",a.blur);gl.drawArrays(gl.TRIANGLES,
0,m.count());a.style.antialias&&(t.deactivate(),b.draw_blur(t.tex))}}function xa(a,c,b){var d,e,f,h=!1;this.id=J();var k=!1;this.initialize=function(g){d||(d=B(g.gl,y+"shaders/raster"));this.image=U(g.gl,a,function(){k=!0});e=D(g.gl,w(new vect(0,1),new vect(1,0)),2);f=D(g.gl,w(c,b),2);h=!0};this.draw=function(a){var b=a.gl;h||this.initialize(a);k&&(b.useProgram(d),d.data("screen",a.camera.mat3),d.data("pos",f),d.data("tex_in",e),d.data("sampler",this.image),b.drawArrays(b.TRIANGLES,0,f.numItems))}}
function ya(a){u||(u=B(y+"shaders/hillshade"));var c=$(a).find("LatLonBox"),b=new vect(parseFloat(c.find("west").text()),parseFloat(c.find("south").text())),d=new vect(parseFloat(c.find("east").text()),parseFloat(c.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var e=!1,f=U(a,function(){e=!0});this.ready=function(){return e};var h=D(w(new vect(0,1),new vect(1,0)),2),k=D(w(b,d),2),g=315;this.draw=function(a){if(e){for(gl.useProgram(altitude_shader);1<=g;)g-=1;altitude_shader.data("azimuth",
g);altitude_shader.data("altitude",Math.PI/4/(2*Math.PI));altitude_shader.data("screen",a.camera.mat3);altitude_shader.data("pos",k);altitude_shader.data("tex_in",h);altitude_shader.data("elevation",f);a=vect.sub(a.camera.screen(d),a.camera.screen(b));altitude_shader.data("pix_w",1/a.x);altitude_shader.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,k.numItems);return g}}}function ya(a){u||(u=B(engine.gl,y+"shaders/hillshade"));var c=$(a).find("LatLonBox"),b=new vect(parseFloat(c.find("west").text()),
parseFloat(c.find("south").text())),d=new vect(parseFloat(c.find("east").text()),parseFloat(c.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var e=!1,f=U(engine.gl,a,function(){e=!0});this.ready=function(){return e};var h=D(engine.gl,w(new vect(0,1),new vect(1,0)),2),k=D(engine.gl,w(b,d),2),g=315;this.initialize=function(){};this.draw=function(a){if(e){for(gl.useProgram(u);1<=g;)g-=1;u.data("azimuth",g);u.data("altitude",Math.PI/4/(2*Math.PI));u.data("screen",a.camera.mat3);
u.data("pos",k);u.data("tex_in",h);u.data("elevation",f);a=vect.sub(a.camera.screen(d),a.camera.screen(b));u.data("pix_w",1/a.x);u.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,k.numItems);return g}}}function aa(a){function c(a){a||(a={});a.desaturate||(a.desaturate=0);a.darken||(a.darken=0);a.hue||(a.hue=0);a.hue_color||(a.hue_color=ma(0,0,0,1));var c=a.url,d=a.min,e=a.rows,g=a.cols,k=a.cellsize;this.rows=e;this.cols=g;for(var j={},m={},s=function(b,c){var e=new vect(d.x+b*k,d.y+c*k),f=new vect(d.x+
(b+1)*k,d.y+(c+1)*k),e={vert:w(e,f,a.z_index),tex:null,i:b,j:c,id:b+g*c,ready:!1,min:e,max:f};m[b][c]=e;j[e.id]=e},l=0;l<g;l++)m[l]={};this.size=function(a){var b=a.camera.screen(d);a=a.camera.screen(vect.add(d,new vect(k*g,k*e)));b=vect.sub(a,b);b.y=Math.abs(b.y);return b};var n=!1;this.noexpire=function(a){n=a};this.cull=function(){if(!n){var b=(new Date).getTime(),c;for(c in r)if(b-r[c]>Ta){var d=j[c];delete j[c];delete m[d.i][d.j];a.available.push(d.tex);d.tex=null;d.ready=!1;delete r[c]}}};var q=
function(){var a=f.camera.project(new vect(f.canvas.offset().left,f.canvas.offset().top+f.canvas.height())),b=f.camera.project(new vect(f.canvas.offset().left+f.canvas.width(),f.canvas.offset().top)),c=Math.floor((a.x-d.x)/k),e=Math.ceil((b.x-d.x)/k),a=Math.floor((a.y-d.y)/k),b=Math.ceil((b.y-d.y)/k);return{min_col:c,max_col:e,min_row:a,max_row:b}},r={};this.ready=function(){for(var a=q(),b=Math.max(0,a.min_col);b<Math.min(g,a.max_col);b++)for(var c=Math.max(0,a.min_row);c<Math.min(e,a.max_row);c++)if(!m[b][c]||
!m[b][c].ready)return!1;return!0};var t=function(b,d){if(!m[b][d].tex){var e;if("file"==a.source)e=c+"/"+m[b][d].id+".png";else if("wms"==a.source){e={service:"wms",version:"1.1.0",request:"GetMap",layers:a.layer,bbox:[m[b][d].min.x,m[b][d].min.y,m[b][d].max.x,m[b][d].max.y].join(),width:a.size,height:a.size,srs:"EPSG:4326",format:"image/png",transparent:"true"};var f=[],g;for(g in e)f.push(g+"="+e[g]);e=c+"?"+f.join("&")}m[b][d].tex=a.available.pop();m[b][d].tex||(m[b][d].tex=new qa(h));g=e;var k=
m[b][d],j=new Image;j.crossOrigin="";j.onload=function(){k.tex&&(k.tex.image(j),k.ready=!0)};j.src=g}};this.fetch_all=function(){for(var a=(new Date).getTime(),b=0;b<g;b++)for(var c=0;c<e;c++)m[b][c]||s(b,c),m[b][c].tex||t(b,c),r[m[b][c].id]=a};this.fetch=function(){for(var a=q(),b=(new Date).getTime(),c=Math.max(0,a.min_col-1);c<Math.min(g,a.max_col+1);c++)for(var d=Math.max(0,a.min_row-1);d<Math.min(e,a.max_row+1);d++)m[c][d]||s(c,d),m[c][d].tex||t(c,d),r[m[c][d].id]=b};var u=!1;this.initialize=
function(a){if(u)throw"Not Implemented: Migrating Tile Layers to New Map";b||(b=B(a.gl,y+"shaders/tile"));u=!0};this.draw=function(c,d,f,k,j){u||this.initialize(c);c=function(){za++;f.update();b.data("pos",f.get("vert"));b.data("tex_in",f.get("tex"));b.data("lookup_in",f.get("lookup"));b.data("desaturate",a.desaturate);b.data("darken",a.darken);b.data("hue",a.hue);b.data("hue_color",a.hue_color.array);h.drawArrays(h.TRIANGLES,0,6*k)};d=q();for(var s=(new Date).getTime(),l=Math.max(0,d.min_col);l<
Math.min(g,d.max_col);l++)for(var n=Math.max(0,d.min_row);n<Math.min(e,d.max_row);n++)if(m[l][n]&&m[l][n].ready&&m[l][n].tex){f.write("vert",m[l][n].vert,6*k,6);f.write("tex",w(new vect(0,0),new vect(1,1)),6*k,6);f.repeat("lookup",[k/Q+1/(2*Q)],6*k,6);r[m[l][n].id]=s;b.data("sampler"+k,m[l][n].tex);if(null==m[l][n].tex)throw"badness";k++;Aa++;k>=Q&&(c(),k=0)}j&&c();return k}}var b=null,d=[],e=[],f=null,h=null;this.id=J();for(var k=0;k<a.levels;k++){var g=l(a);"file"==g.source&&(g.url+="/"+a.size*
Math.pow(2,k+1));g.min=new vect(-180,-90);g.rows=Math.pow(2,k);g.cols=2*g.rows;g.cellsize=180/g.rows;g.z_index=1-ja-k/1E3;g.available=e;g=new c(g);d.push(g)}ja+=(a.levels+2)/1E3;var j=null,m=!1;this.initialize=function(a){f=a;b||(b=B(f.gl,y+"shaders/tile"));h=f.gl;j=new P(f.gl,6*Q);j.create("vert",3);j.create("tex",2);j.create("lookup",1);j.alloc(6*Q);for(a=0;25>a;a++)e.push(new qa(f.gl));for(a=0;a<d.length;a++)d[a].initialize(f);d[0].fetch_all();d[0].noexpire(!0);m=!0};this.draw=function(c,e){m||
initialize(c);h.useProgram(b);b.data("screen",c.camera.mat3);za=Aa=0;for(var f=Infinity,g=d[0],k,l=0;l<d.length;l++){var n=a.size*d[l].cols/d[l].size(c).x;1>n&&(n=1/n);n<f&&(f=n,g=d[l],k=l)}for(l=k;0<=l;l--)d[l].fetch();if(g.ready())g.draw(c,e,j,0,!0);else{c.enableZ();f=0;for(l=k;0<=l;l--)f=d[l].draw(c,e,j,f,0==l);c.disableZ()}$.each(d,function(a,b){b.cull()})}}var y="",N=jQuery,Ua=function(a){if("string"===typeof a.data){var c=a.handler,b=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==
a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var e="keypress"!==a.type&&N.hotkeys.specialKeys[a.which],f=String.fromCharCode(a.which).toLowerCase(),h="",k={};a.altKey&&"alt"!==e&&(h+="alt+");a.ctrlKey&&"ctrl"!==e&&(h+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==e)&&(h+="meta+");a.shiftKey&&"shift"!==e&&(h+="shift+");e?k[h+e]=!0:(k[h+f]=!0,k[h+N.hotkeys.shiftNums[f]]=!0,"shift+"===h&&(k[N.hotkeys.shiftNums[f]]=!0));e=0;for(f=b.length;e<f;e++)if(k[b[e]])return c.apply(this,
arguments)}}}};N.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",
144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"}};N.each(["keydown","keyup","keypress"],function(){N.event.special[this]={add:Ua}});var G=jQuery,ka=function(a){var c=a||window.event,b=[].slice.call(arguments,1),d=0,e=0,f=0;a=G.event.fix(c);a.type="mousewheel";c.wheelDelta&&
(d=c.wheelDelta/120);c.detail&&(d=-c.detail/3);f=d;void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(f=0,e=-1*d);void 0!==c.wheelDeltaY&&(f=c.wheelDeltaY/120);void 0!==c.wheelDeltaX&&(e=-1*c.wheelDeltaX/120);b.unshift(a,d,e,f);return(G.event.dispatch||G.event.handle).apply(this,b)},O=["DOMMouseScroll","mousewheel"];if(G.event.fixHooks)for(var H=O.length;H;)G.event.fixHooks[O[--H]]=G.event.mouseHooks;G.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=O.length;a;)this.addEventListener(O[--a],
ka,!1);else this.onmousewheel=ka},teardown:function(){if(this.removeEventListener)for(var a=O.length;a;)this.removeEventListener(O[--a],ka,!1);else this.onmousewheel=null}};G.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});for(var Ba=0,H=["ms","moz","webkit","o"],R=0;R<H.length&&!window.requestAnimationFrame;++R)window.requestAnimationFrame=window[H[R]+"RequestAnimationFrame"],window.cancelAnimationFrame=
window[H[R]+"CancelAnimationFrame"]||window[H[R]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var c=(new Date).getTime(),b=Math.max(0,16-(c-Ba)),d=window.setTimeout(function(){a(c+b)},b);Ba=c+b;return d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var V={x:0,y:0};$(document).mousemove(function(a){V.x=a.clientX;V.y=a.clientY});var Pa=!1,pa=0,z=new function(){this.styles={};this.derivedStyle=function(a,
b,d,e){if(!d)throw"Undefined operation";var f;f=this.getStyle(a,d,e);null===f&&(f=this.getStyle(a,null,e),null===f&&(f=this.getStyle(b,d,e),null===f&&(f=this.getStyle(b,null,e),null===f&&(f=d.defaultStyle(a.type,e)))));return f};var a=function(a,b){var d=b?b.id:"default";d in z.styles||(z.styles[d]={});a.id in z.styles[d]||(z.styles[d][a.id]={})};this.getStyle=function(c,b,d){a(c,b);c=this.styles[b?b.id:"default"][c.id][d];return void 0===c?null:c};this.setStyle=function(c,b,d,e){a(c,b);this.styles[b?
b.id:"default"][c.id][d]=e;E.trigger(c,"style",[c,d])}},E=new function(){this.listeners={};this.manage=function(a){a.id in this.listeners||(this.listeners[a.id]={parents:[],callbacks:{}})};this.linkParent=function(a,c){this.listeners[c.id].parents.push(a.id)};this.addEventHandler=function(a,c,b){this.listeners[a.id].callbacks[c]||(this.listeners[a.id].callbacks[c]=[]);this.listeners[a.id].callbacks[c].push(b)};this.moveMouse=function(){};this.clickMouse=function(){};this.mouseDown=function(){};this.trigger=
function(a,c,b){a.id in this.listeners&&(c in this.listeners[a.id].callbacks&&$.each(this.listeners[a.id].callbacks[c],function(c,e){e.apply(a,b)}),$.each(this.listeners[a.id].parents,function(a,e){E.trigger(e,c,b)}))}},Ja=1024,Ka=na(0,0,1,1),Na=1024,Ca=function(a,c,b){var d={};$.each(a.Queriers,function(e,f){d[e]=new f(a,c,b)});this.boxSearch=function(a){var b=new t([]),c;for(c in d)var k=d[c].boxSearch(a),b=b.join(k);return b};this.pointSearch=function(a){var b=new t([]),c;for(c in d)var k=d[c].pointSearch(a),
b=b.join(k);return b}},Va=function(a,c){var b=[],d=0;c.features().type("Point").each(function(e,h){var k=z.derivedStyle(h,c,a,"radius");k>d&&(d=k);$.each(h.geom,function(a,c){b.push({x:c[0],y:c[1],ref:h})})});var e=new Y(b);this.boxSearch=function(a){a=e.search(a);var b=[];$.each(a,function(a,c){b.push(c.ref)});return new t(b)};this.pointSearch=function(b){for(var h=vect.add(b,new vect(-d,d)),k=vect.add(b,new vect(d,-d)),h=new K(a.camera.project(h),a.camera.project(k)),h=e.search(h),k=0;k<h.length;k++)for(var g=
h[k].ref,j=z.derivedStyle(g,c,a,"radius"),k=0;k<g.geom.length;k++){var m=a.camera.screen(geom2vect(g.geom[k]));if(vect.dist(m,b)<j)return new t([g.ref])}return new t([])}},Wa=function(a,c){var b=c.features().type("Polygon"),d=[];b.each(function(a,b){$.each(b.geom,function(a,c){$.each(c,function(a,c){$.each(c,function(a,c){d.push({ref:b,x:c[0],y:c[1]})})})})});var e=new Y(d);this.boxSearch=function(a){var c=e.search(a),d={};$.each(c,function(a,b){d[b.ref.id]=b.ref});b.each(function(b,c){for(var e=
0;4>e;e++)c.contains(a.vertex(e))&&(d[c.id]=c)});var c=[],g;for(g in d)c.push(d[g]);return new t(c)};this.pointSearch=function(a){var b=[];c.feature().each(function(c,d){d.contains(a)&&b.push(d)});return new t(b)}},Xa=function(a,c,b){var d=[];c.features().each(function(a,c){var e=function(a){d.push({ref:c,x:a.x,y:a.y})};$.each(b.geomFunc(c),function(a,b){$.each(b,function(a,b){var c=new vect(b[0][0],b[0][1]);e(c);for(var d=1;d<b.length;d++){for(var f=new vect(b[d][0],b[d][1]),g=0;1>g;){var g=g+0.1,
h=vect.sub(f,c).scale(g);e(vect.add(c,h))}c=f}})})});var e=new Y(d);this.boxSearch=function(a){a=e.search(a);var b={};$.each(a,function(a,c){b[c.ref.id]=c.ref});a=[];for(var c in b)a.push(b[c]);return new t(a)};this.pointSearch=function(){return new t([])}},la=function(a){this.id=J();this.type="Feature";this.type=a.type;var c=a.attr;this.attr=function(a,d){if(void 0===d)return c[a];throw"Not Implemented";};this.geom=a.geom;this.geometry=function(){};this.style=function(a,c,e){var f;!a||"Engine"==
a.type?(f=a,a=c,c=e):f=null;if(void 0===c)return z.getStyle(this,f,a);z.setStyle(this,f,a,c);return this}},J,Da=1;J=function(){var a=Da;Da++;return a};var ra;ra=function(a,c){return new vect(a+1E-6*Math.random()-5E-7,c+1E-6*Math.random()-5E-7)};var Sa={Point:function(a,c){la.call(this,a,c);this.bounds=null;for(var b=0;b<this.geom.length;b++){var d=new vect(this.geom[b][0],this.geom[b][1]),d=new K(d.clone(),d.clone());this.bounds?this.bounds.union(d):this.bounds=d}this.map_contains=function(a,b){for(var d=
z.derivedStyle(this,c,a,"radius"),k=0;k<this.geom.length;k++){var g=a.camera.screen(new vect(this.geom[k][0],this.geom[k][1]));if(vect.dist(g,b)<d)return!0}return!1}},Polygon:function(a,c){la.call(this,a,c);this.bounds=wa(this.geom);this.map_contains=function(a,c){return this.contains(a.camera.project(c))};this.contains=function(a){var c=0;if(this.bounds.contains(a)){c++;for(c=0;c<this.geom.length;c++){var e=0;$.each(this.geom[c],function(c,d){for(var k=0;k<d.length;k++){var g=(k+1)%d.length;if(0>
(a.y-d[k][1])/(a.y-d[g][1])){var j=new vect(720,a.y),m=new vect(d[k][0],d[k][1]),g=new vect(d[g][0],d[g][1]);vect.intersects(a,j,m,g)&&e++}}});if(1==e%2)return!0}}return!1}},Line:function(a,c){la.call(this,a,c);this.bounds=wa(this.geom);this.map_contains=function(){return!1}}},A=null,t=function(a){var c=null;this.length=a.length;this.count=function(){return a.length};this.items=function(){return a};this.type=function(b){for(var c=[],f=0;f<a.length;f++)("*"==b||a[f].type==b)&&c.push(a[f]);return new t(c)};
this.join=function(b){for(var c=[],f=0;f<a.length;f++)c.push(a[f]);for(f=0;f<b.count();f++){var h=b.get(f);this.id(h.id)||c.push(h)}return new t(c)};this.attr=function(){throw"Not Implemented";};this.get=function(b){return a[b]};this.subset=function(b){for(var c=[],f=0;f<b.length;f++)c.push(a[b[f]]);return new t(c)};this.id=function(b){if(!c){c={};for(var e=0;e<a.length;e++)c[a[e].id]=a[e]}return b in c?c[b]:null};this.each=function(b){for(var c=0;c<a.length;c++)b(c,a[c]);return this};var b={">":function(a,
b){return a>b},"<":function(a,b){return a<b},"==":function(a,b){return a==b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=b}};this.select=function(c){if(c.match(/^\s*\*\s*$/))return new t(a);var e=c.match(/^\s*([^\s]+)\s*([=<>]+)\s*(([^\s])+)\s*$/);if(!e)throw"Bad Selector";c=e[1];var f=e[2],h=null,k=null;isNaN(e[3])?k=e[3]:h=parseFloat(e[3]);new_elem=[];if(k)for(e=0;e<a.length;e++)b[f](a[e].attr(c),a[e].attr(k))&&new_elem.push(a[e]);else for(e=0;e<a.length;e++)b[f](a[e].attr(c),h)&&
new_elem.push(a[e]);return new t(new_elem)};this.filter=function(b){for(var c=[],f=0;f<a.length;f++)b(a[f])&&c.push(a[f]);return new t(c)};this.quantile=function(b,c,f){var h=a.filter(function(a){return void 0!==a.attr(b)});h.sort(function(a,c){return a.attr(b)-c.attr(b)});var k=Math.round(c*h.length/f);c=Math.round((c-1)*h.length/f);return new t(h.slice(c,k))};this.range=function(b){for(var c=Infinity,f=-Infinity,h=!1,k=0;k<a.length;k++){var g=a[k].attr(b);isNaN(g)||(h=!0,c>g&&(c=g),f<g&&(f=g))}return!h?
null:{min:c,max:f}};this.style=function(b,c,f){var h,k,g;"Engine"==b.type?(h=b,k=c,g=f):(h=null,k=b,g=c);if(void 0===g){if(a[0])return a[0].style(h,k)}else return $.each(a,function(a,b){b.style(h,k,"function"==typeof g?g(b):Fa(g)?g[a]:g)}),this}},u=null,I=null,u=null,Ta=1E3,ja=0,Q=8,Aa=0,za=0,Ea=[];window.wiggle={Map:function(a,c){var b=this;void 0===c&&(c={});c.geomFunc=function(a){return a.geom};j(c,{width:360,center:new vect(0,0),base:"default","tile-server":"http://eland.ecohealthalliance.org/wigglemaps",
preserveAspectRatio:!0});ta.call(this,a,c);var d=[Ma,W];this.Renderers={Point:Ia,Polygon:function(a,b,c){var e=[],j=function(a){this.update=function(b,c){$.each(a,function(a,d){d.update(b,c)})};this.keys=function(){var b={};$.each(a,function(a,c){for(key in c.style_map)b[key]=!0});return b}};$.each(d,function(d,j){e.push(new j(a,b,c))});this.views=[];this.create=function(a,b){var c=[];$.each(e,function(d,e){c.push(e.create(a,b))});return new j(c)};this.draw=function(){$.each(e,function(a,b){b.draw()})}},
Line:W};this.Queriers={Point:Va,Polygon:Wa};this.styles={Point:{fill:new r(0.02,0.44,0.69,1),opacity:1,radius:5,stroke:"none","stroke-width":2},Polygon:{fill:new r(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new r(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":0.75},Line:{stroke:new r(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":2},"default":{fill:new r(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new r(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":1}};var e=null;"default"==c.base||
"nasa"==c.base?(e=l(c),n(e,{source:"file",url:c["tile-server"]+"/tiles/nasa_topo_bathy",levels:8,size:256}),e=new aa(e)):"ne"==c.base?(e=l(c),n(e,{source:"file",url:c["tile-server"]+"/tiles/NE1_HR_LC_SR_W_DR",levels:6,size:256}),e=new aa(e)):"ne1"==c.base?(e=l(c),n(e,{source:"file",url:TILE_SERVER+"/tiles/NE1_HR_LC",levels:6,size:256}),e=new aa(e)):e=null;e&&(e.initialize(b),b.scene.push(e));this.append=function(a){"draw"in a?this.scene.push(a):(this.scene.push(new sa(b,a,c)),this.queriers[a.id]=
new Ca(this,a,c))}},TimeSeries:function(a,c,b){void 0===b&&(b={});b.order||(b.order=c.numeric(),b.order.sort());var d=c.features(),e=null;$.each(b.order,function(a,b){var c=d.range(b);e=e?{min:e.min<c.min?e.min:c.min,max:e.max>c.max?e.max:c.max}:c});j(b,{range:{min:e.min,max:e.max},domain:{min:0,max:b.order.length-1},min:new vect(0,e.min),width:b.order.length-1,height:e.max-e.min,worldMin:new vect(0,e.min),worldMax:new vect(b.order.length-1,e.max),ylock:!0});var f=b.order;b.geomFunc=function(a){for(var b=
[],c=[],d=0;d<f.length;d++){var e=a.attr(f[d]);isNaN(e)?0<c.length&&(b.push(c),c=[]):c.push([d,e])}0<c.length&&b.push(c);return[b]};ta.call(this,a,b);this.styles={"default":{fill:new r(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new r(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":2}};this.Renderers={"default":W};this.Queriers={"*":Xa};var h={stroke:new r(0.25,0.25,0.25,1),"stroke-width":0.75,"stroke-opacity":1},k=function(a){return h[a]},g=new W(this);$.each(b.order,function(a){g.create([[[[a,
b.range.min],[a,b.range.max]]]],k)});g.create([[[[b.domain.min,b.range.min],[b.domain.max,b.range.min],[b.domain.max,b.range.max],[b.domain.min,b.range.max],[b.domain.min,b.range.min]]]],k);this.scene.push(g);if(b.ticks){for(a=0;a>b.range.min;)a-=b.ticks;for(;a<b.range.max;)g.create([[[[b.domain.min,a],[b.domain.max,a]]]],k),a+=b.ticks}this.scene.push(new sa(this,c,b));this.queriers[c.id]=new Ca(this,c,b)},layer:{Layer:Z,Grid:ia,Hillshade:ya,Elevation:function(a){I||(I=B(y+"shaders/elevation"));var c=
$(a).find("LatLonBox"),b=new vect(parseFloat(c.find("west").text()),parseFloat(c.find("south").text())),d=new vect(parseFloat(c.find("east").text()),parseFloat(c.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var e=U(a),f=D(w(new vect(0,1),new vect(1,0)),2),h=D(w(b,d),2);this.draw=function(a,c,j){j||(gl.useProgram(I),I.data("screen",a.camera.mat3),I.data("pos",h),I.data("tex_in",f),I.data("elevation",e),vect.sub(a.camera.screen(d),a.camera.screen(b)),gl.drawArrays(gl.TRIANGLES,
0,h.numItems))}},Raster:xa},io:{Shapefile:function(a){var c=a.path;$.ajax({url:c+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(b){for(var d=[],e=100;e<b.length;)d.push(2*ba(b,e)),e+=8;$.ajax({url:c+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(b){for(var c=[],e=[],g=0;g<d.length;g++){var j=d[g];ba(b,j);ba(b,j+4);var m=j+8,l=C(b,m);if(0==l)console.log("NULL Shape");else if(1==l)l=S(b,m+4),m=S(b,m+12),c.push({type:"Point",attr:{},geom:[[l,m]]});else if(5==
l){for(var l=C(b,m+36),m=C(b,m+40),n=j+52,j=j+52+4*l,q=[],r=0;r<l;r++){var t=C(b,n+4*r),u;u=r+1<l?C(b,n+4*(r+1)):m;var w=j,v=[];for(u-=1;u>=t;u--){var y=S(b,w+16*u),z=S(b,w+16*u+8);v.push([y,z])}q.push(v)}e.push({type:"Polygon",attr:{},geom:[q]})}else throw"Not Implemented: "+l;}if(0<c.length){var x=new Z(a);$.each(c,function(a,b){x.append(b)});b=x}else 0<e.length?(x=new Z(a),$.each(e,function(a,b){x.append(b)}),b=x):b=void 0;a.success(b)}})}})},GeoJSON:function(a,c){void 0===c&&(c={});for(var b=
new Z(c),d=0;d<a.features.length;d++){var e=a.features[d];if("Feature"==e.type){"Point"==e.geometry.type&&b.append({type:"Point",geom:[e.geometry.coordinates],attr:e.properties});"MultiPoint"==e.geometry.type&&b.append({type:"Point",geom:e.geometry.coordinates,attr:e.properties});if("Polygon"==e.geometry.type){for(var f=e.geometry.coordinates,h=[],k=0;k<=f.length-1;k++){for(var g=[],j=f[k].length-1;0<=j;j--)g.push(f[k][j]);h.push(g)}b.append({type:"Polygon",geom:[h],attr:e.properties})}if("MultiPolygon"==
e.geometry.type){var m=[];$.each(e.geometry.coordinates,function(a,b){for(var c=[],d=0;d<=b.length-1;d++){for(var e=[],f=b[d].length-1;0<=f;f--)e.push(b[d][f]);c.push(e)}m.push(c)});b.append({type:"Polygon",geom:m,attr:e.properties})}"MultiLineString"==e.geometry.type&&$.each(e.geometry.coordinates,function(a,c){b.append({type:"Line",geom:[[c]],attr:e.properties})})}}return b},KML:function(a){var c=$(a).find("LatLonBox"),b=new vect(parseFloat(c.find("west").text()),parseFloat(c.find("south").text())),
c=new vect(parseFloat(c.find("east").text()),parseFloat(c.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();return new xa(y+a,b,c)},SparseGrid:function(a,c){var b=T(a,0),d=T(a,4),e=C(a,8),f=C(a,12),h=T(a,16),k={};for(key in c)k[key]=c[key];k.lower=new vect(b,d);k.upper=new vect(b+h*e,d+h*f);k.rows=f;k.cols=e;b=new ia(k);for(d=20;d<a.length;){for(var h=C(a,d),e=C(a,d+4),f=d+4,k=e,g=0;g<k;g++){var j=T(a,f+4*g);b.raw_set(h+g,j)}d+=8+4*e}return b},AsciiGrid:function(a,c){var b=a.split("\n"),
d=b.splice(0,6),e=parseInt(d[0].slice(14)),f=parseInt(d[1].slice(14)),h=parseFloat(d[2].slice(14)),k=parseFloat(d[3].slice(14)),g=parseFloat(d[4].slice(14)),d=d[5].slice(14),j={};for(key in c)j[key]=c[key];j.lower=new vect(h,k);j.upper=new vect(h+g*e,k+g*f);j.rows=f;j.cols=e;h=new ia(j);for(k=0;k<f;k++){g=b[k].split(" ");for(j=0;j<e;j++)g[j]==d?h.set(f-1-k,j,NaN):h.set(f-1-k,j,parseFloat(g[j]))}return h},WMS:function(a){a=l(a);for(var c=["url","layer"],b=0;b<c.length;b++){var d=c[b];if(!(d in a))throw"Key "+
d+" not found";}j(a,{levels:16,size:256});var c={source:"wms"},e;for(e in c)a[e]=c[e];return new aa(a)}},util:{fcolor:ma,icolor:function(a,c,b,d){return new r(q(a/255,0,1),q(c/255,0,1),q(b/255,0,1),q(d/255,0,1))},Box:K,RangeTree:Y},widget:{Slider:function(a,c,b){var d=function(a){if(a>=b)throw"Slider index out of bounds";return c.x/(b-1)*a},e=function(d){return d<=a.x?0:d>=a.x+c.x?b-1:Math.round((d-a.x)/c.x*(b-1))};this.dom=$("<div></div>").addClass("slider-container").css("position","relative").css("left",
a.x).css("top",a.y).css("width",c.x).css("height",c.y);var f=!1,h=0,j=$("<div></div>").addClass("slider-box").css("position","relative").css("left",-10).css("height",c.y).css("width",20).mousedown(function(){f=!0});this.tick=function(){return h};this.count=function(){return b};var g=function(){};this.change=function(a){g=a};var l=function(){};this.release=function(a){l=a};this.dragging=function(){return f};this.dom.append(j);this.set=function(a){a!=h&&g(a);h=a;var b=d(a);j.css("left",b-10);l(a)};
$(document).bind("mouseup",function(){if(f){f=!1;var a=e(event.clientX);l(a)}});$(document).bind("mousemove",function(a){f&&(a=e(a.clientX),a!=h&&g(a),h=a,a=d(a),j.css("left",a-10))})}},ready:function(a){Ea.push(a)}};$(document).ready(function(){$('script[src*="wigglemaps"]').each(function(a,c){var b=/wigglemaps(\.min)?\.js/;$(c).attr("src").match(b)&&(y=$(c).attr("src").replace(b,""))});$.each(Ea,function(a,c){c()})})})();
