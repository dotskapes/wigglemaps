function Vector2D(j,l){this.x=j;this.y=l;this.add=function(j){this.x+=j.x;this.y+=j.y;return this};this.sub=function(j){this.x-=j.x;this.y-=j.y;return this};this.scale=function(j){this.x*=j;this.y*=j;return this};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.normalize=function(){var j=this.length();if(0==j)return this;this.x/=j;this.y/=j;return this};this.div=function(j){this.x/=j.x;this.y/=j.y;return this};this.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);
return this};this.zero=function(){return 0==this.x+this.y};this.dot=function(j){return this.x*j.x+this.y*j.y};this.cross=function(j){return this.x*j.y-this.y*j.x};this.rotate=function(j){var l=Math.cos(j);j=Math.sin(j);xp=l*this.x-j*this.y;yp=j*this.x+l*this.y;this.x=xp;this.y=yp;return this};this.clone=function(){return new Vector2D(this.x,this.y)};this.array=function(){return[this.x,this.y]}}function vect(j,l){return new Vector2D(j,l)}vect.scale=function(j,l){return j.clone().scale(l)};
vect.add=function(j,l){return j.clone().add(l)};vect.sub=function(j,l){return j.clone().sub(l)};vect.dist=function(j,l){return j.clone().sub(l).length()};vect.dir=function(j,l){return j.clone().sub(l).normalize()};vect.dot=function(j,l){return j.x*l.x+j.y*l.y};vect.cross=function(j,l){return j.x*l.y-j.y*l.x};vect.left=function(j,l,r,p){p||(p=0);l=vect.sub(l,j);j=vect.sub(r,j);return vect.cross(l,j)>=-p};
vect.intersects=function(j,l,r,p,s){s||(s=0);return vect.left(j,l,r,s)!=vect.left(j,l,p,s)&&vect.left(r,p,l,s)!=vect.left(r,p,j,s)};vect.intersect2dt=function(j,l,r,p){p=j.x*(p.y-r.y)+l.x*(r.y-p.y)+p.x*(l.y-j.y)+r.x*(j.y-l.y);return 0==p?Infinity:-(j.x*(r.y-l.y)+l.x*(j.y-r.y)+r.x*(l.y-j.y))/p};
vect.intersect2dpos=function(j,l,r,p){var s=j.x*(p.y-r.y)+l.x*(r.y-p.y)+p.x*(l.y-j.y)+r.x*(j.y-l.y);if(0==s)return Infinity;r=(j.x*(p.y-r.y)+r.x*(j.y-p.y)+p.x*(r.y-j.y))/s;l=vect.sub(l,j);l.scale(r);return vect.add(j,l)};vect.rotate=function(j,l){var r=Math.cos(l),p=Math.sin(l);xp=r*j.x-p*j.y;yp=p*j.x+r*j.y;return j=new vect(xp,yp)};vect.normalize=function(j){return j.clone().normalize()};
(function(){function j(a,b){for(var c in b)c in a||(a[c]=b[c])}function l(a){var b={};for(key in a)b[key]=a[key];return b}function r(a,b){for(key in b)a[key]=b[key]}function p(a,b,c){return Math.min(Math.max(a,b),c)}function s(a,b,c,d){1>=a&&1>=b&&1>=c&&1>=d?(this.r=a,this.g=b,this.b=c,this.a=d):(this.r=a/255,this.g=b/255,this.b=c/255,this.a=d/255);this.array=[this.r,this.g,this.b,this.a];this.vect=function(){return this.array};this.rgb=function(){return"rgb("+parseInt(255*this.r)+","+parseInt(255*
this.g)+","+parseInt(255*this.b)+")"}}function ma(a,b,c,d){return new s(p(a,0,1),p(b,0,1),p(c,0,1),p(d,0,1))}function Fa(a){if(null==a||void 0==a.length)return!1;for(var b=0;b<a.length;b++)if(!(b in a))return!1;return!0}function ba(a,b){return((a.charCodeAt(b)&255)<<24)+((a.charCodeAt(b+1)&255)<<16)+((a.charCodeAt(b+2)&255)<<8)+(a.charCodeAt(b+3)&255)}function D(a,b){return((a.charCodeAt(b+3)&255)<<24)+((a.charCodeAt(b+2)&255)<<16)+((a.charCodeAt(b+1)&255)<<8)+(a.charCodeAt(b)&255)}function T(a,b){var c=
a.charCodeAt(b)&255,d=a.charCodeAt(b+1)&255,e=a.charCodeAt(b+2)&255,f=a.charCodeAt(b+3)&255,h=a.charCodeAt(b+4)&255,k=a.charCodeAt(b+5)&255,g=a.charCodeAt(b+6)&255,n=a.charCodeAt(b+7)&255,m=1-2*(n>>7),n=((n&127)<<4)+((g&240)>>4)-1023,c=(g&15)*Math.pow(2,48)+k*Math.pow(2,40)+h*Math.pow(2,32)+f*Math.pow(2,24)+e*Math.pow(2,16)+d*Math.pow(2,8)+c;return m*(1+c*Math.pow(2,-52))*Math.pow(2,n)}function U(a,b){var c=a.charCodeAt(b)&255,d=a.charCodeAt(b+1)&255,e=a.charCodeAt(b+2)&255,f=a.charCodeAt(b+3)&255,
h=1-2*(f>>7),f=((f&127)<<1)+((e&254)>>7)-127,c=(e&127)*Math.pow(2,16)+d*Math.pow(2,8)+c;return h*(1+c*Math.pow(2,-23))*Math.pow(2,f)}function na(a,b,c,d){return[a-c,b+d,a-c,b-d,a+c,b+d,a-c,b-d,a+c,b-d,a+c,b+d]}function x(a,b,c){return 2==arguments.length?[a.x,b.y,a.x,a.y,b.x,b.y,a.x,a.y,b.x,a.y,b.x,b.y]:[a.x,b.y,c,a.x,a.y,c,b.x,b.y,c,a.x,a.y,c,b.x,a.y,c,b.x,b.y,c]}function C(a,b){if(!a)return null;var c=a.createProgram(),d=oa(a,a.VERTEX_SHADER,b+"/vert.glsl"),e=oa(a,a.FRAGMENT_SHADER,b+"/frag.glsl");
a.attachShader(c,d);a.attachShader(c,e);a.linkProgram(c);var f={},d=(d.source+e.source).match(/((uniform)|(attribute)) (\w+) (\w+)/mg),e=0;a.useProgram(c);if(d){for(var h=0;h<d.length;h++){var k=d[h].split(" ");f[k[2]]={u:k[0],type:k[1],loc:null};if("uniform"==k[0])f[k[2]].loc=a.getUniformLocation(c,k[2]);else{var g=a.getAttribLocation(c,k[2]);f[k[2]].loc=g}"sampler2D"==k[1]&&(f[k[2]].tex=e,e++)}c.get=function(a){return f[a].loc};c.data=function(c,d){var b=f[c];if(!b)throw"Could not find shader variable "+
c;if("uniform"==b.u)if("float"==b.type)a.uniform1f(b.loc,d);else if("vec2"==b.type)a.uniform2fv(b.loc,d);else if("ivec2"==b.type)a.uniform2iv(b.loc,d);else if("vec3"==b.type)a.uniform3fv(b.loc,d);else if("ivec3"==b.type)a.uniform3iv(b.loc,d);else if("vec4"==b.type)a.uniform4fv(b.loc,d);else if("ivec4"==b.type)a.uniform4iv(b.loc,d);else if("bool"==b.type)a.uniform1i(b.loc,d);else if("mat4"==b.type)a.uniformMatrix4fv(b.loc,!1,d);else if("mat3"==b.type)a.uniformMatrix3fv(b.loc,!1,d);else if("sampler2D"==
b.type)"texture"in d&&(d=d.texture()),a.activeTexture(a["TEXTURE"+b.tex]),a.bindTexture(a.TEXTURE_2D,d),a.uniform1i(b.loc,b.tex);else if("int"==b.type)a.uniform1i(b.loc,d);else throw"Unsupported Type for Shader Helper: "+b.type;else if("attribute"==b.u)a.enableVertexAttribArray(b.loc),a.bindBuffer(a.ARRAY_BUFFER,d),a.vertexAttribPointer(b.loc,d.itemSize,a.FLOAT,!1,0,0);else throw"Type: "+b.u+" Recieved";}}return c}function oa(a,b,c){var d=a.createShader(b);$.ajax({async:!1,url:c,dataType:"text",success:function(c){a.shaderSource(d,
c);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS))throw a.getShaderInfoLog(d);d.source=c},error:function(){console.log("Could not load "+c)}});return d}function E(a,b,c){var d=a.createBuffer(),e=new Float32Array(b);a.bindBuffer(a.ARRAY_BUFFER,d);d.itemSize=c;d.numItems=b.length/c;a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return d}function ca(a,b,c){if(!a)return null;var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);var e=new Float32Array(b*
c);d.itemSize=c;d.numItems=b;d.update=function(c,b){var e=new Float32Array(c);a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferSubData(a.ARRAY_BUFFER,4*b,e);a.bindBuffer(a.ARRAY_BUFFER,null)};a.bufferData(a.ARRAY_BUFFER,e,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return d}function V(a,b,c){var d=a.createTexture();d.id=pa;pa++;var e=new Image;e.onload=function(){a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);c&&c()};e.src=b;return d}function Q(a,b){var c=a.gl,d={},e;e=b?b:256;var f=0,h=function(a,c,d,b){a||console.log("ack");d||(d=0);b||(b=c.length);for(var e=0;e<b;e++)a[d+e]=c[e]};this.create=function(a,b){if(!b)throw"Length of buffer must be a positive integer";var f=new Float32Array(e*
b),h=ca(c,e,b);d[a]={array:f,buffer:h,len:b,dirty:!1}};this.alloc=function(a){if(f+a>=e){for(var b=e;b<f+a;)b*=2;e=b;for(name in d){var n=new Float32Array(b*d[name].len),m=d[name].array,q=ca(c,e,d[name].len);h(n,m);d[name].array=n;d[name].buffer=q;d[name].dirty=!0}}b=f;f+=a;return b};this.get=function(a){return d[a].buffer};this.write=function(a,b,c,e){h(d[a].array,b,c*d[a].len,e*d[a].len);d[a].dirty=!0};this.repeat=function(a,b,c,e){for(var f=0;f<e;f++)h(d[a].array,b,(c+f)*d[a].len,d[a].len);d[a].dirty=
!0};this.count=function(){return f};this.data=function(a){return d[a].array};this.update=function(){for(name in d)d[name].dirty&&(d[name].buffer&&d[name].buffer.update(d[name].array,0),d[name].dirty=!1,a.dirty=!0)}}function qa(a,b){var c=a.gl,d=l(b);j(d,{mag_filter:c.LINEAR,min_filter:c.LINEAR,wrap_s:c.CLAMP_TO_EDGE,wrap_t:c.CLAMP_TO_EDGE,mipmap:!1});var e=c.createTexture(),f=null;this.image=function(b){f=b;c.bindTexture(c.TEXTURE_2D,e);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,f);
c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d.mag_filter);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,d.min_filter);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,d.wrap_s);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,d.wrap_t);d.mipmap&&c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null);a.dirty=!0};this.texture=function(){return f?e:null}}function Ga(a,b){var c=a.canvas,d=this;b||(b={});b.width&&!b.height?b.height=b.width:!b.width&&b.height&&(b.width=b.height);var e=b.preserveAspectRatio?
c.height()/c.width():1;b.min?b.center=vect.add(b.min,(new vect(b.width,b.height*e)).scale(0.5)):b.center||(b.center=new vect(0,0));var f=b.width,h=b.height,k=b.height/b.width,g=b.center.clone(),n=1;this.worldToPx=new Float32Array(9);this.pxToScreen=new Float32Array(9);this.mat3=this.worldToScreen=new Float32Array(9);this.reconfigure=function(){var e=b.preserveAspectRatio?c.height()/c.width():1,k=(new vect(f/(b.xlock?1:n),f*(h/f)*e/(b.ylock?1:n))).scale(0.5),e=vect.add(g,k),k=vect.sub(g,k),j=c.width(),
da=c.height(),e=vect.sub(e,k);d.worldToPx[0]=j/e.x;d.worldToPx[1]=0;d.worldToPx[2]=0;d.worldToPx[3]=0;d.worldToPx[4]=da/e.y;d.worldToPx[5]=0;d.worldToPx[6]=-(k.x*j)/e.x;d.worldToPx[7]=-(k.y*da)/e.y;d.worldToPx[8]=1;d.pxToScreen[0]=2/j;d.pxToScreen[1]=0;d.pxToScreen[2]=0;d.pxToScreen[3]=0;d.pxToScreen[4]=2/da;d.pxToScreen[5]=0;d.pxToScreen[6]=-1;d.pxToScreen[7]=-1;d.pxToScreen[8]=1;d.worldToScreen[0]=2/e.x;d.worldToScreen[1]=0;d.worldToScreen[2]=0;d.worldToScreen[3]=0;d.worldToScreen[4]=2/e.y;d.worldToScreen[5]=
0;d.worldToScreen[6]=-2*k.x/e.x-1;d.worldToScreen[7]=-2*k.y/e.y-1;d.worldToScreen[8]=1;a.dirty=!0};this.reconfigure();this.project=function(a){a=new vect(2*(a.x-c.offset().left)/c.width()-1,-(2*(a.y-c.offset().top)/c.height()-1));a.x=a.x/this.mat3[0]-this.mat3[6]/this.mat3[0];a.y=a.y/this.mat3[4]-this.mat3[7]/this.mat3[4];return a};this.screen=function(a){a=new vect(a.x*this.mat3[0]+this.mat3[6],a.y*this.mat3[4]+this.mat3[7]);a.x=c.offset().left+c.width()*(a.x+1)/2;a.y=c.offset().top+c.height()*(-a.y+
1)/2;return a};this.percent=function(a){return new vect(2*((a.x-c.offset().left)/c.width())-1,-(2*((a.y-c.offset().top)/c.height())-1))};this.pixel=function(a){return new vect(c.offset().left+(a.x+1)/2*c.width(),c.offset().top+(-a.y+1)/2*c.height())};this.move=function(a){g.add(a);this.reconfigure()};this.zoom=function(a){if(void 0===a)return n;n=a;this.reconfigure()};this.position=function(a,b){if(void 0===a)return g.clone();g=void 0===b?a.clone():new vect(a,b);this.reconfigure()};this.reset=function(){n=
1;this.reconfigure()};c.resize(function(){d.reconfigure()});this.extents=function(a){f=a;h=a*k;n=1;this.reconfigure()};this.size=function(){var a=b.preserveAspectRatio?c.height()/c.width():1;return new vect(f/(b.xlock?1:n),f*(h/f)*a/(b.ylock?1:n))}}function Ha(a,b){var c=!1,d=new vect(0,0),e=new vect(0,0),f=null,h=0;a.canvas.mousedown(function(a){d=new vect(a.clientX,a.clientY);c=!0});$(window).bind("mouseup",function(){c=!1});$(document).bind("keypress","+",function(){a.camera.zoom(1.1)});$(document).bind("keypress",
"-",function(){a.camera.zoom(10/11)});$(document).bind("keypress","0",function(){a.camera.reset()});a.canvas.bind("mousewheel",function(b,c){c*=0.5;0>c?(c=-1*c+1,c=1/c):c+=1;var d=a.camera.zoom();a.camera.zoom(d*c);g();b.preventDefault()});var k=!0;this.disable=function(){k=!1};this.enable=function(){k=!0};this.update=function(b){e=new vect(F.x,F.y);var m=!1,q;c&&k?(m=vect.sub(a.camera.project(d),a.camera.project(e)),q=a.camera.position(),q=vect.add(q,m),a.camera.position(q),d=e,h=m.length()/b,f=
m,f.normalize(),m=!0):0.01<h&&f&&(m=vect.scale(f,h*b),q=a.camera.position(),q=vect.add(q,m),a.camera.position(q),h-=3*b*h,m=!0);m&&g()};var g=function(){if(b.worldMin&&b.worldMax){var c=a.camera.position(),c=a.camera.size(),d=b.worldMax.x-b.worldMin.x;c.x>d&&(c=c.x*a.camera.zoom(),a.camera.zoom(d/c));a.camera.position();c=a.camera.size();d=b.worldMax.y-b.worldMin.y;c.y>d&&(c=c.y*a.camera.zoom(),a.camera.zoom(d/c))}var c=a.camera.position(),d=a.camera.size().scale(0.5),e=!1;b.worldMin&&(c.x-d.x<b.worldMin.x&&
(c.x=b.worldMin.x+d.x),c.y-d.y<b.worldMin.y&&(c.y=b.worldMin.y+d.y),e=!0);b.worldMax&&(c.x+d.x>b.worldMax.x&&(c.x=b.worldMax.x-d.x),c.y+d.y>b.worldMax.y&&(c.y=b.worldMax.y-d.y),e=!0);e&&a.camera.position(c)}}function ea(a,b){this.style_map={};this.geom=a;var c={};this.updateMany=function(a){for(var c in a)this.updateOne(c,a[value])};this.updateOne=function(a,b){if(void 0===b)throw"No value for style defined";if(c[a]!=b&&(c[a]=b,a in this.style_map))this.style_map[a](b)};this.updateDefault=function(a){var c=
b(a);this.updateOne(a,c)};this.update=function(a,c){"string"==typeof a?void 0===c?this.updateDefault(a):this.updateOne(a,c):this.updateMany(a)};this.keys=function(){var a={};for(key in this.style_map)a[key]=!0;return a};this.updateAll=function(){for(var a in this.style_map)this.updateDefault(a)}}function fa(a){this.engine=a;this.views=[];this.update=function(a){for(var c=0;c<views.length;c++)this.views[c].update(a)};this.View=function(){throw"Attempt to call abstract function";};this.create=function(a,
c){var d=new this.View(a,c);this.views.push(d);d.updateAll();return d};this.draw=function(){throw"Attempt to call abstract function";}}function Ia(a,b){fa.call(this,a,b);a.shaders.point||(a.shaders.point=C(a.gl,y+"shaders/point"));var c=a.shaders.point,d=10,e=new Q(a,Ja);e.create("vert",2);e.create("unit",2);e.create("stroke_width",1);e.create("rad",1);e.create("fill_color",3);e.create("fill",1);e.create("stroke_color",3);e.create("stroke",1);e.create("alpha",1);this.View=function(a,c){ea.call(this,
a,c);var b,g;this.style_map={fill:function(a){"none"==a?e.repeat("fill",[-0.75],b,g):(e.repeat("fill",[0.75],b,g),e.repeat("fill_color",a.array,b,g))},opacity:function(a){e.repeat("alpha",[a],b,g)},radius:function(a){a>d&&(d=a);e.repeat("rad",[a],b,g)},stroke:function(a){"none"==a?e.repeat("stroke",[-0.75],b,g):(e.repeat("stroke",[0.75],b,g),e.repeat("stroke_color",a.array,b,g))},"stroke-width":function(a){e.repeat("stroke_width",[a],b,g)}};g=6*a.length;b=e.alloc(g);$.each(a,function(a,c){e.repeat("vert",
c,b+6*a,6);e.write("unit",Ka,b+6*a,6)})};this.update=function(){e.update()};this.draw=function(){var b=a.gl;b.useProgram(c);c.data("screen",a.camera.mat3);c.data("pos",e.get("vert"));c.data("circle_in",e.get("unit"));c.data("color_in",e.get("fill_color"));c.data("stroke_color_in",e.get("stroke_color"));c.data("alpha_in",e.get("alpha"));c.data("fill_in",e.get("fill"));c.data("stroke_in",e.get("stroke"));c.data("aspect",a.canvas.width()/a.canvas.height());c.data("pix_w",2/a.canvas.width());c.data("rad",
e.get("rad"));c.data("stroke_width_in",e.get("stroke_width"));c.data("max_rad",d);b.drawArrays(b.TRIANGLES,0,e.count())}}function La(a,b){for(var c=6*b.length,d=a.alloc(c),e=[-1,1,-1,-1,1,-1,-1,1,1,-1,1,1],f=0,h=function(){if(b[f]){var a=new vect(b[f][0],b[f][1]);f++;return a}return null},k=null,g=h(),n=h(),m=[],q=[],j=[];g;)m.push(k||vect.add(g,vect.sub(g,n))),q.push(g),j.push(n||vect.add(g,vect.sub(g,k))),k=g,g=n,n=h();currentIndex=d;d=function(c,b,d){a.write("prev",c.array(),currentIndex,1);a.write("current",
b.array(),currentIndex,1);a.write("next",d.array(),currentIndex,1);currentIndex++};for(h=1;h<b.length;h++)a.write("unit",e,currentIndex,6),d(m[h-1],q[h-1],j[h-1]),d(j[h-1],q[h-1],m[h-1]),d(j[h],q[h],m[h]),d(m[h-1],q[h-1],j[h-1]),d(j[h],q[h],m[h]),d(m[h],q[h],j[h]);return c}function W(a){fa.call(this,a);a.shaders.line||(a.shaders.line=C(a.gl,y+"shaders/line"));var b=a.shaders.line,c=new Q(a,1024);c.create("prev",2);c.create("current",2);c.create("next",2);c.create("unit",2);c.create("width",1);c.create("color",
3);c.create("alpha",1);this.View=function(a,b){ea.call(this,a,b);var f=c.count(),h=0;this.style_map={stroke:function(a){c.repeat("color",a.array,f,h)},"stroke-opacity":function(a){c.repeat("alpha",[a],f,h)},"stroke-width":function(a){c.repeat("width",[a],f,h)}};$.each(a,function(a,b){for(a=0;a<b.length;a++)h+=La(c,b[a])})};this.update=function(){c.update()};this.draw=function(){var d=a.gl;c.update();d.useProgram(b);b.data("world",a.camera.worldToPx);b.data("screen",a.camera.pxToScreen);b.data("prev",
c.get("prev"));b.data("current",c.get("current"));b.data("next",c.get("next"));b.data("color_in",c.get("color"));b.data("alpha_in",c.get("alpha"));b.data("circle_in",c.get("unit"));b.data("width",c.get("width"));b.data("px_w",2/a.canvas.width());b.data("px_h",2/a.canvas.height());d.drawArrays(d.TRIANGLES,0,c.count())}}function Ma(a){fa.call(this,a);a.shaders.polygon||(a.shaders.polygon=C(a.gl,y+"shaders/poly"));var b=a.shaders.polygon,c=new Q(a,Na);c.create("vert",2);c.create("color",3);c.create("alpha",
1);this.View=function(a,b){ea.call(this,a,b);var f,h;this.style_map={fill:function(a){c.repeat("color",a.array,f,h)},"fill-opacity":function(a){c.repeat("alpha",[a],f,h)}};var k=[];h=0;$.each(a,function(a,c){for(var b,d=0;100>d;)try{for(var e=c,f=[],g=[],j=0;j<e.length;j++){var l=[];if(3>=e[j].length)g.push(e[j]);else for(var v=1;v<e[j].length;v++)l.push(ra(e[j][v][0],e[j][v][1]));l.push(f[0]);f.push(l)}for(var p=Oa(f),v=0;v<g.length;v++)p.push(g[v][0][0]),p.push(g[v][0][1]),p.push(g[v][1][0]),p.push(g[v][1][1]),
p.push(g[v][2][0]),p.push(g[v][2][1]);b=p;break}catch(Ya){d++}100==d&&(console.log("Rendering Polygon Failed: Skipping Interior"),b=[]);h+=b.length/2;k.push(b)});var g=f=c.alloc(h);$.each(k,function(a,b){var d=b.length/2;c.write("vert",b,g,d);g+=d})};this.update=function(){c.update()};this.draw=function(){var d=a.gl;c.update();d.useProgram(b);b.data("screen",a.camera.mat3);b.data("pos",c.get("vert"));b.data("color_in",c.get("color"));b.data("alpha_in",c.get("alpha"));d.drawArrays(d.TRIANGLES,0,c.count())}}
function sa(a,b,c){var d=this;z.manage(b);z.linkParent(a,b);this.renderers={};this.views={};var e=function(c,e){var k=u.derivedStyle(c,b,a,e);d.views[c.id].update(e,k)};b.features().each(function(f,h){var k;k=h.type in a.Renderers?h.type:"default";k in d.renderers||(d.renderers[k]=new a.Renderers[k](a,b,c));k=d.renderers[k].create(c.geomFunc(h),function(c){return function(d){return u.derivedStyle(c,b,a,d)}}(h));d.views[h.id]=k;z.manage(h);z.linkParent(b,h);z.addEventHandler(h,"style",e)});this.update=
function(a,c){for(var b in this.renderers)this.renderers[b].update(c)};this.draw=function(a,c){for(var b in this.renderers)this.renderers[b].draw(c)}}function ta(a,b){var c=this;j(b,{background:new s(0,0,0,1)});this.type="Engine";this.id=K();this.canvas=$("<canvas></canvas>").attr("id","viewer");var d=null;a?($(a).append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height())):(a=window,$("body").append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",
$(a).height()),$(window).resize(function(){c.resize()}));var e=[];this.resize=function(){this.canvas.attr("width",$(a).width());this.canvas.attr("height",$(a).height());d.viewport(0,0,this.canvas.width(),this.canvas.height());this.camera.reconfigure();for(var c=0;c<e.length;c++)e[c].resize()};var f=this.canvas;this.gl=d=Pa?WebGLDebugUtils.makeDebugContext(f.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1}),function(a,c){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to "+
c;}):f.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1});d.viewport(0,0,this.canvas.width(),this.canvas.height());d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.enable(d.BLEND);this.camera=new Ga(c,b);this.scroller=new Ha(this,b);this.extents=function(a){this.camera.extents(a)};this.center=function(a,c){void 0===c?this.camera.position(a):this.camera.position(new vect(a,c))};this.pxW=1/this.canvas.attr("width");this.pxH=1/this.canvas.attr("height");this.Renderers=
{};this.Queriers={};this.renderers={};this.views={};this.styles={};this.dirty=!0;this.defaultStyle=function(a,c){var b;a in this.styles&&(b=this.styles[a][c]);if(null===b||void 0===b)b=this.styles["default"][c];return null===b||void 0===b?null:b};z.manage(this);this.search=function(a,c){return this.queriers[a.id].boxSearch(c)};this.style=function(a,c,b){void 0===this.styles[a.id]&&(this.styles[a.id]={});if(void 0===b)return void 0!==this.styles[a.id][c]?this.styles[a.id][c]:null;this.styles[a.id][c]=
b;a.id in this.views?this.views[a.id].update(c):a.id in this.renderers&&$.each(this.renderers[a.id],function(a,c){c.update()})};var h=new Qa(this);this.select=function(a){h.select(a)};var k=!1;this.enableSelect=function(){this.scroller.disable();h.enable();k=!0};this.disableSelect=function(){this.scroller.enable();h.disable();k=!1};var g=(new Date).getTime(),n=[],m,q=this;m=function(){q.draw()};this.shaders={};this.scene=[];this.queriers={};var l=0;this.update=function(){var a=(new Date).getTime(),
b=(a-g)/1E3;60<=n.length&&n.splice(0,1);n.push(b);for(var d=0,e=0;e<n.length;e++)d+=n[e];d/=n.length;$("#fps").text(Math.floor(1/d));g=a;this.scroller.update(b);if(F.lastMove>l){var f=vect(F.x,F.y),h=!1;$.each(this.queriers,function(a,c){var b=c.pointSearch(f);if(b)return z.mouseOver(b),h=!0,!1});h||z.mouseOver(null)}l=F.lastMove;$.each(this.scene,function(a,d){d.update&&d.update(c,b)})};this.draw=function(){this.update();this.dirty&&(d.clearColor(b.background.r,b.background.g,b.background.b,b.background.a),
d.clear(d.COLOR_BUFFER_BIT),d.clearDepth(0),$.each(this.scene,function(a,b){b.draw(c)}),k&&h.draw(this));this.dirty=!1;requestAnimationFrame(m)};this.enableZ=function(){d.depthFunc(d.LEQUAL);d.enable(d.DEPTH_TEST)};this.disableZ=function(){d.disable(d.DEPTH_TEST)};this.canvas.mouseout(function(){z.mouseOver(null)});requestAnimationFrame(m)}function Qa(a){var b=C(a.gl,y+"shaders/selbox"),c=!1,d=!1,e=null,f=null,h=ca(a.gl,6,2),k=E(a.gl,na(0,0,1,1),2),g=function(){h.update(x(e,f),0);a.dirty=!0};a.canvas.bind("mousedown",
function(b){c&&(show=d=!0,f=e=a.camera.percent(new vect(b.clientX,b.clientY)),g())});var n=function(){};this.select=function(a){n=a};$(document).bind("mouseup",function(){if(c&&d){var b=a.camera.project(a.camera.pixel(e)),h=a.camera.project(a.camera.pixel(f));if(b.x>h.x){var g=b.x;b.x=h.x;h.x=g}b.y>h.y&&(g=b.y,b.y=h.y,h.y=g);d=!1;n(new L(b,h))}});$(document).bind("click",function(){c&&(show=!1)});$(document).bind("mousemove",function(b){c&&d&&(f=a.camera.percent(new vect(b.clientX,b.clientY)),g())});
this.enable=function(){c=!0};this.disable=function(){c=!1};this.draw=function(a){a=a.gl;d&&(a.useProgram(b),b.data("pos",h),b.data("edge_in",k),a.drawArrays(a.TRIANGLES,0,h.numItems))}}function ua(a,b){for(;a>=b;)a-=b;for(;0>a;)a+=b;return a}function Ra(a,b,c,d){this.current=a;this.upper=b;this.lower=c;this.index=d}function va(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1}function X(a,b,c){if(void 0==b)throw"whoa";return 0==a[b+1].y-a[b].y?Math.min(a[b].x,a[b+1].x):a[b].x+(a[b+1].x-
a[b].x)*((c-a[b].y)/(a[b+1].y-a[b].y))}function M(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return!1}function w(a,b,c){return new vect(X(b,c,b[a].y),b[a].y)}function G(a,b){if(!b)throw"eek";a.push(b.x);a.push(b.y)}function N(a,b,c){if(!b||!c||3!=c.length+b.length&&4!=c.length+b.length)throw"ahh";if(3==b.length+c.length){for(var d=0;d<b.length;d++)G(a,b[d]);for(d=0;d<c.length;d++)G(a,c[d])}else b[1].x<b[0].x&&(d=b[0],b[0]=b[1],b[1]=d),c[1].x<c[0].x&&(d=c[0],c[0]=c[1],c[1]=d),G(a,b[0]),G(a,
b[1]),G(a,c[1]),G(a,c[0]),G(a,c[1]),G(a,b[0])}function Oa(a){for(var b=[],c=0,d=[],e=0;e<a.length;e++){for(var f=0;f<a[e].length-1;f++){var h=ua(f+1,a[e].length-1),k=ua(f-1,a[e].length-1);b.push(new Ra(f+c,h+c,k+c,e));d.push(a[e][f])}d.push(a[e][0]);c+=a[e].length}b.sort(function(a,b){return d[a.current].y-d[b.current].y});a=[];e=[];new vect(-200,0);new vect(200,0);c=0;c=[];k=[];for(f=0;f<b.length;f++){var g=b[f],h=va(a,g.lower),n=va(a,g.current),m,q;if(h&&!n)q=m=M(a,g.lower);else if(n&&!h)m=q=M(a,
g.current);else if(h&&n)m=M(a,g.lower),q=M(a,g.current);else if(!h&&!n){a:{m=a;q=d;for(var j=d[g.current].x,l=d[g.current].y,p=0;p<m.length;p++){var r=X(q,m[p],l);if(r>j||0==r-j&&q[m[p]].y>q[index].y){q=p;break a}}q=m.length}m=q}if(1<Math.abs(m-q)){for(h=0;h<a.length;h++);throw"Bad";}j=vect.left(d[g.lower],d[g.current],d[g.upper]);l=Math.floor(Math.min(m,q)/2);!j&&!h&&!n?(N(k,e[l],[w(g.current,d,a[q-1]),w(g.current,d,a[q])]),e.splice(l,1,[w(g.current,d,a[q-1]),d[g.current]],[d[g.current],w(g.current,
d,a[m])])):j&&!h&&!n?e.splice(l,0,[d[g.current]]):h&&!n?(N(k,e[l],[w(g.current,d,a[Math.max(m,q)-1]),d[g.current]]),e[l]=[w(g.current,d,a[Math.min(m,q)-1]),d[g.current]]):!h&&n?(N(k,e[l],[d[g.current],w(g.current,d,a[Math.min(q,m)+1])]),e[l]=[d[g.current],w(g.current,d,a[Math.max(q,m)+1])]):!j&&h&&n?(N(k,e[l],[w(g.current,d,a[Math.min(m,q)-1]),d[g.current]]),N(k,e[l+1],[w(g.current,d,a[Math.max(m,q)+1]),d[g.current]]),e.splice(l,2,[w(g.current,d,a[Math.min(m,q)-1]),w(g.current,d,a[Math.max(m,q)+1])])):
j&&(h&&n)&&(N(k,e[l],[d[g.current]]),e.splice(l,1));h&&!n?a[m]=g.current:n&&!h?a[q]=g.lower:h&&n?(a.splice(M(a,g.lower),1),a.splice(M(a,g.current),1)):!h&&!n&&(j?a.splice(m,0,g.lower,g.current):a.splice(m,0,g.current,g.lower));for(h=0;h<a.length-1;h++)if(X(d,a[h],d[g.current].y)>X(d,a[h+1],d[g.current].y))throw console.log("Misplaced Sweep"),"Misplace!";}if(0<a.length)throw console.log(a),"Bad "+a.length;if(0<c.length)throw console.log(c),"Wrong";return k}function L(a,b){this.min=a.clone();this.max=
b.clone();this.contains=function(c){return a.x<=c.x&&b.x>=c.x&&a.y<=c.y&&b.y>=c.y};this.x_in=function(c){return a.x<=c.x&&b.x>=c.x};this.x_left=function(b){return a.x>=b.x};this.x_right=function(a){return b.x<=a.x};this.y_in=function(c){return a.y<=c.y&&b.y>=c.y};this.y_left=function(b){return a.y>=b.y};this.y_right=function(a){return b.y<=a.y};this.area=function(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)};this.height=function(){return this.max.y-this.min.y};this.width=function(){return this.max.x-
this.min.x};this.vertex=function(a){switch(a){case 0:return this.min.clone();case 1:return new vect(this.max.x,this.min.y);case 2:return this.max.clone();case 3:return new vect(this.min.x,this.max.y);default:throw"Index out of bounds: "+a;}};this.intersects=function(a){for(var b=0;4>b;b++)for(var e=0;4>e;e++)if(vect.intersects(this.vertex(b),this.vertex((b+1)%4),a.vertex(e),a.vertex((e+1)%4)))return!0;return this.contains(a.min)&&this.contains(a.max)&&this.contains(new vect(a.min.x,a.max.y))&&this.contains(new vect(a.max.x,
a.min.y))||a.contains(this.min)&&a.contains(this.max)&&a.contains(new vect(this.min.x,this.max.y))&&a.contains(new vect(this.max.x,this.min.y))?!0:!1};this.union=function(a){this.min.x=Math.min(this.min.x,a.min.x);this.min.y=Math.min(this.min.y,a.min.y);this.max.x=Math.max(this.max.x,a.max.x);this.max.y=Math.max(this.max.y,a.max.y)};this.centroid=function(){return new vect((this.max.x+this.min.x)/2,(this.max.y+this.min.y)/2)};this.clone=function(){return new L(a,b)}}function ha(a,b,c,d){this.data=
a[d];this.right=this.left=null;b!=d&&(this.left=new ha(a,b,d-1,parseInt((b+(d-1))/2)));c!=d&&(this.right=new ha(a,d+1,c,parseInt((c+(d+1))/2)));this.subtree=[];for(d=b;d<=c;d++)this.subtree.push(a[d]);this.subtree.sort(function(a,b){return a.y-b.y});this.yrange=function(a,b,c){return a.y_in(this.subtree[b])&&a.y_in(this.subtree[c])};this.subquery=function(a,b,c,d,g){if(this.yrange(b,c,d))for(b=c;b<=d;b++)a.push(this.subtree[b]);else b.y_in(this.subtree[g])&&a.push(this.subtree[g]),b.y_left(this.subtree[g])?
g!=d&&this.subquery(a,b,g+1,d,parseInt((d+(g+1))/2)):(b.x_right(this.subtree[g])||g!=d&&this.subquery(a,b,g+1,d,parseInt((d+(g+1))/2)),g!=c&&this.subquery(a,b,c,g-1,parseInt((c+(g-1))/2)))};this.search=function(d,f){f.x_in(a[b])&&f.x_in(a[c])?this.subquery(d,f,0,this.subtree.length-1,parseInt((this.subtree.length-1)/2)):(f.contains(this.data)&&d.push(this.data),f.x_left(this.data)?this.right&&this.right.search(d,f):f.x_right(this.data)?this.left&&this.left.search(d,f):(this.left&&this.left.search(d,
f),this.right&&this.right.search(d,f)))}}function Y(a){a.sort(function(a,c){return a.x-c.x});0<a.length?this.root=new ha(a,0,a.length-1,parseInt((a.length-1)/2)):null==this.root;this.search=function(a){if(!this.root)return[];a=a.clone();var c=[];this.root.search(c,a);return c}}function wa(a){var b=new vect(Infinity,Infinity),c=new vect(-Infinity,-Infinity);$.each(a,function(a,e){$.each(e,function(a,d){$.each(d,function(a,d){d[0]<b.x&&(b.x=d[0]);d[0]>c.x&&(c.x=d[0]);d[1]<b.y&&(b.y=d[1]);d[1]>c.y&&
(c.y=d[1])})})});return new L(b,c)}function Z(a){a||(a={});this.id=K();this.type="Layer";var b={};if(a.style)throw"Not Implemeneted";this.style=function(a,b,c){var d;!a||"Engine"==a.type?(d=a,a=b,b=c):d=null;if(void 0===b)return u.getStyle(this,d,a);u.setStyle(this,d,a,b);return this};this.bounds=null;this.features=function(){var a=[],c;for(c in b)a.push(b[c]);return new A(a)};var c={};this.properties=function(){var a=[],b;for(b in c)a.push(b);return a};this.numeric=function(){var a=[],b;for(b in c)c[b]&&
a.push(b);return a};var d={};this.attr=function(a,b){if(2>arguments.length)return void 0!==d[a]?d[a]:null;d[a]=b};this.fixed=!1;this.append=function(a){if(this.fixed)throw"Layers are currently immutable once added to a map";var d=new Sa[a.type](a,this);b[d.id]=d;this.bounds?this.bounds.union(d.bounds):this.bounds=d.bounds.clone();for(var h in a.attr)c[h]=void 0===c[h]?isNaN(a.attr[h])?!1:!0:!isNaN(a.attr[h])&&c[h]?!0:!1;dirty=!0;return d};this.mouseover=function(a){z.addEventHandler(this,"mouseover",
a)};this.mouseout=function(a){z.addEventHandler(this,"mouseout",a)}}function ia(a){B||(B=C(engine.gl,y+"shaders/grid"));a||(a={});a.style||(a.style={});var b=a.lower,c=a.upper,d=a.rows,e=a.cols,f=(c.x-b.x)/e,h=(c.y-b.y)/d,k=new Float32Array(d*e),g=new Uint8Array(4*e*d),n=!1,m=new Q(engine,6);m.create("vert",2);m.create("screen",2);m.create("tex",2);var q=new vect(b.x,b.y),j=new vect(c.x,c.y),l=new vect(0,0),p=new vect(1,1),r=m.alloc(6);m.write("vert",x(q,j),r,6);m.write("screen",x(new vect(-1,-1),
new vect(1,1)),r,6);m.write("tex",x(l,p),r,6);var ga=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,ga);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindTexture(gl.TEXTURE_2D,null);this.lower=function(){return b.clone()};this.upper=function(){return c.clone()};this.rows=function(){return d};
this.cols=function(){return e};this.centroid=function(a,c){return new vect(b.x+f*c+f/2,b.y+h*a+h/2)};this.get=function(a,b){return k[e*a+b]};var s=-Infinity,v=Infinity;this.qunatiles=function(a,b){b||(b=function(a,b){return a-b});for(var c=[],d=0;d<k.length;d++)c.push(k[d]);c.sort(b);for(var e=[-Infinity],d=1;d<a;d++){var f=parseInt(inc*d);e.push(c[f])}e.push(Infinity);return e};this.set=function(a,b,c){if(a>=d||b>=e)throw"Index Out of Bounds";k[e*a+b]=c;n=!0};this.raw_set=function(a,b){if(a>=d*e)throw"Index Out of Bounds: "+
a;k[a]=b;n=!0};this.clear=function(a){for(var b=0;b<d*e;b++)k[b]=a};this.initialize=function(){};var u=null;this.draw=function(b){u||(u=b.framebuffer());m.update();if(n){s=-Infinity;v=Infinity;for(var c=0;c<d*e;c++){var f=k[c];f>s&&(s=f);f<v&&(v=f)}for(c=0;c<d*e;c++){var f=c,h=a.map(v,s,k[c]);g[4*f]=parseInt(255*h.r);g[4*f+1]=parseInt(255*h.g);g[4*f+2]=parseInt(255*h.b);g[4*f+3]=parseInt(255*h.a)}gl.bindTexture(gl.TEXTURE_2D,ga);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,d,0,gl.RGBA,gl.UNSIGNED_BYTE,
g);gl.bindTexture(gl.TEXTURE_2D,null);n=!1}a.style.antialias&&u.activate({blend:!1});gl.useProgram(B);B.data("screen",b.camera.mat3);B.data("pos",m.get("vert"));B.data("tex_in",m.get("tex"));B.data("sampler",ga);c=vect.sub(b.camera.screen(j),b.camera.screen(q));B.data("width",c.x);B.data("height",-c.y);B.data("rows",d);B.data("cols",e);B.data("blur",a.blur);gl.drawArrays(gl.TRIANGLES,0,m.count());a.style.antialias&&(u.deactivate(),b.draw_blur(u.tex))}}function xa(a,b,c){var d,e,f,h=!1;this.id=K();
var k=!1;this.initialize=function(g){d||(d=C(g.gl,y+"shaders/raster"));this.image=V(g.gl,a,function(){k=!0});e=E(g.gl,x(new vect(0,1),new vect(1,0)),2);f=E(g.gl,x(b,c),2);h=!0};this.draw=function(a){var b=a.gl;h||this.initialize(a);k&&(b.useProgram(d),d.data("screen",a.camera.mat3),d.data("pos",f),d.data("tex_in",e),d.data("sampler",this.image),b.drawArrays(b.TRIANGLES,0,f.numItems))}}function ya(a){t||(t=C(y+"shaders/hillshade"));var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),
parseFloat(b.find("south").text())),d=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var e=!1,f=V(a,function(){e=!0});this.ready=function(){return e};var h=E(x(new vect(0,1),new vect(1,0)),2),k=E(x(c,d),2),g=315;this.draw=function(a){if(e){for(gl.useProgram(altitude_shader);1<=g;)g-=1;altitude_shader.data("azimuth",g);altitude_shader.data("altitude",Math.PI/4/(2*Math.PI));altitude_shader.data("screen",a.camera.mat3);altitude_shader.data("pos",
k);altitude_shader.data("tex_in",h);altitude_shader.data("elevation",f);a=vect.sub(a.camera.screen(d),a.camera.screen(c));altitude_shader.data("pix_w",1/a.x);altitude_shader.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,k.numItems);return g}}}function ya(a){t||(t=C(engine.gl,y+"shaders/hillshade"));var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),d=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();
var e=!1,f=V(engine.gl,a,function(){e=!0});this.ready=function(){return e};var h=E(engine.gl,x(new vect(0,1),new vect(1,0)),2),k=E(engine.gl,x(c,d),2),g=315;this.initialize=function(){};this.draw=function(a){if(e){for(gl.useProgram(t);1<=g;)g-=1;t.data("azimuth",g);t.data("altitude",Math.PI/4/(2*Math.PI));t.data("screen",a.camera.mat3);t.data("pos",k);t.data("tex_in",h);t.data("elevation",f);a=vect.sub(a.camera.screen(d),a.camera.screen(c));t.data("pix_w",1/a.x);t.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,
0,k.numItems);return g}}}function aa(a){function b(a){a||(a={});a.desaturate||(a.desaturate=0);a.darken||(a.darken=0);a.hue||(a.hue=0);a.hue_color||(a.hue_color=ma(0,0,0,1));var b=a.url,d=a.min,e=a.rows,g=a.cols,k=a.cellsize;this.rows=e;this.cols=g;for(var m={},n={},j=function(b,c){var e=new vect(d.x+b*k,d.y+c*k),f=new vect(d.x+(b+1)*k,d.y+(c+1)*k),e={vert:x(e,f,a.z_index),tex:null,i:b,j:c,id:b+g*c,ready:!1,min:e,max:f};n[b][c]=e;m[e.id]=e},l=0;l<g;l++)n[l]={};this.size=function(a){var b=a.camera.screen(d);
a=a.camera.screen(vect.add(d,new vect(k*g,k*e)));b=vect.sub(a,b);b.y=Math.abs(b.y);return b};var p=!1;this.noexpire=function(a){p=a};this.cull=function(){if(!p){var b=(new Date).getTime(),c;for(c in s)if(b-s[c]>Ta){var d=m[c];delete m[c];delete n[d.i][d.j];a.available.push(d.tex);d.tex=null;d.ready=!1;delete s[c]}}};var r=function(){var a=f.camera.project(new vect(f.canvas.offset().left,f.canvas.offset().top+f.canvas.height())),b=f.camera.project(new vect(f.canvas.offset().left+f.canvas.width(),f.canvas.offset().top)),
c=Math.floor((a.x-d.x)/k),e=Math.ceil((b.x-d.x)/k),a=Math.floor((a.y-d.y)/k),b=Math.ceil((b.y-d.y)/k);return{min_col:c,max_col:e,min_row:a,max_row:b}},s={};this.ready=function(){for(var a=r(),b=Math.max(0,a.min_col);b<Math.min(g,a.max_col);b++)for(var c=Math.max(0,a.min_row);c<Math.min(e,a.max_row);c++)if(!n[b][c]||!n[b][c].ready)return!1;return!0};var u=function(c,d){if(!n[c][d].tex){var e;if("file"==a.source)e=b+"/"+n[c][d].id+".png";else if("wms"==a.source){e={service:"wms",version:"1.1.0",request:"GetMap",
layers:a.layer,bbox:[n[c][d].min.x,n[c][d].min.y,n[c][d].max.x,n[c][d].max.y].join(),width:a.size,height:a.size,srs:"EPSG:4326",format:"image/png",transparent:"true"};var h=[],g;for(g in e)h.push(g+"="+e[g]);e=b+"?"+h.join("&")}n[c][d].tex=a.available.pop();n[c][d].tex||(n[c][d].tex=new qa(f));g=e;var k=n[c][d],m=new Image;m.crossOrigin="";m.onload=function(){k.tex&&(k.tex.image(m),k.ready=!0)};m.src=g}};this.fetch_all=function(){for(var a=(new Date).getTime(),b=0;b<g;b++)for(var c=0;c<e;c++)n[b][c]||
j(b,c),n[b][c].tex||u(b,c),s[n[b][c].id]=a};this.fetch=function(){for(var a=r(),b=(new Date).getTime(),c=Math.max(0,a.min_col-1);c<Math.min(g,a.max_col+1);c++)for(var d=Math.max(0,a.min_row-1);d<Math.min(e,a.max_row+1);d++)n[c][d]||j(c,d),n[c][d].tex||u(c,d),s[n[c][d].id]=b};var t=!1;this.initialize=function(a){if(t)throw"Not Implemented: Migrating Tile Layers to New Map";c||(c=C(a.gl,y+"shaders/tile"));t=!0};this.draw=function(b,d,f,k,m){t||this.initialize(b);b=function(){za++;f.update();c.data("pos",
f.get("vert"));c.data("tex_in",f.get("tex"));c.data("lookup_in",f.get("lookup"));c.data("desaturate",a.desaturate);c.data("darken",a.darken);c.data("hue",a.hue);c.data("hue_color",a.hue_color.array);h.drawArrays(h.TRIANGLES,0,6*k)};d=r();for(var j=(new Date).getTime(),l=Math.max(0,d.min_col);l<Math.min(g,d.max_col);l++)for(var p=Math.max(0,d.min_row);p<Math.min(e,d.max_row);p++)if(n[l][p]&&n[l][p].ready&&n[l][p].tex){f.write("vert",n[l][p].vert,6*k,6);f.write("tex",x(new vect(0,0),new vect(1,1)),
6*k,6);f.repeat("lookup",[k/R+1/(2*R)],6*k,6);s[n[l][p].id]=j;c.data("sampler"+k,n[l][p].tex);if(null==n[l][p].tex)throw"badness";k++;Aa++;k>=R&&(b(),k=0)}m&&b();return k}}var c=null,d=[],e=[],f=null,h=null;this.id=K();for(var k=0;k<a.levels;k++){var g=l(a);"file"==g.source&&(g.url+="/"+a.size*Math.pow(2,k+1));g.min=new vect(-180,-90);g.rows=Math.pow(2,k);g.cols=2*g.rows;g.cellsize=180/g.rows;g.z_index=1-ja-k/1E3;g.available=e;g=new b(g);d.push(g)}ja+=(a.levels+2)/1E3;var n=null,m=!1;this.initialize=
function(a){f=a;c||(c=C(f.gl,y+"shaders/tile"));h=f.gl;n=new Q(f,6*R);n.create("vert",3);n.create("tex",2);n.create("lookup",1);n.alloc(6*R);for(a=0;25>a;a++)e.push(new qa(f));for(a=0;a<d.length;a++)d[a].initialize(f);d[0].fetch_all();d[0].noexpire(!0);m=!0};this.draw=function(b,e){m||initialize(b);h.useProgram(c);c.data("screen",b.camera.mat3);za=Aa=0;for(var f=Infinity,g=d[0],k,j=0;j<d.length;j++){var l=a.size*d[j].cols/d[j].size(b).x;1>l&&(l=1/l);l<f&&(f=l,g=d[j],k=j)}for(j=k;0<=j;j--)d[j].fetch();
if(g.ready())g.draw(b,e,n,0,!0);else{b.enableZ();f=0;for(j=k;0<=j;j--)f=d[j].draw(b,e,n,f,0==j);b.disableZ()}$.each(d,function(a,b){b.cull()})}}var y="",O=jQuery,Ua=function(a){if("string"===typeof a.data){var b=a.handler,c=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var e="keypress"!==a.type&&O.hotkeys.specialKeys[a.which],f=String.fromCharCode(a.which).toLowerCase(),h="",k={};a.altKey&&"alt"!==
e&&(h+="alt+");a.ctrlKey&&"ctrl"!==e&&(h+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==e)&&(h+="meta+");a.shiftKey&&"shift"!==e&&(h+="shift+");e?k[h+e]=!0:(k[h+f]=!0,k[h+O.hotkeys.shiftNums[f]]=!0,"shift+"===h&&(k[O.hotkeys.shiftNums[f]]=!0));e=0;for(f=c.length;e<f;e++)if(k[c[e]])return b.apply(this,arguments)}}}};O.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",
37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_",
"=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"}};O.each(["keydown","keyup","keypress"],function(){O.event.special[this]={add:Ua}});var H=jQuery,ka=function(a){var b=a||window.event,c=[].slice.call(arguments,1),d=0,e=0,f=0;a=H.event.fix(b);a.type="mousewheel";b.wheelDelta&&(d=b.wheelDelta/120);b.detail&&(d=-b.detail/3);f=d;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(f=0,e=-1*d);void 0!==b.wheelDeltaY&&(f=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(e=-1*b.wheelDeltaX/120);
c.unshift(a,d,e,f);return(H.event.dispatch||H.event.handle).apply(this,c)},P=["DOMMouseScroll","mousewheel"];if(H.event.fixHooks)for(var I=P.length;I;)H.event.fixHooks[P[--I]]=H.event.mouseHooks;H.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=P.length;a;)this.addEventListener(P[--a],ka,!1);else this.onmousewheel=ka},teardown:function(){if(this.removeEventListener)for(var a=P.length;a;)this.removeEventListener(P[--a],ka,!1);else this.onmousewheel=null}};H.fn.extend({mousewheel:function(a){return a?
this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});for(var Ba=0,I=["ms","moz","webkit","o"],S=0;S<I.length&&!window.requestAnimationFrame;++S)window.requestAnimationFrame=window[I[S]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[I[S]+"CancelAnimationFrame"]||window[I[S]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-Ba)),
d=window.setTimeout(function(){a(b+c)},c);Ba=b+c;return d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var F={x:0,y:0};$(document).mousemove(function(a){F.x=a.clientX;F.y=a.clientY;F.lastMove=(new Date).getTime()});var Pa=!1,pa=0,u=new function(){this.styles={};this.derivedStyle=function(a,c,d,e){if(!d)throw"Undefined operation";var f;f=this.getStyle(a,d,e);null===f&&(f=this.getStyle(a,null,e),null===f&&(f=this.getStyle(c,d,e),null===f&&(f=this.getStyle(c,
null,e),null===f&&(f=d.defaultStyle(a.type,e)))));return f};var a=function(a,c){var d=c?c.id:"default";d in u.styles||(u.styles[d]={});a.id in u.styles[d]||(u.styles[d][a.id]={})};this.getStyle=function(b,c,d){a(b,c);b=this.styles[c?c.id:"default"][b.id][d];return void 0===b?null:b};this.setStyle=function(b,c,d,e){a(b,c);this.styles[c?c.id:"default"][b.id][d]=e;z.trigger(b,"style",[b,d])}},z=new function(){this.listeners={};this.manage=function(a){a.id in this.listeners||(this.listeners[a.id]={parents:[],
callbacks:{}})};this.linkParent=function(a,c){this.listeners[c.id].parents.push(a)};this.addEventHandler=function(a,c,d){this.listeners[a.id].callbacks[c]||(this.listeners[a.id].callbacks[c]=[]);this.listeners[a.id].callbacks[c].push(d)};this.moveMouse=function(){};this.clickMouse=function(){};this.mouseDown=function(){};var a=null;this.mouseOver=function(b){null!==a&&b!=a&&this.trigger(a,"mouseout",[a]);null!==b&&b!=a&&this.trigger(b,"mouseover",[b]);a=b};this.trigger=function(a,c,d){a.id in this.listeners&&
(c in this.listeners[a.id].callbacks&&$.each(this.listeners[a.id].callbacks[c],function(c,f){f.apply(a,d)}),$.each(this.listeners[a.id].parents,function(a,b){z.trigger(b,c,d)}))}},Ja=1024,Ka=na(0,0,1,1),Na=1024,Ca=function(a,b,c){var d={};$.each(a.Queriers,function(e,f){d[e]=new f(a,b,c)});this.boxSearch=function(a){var b=new A([]),c;for(c in d)var k=d[c].boxSearch(a),b=b.join(k);return b};this.pointSearch=function(a){for(var b in d){var c=d[b].pointSearch(a);if(c)return c}return null}},Va=function(a,
b){var c=[],d=0;b.features().type("Point").each(function(e,h){var k=u.derivedStyle(h,b,a,"radius");k>d&&(d=k);$.each(h.geom,function(a,b){c.push({x:b[0],y:b[1],ref:h})})});var e=new Y(c);this.boxSearch=function(a){a=e.search(a);var b=[];$.each(a,function(a,c){b.push(c.ref)});return new A(b)};this.pointSearch=function(c){for(var h=vect.add(c,new vect(-d,d)),k=vect.add(c,new vect(d,-d)),h=new L(a.camera.project(h),a.camera.project(k)),h=e.search(h),k=0;k<h.length;k++)for(var g=h[k].ref,n=u.derivedStyle(g,
b,a,"radius"),m=0;m<g.geom.length;m++){var j=a.camera.screen(new vect(g.geom[m][0],g.geom[m][1]));if(vect.dist(j,c)<n)return g}return null}},Wa=function(a,b){var c=b.features().type("Polygon"),d=[];c.each(function(a,b){$.each(b.geom,function(a,c){$.each(c,function(a,c){$.each(c,function(a,c){d.push({ref:b,x:c[0],y:c[1]})})})})});var e=new Y(d);this.boxSearch=function(a){var b=e.search(a),d={};$.each(b,function(a,b){d[b.ref.id]=b.ref});c.each(function(b,c){for(var e=0;4>e;e++)c.contains(a.vertex(e))&&
(d[c.id]=c)});var b=[],g;for(g in d)b.push(d[g]);return new A(b)};this.pointSearch=function(b){b=a.camera.project(b);for(var d=0;d<c.count();d++){var e=c.get(d);if(e.contains(b))return e}return null}},Xa=function(a,b,c){var d=b.features(),e=[];b.features().each(function(a,b){$.each(c.geomFunc(b),function(a,c){$.each(c,function(a,c){$.each(c,function(a,c){e.push({ref:b,x:c[0],y:c[1]})})})})});var f=new Y(e);this.boxSearch=function(a){a=f.search(a);var b={};$.each(a,function(a,c){b[c.ref.id]=c.ref});
a=[];for(var c in b)a.push(b[c]);return new A(a)};this.pointSearch=function(e){var f=a.camera.project(e),f=Math.floor(f.x);if(0>f||f>=c.order.length)return null;for(var g=0;g<d.count();g++){var n=d.get(g),m=n.attr(c.order[f]),j=n.attr(c.order[f+1]);if(!isNaN(m)&&!isNaN(j)){var m=vect(f,m),l=vect(f+1,j),j=a.camera.screen(m),m=a.camera.screen(l),m=vect.dir(m,j),j=vect.sub(e,j),m=vect.dot(j,m),j=j.length();if(Math.sqrt(Math.pow(j,2)-Math.pow(m,2))<u.derivedStyle(n,b,a,"stroke-width"))return n}}return null}},
la=function(a){this.id=K();this.type="Feature";this.type=a.type;var b=a.attr;this.attr=function(a,d){if(void 0===d)return b[a];throw"Not Implemented";};this.geom=a.geom;this.geometry=function(){};this.style=function(a,b,e){var f;!a||"Engine"==a.type?(f=a,a=b,b=e):f=null;if(void 0===b)return u.getStyle(this,f,a);u.setStyle(this,f,a,b);return this}},K,Da=1;K=function(){var a=Da;Da++;return a};var ra;ra=function(a,b){return new vect(a+1E-6*Math.random()-5E-7,b+1E-6*Math.random()-5E-7)};var Sa={Point:function(a,
b){la.call(this,a,b);this.bounds=null;for(var c=0;c<this.geom.length;c++){var d=new vect(this.geom[c][0],this.geom[c][1]),d=new L(d.clone(),d.clone());this.bounds?this.bounds.union(d):this.bounds=d}this.map_contains=function(a,c){for(var d=u.derivedStyle(this,b,a,"radius"),k=0;k<this.geom.length;k++){var g=a.camera.screen(new vect(this.geom[k][0],this.geom[k][1]));if(vect.dist(g,c)<d)return!0}return!1}},Polygon:function(a,b){la.call(this,a,b);this.bounds=wa(this.geom);this.map_contains=function(a,
b){return this.contains(a.camera.project(b))};this.contains=function(a){var b=0;if(this.bounds.contains(a)){b++;for(b=0;b<this.geom.length;b++){var e=0;$.each(this.geom[b],function(b,d){for(var k=0;k<d.length;k++){var g=(k+1)%d.length;if(0>(a.y-d[k][1])/(a.y-d[g][1])){var j=new vect(720,a.y),m=new vect(d[k][0],d[k][1]),g=new vect(d[g][0],d[g][1]);vect.intersects(a,j,m,g)&&e++}}});if(1==e%2)return!0}}return!1}},Line:function(a,b){la.call(this,a,b);this.bounds=wa(this.geom);this.map_contains=function(){return!1}}},
B=null,A=function(a){var b=null;this.length=a.length;this.count=function(){return a.length};this.items=function(){return a};this.type=function(b){for(var c=[],f=0;f<a.length;f++)("*"==b||a[f].type==b)&&c.push(a[f]);return new A(c)};this.join=function(b){for(var c=[],f=0;f<a.length;f++)c.push(a[f]);for(f=0;f<b.count();f++){var h=b.get(f);this.id(h.id)||c.push(h)}return new A(c)};this.attr=function(){throw"Not Implemented";};this.get=function(b){return a[b]};this.subset=function(b){for(var c=[],f=0;f<
b.length;f++)c.push(a[b[f]]);return new A(c)};this.id=function(c){if(!b){b={};for(var e=0;e<a.length;e++)b[a[e].id]=a[e]}return c in b?b[c]:null};this.each=function(b){for(var c=0;c<a.length;c++)b(c,a[c]);return this};var c={">":function(a,b){return a>b},"<":function(a,b){return a<b},"==":function(a,b){return a==b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=b}};this.select=function(b){if(b.match(/^\s*\*\s*$/))return new A(a);var e=b.match(/^\s*([^\s]+)\s*([=<>]+)\s*(([^\s])+)\s*$/);
if(!e)throw"Bad Selector";b=e[1];var f=e[2],h=null,k=null;isNaN(e[3])?k=e[3]:h=parseFloat(e[3]);new_elem=[];if(k)for(e=0;e<a.length;e++)c[f](a[e].attr(b),a[e].attr(k))&&new_elem.push(a[e]);else for(e=0;e<a.length;e++)c[f](a[e].attr(b),h)&&new_elem.push(a[e]);return new A(new_elem)};this.filter=function(b){for(var c=[],f=0;f<a.length;f++)b(a[f])&&c.push(a[f]);return new A(c)};this.quantile=function(b,c,f){var h=a.filter(function(a){return void 0!==a.attr(b)});h.sort(function(a,c){return a.attr(b)-
c.attr(b)});var k=Math.round(c*h.length/f);c=Math.round((c-1)*h.length/f);return new A(h.slice(c,k))};this.range=function(b){for(var c=Infinity,f=-Infinity,h=!1,k=0;k<a.length;k++){var g=a[k].attr(b);isNaN(g)||(h=!0,c>g&&(c=g),f<g&&(f=g))}return!h?null:{min:c,max:f}};this.style=function(b,c,f){var h,k,g;"Engine"==b.type?(h=b,k=c,g=f):(h=null,k=b,g=c);if(void 0===g){if(a[0])return a[0].style(h,k)}else return $.each(a,function(a,b){b.style(h,k,"function"==typeof g?g(b):Fa(g)?g[a]:g)}),this}},t=null,
J=null,t=null,Ta=1E3,ja=0,R=8,Aa=0,za=0,Ea=[];window.wiggle={Map:function(a,b){var c=this;void 0===b&&(b={});b.geomFunc=function(a){return a.geom};j(b,{width:360,center:new vect(0,0),base:"default","tile-server":"http://eland.ecohealthalliance.org/wigglemaps",preserveAspectRatio:!0});ta.call(this,a,b);var d=[Ma,W];this.Renderers={Point:Ia,Polygon:function(a,b,c){var e=[],j=function(a){this.update=function(b,c){$.each(a,function(a,d){d.update(b,c)})};this.keys=function(){var b={};$.each(a,function(a,
c){for(key in c.style_map)b[key]=!0});return b}};$.each(d,function(d,j){e.push(new j(a,b,c))});this.views=[];this.create=function(a,b){var c=[];$.each(e,function(d,e){c.push(e.create(a,b))});return new j(c)};this.update=function(){$.each(e,function(a,b){b.update()})};this.draw=function(){$.each(e,function(a,b){b.draw()})}},Line:W};this.Queriers={Point:Va,Polygon:Wa};this.styles={Point:{fill:new s(0.02,0.44,0.69,1),opacity:1,radius:5,stroke:"none","stroke-width":2},Polygon:{fill:new s(0.02,0.44,0.69,
1),"fill-opacity":0.5,stroke:new s(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":0.75},Line:{stroke:new s(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":2},"default":{fill:new s(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new s(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":1}};var e=null;"default"==b.base||"nasa"==b.base?(e=l(b),r(e,{source:"file",url:b["tile-server"]+"/tiles/nasa_topo_bathy",levels:8,size:256}),e=new aa(e)):"ne"==b.base?(e=l(b),r(e,{source:"file",url:b["tile-server"]+
"/tiles/NE1_HR_LC_SR_W_DR",levels:6,size:256}),e=new aa(e)):"ne1"==b.base?(e=l(b),r(e,{source:"file",url:TILE_SERVER+"/tiles/NE1_HR_LC",levels:6,size:256}),e=new aa(e)):e=null;e&&(e.initialize(c),c.scene.push(e));this.append=function(a){"draw"in a?this.scene.push(a):(this.scene.push(new sa(c,a,b)),this.queriers[a.id]=new Ca(this,a,b))}},TimeSeries:function(a,b,c){void 0===c&&(c={});c.order||(c.order=b.numeric(),c.order.sort());var d=b.features(),e=null;$.each(c.order,function(a,b){var c=d.range(b);
e=e?{min:e.min<c.min?e.min:c.min,max:e.max>c.max?e.max:c.max}:c});j(c,{range:{min:e.min,max:e.max},domain:{min:0,max:c.order.length-1},min:new vect(0,e.min),width:c.order.length-1,height:e.max-e.min,worldMin:new vect(0,e.min),worldMax:new vect(c.order.length-1,e.max),ylock:!0});var f=c.order;c.geomFunc=function(a){for(var b=[],c=[],d=0;d<f.length;d++){var e=a.attr(f[d]);isNaN(e)?0<c.length&&(b.push(c),c=[]):c.push([d,e])}0<c.length&&b.push(c);return[b]};ta.call(this,a,c);this.styles={"default":{fill:new s(0.02,
0.44,0.69,1),"fill-opacity":0.5,stroke:new s(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":2}};this.Renderers={"default":W};this.Queriers={"*":Xa};var h={stroke:new s(0.25,0.25,0.25,1),"stroke-width":0.75,"stroke-opacity":1},k=function(a){return h[a]},g=new W(this);$.each(c.order,function(a){g.create([[[[a,c.range.min],[a,c.range.max]]]],k)});g.create([[[[c.domain.min,c.range.min],[c.domain.max,c.range.min],[c.domain.max,c.range.max],[c.domain.min,c.range.max],[c.domain.min,c.range.min]]]],
k);this.scene.push(g);if(c.ticks){for(a=0;a>c.range.min;)a-=c.ticks;for(;a<c.range.max;)g.create([[[[c.domain.min,a],[c.domain.max,a]]]],k),a+=c.ticks}this.scene.push(new sa(this,b,c));this.queriers[b.id]=new Ca(this,b,c)},layer:{Layer:Z,Grid:ia,Hillshade:ya,Elevation:function(a){J||(J=C(y+"shaders/elevation"));var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),d=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));
a=$(a).find("GroundOverlay Icon href").text();var e=V(a),f=E(x(new vect(0,1),new vect(1,0)),2),h=E(x(c,d),2);this.draw=function(a,b,j){j||(gl.useProgram(J),J.data("screen",a.camera.mat3),J.data("pos",h),J.data("tex_in",f),J.data("elevation",e),vect.sub(a.camera.screen(d),a.camera.screen(c)),gl.drawArrays(gl.TRIANGLES,0,h.numItems))}},Raster:xa},io:{Shapefile:function(a){var b=a.path;$.ajax({url:b+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(c){for(var d=[],e=100;e<c.length;)d.push(2*
ba(c,e)),e+=8;$.ajax({url:b+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(b){for(var c=[],e=[],g=0;g<d.length;g++){var j=d[g];ba(b,j);ba(b,j+4);var m=j+8,l=D(b,m);if(0==l)console.log("NULL Shape");else if(1==l)l=T(b,m+4),m=T(b,m+12),c.push({type:"Point",attr:{},geom:[[l,m]]});else if(5==l){for(var l=D(b,m+36),m=D(b,m+40),p=j+52,j=j+52+4*l,r=[],s=0;s<l;s++){var u=D(b,p+4*s),t;t=s+1<l?D(b,p+4*(s+1)):m;var x=j,v=[];for(t-=1;t>=u;t--){var y=T(b,x+16*t),z=T(b,x+16*t+8);v.push([y,
z])}r.push(v)}e.push({type:"Polygon",attr:{},geom:[r]})}else throw"Not Implemented: "+l;}if(0<c.length){var w=new Z(a);$.each(c,function(a,b){w.append(b)});b=w}else 0<e.length?(w=new Z(a),$.each(e,function(a,b){w.append(b)}),b=w):b=void 0;a.success(b)}})}})},GeoJSON:function(a,b){void 0===b&&(b={});for(var c=new Z(b),d=0;d<a.features.length;d++){var e=a.features[d];if("Feature"==e.type){"Point"==e.geometry.type&&c.append({type:"Point",geom:[e.geometry.coordinates],attr:e.properties});"MultiPoint"==
e.geometry.type&&c.append({type:"Point",geom:e.geometry.coordinates,attr:e.properties});if("Polygon"==e.geometry.type){for(var f=e.geometry.coordinates,h=[],k=0;k<=f.length-1;k++){for(var g=[],j=f[k].length-1;0<=j;j--)g.push(f[k][j]);h.push(g)}c.append({type:"Polygon",geom:[h],attr:e.properties})}if("MultiPolygon"==e.geometry.type){var m=[];$.each(e.geometry.coordinates,function(a,b){for(var c=[],d=0;d<=b.length-1;d++){for(var e=[],f=b[d].length-1;0<=f;f--)e.push(b[d][f]);c.push(e)}m.push(c)});c.append({type:"Polygon",
geom:m,attr:e.properties})}"MultiLineString"==e.geometry.type&&$.each(e.geometry.coordinates,function(a,b){c.append({type:"Line",geom:[[b]],attr:e.properties})})}}return c},KML:function(a){var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),b=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();return new xa(y+a,c,b)},SparseGrid:function(a,b){var c=U(a,0),d=U(a,4),e=D(a,
8),f=D(a,12),h=U(a,16),k={};for(key in b)k[key]=b[key];k.lower=new vect(c,d);k.upper=new vect(c+h*e,d+h*f);k.rows=f;k.cols=e;c=new ia(k);for(d=20;d<a.length;){for(var h=D(a,d),e=D(a,d+4),f=d+4,k=e,g=0;g<k;g++){var j=U(a,f+4*g);c.raw_set(h+g,j)}d+=8+4*e}return c},AsciiGrid:function(a,b){var c=a.split("\n"),d=c.splice(0,6),e=parseInt(d[0].slice(14)),f=parseInt(d[1].slice(14)),h=parseFloat(d[2].slice(14)),k=parseFloat(d[3].slice(14)),g=parseFloat(d[4].slice(14)),d=d[5].slice(14),j={};for(key in b)j[key]=
b[key];j.lower=new vect(h,k);j.upper=new vect(h+g*e,k+g*f);j.rows=f;j.cols=e;h=new ia(j);for(k=0;k<f;k++){g=c[k].split(" ");for(j=0;j<e;j++)g[j]==d?h.set(f-1-k,j,NaN):h.set(f-1-k,j,parseFloat(g[j]))}return h},WMS:function(a){a=l(a);for(var b=["url","layer"],c=0;c<b.length;c++){var d=b[c];if(!(d in a))throw"Key "+d+" not found";}j(a,{levels:16,size:256});var b={source:"wms"},e;for(e in b)a[e]=b[e];return new aa(a)}},util:{fcolor:ma,icolor:function(a,b,c,d){return new s(p(a/255,0,1),p(b/255,0,1),p(c/
255,0,1),p(d/255,0,1))},Box:L,RangeTree:Y},widget:{Slider:function(a,b,c){var d=function(a){if(a>=c)throw"Slider index out of bounds";return b.x/(c-1)*a},e=function(d){return d<=a.x?0:d>=a.x+b.x?c-1:Math.round((d-a.x)/b.x*(c-1))};this.dom=$("<div></div>").addClass("slider-container").css("position","relative").css("left",a.x).css("top",a.y).css("width",b.x).css("height",b.y);var f=!1,h=0,k=$("<div></div>").addClass("slider-box").css("position","relative").css("left",-10).css("height",b.y).css("width",
20).mousedown(function(){f=!0});this.tick=function(){return h};this.count=function(){return c};var g=function(){};this.change=function(a){g=a};var j=function(){};this.release=function(a){j=a};this.dragging=function(){return f};this.dom.append(k);this.set=function(a){a!=h&&g(a);h=a;var b=d(a);k.css("left",b-10);j(a)};$(document).bind("mouseup",function(){if(f){f=!1;var a=e(event.clientX);j(a)}});$(document).bind("mousemove",function(a){f&&(a=e(a.clientX),a!=h&&g(a),h=a,a=d(a),k.css("left",a-10))})}},
ready:function(a){Ea.push(a)}};$(document).ready(function(){$('script[src*="wigglemaps"]').each(function(a,b){var c=/wigglemaps(\.min)?\.js/;$(b).attr("src").match(c)&&(y=$(b).attr("src").replace(c,""))});$.each(Ea,function(a,b){b()})})})();
