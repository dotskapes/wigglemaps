function vect(n,p,r){this.x=n;this.y=p;this.z=r?r:0;this.add=function(l){this.x+=l.x;this.y+=l.y;this.z+=l.z};this.sub=function(l){this.x-=l.x;this.y-=l.y;this.z-=l.z};this.scale=function(l){this.x*=l;this.y*=l;this.z*=l};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.normalize=function(){var l=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);0!=l&&(this.x/=l,this.y/=l,this.z/=l)};this.div=function(l){this.x/=l.x;this.y/=l.y;this.z/=l.z};this.floor=function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z)};this.zero=function(){return 0==this.x+this.y+this.z};this.dot=function(l){return this.x*l.x+this.y*l.y+this.z*l.z};this.cross=function(){throw"Need to reimplement";};this.rotate=function(l){var n=Math.cos(l);l=Math.sin(l);xp=n*this.x-l*this.y;yp=l*this.x+n*this.y;this.x=xp;this.y=yp;return this};this.clone=function(){return new vect(this.x,this.y,this.z)}}vect.scale=function(n,p){return new vect(n.x*p,n.y*p,n.z*p)};
vect.add=function(n,p){return new vect(n.x+p.x,n.y+p.y,n.z+p.z)};vect.sub=function(n,p){if(!n||!p)throw"Bad Vector";return new vect(n.x-p.x,n.y-p.y,n.z-p.z)};vect.dist=function(n,p){var r=p.x-n.x,l=p.y-n.y,s=p.z-n.z;return Math.sqrt(r*r+l*l+s*s)};vect.dir=function(n,p){var r=vect.sub(n,p);r.normalize();return r};vect.dot2d=function(n,p){return n.x*p.x+n.y*p.y};vect.cross=function(n,p){return n.x*p.y-n.y*p.x};
vect.left=function(n,p,r,l){l||(l=0);p=vect.sub(p,n);n=vect.sub(r,n);return vect.cross(p,n)>=-l};vect.intersects=function(n,p,r,l,s){s||(s=0);return vect.left(n,p,r,s)!=vect.left(n,p,l,s)&&vect.left(r,l,p,s)!=vect.left(r,l,n,s)};vect.intersect2dt=function(n,p,r,l){l=n.x*(l.y-r.y)+p.x*(r.y-l.y)+l.x*(p.y-n.y)+r.x*(n.y-p.y);return 0==l?Infinity:-(n.x*(r.y-p.y)+p.x*(n.y-r.y)+r.x*(p.y-n.y))/l};
vect.intersect2dpos=function(n,p,r,l){var s=n.x*(l.y-r.y)+p.x*(r.y-l.y)+l.x*(p.y-n.y)+r.x*(n.y-p.y);if(0==s)return Infinity;r=(n.x*(l.y-r.y)+r.x*(n.y-l.y)+l.x*(r.y-n.y))/s;p=vect.sub(p,n);p.scale(r);return vect.add(n,p)};vect.rotate=function(n,p){var r=Math.cos(p),l=Math.sin(p);xp=r*n.x-l*n.y;yp=l*n.x+r*n.y;return n=new vect(xp,yp,n.z)};
(function(){function n(a,e){for(var d in e)d in a||(a[d]=e[d])}function p(a){var e={};for(key in a)e[key]=a[key];return e}function r(a,e){for(key in e)a[key]=e[key]}function l(a,e,d){return Math.min(Math.max(a,e),d)}function s(a,e,d,c){1>=a&&1>=e&&1>=d&&1>=c?(this.r=a,this.g=e,this.b=d,this.a=c):(this.r=a/255,this.g=e/255,this.b=d/255,this.a=c/255);this.array=[this.r,this.g,this.b,this.a];this.vect=function(){return this.array};this.rgb=function(){return"rgb("+parseInt(255*this.r)+","+parseInt(255*
this.g)+","+parseInt(255*this.b)+")"}}function xa(a,e,d,c){return new s(l(a,0,1),l(e,0,1),l(d,0,1),l(c,0,1))}function ha(a,e){return((a.charCodeAt(e)&255)<<24)+((a.charCodeAt(e+1)&255)<<16)+((a.charCodeAt(e+2)&255)<<8)+(a.charCodeAt(e+3)&255)}function G(a,e){return((a.charCodeAt(e+3)&255)<<24)+((a.charCodeAt(e+2)&255)<<16)+((a.charCodeAt(e+1)&255)<<8)+(a.charCodeAt(e)&255)}function aa(a,e){var d=a.charCodeAt(e)&255,c=a.charCodeAt(e+1)&255,b=a.charCodeAt(e+2)&255,f=a.charCodeAt(e+3)&255,j=a.charCodeAt(e+
4)&255,h=a.charCodeAt(e+5)&255,g=a.charCodeAt(e+6)&255,k=a.charCodeAt(e+7)&255,m=1-2*(k>>7),k=((k&127)<<4)+((g&240)>>4)-1023,d=(g&15)*Math.pow(2,48)+h*Math.pow(2,40)+j*Math.pow(2,32)+f*Math.pow(2,24)+b*Math.pow(2,16)+c*Math.pow(2,8)+d;return m*(1+d*Math.pow(2,-52))*Math.pow(2,k)}function ba(a,e){var d=a.charCodeAt(e)&255,c=a.charCodeAt(e+1)&255,b=a.charCodeAt(e+2)&255,f=a.charCodeAt(e+3)&255,j=1-2*(f>>7),f=((f&127)<<1)+((b&254)>>7)-127,d=(b&127)*Math.pow(2,16)+c*Math.pow(2,8)+d;return j*(1+d*Math.pow(2,
-23))*Math.pow(2,f)}function ya(a,e,d,c){return[a-d,e+c,a-d,e-c,a+d,e+c,a-d,e-c,a+d,e-c,a+d,e+c]}function u(a,e,d){return 2==arguments.length?[a.x,e.y,a.x,a.y,e.x,e.y,a.x,a.y,e.x,a.y,e.x,e.y]:[a.x,e.y,d,a.x,a.y,d,e.x,e.y,d,a.x,a.y,d,e.x,a.y,d,e.x,e.y,d]}function B(a,e){if(!a)return null;var d=a.createProgram(),c=za(a,a.VERTEX_SHADER,e+"/vert.glsl"),b=za(a,a.FRAGMENT_SHADER,e+"/frag.glsl");a.attachShader(d,c);a.attachShader(d,b);a.linkProgram(d);var f={},c=(c.source+b.source).match(/((uniform)|(attribute)) (\w+) (\w+)/mg),
b=0;a.useProgram(d);if(c){for(var j=0;j<c.length;j++){var h=c[j].split(" ");f[h[2]]={u:h[0],type:h[1],loc:null};if("uniform"==h[0])f[h[2]].loc=a.getUniformLocation(d,h[2]);else{var g=a.getAttribLocation(d,h[2]);f[h[2]].loc=g}"sampler2D"==h[1]&&(f[h[2]].tex=b,b++)}d.get=function(a){return f[a].loc};d.data=function(c,b){var d=f[c];if(!d)throw"Could not find shader variable "+c;if("uniform"==d.u)if("float"==d.type)a.uniform1f(d.loc,b);else if("vec2"==d.type)a.uniform2fv(d.loc,b);else if("ivec2"==d.type)a.uniform2iv(d.loc,
b);else if("vec3"==d.type)a.uniform3fv(d.loc,b);else if("ivec3"==d.type)a.uniform3iv(d.loc,b);else if("vec4"==d.type)a.uniform4fv(d.loc,b);else if("ivec4"==d.type)a.uniform4iv(d.loc,b);else if("bool"==d.type)a.uniform1i(d.loc,b);else if("mat4"==d.type)a.uniformMatrix4fv(d.loc,!1,b);else if("mat3"==d.type)a.uniformMatrix3fv(d.loc,!1,b);else if("sampler2D"==d.type)"texture"in b&&(b=b.texture()),a.activeTexture(a["TEXTURE"+d.tex]),a.bindTexture(a.TEXTURE_2D,b),a.uniform1i(d.loc,d.tex);else if("int"==
d.type)a.uniform1i(d.loc,b);else throw"Unsupported Type for Shader Helper: "+d.type;else if("attribute"==d.u)a.enableVertexAttribArray(d.loc),a.bindBuffer(a.ARRAY_BUFFER,b),a.vertexAttribPointer(d.loc,b.itemSize,a.FLOAT,!1,0,0);else throw"Type: "+d.u+" Recieved";}}return d}function za(a,e,d){var c=a.createShader(e);$.ajax({async:!1,url:d,dataType:"text",success:function(b){a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw a.getShaderInfoLog(c);c.source=b},error:function(){console.log("Could not load "+
d)}});return c}function H(a,e,d){var c=a.createBuffer(),b=new Float32Array(e);a.bindBuffer(a.ARRAY_BUFFER,c);c.itemSize=d;c.numItems=e.length/d;a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return c}function ia(a,e,d){if(!a)return null;var c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);var b=new Float32Array(e*d);c.itemSize=d;c.numItems=e;c.update=function(b,d){var e=new Float32Array(b);a.bindBuffer(a.ARRAY_BUFFER,c);a.bufferSubData(a.ARRAY_BUFFER,4*d,e);a.bindBuffer(a.ARRAY_BUFFER,
null)};a.bufferData(a.ARRAY_BUFFER,b,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return c}function ca(a,e,d){var c=a.createTexture();c.id=Aa;Aa++;var b=new Image;b.onload=function(){a.bindTexture(a.TEXTURE_2D,c);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,
a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);d&&d()};b.src=e;return c}function ja(a,e){var d=p(e);n(d,{mag_filter:a.LINEAR,min_filter:a.LINEAR,wrap_s:a.CLAMP_TO_EDGE,wrap_t:a.CLAMP_TO_EDGE,mipmap:!1});var c=a.createTexture(),b=null;this.image=function(e){b=e;a.bindTexture(a.TEXTURE_2D,c);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d.mag_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d.min_filter);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_S,d.wrap_s);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrap_t);d.mipmap&&a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null)};this.texture=function(){return b?c:null}}function Ba(a,e,d){var c=a.style(d);null===c&&(c=e.style(d),null===c&&(c=Pa[a.type][d]));return c}function Qa(a,e){e||(e={});"center"in e||(e.center=new vect(0,0));"extents"in e||(e.extents=180);this.mat3=new Float32Array(9);var d=a.width()/a.height();this.mat3[0]=2/e.extents;this.mat3[4]=2*d/e.extents;
this.mat3[8]=1;this.mat3[6]=0;this.mat3[7]=0;this.level=1;this.project=function(c){c=new vect(2*(c.x-a.offset().left)/a.width()-1,-(2*(c.y-a.offset().top)/a.height()-1));c.x=c.x/this.mat3[0]-this.mat3[6]/this.mat3[0];c.y=c.y/this.mat3[4]-this.mat3[7]/this.mat3[4];return c};this.screen=function(c){c=new vect(c.x*this.mat3[0]+this.mat3[6],c.y*this.mat3[4]+this.mat3[7]);c.x=a.offset().left+a.width()*(c.x+1)/2;c.y=a.offset().top+a.height()*(-c.y+1)/2;return c};this.percent=function(c){return new vect(2*
((c.x-a.offset().left)/a.width())-1,-(2*((c.y-a.offset().top)/a.height())-1))};this.pixel=function(c){return new vect(a.offset().left+(c.x+1)/2*a.width(),a.offset().top+(-c.y+1)/2*a.height())};this.move=function(a){this.mat3[6]-=a.x*this.mat3[0];this.mat3[7]-=a.y*this.mat3[4]};this.position=function(a){if(!a)return new vect(-this.mat3[6]/this.mat3[0],-this.mat3[7]/this.mat3[4]);this.mat3[6]=-a.x*this.mat3[0];this.mat3[7]=-a.y*this.mat3[4]};this.position(e.center);this.extents=function(a){e.extents=
a;a=this.position();this.level=1;this.mat3[0]=2/e.extents;this.mat3[4]=2*d/e.extents;this.position(a)};this.zoom=function(a){var b=new vect(this.mat3[6]/this.mat3[0],this.mat3[7]/this.mat3[4]);this.mat3[0]*=a;this.mat3[4]*=a;this.mat3[6]=b.x*this.mat3[0];this.mat3[7]=b.y*this.mat3[4];this.level*=a};this.reset=function(){this.zoom(1/this.level)};this.reconfigure=function(){var c=this.position();this.mat3[4]/=d;d=a.width()/a.height();this.mat3[4]*=d;this.position(c)}}function Ra(a){var e=!1,d=new vect(0,
0),c=new vect(0,0),b=null,f=0;a.canvas.mousedown(function(a){d=new vect(a.clientX,a.clientY);e=!0});$(window).bind("mouseup",function(){e=!1});$(document).bind("keypress","+",function(){a.camera.zoom(1.1)});$(document).bind("keypress","-",function(){a.camera.zoom(10/11)});$(document).bind("keypress","0",function(){a.camera.reset()});a.canvas.bind("mousewheel",function(c,b){b*=0.5;0>b?(b=-1*b+1,b=1/b):b+=1;a.camera.zoom(b);c.preventDefault()});var j=!0;this.disable=function(){j=!1};this.enable=function(){j=
!0};this.update=function(h){c=new vect(O.x,O.y);if(e&&j){var g=vect.sub(a.camera.project(d),a.camera.project(c));a.camera.move(g);d=c;f=g.length()/h;b=g;b.normalize()}else 0.01<f&&b&&(a.camera.move(vect.scale(b,f*h)),f-=3*h*f)}}function Sa(a,e,d){d||(d={});n(d,{base:"default",background:new s(0,0,0,1),antialias:!0});var c=this;this.canvas=$("<canvas></canvas>").attr("id","viewer");a?($(a).append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height())):(a=window,
$("body").append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height()),$(window).resize(function(){c.resize()}));this.resize=function(){c.canvas.attr("width",$(a).width());c.canvas.attr("height",$(a).height());b.viewport(0,0,c.canvas.width(),c.canvas.height());c.camera.reconfigure();for(var d=0;d<m.length;d++)m[d].resize()};var b;e=this.canvas;this.gl=b=gl=Ta?WebGLDebugUtils.makeDebugContext(e.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1}),
function(a,b){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to "+b;}):e.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1});b.viewport(0,0,c.canvas.width(),c.canvas.height());b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);b.enable(b.BLEND);y||(y=B(b,z+"shaders/blur"));Ca||(Ca=B(b,z+"shaders/light"));var f=new P(b,6);f.create("vert",2);f.create("tex",2);e=f.alloc(6);f.write("vert",u(new vect(-1,-1),new vect(1,1)),e,6);f.write("tex",u(new vect(0,0),new vect(1,
1)),e,6);f.update();this.scene=[];this.camera=new Qa(this.canvas,d);this.scroller=new Ra(this);this.pxW=1/this.canvas.attr("width");this.pxH=1/this.canvas.attr("height");this.sel=new Ua(this);this.select=function(a){a?(this.scroller.disable(),this.sel.enable()):(this.scroller.enable(),this.sel.disable())};var j=(new Date).getTime(),h=[];this.attr=function(a,b){"base"==a&&(d.base=b,k())};var g=null,k=function(){if("default"==d.base||"nasa"==d.base){var a=p(d);r(a,{source:"file",url:la+"/tiles/nasa_topo_bathy",
levels:8,size:256});g=new ea(a)}else"ne"==d.base?(a=p(d),r(a,{source:"file",url:la+"/tiles/NE1_HR_LC_SR_W_DR",levels:6,size:256}),g=new ea(a)):"ne1"==d.base?(a=p(d),r(a,{source:"file",url:la+"/tiles/NE1_HR_LC",levels:6,size:256}),g=new ea(a)):g=null;g&&g.initialize(c)};k();this.enable_z=function(){b.depthFunc(b.LEQUAL);b.enable(b.DEPTH_TEST)};this.disable_z=function(){b.disable(b.DEPTH_TEST)};var m=[],q=[null];this.framebuffer=function(){var a=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,
a);a.width=c.canvas.width();a.height=c.canvas.height();var d=b.createTexture();b.bindTexture(b.TEXTURE_2D,d);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,a.width,a.height,0,b.RGBA,b.UNSIGNED_BYTE,null);var e=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,
e);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,a.width,a.height);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d,0);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,e);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null);var f={framebuffer:a,renderbuffer:e,tex:d,resize:function(){a.width=c.canvas.width();a.height=c.canvas.height();b.bindTexture(b.TEXTURE_2D,d);b.texImage2D(b.TEXTURE_2D,
0,b.RGBA,a.width,a.height,0,b.RGBA,b.UNSIGNED_BYTE,null);b.bindRenderbuffer(b.RENDERBUFFER,e);b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,a.width,a.height);b.bindTexture(b.TEXTURE_2D,null);b.bindRenderbuffer(b.RENDERBUFFER,null)},activate:function(d){d||(d={});n(d,{blend:!0,clear:!0});q.push(a);d.blend||b.disable(b.BLEND);b.bindFramebuffer(b.FRAMEBUFFER,a);b.viewport(0,0,c.canvas.width(),c.canvas.height());d.clear&&(b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT),b.clearDepth(0))},
deactivate:function(){var c=q.pop(),d=q[q.length-1];if(c!=a)throw"Non-nested use of framebuffers";b.bindFramebuffer(b.FRAMEBUFFER,d);b.enable(b.BLEND)}};m.push(f);return f};var E=this.framebuffer(),x=this.framebuffer();this.draw_blur=function(a){b.useProgram(y);x.activate({blend:!1});y.data("pos",f.get("vert"));y.data("tex_in",f.get("tex"));y.data("sampler",a);y.data("width",c.canvas.width());y.data("height",c.canvas.height());y.data("hor",!0);b.drawArrays(b.TRIANGLES,0,f.count());x.deactivate();
y.data("pos",f.get("vert"));y.data("tex_in",f.get("tex"));y.data("sampler",x.tex);y.data("width",c.canvas.width());y.data("height",c.canvas.height());y.data("hor",!1);b.drawArrays(b.TRIANGLES,0,f.count())};this.dirty=!0;var l=function(){var a=(new Date).getTime(),e=(a-j)/1E3;c.scroller.update(e);60<=h.length&&h.splice(0,1);h.push(e);for(var f=0,k=0;k<h.length;k++)f+=h[k];f/=h.length;$("#fps").text(Math.floor(1/f));j=a;b.clearColor(d.background.r,d.background.g,d.background.b,d.background.a);b.clear(b.COLOR_BUFFER_BIT);
b.clearDepth(0);a=!1;c.shade&&(a=c.shade.ready());a&&E.activate();g&&g.draw(c,e);for(k=0;k<c.scene.length;k++)c.scene[k].draw(c,e,!1);c.sel.draw(c,e);requestAnimationFrame(l)};this.read_pixel=function(a,d){b.bindFramebuffer(b.FRAMEBUFFER,c.framebuffer);var e=new Uint8Array(4),f=(a-c.canvas.position().left)/c.canvas.width(),g=(c.canvas.position().top+c.canvas.height()-d)/c.canvas.height();b.readPixels(parseInt(f*c.framebuffer.width),parseInt(g*c.framebuffer.height),1,1,b.RGBA,b.UNSIGNED_BYTE,e);b.bindFramebuffer(b.FRAMEBUFFER,
null);return e};$(document).mousemove(function(a){O.x=a.clientX;O.y=a.clientY});this.canvas.click(function(){});this.canvas.dblclick(function(){});var ma=!1;this.canvas.mousedown(function(){ma=!0});this.canvas.mouseup(function(){ma=!1});this.canvas.mousemove(function(){if(!ma){var a=new vect(O.x,O.y);$.each(c.scene,function(b,d){d.update_move&&d.update_move(c,a)})}});this.canvas.mouseout(function(){$.each(c.scene,function(a,b){b.force_out&&b.force_out(c)})});requestAnimationFrame(l)}function P(a,
e){var d={},c;c=e?e:256;var b=0,f=function(a,b,c,d){a||console.log("ack");c||(c=0);d||(d=b.length);for(var e=0;e<d;e++)a[c+e]=b[e]};this.create=function(b,e){if(!e)throw"Length of buffer must be a positive integer";var f=new Float32Array(c*e),k=ia(a,c,e);d[b]={array:f,buffer:k,len:e,dirty:!1}};this.alloc=function(e){if(b+e>=c){for(var h=c;h<b+e;)h*=2;c=h;for(name in d){var g=new Float32Array(h*d[name].len),k=d[name].array,m=ia(a,c,d[name].len);f(g,k);d[name].array=g;d[name].buffer=m;d[name].dirty=
!0}}h=b;b+=e;return h};this.get=function(a){return d[a].buffer};this.write=function(a,b,c,e){f(d[a].array,b,c*d[a].len,e*d[a].len);d[a].dirty=!0};this.repeat=function(a,b,c,e){for(var m=0;m<e;m++)f(d[a].array,b,(c+m)*d[a].len,d[a].len);d[a].dirty=!0};this.count=function(){return b};this.data=function(a){return d[a].array};this.update=function(){for(name in d)d[name].dirty&&(d[name].buffer&&d[name].buffer.update(d[name].array,0),d[name].dirty=!1)}}function Ua(a){W||(W=B(a.gl,z+"shaders/selbox"));var e=
!1,d=!1,c=null,b=null,f=ia(a.gl,6,2),j=H(a.gl,ya(0,0,1,1),2);a.canvas.bind("mousedown",function(g){e&&(show=d=!0,b=c=a.camera.percent(new vect(g.clientX,g.clientY)),f.update(u(c,b),0))});var h=function(){};this.select=function(a){h=a};$(document).bind("mouseup",function(){if(e&&d){var f=a.camera.project(a.camera.pixel(c)),j=a.camera.project(a.camera.pixel(b));if(f.x>j.x){var m=f.x;f.x=j.x;j.x=m}f.y>j.y&&(m=f.y,f.y=j.y,j.y=m);d=!1;h(new Q(f,j))}});$(document).bind("click",function(){e&&(show=!1)});
$(document).bind("mousemove",function(g){e&&d&&(b=a.camera.percent(new vect(g.clientX,g.clientY)),f.update(u(c,b),0))});this.enable=function(){e=!0};this.disable=function(){e=!1};this.draw=function(){d&&(gl.useProgram(W),W.data("pos",f),W.data("edge_in",j),gl.drawArrays(gl.TRIANGLES,0,f.numItems))}}function Da(a,e){for(;a>=e;)a-=e;for(;0>a;)a+=e;return a}function Va(a,e,d,c){this.current=a;this.upper=e;this.lower=d;this.index=c}function Ea(a,e){for(var d=0;d<a.length;d++)if(a[d]==e)return!0;return!1}
function ga(a,e,d){if(void 0==e)throw"whoa";return 0==a[e+1].y-a[e].y?Math.min(a[e].x,a[e+1].x):a[e].x+(a[e+1].x-a[e].x)*((d-a[e].y)/(a[e+1].y-a[e].y))}function R(a,e){for(var d=0;d<a.length;d++)if(a[d]==e)return d;return!1}function C(a,e,d){return new vect(ga(e,d,e[a].y),e[a].y)}function I(a,e){if(!e)throw"eek";a.push(e.x);a.push(e.y)}function S(a,e,d){if(!e||!d||3!=d.length+e.length&&4!=d.length+e.length)throw"ahh";if(3==e.length+d.length){for(var c=0;c<e.length;c++)I(a,e[c]);for(c=0;c<d.length;c++)I(a,
d[c])}else e[1].x<e[0].x&&(c=e[0],e[0]=e[1],e[1]=c),d[1].x<d[0].x&&(c=d[0],d[0]=d[1],d[1]=c),I(a,e[0]),I(a,e[1]),I(a,d[1]),I(a,d[0]),I(a,d[1]),I(a,e[0])}function Wa(a){for(var e=[],d=0,c=[],b=0;b<a.length;b++){for(var f=0;f<a[b].length-1;f++){var j=Da(f+1,a[b].length-1),h=Da(f-1,a[b].length-1);e.push(new Va(f+d,j+d,h+d,b));c.push(a[b][f])}c.push(a[b][0]);d+=a[b].length}e.sort(function(a,b){return c[a.current].y-c[b.current].y});a=[];b=[];new vect(-200,0);new vect(200,0);d=0;d=[];h=[];for(f=0;f<e.length;f++){var g=
e[f],j=Ea(a,g.lower),k=Ea(a,g.current),m,q;if(j&&!k)q=m=R(a,g.lower);else if(k&&!j)m=q=R(a,g.current);else if(j&&k)m=R(a,g.lower),q=R(a,g.current);else if(!j&&!k){a:{m=a;q=c;for(var E=c[g.current].x,x=c[g.current].y,l=0;l<m.length;l++){var n=ga(q,m[l],x);if(n>E||0==n-E&&q[m[l]].y>q[index].y){q=l;break a}}q=m.length}m=q}if(1<Math.abs(m-q)){for(j=0;j<a.length;j++);throw"Bad";}E=vect.left(c[g.lower],c[g.current],c[g.upper]);x=Math.floor(Math.min(m,q)/2);!E&&!j&&!k?(S(h,b[x],[C(g.current,c,a[q-1]),C(g.current,
c,a[q])]),b.splice(x,1,[C(g.current,c,a[q-1]),c[g.current]],[c[g.current],C(g.current,c,a[m])])):E&&!j&&!k?b.splice(x,0,[c[g.current]]):j&&!k?(S(h,b[x],[C(g.current,c,a[Math.max(m,q)-1]),c[g.current]]),b[x]=[C(g.current,c,a[Math.min(m,q)-1]),c[g.current]]):!j&&k?(S(h,b[x],[c[g.current],C(g.current,c,a[Math.min(q,m)+1])]),b[x]=[c[g.current],C(g.current,c,a[Math.max(q,m)+1])]):!E&&j&&k?(S(h,b[x],[C(g.current,c,a[Math.min(m,q)-1]),c[g.current]]),S(h,b[x+1],[C(g.current,c,a[Math.max(m,q)+1]),c[g.current]]),
b.splice(x,2,[C(g.current,c,a[Math.min(m,q)-1]),C(g.current,c,a[Math.max(m,q)+1])])):E&&(j&&k)&&(S(h,b[x],[c[g.current]]),b.splice(x,1));j&&!k?a[m]=g.current:k&&!j?a[q]=g.lower:j&&k?(a.splice(R(a,g.lower),1),a.splice(R(a,g.current),1)):!j&&!k&&(E?a.splice(m,0,g.lower,g.current):a.splice(m,0,g.current,g.lower));for(j=0;j<a.length-1;j++)if(ga(c,a[j],c[g.current].y)>ga(c,a[j+1],c[g.current].y))throw console.log("Misplaced Sweep"),"Misplace!";}if(0<a.length)throw console.log(a),"Bad "+a.length;if(0<d.length)throw console.log(d),
"Wrong";return h}function Q(a,e){this.min=a.clone();this.max=e.clone();this.contains=function(d){return a.x<=d.x&&e.x>=d.x&&a.y<=d.y&&e.y>=d.y};this.x_in=function(d){return a.x<=d.x&&e.x>=d.x};this.x_left=function(d){return a.x>=d.x};this.x_right=function(a){return e.x<=a.x};this.y_in=function(d){return a.y<=d.y&&e.y>=d.y};this.y_left=function(d){return a.y>=d.y};this.y_right=function(a){return e.y<=a.y};this.area=function(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)};this.height=function(){return this.max.y-
this.min.y};this.width=function(){return this.max.x-this.min.x};this.vertex=function(a){switch(a){case 0:return this.min.clone();case 1:return new vect(this.max.x,this.min.y);case 2:return this.max.clone();case 3:return new vect(this.min.x,this.max.y);default:throw"Index out of bounds: "+a;}};this.intersects=function(a){for(var c=0;4>c;c++)for(var b=0;4>b;b++)if(vect.intersects(this.vertex(c),this.vertex((c+1)%4),a.vertex(b),a.vertex((b+1)%4)))return!0;return this.contains(a.min)&&this.contains(a.max)&&
this.contains(new vect(a.min.x,a.max.y))&&this.contains(new vect(a.max.x,a.min.y))||a.contains(this.min)&&a.contains(this.max)&&a.contains(new vect(this.min.x,this.max.y))&&a.contains(new vect(this.max.x,this.min.y))?!0:!1};this.union=function(a){this.min.x=Math.min(this.min.x,a.min.x);this.min.y=Math.min(this.min.y,a.min.y);this.max.x=Math.max(this.max.x,a.max.x);this.max.y=Math.max(this.max.y,a.max.y)};this.centroid=function(){return new vect((this.max.x+this.min.x)/2,(this.max.y+this.min.y)/2)};
this.clone=function(){return new Q(a,e)}}function na(a,e,d,c){this.data=a[c];this.right=this.left=null;e!=c&&(this.left=new na(a,e,c-1,parseInt((e+(c-1))/2)));d!=c&&(this.right=new na(a,c+1,d,parseInt((d+(c+1))/2)));this.subtree=[];for(c=e;c<=d;c++)this.subtree.push(a[c]);this.subtree.sort(function(a,c){return a.y-c.y});this.yrange=function(a,c,d){return a.y_in(this.subtree[c])&&a.y_in(this.subtree[d])};this.subquery=function(a,c,d,e,g){if(this.yrange(c,d,e))for(c=d;c<=e;c++)a.push(this.subtree[c]);
else c.y_in(this.subtree[g])&&a.push(this.subtree[g]),c.y_left(this.subtree[g])?g!=e&&this.subquery(a,c,g+1,e,parseInt((e+(g+1))/2)):(c.x_right(this.subtree[g])||g!=e&&this.subquery(a,c,g+1,e,parseInt((e+(g+1))/2)),g!=d&&this.subquery(a,c,d,g-1,parseInt((d+(g-1))/2)))};this.search=function(c,f){f.x_in(a[e])&&f.x_in(a[d])?this.subquery(c,f,0,this.subtree.length-1,parseInt((this.subtree.length-1)/2)):(f.contains(this.data)&&c.push(this.data),f.x_left(this.data)?this.right&&this.right.search(c,f):f.x_right(this.data)?
this.left&&this.left.search(c,f):(this.left&&this.left.search(c,f),this.right&&this.right.search(c,f)))}}function oa(a){a.sort(function(a,d){return a.x-d.x});0<a.length?this.root=new na(a,0,a.length-1,parseInt((a.length-1)/2)):null==this.root;this.search=function(a){if(!this.root)return[];a=a.clone();var d=[];this.root.search(d,a);return d}}function pa(){this.views=[];this.update=function(a){for(var e=0;e<views.length;e++)this.views[e].update(a)};this.view_factory=function(){throw"Not Implemented";
};this.create=function(a){a=this.view_factory(a);this.views.push(a);return a}}function qa(a,e){this.style_map={};this.update=function(d){var c=Ba(a,e,d);if(null===c)throw"Style property does not exist";this.style_map[d](c)};this.update_all=function(){for(var a in this.style_map)this.update(a)}}function Fa(a,e){pa.call(this,a,e);F||(F=B(a.gl,z+"shaders/line"));var d=new P(a.gl,1024);d.create("vert",2);d.create("norm",2);d.create("color",3);d.create("alpha",1);var c=function(a){qa.call(this,a,e);var c=
d.count(),j=0;this.style_map={stroke:function(a){d.repeat("color",a.array,c,j)},"stroke-opacity":function(a){d.repeat("alpha",[a],c,j)}};$.each(a.geom,function(a,c){for(a=0;a<c.length;a++)j+=6*c[a].length,Xa(d,c[a])});this.update_all()};this.view_factory=function(a){return new c(a,e)};this.draw=function(){d.update();gl.useProgram(F);F.data("screen",a.camera.mat3);F.data("pos",d.get("vert"));F.data("norm",d.get("norm"));F.data("color_in",d.get("color"));F.data("alpha_in",d.get("alpha"));F.data("px_w",
2/a.canvas.width());F.data("px_h",2/a.canvas.height());gl.drawArrays(gl.TRIANGLES,0,d.count())}}function Ga(a){var e={},d={},c=!1,b={},f={},j=!1;if(a.style)for(var h in a.style)b[h]=a.style[h];this.style=function(a,d){if(2>arguments.length)return void 0!==b[a]?b[a]:null;b[a]=d;if(c)for(var f in e)e[f].update(a);return this};this.bounds=null;this.features=function(){var a=[],c;for(c in f)a.push(f[c]);return new t(a)};var g={};this.properties=function(a){var c=[],b;for(b in g)(!a||a&&g[b])&&c.push(b);
return c};this.search=function(a){j&&this.update();var c=new t([]),b;for(b in d)var e=d[b].search(a),c=c.join(e);return c};this.map_contains=function(a,c){j&&this.update();var b=new t([]),e;for(e in d)var f=d[e].map_contains(a,c),b=b.join(f);return b};this.append=function(a){var b=new X[a.type].geometry(a,this);f[b.id]=b;this.bounds?this.bounds.union(b.bounds):this.bounds=b.bounds.clone();for(var d in a.attr)g[d]=void 0===g[d]?isNaN(a.attr[d])?!1:!0:!isNaN(a.attr[d])&&g[d]?!0:!1;c&&b.initialize(e[b.type]);
j=!0};var k=null,m=null;this.mouseover=function(a){k=a};this.mouseout=function(a){m=a};var q={};this.update_move=function(a,c){if(k||m){var b=this.map_contains(a,c),d={};b&&b.each(function(a,c){d[c.id]=c});for(var e in q)!(e in d)&&m&&m(q[e]);for(e in d)!(e in q)&&k&&k(d[e]);q=d}};this.force_out=function(){for(var a in q)m&&m(q[a]);q={}};this.initialize=function(a){for(var b in X)e[b]=new X[b].renderer(a,this);c=!0;for(var d in f)f[d].initialize(e[f[d].type])};this.update=function(){var a=this.features(),
c;for(c in X)d[c]=new X[c].collection(a.type(c).items());j=!1};this.draw=function(){j&&this.update();if(!c)throw"Layer has not yet been initialized";for(var a in e)e[a].draw()}}function Ha(a){var e=new vect(Infinity,Infinity),d=new vect(-Infinity,-Infinity);$.each(a,function(a,b){$.each(b,function(a,c){$.each(c,function(a,c){c[0]<e.x&&(e.x=c[0]);c[0]>d.x&&(d.x=c[0]);c[1]<e.y&&(e.y=c[1]);c[1]>d.y&&(d.y=c[1])})})});return new Q(e,d)}function Xa(a,e){for(var d=a.alloc(6*e.length),c=0,b=function(){if(e[c]){var a=
new vect(e[c][0],e[c][1]);c++;return a}return null},f=[],j=[],h=function(a,c,b,d){d?(a[b]=-c.x,a[b+1]=-c.y):(a[b]=c.x,a[b+1]=c.y)},g=function(a,c,b,d){h(a,c,0,!1);h(a,b,2,!1);h(a,c,4,d);h(a,b,6,d);h(a,c,8,d);h(a,b,10,!1)},k=b(),m=b(),q=b(),l=vect.dir(m,k).rotate(ra/2),n,p=d;m;)n=q?vect.dir(q,k).rotate(ra/2):vect.dir(m,k).rotate(ra/2),g(f,k,m,!1),g(j,l,n,!0),a.write("vert",f,p,6),a.write("norm",j,p,6),p+=6,k=m,m=q,q=b(),l=n;return d}function sa(a){D||(D=B(engine.gl,z+"shaders/grid"));a||(a={});a.style||
(a.style={});var e=a.lower,d=a.upper,c=a.rows,b=a.cols,f=(d.x-e.x)/b,j=(d.y-e.y)/c,h=new Float32Array(c*b),g=new Uint8Array(4*b*c),k=!1,m=new P(engine.gl,6);m.create("vert",2);m.create("screen",2);m.create("tex",2);var q=new vect(e.x,e.y),l=new vect(d.x,d.y),n=new vect(0,0),p=new vect(1,1),r=m.alloc(6);m.write("vert",u(q,l),r,6);m.write("screen",u(new vect(-1,-1),new vect(1,1)),r,6);m.write("tex",u(n,p),r,6);var ka=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,ka);gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindTexture(gl.TEXTURE_2D,null);this.lower=function(){return e.clone()};this.upper=function(){return d.clone()};this.rows=function(){return c};this.cols=function(){return b};this.centroid=function(a,c){return new vect(e.x+f*c+f/2,e.y+j*a+j/2)};this.get=function(a,c){return h[b*
a+c]};var da=-Infinity,fa=Infinity;this.qunatiles=function(a,c){c||(c=function(a,c){return a-c});for(var b=[],d=0;d<h.length;d++)b.push(h[d]);b.sort(c);for(var e=[-Infinity],d=1;d<a;d++){var f=parseInt(inc*d);e.push(b[f])}e.push(Infinity);return e};this.set=function(a,d,e){if(a>=c||d>=b)throw"Index Out of Bounds";h[b*a+d]=e;k=!0};this.raw_set=function(a,d){if(a>=c*b)throw"Index Out of Bounds: "+a;h[a]=d;k=!0};this.clear=function(a){for(var d=0;d<c*b;d++)h[d]=a};this.initialize=function(){};var V=
null;this.draw=function(d){V||(V=d.framebuffer());m.update();if(k){da=-Infinity;fa=Infinity;for(var e=0;e<c*b;e++){var f=h[e];f>da&&(da=f);f<fa&&(fa=f)}for(e=0;e<c*b;e++){var f=e,j=a.map(fa,da,h[e]);g[4*f]=parseInt(255*j.r);g[4*f+1]=parseInt(255*j.g);g[4*f+2]=parseInt(255*j.b);g[4*f+3]=parseInt(255*j.a)}gl.bindTexture(gl.TEXTURE_2D,ka);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,b,c,0,gl.RGBA,gl.UNSIGNED_BYTE,g);gl.bindTexture(gl.TEXTURE_2D,null);k=!1}a.style.antialias&&V.activate({blend:!1});gl.useProgram(D);
D.data("screen",d.camera.mat3);D.data("pos",m.get("vert"));D.data("tex_in",m.get("tex"));D.data("sampler",ka);e=vect.sub(d.camera.screen(l),d.camera.screen(q));D.data("width",e.x);D.data("height",-e.y);D.data("rows",c);D.data("cols",b);D.data("blur",a.blur);gl.drawArrays(gl.TRIANGLES,0,m.count());a.style.antialias&&(V.deactivate(),d.draw_blur(V.tex))}}function Ya(a,e,d){K||(K=B(z+"shaders/raster"));this.image=ca(a);var c=H(u(new vect(0,1),new vect(1,0)),2),b=H(u(e,d),2);this.draw=function(a,d,e){e||
(gl.useProgram(K),K.data("screen",a.camera.mat3),K.data("pos",b),K.data("tex_in",c),K.data("sampler",this.image),gl.drawArrays(gl.TRIANGLES,0,b.numItems))}}function ta(a){v||(v=B(z+"shaders/hillshade"));var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),parseFloat(e.find("south").text())),c=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var b=!1,f=ca(a,function(){b=!0});this.ready=function(){return b};
var j=H(u(new vect(0,1),new vect(1,0)),2),h=H(u(d,c),2),g=315;this.draw=function(a){if(b){for(gl.useProgram(altitude_shader);1<=g;)g-=1;altitude_shader.data("azimuth",g);altitude_shader.data("altitude",Math.PI/4/(2*Math.PI));altitude_shader.data("screen",a.camera.mat3);altitude_shader.data("pos",h);altitude_shader.data("tex_in",j);altitude_shader.data("elevation",f);a=vect.sub(a.camera.screen(c),a.camera.screen(d));altitude_shader.data("pix_w",1/a.x);altitude_shader.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,
0,h.numItems);return g}}}function ta(a){v||(v=B(engine.gl,z+"shaders/hillshade"));var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),parseFloat(e.find("south").text())),c=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var b=!1,f=ca(engine.gl,a,function(){b=!0});this.ready=function(){return b};var j=H(engine.gl,u(new vect(0,1),new vect(1,0)),2),h=H(engine.gl,u(d,c),2),g=315;this.initialize=function(){};
this.draw=function(a){if(b){for(gl.useProgram(v);1<=g;)g-=1;v.data("azimuth",g);v.data("altitude",Math.PI/4/(2*Math.PI));v.data("screen",a.camera.mat3);v.data("pos",h);v.data("tex_in",j);v.data("elevation",f);a=vect.sub(a.camera.screen(c),a.camera.screen(d));v.data("pix_w",1/a.x);v.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,h.numItems);return g}}}function ea(a){for(var e=[],d=[],c=0;c<a.levels;c++){var b=p(a);"file"==b.source&&(b.url+="/"+a.size*Math.pow(2,c+1));b.min=new vect(-180,-90);b.rows=
Math.pow(2,c);b.cols=2*b.rows;b.cellsize=180/b.rows;b.z_index=1-ua-c/1E3;b.available=d;b=new Za(b);e.push(b)}ua+=(a.levels+2)/1E3;var f=null;this.initialize=function(a){A||(A=B(a.gl,z+"shaders/tile"));f=new P(a.gl,6*Y);f.create("vert",3);f.create("tex",2);f.create("lookup",1);f.alloc(6*Y);for(var c=0;25>c;c++)d.push(new ja(a.gl));for(c=0;c<e.length;c++)e[c].initialize(a);e[0].fetch_all();e[0].noexpire(!0)};this.draw=function(c,b){gl.useProgram(A);A.data("screen",c.camera.mat3);Ia=Ja=0;for(var d=Infinity,
k=e[0],m,q=0;q<e.length;q++){var l=a.size*e[q].cols/e[q].size(c).x;1>l&&(l=1/l);l<d&&(d=l,k=e[q],m=q)}for(q=m;0<=q;q--)e[q].fetch();if(k.ready())k.draw(c,b,f,0,!0);else{c.enable_z();d=0;for(q=m;0<=q;q--)d=e[q].draw(c,b,f,d,0==q);c.disable_z()}$.each(e,function(a,c){c.cull()})}}function Za(a){a||(a={});a.desaturate||(a.desaturate=0);a.darken||(a.darken=0);a.hue||(a.hue=0);a.hue_color||(a.hue_color=xa(0,0,0,1));if(!a.available){a.available=[];for(var e=0;8>e;e++)a.available.push(new ja(d))}var d=null,
c=a.url,b=a.min,f=a.rows,j=a.cols,h=a.cellsize;this.rows=f;this.cols=j;for(var g={},k={},m=function(c,d){var e=new vect(b.x+c*h,b.y+d*h),f=new vect(b.x+(c+1)*h,b.y+(d+1)*h),e={vert:u(e,f,a.z_index),tex:null,i:c,j:d,id:c+j*d,ready:!1,min:e,max:f};k[c][d]=e;g[e.id]=e},e=0;e<j;e++)k[e]={};this.size=function(a){var c=a.camera.screen(b);a=a.camera.screen(vect.add(b,new vect(h*j,h*f)));c=vect.sub(a,c);c.y=Math.abs(c.y);return c};var l=!1;this.noexpire=function(a){l=a};this.cull=function(){if(!l){var c=
(new Date).getTime(),b;for(b in p)if(c-p[b]>$a){var d=g[b];delete g[b];delete k[d.i][d.j];a.available.push(d.tex);d.tex=null;d.ready=!1;delete p[b]}}};var n=function(){var a=engine.camera.project(new vect(engine.canvas.offset().left,engine.canvas.offset().top+engine.canvas.height())),c=engine.camera.project(new vect(engine.canvas.offset().left+engine.canvas.width(),engine.canvas.offset().top)),d=Math.floor((a.x-b.x)/h),e=Math.ceil((c.x-b.x)/h),a=Math.floor((a.y-b.y)/h),c=Math.ceil((c.y-b.y)/h);return{min_col:d,
max_col:e,min_row:a,max_row:c}},p={};this.ready=function(){for(var a=n(),c=Math.max(0,a.min_col);c<Math.min(j,a.max_col);c++)for(var b=Math.max(0,a.min_row);b<Math.min(f,a.max_row);b++)if(!k[c][b]||!k[c][b].ready)return!1;return!0};var r=function(b,e){if(!k[b][e].tex){var f;if("file"==a.source)f=c+"/"+k[b][e].id+".png";else if("wms"==a.source){f={service:"wms",version:"1.1.0",request:"GetMap",layers:a.layer,bbox:[k[b][e].min.x,k[b][e].min.y,k[b][e].max.x,k[b][e].max.y].join(),width:a.size,height:a.size,
srs:"EPSG:4326",format:"image/png",transparent:"true"};var g=[],j;for(j in f)g.push(j+"="+f[j]);f=c+"?"+g.join("&")}k[b][e].tex=a.available.pop();k[b][e].tex||(k[b][e].tex=new ja(d));j=f;var h=k[b][e],m=new Image;m.crossOrigin="";m.onload=function(){h.tex&&(h.tex.image(m),h.ready=!0)};m.src=j}};this.fetch_all=function(){for(var a=(new Date).getTime(),c=0;c<j;c++)for(var b=0;b<f;b++)k[c][b]||m(c,b),k[c][b].tex||r(c,b),p[k[c][b].id]=a};this.fetch=function(){for(var a=n(),c=(new Date).getTime(),b=Math.max(0,
a.min_col-1);b<Math.min(j,a.max_col+1);b++)for(var d=Math.max(0,a.min_row-1);d<Math.min(f,a.max_row+1);d++)k[b][d]||m(b,d),k[b][d].tex||r(b,d),p[k[b][d].id]=c};var s=!1;this.initialize=function(a){if(s)throw"Not Implemented: Migrating Tile Layers to New Map";A||(A=B(a.gl,z+"shaders/tile"));d=a.gl;s=!0};this.draw=function(c,b,e,g,h){s||this.initialize(c);c=function(){Ia++;e.update();A.data("pos",e.get("vert"));A.data("tex_in",e.get("tex"));A.data("lookup_in",e.get("lookup"));A.data("desaturate",a.desaturate);
A.data("darken",a.darken);A.data("hue",a.hue);A.data("hue_color",a.hue_color.array);d.drawArrays(d.TRIANGLES,0,6*g)};b=n();for(var m=(new Date).getTime(),l=Math.max(0,b.min_col);l<Math.min(j,b.max_col);l++)for(var q=Math.max(0,b.min_row);q<Math.min(f,b.max_row);q++)if(k[l][q]&&k[l][q].ready&&k[l][q].tex){e.write("vert",k[l][q].vert,6*g,6);e.write("tex",u(new vect(0,0),new vect(1,1)),6*g,6);e.repeat("lookup",[g/Y+1/(2*Y)],6*g,6);p[k[l][q].id]=m;A.data("sampler"+g,k[l][q].tex);if(null==k[l][q].tex)throw"badness";
g++;Ja++;g>=Y&&(c(),g=0)}h&&c();return g}}var z="",T=jQuery,ab=function(a){if("string"===typeof a.data){var e=a.handler,d=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var b="keypress"!==a.type&&T.hotkeys.specialKeys[a.which],f=String.fromCharCode(a.which).toLowerCase(),j="",h={};a.altKey&&"alt"!==b&&(j+="alt+");a.ctrlKey&&"ctrl"!==b&&(j+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==b)&&(j+="meta+");
a.shiftKey&&"shift"!==b&&(j+="shift+");b?h[j+b]=!0:(h[j+f]=!0,h[j+T.hotkeys.shiftNums[f]]=!0,"shift+"===j&&(h[T.hotkeys.shiftNums[f]]=!0));b=0;for(f=d.length;b<f;b++)if(h[d[b]])return e.apply(this,arguments)}}}};T.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",
101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"}};T.each(["keydown","keyup",
"keypress"],function(){T.event.special[this]={add:ab}});var J=jQuery,va=function(a){var e=a||window.event,d=[].slice.call(arguments,1),c=0,b=0,f=0;a=J.event.fix(e);a.type="mousewheel";e.wheelDelta&&(c=e.wheelDelta/120);e.detail&&(c=-e.detail/3);f=c;void 0!==e.axis&&e.axis===e.HORIZONTAL_AXIS&&(f=0,b=-1*c);void 0!==e.wheelDeltaY&&(f=e.wheelDeltaY/120);void 0!==e.wheelDeltaX&&(b=-1*e.wheelDeltaX/120);d.unshift(a,c,b,f);return(J.event.dispatch||J.event.handle).apply(this,d)},U=["DOMMouseScroll","mousewheel"];
if(J.event.fixHooks)for(var L=U.length;L;)J.event.fixHooks[U[--L]]=J.event.mouseHooks;J.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=U.length;a;)this.addEventListener(U[--a],va,!1);else this.onmousewheel=va},teardown:function(){if(this.removeEventListener)for(var a=U.length;a;)this.removeEventListener(U[--a],va,!1);else this.onmousewheel=null}};J.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",
a)}});for(var Ka=0,L=["ms","moz","webkit","o"],Z=0;Z<L.length&&!window.requestAnimationFrame;++Z)window.requestAnimationFrame=window[L[Z]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[L[Z]+"CancelAnimationFrame"]||window[L[Z]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var e=(new Date).getTime(),d=Math.max(0,16-(e-Ka)),c=window.setTimeout(function(){a(e+d)},d);Ka=e+d;return c});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)});var ra=3.14159265,Ta=!1,Aa=0,Pa={Point:{fill:new s(0.02,0.44,0.69,1),opacity:1,radius:5,stroke:"none","stroke-width":2},Polygon:{fill:new s(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new s(0.02,0.44,0.69,1),"stroke-opacity":1},Line:{stroke:new s(0.02,0.44,0.69,1),"stroke-opacity":1}},la="http://eland.ecohealthalliance.org/wigglemaps",O={x:0,y:0},y=null,Ca=null,W=null,w=null,bb=ya(0,0,1,1),F=null,M=null,X={Point:{geometry:function(a,e){wa.call(this,a,e);this.bounds=null;
for(var d=0;d<this.geom.length;d++){var c=new vect(this.geom[d][0],this.geom[d][1]),c=new Q(c.clone(),c.clone());this.bounds?this.bounds.union(c):this.bounds=c}this.map_contains=function(a,c){for(var d=this.compute("radius"),e=0;e<this.geom.length;e++){var g=a.camera.screen(new vect(this.geom[e][0],this.geom[e][1]));if(vect.dist(g,c)<d)return!0}return!1}},renderer:function(a,e){pa.call(this,a,e);w||(w=B(a.gl,z+"shaders/point"));var d=10,c=new P(a.gl,1024);c.create("vert",2);c.create("unit",2);c.create("stroke_width",
1);c.create("rad",1);c.create("fill_color",3);c.create("fill",1);c.create("stroke_color",3);c.create("stroke",1);c.create("alpha",1);var b=function(a){qa.call(this,a,e);var b,h;this.style_map={fill:function(a){"none"==a?c.repeat("fill",[-0.75],b,h):(c.repeat("fill",[0.75],b,h),c.repeat("fill_color",a.array,b,h))},opacity:function(a){c.repeat("alpha",[a],b,h)},radius:function(a){a>d&&(d=a);c.repeat("rad",[a],b,h)},stroke:function(a){"none"==a?c.repeat("stroke",[-0.75],b,h):(c.repeat("stroke",[0.75],
b,h),c.repeat("stroke_color",a.array,b,h))},"stroke-width":function(a){c.repeat("stroke_width",[a],b,h)}};a=a.geom;h=6*a.length;b=c.alloc(h);$.each(a,function(a,d){c.repeat("vert",d,b+6*a,6);c.write("unit",bb,b+6*a,6)});this.update_all()};this.view_factory=function(a){return new b(a,e)};this.draw=function(){c.update();gl.useProgram(w);w.data("screen",a.camera.mat3);w.data("pos",c.get("vert"));w.data("circle_in",c.get("unit"));w.data("color_in",c.get("fill_color"));w.data("stroke_color_in",c.get("stroke_color"));
w.data("alpha_in",c.get("alpha"));w.data("fill_in",c.get("fill"));w.data("stroke_in",c.get("stroke"));w.data("aspect",a.canvas.width()/a.canvas.height());w.data("pix_w",2/a.canvas.width());w.data("rad",c.get("rad"));w.data("stroke_width_in",c.get("stroke_width"));w.data("max_rad",d);gl.drawArrays(gl.TRIANGLES,0,c.count())}},collection:function(a){var e=[],d=0;$.each(a,function(a,c){var j=c.compute("radius");j>d&&(d=j);$.each(c.geom,function(a,b){e.push({x:b[0],y:b[1],ref:c})})});var c=new oa(e);this.search=
function(a){a=c.search(a);var d=[];$.each(a,function(a,c){d.push(c.ref)});return new t(d)};this.map_contains=function(a,e){for(var j=vect.add(e,new vect(-d,d)),h=vect.add(e,new vect(d,-d)),j=new Q(a.camera.project(j),a.camera.project(h)),j=c.search(j),h=0;h<j.length;h++){var g=j[h];if(g.ref.map_contains(a,e))return new t([g.ref])}return new t([])}}},Polygon:{geometry:function(a,e){wa.call(this,a,e);this.bounds=Ha(this.geom);this.map_contains=function(a,c){return this.contains(a.camera.project(c))};
this.contains=function(a){var c=0;if(this.bounds.contains(a)){c++;for(c=0;c<this.geom.length;c++){var b=0;$.each(this.geom[c],function(c,e){for(var h=0;h<e.length;h++){var g=(h+1)%e.length;if(0>(a.y-e[h][1])/(a.y-e[g][1])){var k=new vect(720,a.y),m=new vect(e[h][0],e[h][1]),g=new vect(e[g][0],e[g][1]);vect.intersects(a,k,m,g)&&b++}}});if(1==b%2)return!0}}return!1}},renderer:function(a,e){pa.call(this,a,e);M||(M=B(a.gl,z+"shaders/poly"));var d=new Fa(a,e),c=new P(a.gl,1024);c.create("vert",2);c.create("color",
3);c.create("alpha",1);var b=function(a){qa.call(this,a,e);d.create(a);var b,h;this.style_map={fill:function(a){c.repeat("color",a.array,b,h)},"fill-opacity":function(a){c.repeat("alpha",[a],b,h)}};a=a.geom;var g=[];h=0;$.each(a,function(a,c){for(var b,d=0;100>d;)try{for(var e=c,f=[],j=0;j<e.length;j++){for(var k=[],l=1;l<e[j].length;l++)k.push(La(e[j][l][0],e[j][l][1]));k.push(f[0]);f.push(k)}b=Wa(f);break}catch(n){d++}if(100==d)throw"Rendering Polygon Failed";h+=b.length/2;g.push(b)});var k=b=c.alloc(h);
$.each(g,function(a,b){var d=b.length/2;c.write("vert",b,k,d);k+=d});this.update_all()};this.view_factory=function(a){return new b(a,e)};this.draw=function(){c.update();gl.useProgram(M);M.data("screen",a.camera.mat3);M.data("pos",c.get("vert"));M.data("color_in",c.get("color"));M.data("alpha_in",c.get("alpha"));gl.drawArrays(gl.TRIANGLES,0,c.count());d.draw()}},collection:function(a){for(var e=[],d=0;d<a.length;d++)$.each(a[d].geom,function(c,b){$.each(b,function(c,b){$.each(b,function(c,b){e.push({ref:a[d],
x:b[0],y:b[1]})})})});tree=new oa(e);this.search=function(c){var b=tree.search(c),d={};$.each(b,function(a,c){d[c.ref.id]=c.ref});for(b=0;b<a.length;b++)for(var e=0;4>e;e++)a[b].contains(c.vertex(e))&&(d[a[b].id]=a[b]);c=[];for(var h in d)c.push(d[h]);return new t(c)};this.map_contains=function(a,b){return this.contains(a.camera.project(b))};this.contains=function(c){for(var b=[],d=0;d<a.length;d++)a[d].contains(c)&&b.push(a[d]);return new t(b)}}},Line:{geometry:function(a,e){wa.call(this,a,e);this.bounds=
Ha(this.geom);this.map_contains=function(){return!1}},renderer:Fa,collection:function(){this.search=function(){return new t([])};this.map_contains=function(){return new t([])};this.contains=function(){return new t([])}}}},wa=function(a,e){var d={},c=null;this.id=Ma();this.type=a.type;var b=a.attr;this.attr=function(a,c){if(2>arguments.length)return b[a]};this.geom=a.geom;this.geometry=function(){};this.initialize=function(a){c=a.create(this);c.update_all()};this.compute=function(a){return Ba(this,
e,a)};this.style=function(a,b,e){if(2>arguments.length)return void 0!==d[a]?d[a]:null;d[a]=b;c&&c.update(a)}},Ma,Na=1;Ma=function(){var a=Na;Na++;return a};var La;La=function(a,e){return new vect(a+1E-6*Math.random()-5E-7,e+1E-6*Math.random()-5E-7)};var D=null,t=function(a){var e=null;this.length=a.length;this.count=function(){return a.length};this.items=function(){return a};this.type=function(c){for(var b=[],d=0;d<a.length;d++)a[d].type==c&&b.push(a[d]);return new t(b)};this.join=function(c){for(var b=
[],d=0;d<a.length;d++)b.push(a[d]);for(d=0;d<c.count();d++){var e=c.get(d);this.id(e.id)||b.push(e)}return new t(b)};this.attr=function(){throw"Not Implemented";};this.get=function(c){return a[c]};this.subset=function(c){for(var b=[],d=0;d<c.length;d++)b.push(a[c[d]]);return new t(b)};this.id=function(c){if(!e){e={};for(var b=0;b<a.length;b++)e[a[b].id]=a[b]}return c in e?e[c]:null};this.each=function(c){for(var b=0;b<a.length;b++)c(b,a[b]);return this};var d={">":function(a,b){return a>b},"<":function(a,
b){return a<b},"==":function(a,b){return a==b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=b}};this.select=function(c){if(c.match(/^\s*\*\s*$/))return new t(a);var b=c.match(/^\s*([^\s]+)\s*([=<>]+)\s*(([^\s])+)\s*$/);if(!b)throw"Bad Selector";c=b[1];var e=b[2],j=null,h=null;isNaN(b[3])?h=b[3]:j=parseFloat(b[3]);new_elem=[];if(h)for(b=0;b<a.length;b++)d[e](a[b].attr(c),a[b].attr(h))&&new_elem.push(a[b]);else for(b=0;b<a.length;b++)d[e](a[b].attr(c),j)&&new_elem.push(a[b]);return new t(new_elem)};
this.filter=function(c){for(var b=[],d=0;d<a.length;d++)c(a[d])&&b.push(a[d]);return new t(b)};this.quantile=function(c,b,d){a.sort(function(a,b){return a.attr(c)-b.attr(c)});var e=Math.round(b*this.length/d);b=Math.round((b-1)*this.length/d);return new t(a.slice(b,e))};this.range=function(c){for(var b=Infinity,d=-Infinity,e=!1,h=0;h<a.length;h++){var g=a[h].attr(c);isNaN(g)||(e=!0,b>g&&(b=g),d<g&&(d=g))}return!e?null:{min:b,max:d}};this.style=function(c,b){if(1==arguments.length){var d=[];$.each(a,
function(a,b){d.push(b.style(c))});return d}if("function"==typeof b)$.each(a,function(a,d){d.style(c,b(d))});else{var e;a:if(null==b||void 0==b.length)e=!1;else{for(e=0;e<b.length;e++)if(!(e in b)){e=!1;break a}e=!0}e?$.each(a,function(a,d){d.style(c,b[a])}):$.each(a,function(a,d){d.style(c,b)})}return this}},K=null,v=null,N=null,v=null,$a=1E3,ua=0,Y=8,Ja=0,Ia=0,A=null,Oa=[];window.wiggle={Map:function(a,e){this.center=function(a,b){engine.camera.position(new vect(a,b))};this.vcenter=function(a){this.center(a.x,
a.y)};this.extents=function(a){engine.camera.extents(a)};this.append=function(a){a.initialize(engine);engine.scene.push(a)};this.remove=function(a){for(var b=0;b<engine.scene.length;b++)if(engine.scene[b]==a)return engine.scene.splice(b,1),!0;return!1};this.shade=function(a){a=new ta(a);engine.shade=a};this.select=function(a){a?(engine.sel.select(a),engine.select(!0)):engine.select(!1)};this.resize=function(){engine.resize()};this.attr=function(a,b){engine.attr(a,b)};this.png=function(){var a=engine.canvas.get(0).toDataURL();
$.ajax({url:"../server/export.png",type:"POST",data:a})};this.width=function(){return engine.canvas.innerWidth()};this.height=function(){return engine.canvas.innerHeight()};var d=null;this.click=function(a){d=a};engine=new Sa(a,this,e);engine.canvas.click(function(a){d&&(a=new vect(a.pageX,a.pageY),a=engine.camera.project(a),d(a))})},layer:{Layer:Ga,Grid:sa,Hillshade:ta,Elevation:function(a){N||(N=B(z+"shaders/elevation"));var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),
parseFloat(e.find("south").text())),c=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var b=ca(a),f=H(u(new vect(0,1),new vect(1,0)),2),j=H(u(d,c),2);this.draw=function(a,e,k){k||(gl.useProgram(N),N.data("screen",a.camera.mat3),N.data("pos",j),N.data("tex_in",f),N.data("elevation",b),vect.sub(a.camera.screen(c),a.camera.screen(d)),gl.drawArrays(gl.TRIANGLES,0,j.numItems))}}},io:{Shapefile:function(a){var e=a.path;$.ajax({url:e+
".shx",mimeType:"text/plain; charset=x-user-defined",success:function(d){for(var c=[],b=100;b<d.length;)c.push(2*ha(d,b)),b+=8;$.ajax({url:e+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(b){for(var d=[],e=[],g=0;g<c.length;g++){var k=c[g];ha(b,k);ha(b,k+4);var m=k+8,l=G(b,m);if(0==l)console.log("NULL Shape");else if(1==l)l=aa(b,m+4),m=aa(b,m+12),d.push({attr:{},geom:[[l,m]]});else if(5==l){for(var l=G(b,m+36),m=G(b,m+40),n=k+52,k=k+52+4*l,p=[],r=0;r<l;r++){var s=G(b,n+4*r),
t;t=r+1<l?G(b,n+4*(r+1)):m;var u=k,w=[];for(t-=1;t>=s;t--){var y=aa(b,u+16*t),z=aa(b,u+16*t+8);w.push([y,z])}p.push(w)}e.push({attr:{},geom:[p]})}else throw"Not Implemented: "+l;}if(0<d.length){var v=new PointLayer(d.length);$.each(d,function(a,b){v.append(b)});b=v}else 0<e.length?(v=new PolygonLayer(a),$.each(e,function(a,b){for(var c=0;100>c;)try{v.append(b),c=101}catch(d){c++}100==c&&console.log("rendering polygon failed")}),b=v):b=void 0;a.success(b)}})}})},GeoJSON:function(a,e){void 0===e&&(e=
{});for(var d=new Ga(e),c=0;c<a.features.length;c++){var b=a.features[c];if("Feature"==b.type){"Point"==b.geometry.type&&d.append({type:"Point",geom:[b.geometry.coordinates],attr:b.properties});"MultiPoint"==b.geometry.type&&d.append({type:"Point",geom:b.geometry.coordinates,attr:b.properties});if("Polygon"==b.geometry.type){for(var f=b.geometry.coordinates,j=[],h=0;h<=f.length-1;h++){for(var g=[],k=f[h].length-1;0<=k;k--)g.push(f[h][k]);j.push(g)}d.append({type:"Polygon",geom:[j],attr:b.properties})}if("MultiPolygon"==
b.geometry.type){var m=[];$.each(b.geometry.coordinates,function(a,b){for(var c=[],d=0;d<=b.length-1;d++){for(var e=[],f=b[d].length-1;0<=f;f--)e.push(b[d][f]);c.push(e)}m.push(c)});d.append({type:"Polygon",geom:m,attr:b.properties})}"MultiLineString"==b.geometry.type&&$.each(b.geometry.coordinates,function(a,c){d.append({type:"Line",geom:[[c]],attr:b.properties})})}}return d},KML:function(a){var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),parseFloat(e.find("south").text())),
e=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();return new Ya(z+a,d,e)},SparseGrid:function(a,e){var d=ba(a,0),c=ba(a,4),b=G(a,8),f=G(a,12),j=ba(a,16),h={};for(key in e)h[key]=e[key];h.lower=new vect(d,c);h.upper=new vect(d+j*b,c+j*f);h.rows=f;h.cols=b;d=new sa(h);for(c=20;c<a.length;){for(var j=G(a,c),b=G(a,c+4),f=c+4,h=b,g=0;g<h;g++){var k=ba(a,f+4*g);d.raw_set(j+g,k)}c+=8+4*b}return d},AsciiGrid:function(a,e){var d=
a.split("\n"),c=d.splice(0,6),b=parseInt(c[0].slice(14)),f=parseInt(c[1].slice(14)),j=parseFloat(c[2].slice(14)),h=parseFloat(c[3].slice(14)),g=parseFloat(c[4].slice(14)),c=c[5].slice(14),k={};for(key in e)k[key]=e[key];k.lower=new vect(j,h);k.upper=new vect(j+g*b,h+g*f);k.rows=f;k.cols=b;j=new sa(k);for(h=0;h<f;h++){g=d[h].split(" ");for(k=0;k<b;k++)g[k]==c?j.set(f-1-h,k,NaN):j.set(f-1-h,k,parseFloat(g[k]))}return j},WMS:function(a){a=p(a);for(var e=["url","layer"],d=0;d<e.length;d++){var c=e[d];
if(!(c in a))throw"Key "+c+" not found";}n(a,{levels:16,size:256});var e={source:"wms"},b;for(b in e)a[b]=e[b];return new ea(a)}},util:{fcolor:xa,icolor:function(a,e,d,c){return new s(l(a/255,0,1),l(e/255,0,1),l(d/255,0,1),l(c/255,0,1))},Box:Q,RangeTree:oa},widget:{Slider:function(a,e,d){var c=function(a){if(a>=d)throw"Slider index out of bounds";return e.x/(d-1)*a},b=function(b){return b<=a.x?0:b>=a.x+e.x?d-1:Math.round((b-a.x)/e.x*(d-1))};this.dom=$("<div></div>").addClass("slider-container").css("position",
"relative").css("left",a.x).css("top",a.y).css("width",e.x).css("height",e.y);var f=!1,j=0,h=$("<div></div>").addClass("slider-box").css("position","relative").css("left",-10).css("height",e.y).css("width",20).mousedown(function(){f=!0});this.tick=function(){return j};this.count=function(){return d};var g=function(){};this.change=function(a){g=a};var k=function(){};this.release=function(a){k=a};this.dragging=function(){return f};this.dom.append(h);this.set=function(a){a!=j&&g(a);j=a;var b=c(a);h.css("left",
b-10);k(a)};$(document).bind("mouseup",function(){if(f){f=!1;var a=b(event.clientX);k(a)}});$(document).bind("mousemove",function(a){f&&(a=b(a.clientX),a!=j&&g(a),j=a,a=c(a),h.css("left",a-10))})}},ready:function(a){Oa.push(a)}};$(document).ready(function(){$('script[src*="wigglemaps"]').each(function(a,e){var d=/wigglemaps(\.min)?\.js/;$(e).attr("src").match(d)&&(z=$(e).attr("src").replace(d,""))});$.each(Oa,function(a,e){e()})})})();
