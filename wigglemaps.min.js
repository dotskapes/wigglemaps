function vect(f,k,m){this.x=f;this.y=k;this.z=m?m:0;this.add=function(f){this.x+=f.x;this.y+=f.y;this.z+=f.z};this.sub=function(f){this.x-=f.x;this.y-=f.y;this.z-=f.z};this.scale=function(f){this.x*=f;this.y*=f;this.z*=f;return this};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.normalize=function(){var f=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(0==f)return this;this.x/=f;this.y/=f;this.z/=f;return this};this.div=function(f){this.x/=f.x;this.y/=
f.y;this.z/=f.z};this.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z)};this.zero=function(){return 0==this.x+this.y+this.z};this.dot=function(f){return this.x*f.x+this.y*f.y+this.z*f.z};this.cross=function(){throw"Need to reimplement";};this.rotate=function(f){var k=Math.cos(f);f=Math.sin(f);xp=k*this.x-f*this.y;yp=f*this.x+k*this.y;this.x=xp;this.y=yp;return this};this.clone=function(){return new vect(this.x,this.y,this.z)};this.array=function(){return[this.x,
this.y]}}vect.scale=function(f,k){return new vect(f.x*k,f.y*k,f.z*k)};vect.add=function(f,k){return new vect(f.x+k.x,f.y+k.y,f.z+k.z)};vect.sub=function(f,k){if(!f||!k)throw"Bad Vector";return new vect(f.x-k.x,f.y-k.y,f.z-k.z)};vect.dist=function(f,k){var m=k.x-f.x,p=k.y-f.y,q=k.z-f.z;return Math.sqrt(m*m+p*p+q*q)};vect.dir=function(f,k){var m=vect.sub(f,k);m.normalize();return m};vect.dot2d=function(f,k){return f.x*k.x+f.y*k.y};vect.cross=function(f,k){return f.x*k.y-f.y*k.x};
vect.left=function(f,k,m,p){p||(p=0);k=vect.sub(k,f);f=vect.sub(m,f);return vect.cross(k,f)>=-p};vect.intersects=function(f,k,m,p,q){q||(q=0);return vect.left(f,k,m,q)!=vect.left(f,k,p,q)&&vect.left(m,p,k,q)!=vect.left(m,p,f,q)};vect.intersect2dt=function(f,k,m,p){p=f.x*(p.y-m.y)+k.x*(m.y-p.y)+p.x*(k.y-f.y)+m.x*(f.y-k.y);return 0==p?Infinity:-(f.x*(m.y-k.y)+k.x*(f.y-m.y)+m.x*(k.y-f.y))/p};
vect.intersect2dpos=function(f,k,m,p){var q=f.x*(p.y-m.y)+k.x*(m.y-p.y)+p.x*(k.y-f.y)+m.x*(f.y-k.y);if(0==q)return Infinity;m=(f.x*(p.y-m.y)+m.x*(f.y-p.y)+p.x*(m.y-f.y))/q;k=vect.sub(k,f);k.scale(m);return vect.add(f,k)};vect.rotate=function(f,k){var m=Math.cos(k),p=Math.sin(k);xp=m*f.x-p*f.y;yp=p*f.x+m*f.y;return f=new vect(xp,yp,f.z)};vect.normalize=function(f){f=f.clone();var k=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);if(0==k)return f;f.x/=k;f.y/=k;f.z/=k;return f};
(function(){function f(a,b){for(var c in b)c in a||(a[c]=b[c])}function k(a){var b={};for(key in a)b[key]=a[key];return b}function m(a,b){for(key in b)a[key]=b[key]}function p(a,b,c){return Math.min(Math.max(a,b),c)}function q(a,b,c,d){1>=a&&1>=b&&1>=c&&1>=d?(this.r=a,this.g=b,this.b=c,this.a=d):(this.r=a/255,this.g=b/255,this.b=c/255,this.a=d/255);this.array=[this.r,this.g,this.b,this.a];this.vect=function(){return this.array};this.rgb=function(){return"rgb("+parseInt(255*this.r)+","+parseInt(255*
this.g)+","+parseInt(255*this.b)+")"}}function na(a,b,c,d){return new q(p(a,0,1),p(b,0,1),p(c,0,1),p(d,0,1))}function Ea(a){if(null==a||void 0==a.length)return!1;for(var b=0;b<a.length;b++)if(!(b in a))return!1;return!0}function ca(a,b){return((a.charCodeAt(b)&255)<<24)+((a.charCodeAt(b+1)&255)<<16)+((a.charCodeAt(b+2)&255)<<8)+(a.charCodeAt(b+3)&255)}function C(a,b){return((a.charCodeAt(b+3)&255)<<24)+((a.charCodeAt(b+2)&255)<<16)+((a.charCodeAt(b+1)&255)<<8)+(a.charCodeAt(b)&255)}function U(a,b){var c=
a.charCodeAt(b)&255,d=a.charCodeAt(b+1)&255,e=a.charCodeAt(b+2)&255,g=a.charCodeAt(b+3)&255,l=a.charCodeAt(b+4)&255,j=a.charCodeAt(b+5)&255,h=a.charCodeAt(b+6)&255,n=a.charCodeAt(b+7)&255,r=1-2*(n>>7),n=((n&127)<<4)+((h&240)>>4)-1023,c=(h&15)*Math.pow(2,48)+j*Math.pow(2,40)+l*Math.pow(2,32)+g*Math.pow(2,24)+e*Math.pow(2,16)+d*Math.pow(2,8)+c;return r*(1+c*Math.pow(2,-52))*Math.pow(2,n)}function V(a,b){var c=a.charCodeAt(b)&255,d=a.charCodeAt(b+1)&255,e=a.charCodeAt(b+2)&255,g=a.charCodeAt(b+3)&255,
l=1-2*(g>>7),g=((g&127)<<1)+((e&254)>>7)-127,c=(e&127)*Math.pow(2,16)+d*Math.pow(2,8)+c;return l*(1+c*Math.pow(2,-23))*Math.pow(2,g)}function oa(a,b,c,d){return[a-c,b+d,a-c,b-d,a+c,b+d,a-c,b-d,a+c,b-d,a+c,b+d]}function v(a,b,c){return 2==arguments.length?[a.x,b.y,a.x,a.y,b.x,b.y,a.x,a.y,b.x,a.y,b.x,b.y]:[a.x,b.y,c,a.x,a.y,c,b.x,b.y,c,a.x,a.y,c,b.x,a.y,c,b.x,b.y,c]}function w(a,b){if(!a)return null;var c=a.createProgram(),d=pa(a,a.VERTEX_SHADER,b+"/vert.glsl"),e=pa(a,a.FRAGMENT_SHADER,b+"/frag.glsl");
a.attachShader(c,d);a.attachShader(c,e);a.linkProgram(c);var g={},d=(d.source+e.source).match(/((uniform)|(attribute)) (\w+) (\w+)/mg),e=0;a.useProgram(c);if(d){for(var l=0;l<d.length;l++){var j=d[l].split(" ");g[j[2]]={u:j[0],type:j[1],loc:null};if("uniform"==j[0])g[j[2]].loc=a.getUniformLocation(c,j[2]);else{var h=a.getAttribLocation(c,j[2]);g[j[2]].loc=h}"sampler2D"==j[1]&&(g[j[2]].tex=e,e++)}c.get=function(a){return g[a].loc};c.data=function(c,b){var d=g[c];if(!d)throw"Could not find shader variable "+
c;if("uniform"==d.u)if("float"==d.type)a.uniform1f(d.loc,b);else if("vec2"==d.type)a.uniform2fv(d.loc,b);else if("ivec2"==d.type)a.uniform2iv(d.loc,b);else if("vec3"==d.type)a.uniform3fv(d.loc,b);else if("ivec3"==d.type)a.uniform3iv(d.loc,b);else if("vec4"==d.type)a.uniform4fv(d.loc,b);else if("ivec4"==d.type)a.uniform4iv(d.loc,b);else if("bool"==d.type)a.uniform1i(d.loc,b);else if("mat4"==d.type)a.uniformMatrix4fv(d.loc,!1,b);else if("mat3"==d.type)a.uniformMatrix3fv(d.loc,!1,b);else if("sampler2D"==
d.type)"texture"in b&&(b=b.texture()),a.activeTexture(a["TEXTURE"+d.tex]),a.bindTexture(a.TEXTURE_2D,b),a.uniform1i(d.loc,d.tex);else if("int"==d.type)a.uniform1i(d.loc,b);else throw"Unsupported Type for Shader Helper: "+d.type;else if("attribute"==d.u)a.enableVertexAttribArray(d.loc),a.bindBuffer(a.ARRAY_BUFFER,b),a.vertexAttribPointer(d.loc,b.itemSize,a.FLOAT,!1,0,0);else throw"Type: "+d.u+" Recieved";}}return c}function pa(a,b,c){var d=a.createShader(b);$.ajax({async:!1,url:c,dataType:"text",success:function(c){a.shaderSource(d,
c);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS))throw a.getShaderInfoLog(d);d.source=c},error:function(){console.log("Could not load "+c)}});return d}function D(a,b,c){var d=a.createBuffer(),e=new Float32Array(b);a.bindBuffer(a.ARRAY_BUFFER,d);d.itemSize=c;d.numItems=b.length/c;a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return d}function da(a,b,c){if(!a)return null;var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);var e=new Float32Array(b*
c);d.itemSize=c;d.numItems=b;d.update=function(c,b){var e=new Float32Array(c);a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferSubData(a.ARRAY_BUFFER,4*b,e);a.bindBuffer(a.ARRAY_BUFFER,null)};a.bufferData(a.ARRAY_BUFFER,e,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return d}function W(a,b,c){var d=a.createTexture();d.id=qa;qa++;var e=new Image;e.onload=function(){a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);c&&c()};e.src=b;return d}function R(a,b){var c={},d;d=b?b:256;var e=0,g=function(a,c,d,b){a||console.log("ack");d||(d=0);b||(b=c.length);for(var e=0;e<b;e++)a[d+e]=c[e]};this.create=function(b,e){if(!e)throw"Length of buffer must be a positive integer";var h=new Float32Array(d*
e),g=da(a,d,e);c[b]={array:h,buffer:g,len:e,dirty:!1}};this.alloc=function(b){if(e+b>=d){for(var j=d;j<e+b;)j*=2;d=j;for(name in c){var h=new Float32Array(j*c[name].len),n=c[name].array,r=da(a,d,c[name].len);g(h,n);c[name].array=h;c[name].buffer=r;c[name].dirty=!0}}j=e;e+=b;return j};this.get=function(a){return c[a].buffer};this.write=function(a,b,d,e){g(c[a].array,b,d*c[a].len,e*c[a].len);c[a].dirty=!0};this.repeat=function(a,b,d,e){for(var r=0;r<e;r++)g(c[a].array,b,(d+r)*c[a].len,c[a].len);c[a].dirty=
!0};this.count=function(){return e};this.data=function(a){return c[a].array};this.update=function(){for(name in c)c[name].dirty&&(c[name].buffer&&c[name].buffer.update(c[name].array,0),c[name].dirty=!1)}}function ra(a,b){var c=k(b);f(c,{mag_filter:a.LINEAR,min_filter:a.LINEAR,wrap_s:a.CLAMP_TO_EDGE,wrap_t:a.CLAMP_TO_EDGE,mipmap:!1});var d=a.createTexture(),e=null;this.image=function(b){e=b;a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MAG_FILTER,c.mag_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,c.min_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,c.wrap_s);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,c.wrap_t);c.mipmap&&a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null)};this.texture=function(){return e?d:null}}function Fa(a,b){var c=this;b||(b={});b.width&&!b.height?b.height=b.width:!b.width&&b.height&&(b.width=b.height);var d=a.height()/a.width();b.min?b.center=vect.add(b.min,(new vect(b.width,
b.height*d)).scale(0.5)):b.center||(b.center=new vect(0,0));var e=b.width,g=b.height,l=b.height/b.width,j=b.center.clone(),h=1;this.worldToPx=new Float32Array(9);this.pxToScreen=new Float32Array(9);this.mat3=this.worldToScreen=new Float32Array(9);this.reconfigure=function(){var b=a.height()/a.width(),d=(new vect(e/h,e*(g/e)*b/h)).scale(0.5),b=vect.add(j,d),d=vect.sub(j,d),l=a.width(),f=a.height(),b=vect.sub(b,d);c.worldToPx[0]=l/b.x;c.worldToPx[1]=0;c.worldToPx[2]=0;c.worldToPx[3]=0;c.worldToPx[4]=
f/b.y;c.worldToPx[5]=0;c.worldToPx[6]=-(d.x*l)/b.x;c.worldToPx[7]=-(d.y*f)/b.y;c.worldToPx[8]=1;c.pxToScreen[0]=2/l;c.pxToScreen[1]=0;c.pxToScreen[2]=0;c.pxToScreen[3]=0;c.pxToScreen[4]=2/f;c.pxToScreen[5]=0;c.pxToScreen[6]=-1;c.pxToScreen[7]=-1;c.pxToScreen[8]=1;c.worldToScreen[0]=2/b.x;c.worldToScreen[1]=0;c.worldToScreen[2]=0;c.worldToScreen[3]=0;c.worldToScreen[4]=2/b.y;c.worldToScreen[5]=0;c.worldToScreen[6]=-2*d.x/b.x-1;c.worldToScreen[7]=-2*d.y/b.y-1;c.worldToScreen[8]=1};this.reconfigure();
this.project=function(b){b=new vect(2*(b.x-a.offset().left)/a.width()-1,-(2*(b.y-a.offset().top)/a.height()-1));b.x=b.x/this.mat3[0]-this.mat3[6]/this.mat3[0];b.y=b.y/this.mat3[4]-this.mat3[7]/this.mat3[4];return b};this.screen=function(b){b=new vect(b.x*this.mat3[0]+this.mat3[6],b.y*this.mat3[4]+this.mat3[7]);b.x=a.offset().left+a.width()*(b.x+1)/2;b.y=a.offset().top+a.height()*(-b.y+1)/2;return b};this.percent=function(b){return new vect(2*((b.x-a.offset().left)/a.width())-1,-(2*((b.y-a.offset().top)/
a.height())-1))};this.pixel=function(b){return new vect(a.offset().left+(b.x+1)/2*a.width(),a.offset().top+(-b.y+1)/2*a.height())};this.move=function(a){j.add(a);this.reconfigure()};this.zoom=function(a){h*=a;this.reconfigure()};this.position=function(a,b){if(void 0===a)return j.clone();j=void 0===b?a.clone():new vect(a,b);this.reconfigure()};this.reset=function(){h=1;this.reconfigure()};a.resize(function(){c.reconfigure()});this.extents=function(a){e=a;g=a*l;h=1;this.reconfigure()}}function Ga(a){var b=
!1,c=new vect(0,0),d=new vect(0,0),e=null,g=0;a.canvas.mousedown(function(a){c=new vect(a.clientX,a.clientY);b=!0});$(window).bind("mouseup",function(){b=!1});$(document).bind("keypress","+",function(){a.camera.zoom(1.1)});$(document).bind("keypress","-",function(){a.camera.zoom(10/11)});$(document).bind("keypress","0",function(){a.camera.reset()});a.canvas.bind("mousewheel",function(b,d){d*=0.5;0>d?(d=-1*d+1,d=1/d):d+=1;a.camera.zoom(d);b.preventDefault()});var l=!0;this.disable=function(){l=!1};
this.enable=function(){l=!0};this.update=function(j){d=new vect(X.x,X.y);if(b&&l){var h=vect.sub(a.camera.project(c),a.camera.project(d));a.camera.move(h);c=d;g=h.length()/j;e=h;e.normalize()}else 0.01<g&&e&&(a.camera.move(vect.scale(e,g*j)),g-=3*j*g)}}function ea(a){this.style_map={};this.children=[];this.geom=a;this.update=function(a,c){if(null===c)throw"Style property does not exist";if(a in this.style_map)this.style_map[a](c);for(var d=0;d<this.children.length;d++)this.children[d].update(a,c)};
this.keys=function(a){void 0===a&&(a={});for(key in this.style_map)a[key]=!0;for(var c=0;c<this.children.length;c++)this.children[c].keys(a);return a}}function fa(a){this.engine=a;this.views=[];this.children=[];this.update=function(){throw"Don't ever call this";};this.View=function(){throw"Attempt to call abstract function";};this.create=function(a){a=new this.View(this.geomFunc(a));this.views.push(a);return a};this.draw=function(){for(var a=0;a<this.children.length;a++)this.children[a].draw()};this.geomFunc=
function(a){return a.geom}}function Ha(a,b){fa.call(this,a,b);a.shaders.point||(a.shaders.point=w(a.gl,x+"shaders/point"));var c=a.shaders.point,d=10,e=new R(a.gl,Ia);e.create("vert",2);e.create("unit",2);e.create("stroke_width",1);e.create("rad",1);e.create("fill_color",3);e.create("fill",1);e.create("stroke_color",3);e.create("stroke",1);e.create("alpha",1);this.View=function(a){ea.call(this,a);var b,c;this.style_map={fill:function(a){"none"==a?e.repeat("fill",[-0.75],b,c):(e.repeat("fill",[0.75],
b,c),e.repeat("fill_color",a.array,b,c))},opacity:function(a){e.repeat("alpha",[a],b,c)},radius:function(a){a>d&&(d=a);e.repeat("rad",[a],b,c)},stroke:function(a){"none"==a?e.repeat("stroke",[-0.75],b,c):(e.repeat("stroke",[0.75],b,c),e.repeat("stroke_color",a.array,b,c))},"stroke-width":function(a){e.repeat("stroke_width",[a],b,c)}};c=6*a.length;b=e.alloc(c);$.each(a,function(a,d){e.repeat("vert",d,b+6*a,6);e.write("unit",Ja,b+6*a,6)})};this.draw=function(){var b=a.gl;e.update();b.useProgram(c);
c.data("screen",a.camera.mat3);c.data("pos",e.get("vert"));c.data("circle_in",e.get("unit"));c.data("color_in",e.get("fill_color"));c.data("stroke_color_in",e.get("stroke_color"));c.data("alpha_in",e.get("alpha"));c.data("fill_in",e.get("fill"));c.data("stroke_in",e.get("stroke"));c.data("aspect",a.canvas.width()/a.canvas.height());c.data("pix_w",2/a.canvas.width());c.data("rad",e.get("rad"));c.data("stroke_width_in",e.get("stroke_width"));c.data("max_rad",d);b.drawArrays(b.TRIANGLES,0,e.count())}}
function Ka(a,b){for(var c=6*b.length,d=a.alloc(c),e=[-1,1,-1,-1,1,-1,-1,1,1,-1,1,1],g=0,l=function(){if(b[g]){var a=new vect(b[g][0],b[g][1]);g++;return a}return null},j=null,h=l(),n=l(),r=[],f=[],I=[];h;)r.push(j||vect.add(h,vect.sub(h,n))),f.push(h),I.push(n||vect.add(h,vect.sub(h,j))),j=h,h=n,n=l();currentIndex=d;d=function(b,d,c){a.write("prev",b.array(),currentIndex,1);a.write("current",d.array(),currentIndex,1);a.write("next",c.array(),currentIndex,1);currentIndex++};for(l=1;l<b.length;l++)a.write("unit",
e,currentIndex,6),d(r[l-1],f[l-1],I[l-1]),d(I[l-1],f[l-1],r[l-1]),d(I[l],f[l],r[l]),d(r[l-1],f[l-1],I[l-1]),d(I[l],f[l],r[l]),d(r[l],f[l],I[l]);return c}function ga(a,b){fa.call(this,a,b);a.shaders.line||(a.shaders.line=w(a.gl,x+"shaders/line"));var c=a.shaders.line,d=new R(a.gl,1024);d.create("prev",2);d.create("current",2);d.create("next",2);d.create("unit",2);d.create("width",1);d.create("color",3);d.create("alpha",1);this.View=function(a){ea.call(this,a);var b=d.count(),c=0;this.style_map={stroke:function(a){d.repeat("color",
a.array,b,c)},"stroke-opacity":function(a){d.repeat("alpha",[a],b,c)},"stroke-width":function(a){d.repeat("width",[a],b,c)}};$.each(a,function(a,b){for(a=0;a<b.length;a++)c+=Ka(d,b[a])})};this.draw=function(){var b=a.gl;d.update();b.useProgram(c);c.data("world",a.camera.worldToPx);c.data("screen",a.camera.pxToScreen);c.data("prev",d.get("prev"));c.data("current",d.get("current"));c.data("next",d.get("next"));c.data("color_in",d.get("color"));c.data("alpha_in",d.get("alpha"));c.data("circle_in",d.get("unit"));
c.data("width",d.get("width"));c.data("px_w",2/a.canvas.width());c.data("px_h",2/a.canvas.height());b.drawArrays(b.TRIANGLES,0,d.count())}}function La(a,b){fa.call(this,a,b);a.shaders.polygon||(a.shaders.polygon=w(a.gl,x+"shaders/poly"));var c=a.shaders.polygon,d=new ga(a,b);this.children.push(d);var e=new R(a.gl,Ma);e.create("vert",2);e.create("color",3);e.create("alpha",1);this.View=function(a){ea.call(this,a);var b,d;this.style_map={fill:function(a){e.repeat("color",a.array,b,d)},"fill-opacity":function(a){e.repeat("alpha",
[a],b,d)}};var c=[];d=0;$.each(a,function(a,b){for(var e,g=0;100>g;)try{for(var l=b,n=[],f=[],k=0;k<l.length;k++){var E=[];if(3>=l[k].length)f.push(l[k]);else for(var m=1;m<l[k].length;m++)E.push(sa(l[k][m][0],l[k][m][1]));E.push(n[0]);n.push(E)}for(var p=Na(n),m=0;m<f.length;m++)p.push(f[m][0][0]),p.push(f[m][0][1]),p.push(f[m][1][0]),p.push(f[m][1][1]),p.push(f[m][2][0]),p.push(f[m][2][1]);e=p;break}catch(Za){g++}100==g&&(console.log("Rendering Polygon Failed: Skipping Interior"),e=[]);d+=e.length/
2;c.push(e)});var n=b=e.alloc(d);$.each(c,function(a,b){var d=b.length/2;e.write("vert",b,n,d);n+=d})};this.draw=function(){var b=a.gl;e.update();b.useProgram(c);c.data("screen",a.camera.mat3);c.data("pos",e.get("vert"));c.data("color_in",e.get("color"));c.data("alpha_in",e.get("alpha"));b.drawArrays(b.TRIANGLES,0,e.count());d.draw()}}function Oa(a,b,c){ga.call(this,a,b,c);var d=b.attr("order");this.geomFunc=function(a){for(var b=[],c=[],j=0;j<d.length;j++){var h=a.attr(d[j]);isNaN(h)?0<c.length&&
(b.push(c),c=[]):c.push([j,h])}0<c.length&&b.push(c);return[b]}}function Pa(a,b,c,d){var e=this;F.manage(b);F.linkParent(a,b);this.renderers={};this.views={};var g=function(d,c){var h=y.derivedStyle(d,b,a,c);e.views[d.id].update(c,h)};b.features().each(function(c,j){var h;h=j.type in a.Renderers?j.type:"default";h in e.renderers||(e.renderers[h]=new a.Renderers[h](a,b,d));var n=e.renderers[h].create(j);e.views[j.id]=n;for(h in n.keys())g(j,h);F.manage(j);F.linkParent(b,j);F.addEventHandler(j,"style",
g)});this.draw=function(a,b){for(var c in this.renderers)this.renderers[c].draw(b)}}function ta(a,b){var c=this;f(b,{background:new q(0,0,0,1)});this.type="Engine";this.id=M();this.canvas=$("<canvas></canvas>").attr("id","viewer");var d=null;a?($(a).append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height())):(a=window,$("body").append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height()),$(window).resize(function(){c.resize()}));
var e=[];this.resize=function(){this.canvas.attr("width",$(a).width());this.canvas.attr("height",$(a).height());d.viewport(0,0,this.canvas.width(),this.canvas.height());this.camera.reconfigure();for(var b=0;b<e.length;b++)e[b].resize()};var g=this.canvas;this.gl=d=Qa?WebGLDebugUtils.makeDebugContext(g.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1}),function(a,b){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to "+b;}):g.get(0).getContext("experimental-webgl",
{alpha:!1,antialias:!0,premultipliedAlpha:!1});d.viewport(0,0,this.canvas.width(),this.canvas.height());d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);d.enable(d.BLEND);this.camera=new Fa(this.canvas,b);this.scroller=new Ga(this);this.extents=function(a){this.camera.extents(a)};this.center=function(a,b){void 0===b?this.camera.position(a):this.camera.position(new vect(a,b))};this.pxW=1/this.canvas.attr("width");this.pxH=1/this.canvas.attr("height");this.Renderers={};this.renderers={};this.views={};
this.styles={};this.defaultStyle=function(a,b){var c;a in this.styles&&(c=this.styles[a][b]);if(null===c||void 0===c)c=this.styles["default"][b];return null===c||void 0===c?null:c};F.manage(this);this.append=function(a){"draw"in a?this.scene.push(a):(this.scene.push(new Pa(c,a,b)),this.layers[a.id]=a,this.queriers[a.id]=new Ra(this,a),a.fixed=!0)};this.search=function(a,b){return this.queriers[a.id].boxSearch(b)};this.style=function(a,b,c){void 0===this.styles[a.id]&&(this.styles[a.id]={});if(void 0===
c)return void 0!==this.styles[a.id][b]?this.styles[a.id][b]:null;this.styles[a.id][b]=c;a.id in this.views?this.views[a.id].update(b):a.id in this.renderers&&$.each(this.renderers[a.id],function(a,b){b.update()})};var l=new Sa(this);this.select=function(a){l.select(a)};var j=!1;this.enableSelect=function(){this.scroller.disable();l.enable();j=!0};this.disableSelect=function(){this.scroller.enable();l.disable();j=!1};var h=(new Date).getTime(),n=[],r,s=this;r=function(){s.draw()};this.shaders={};this.scene=
[];this.layers={};this.queriers={};this.draw=function(){var a=(new Date).getTime(),e=(a-h)/1E3;this.scroller.update(e);60<=n.length&&n.splice(0,1);n.push(e);for(var g=0,f=0;f<n.length;f++)g+=n[f];g/=n.length;$("#fps").text(Math.floor(1/g));h=a;d.clearColor(b.background.r,b.background.g,b.background.b,b.background.a);d.clear(d.COLOR_BUFFER_BIT);d.clearDepth(0);$.each(this.scene,function(a,b){b.draw(c,e)});requestAnimationFrame(r);j&&l.draw(this,e)};this.enableZ=function(){d.depthFunc(d.LEQUAL);d.enable(d.DEPTH_TEST)};
this.disableZ=function(){d.disable(d.DEPTH_TEST)};requestAnimationFrame(r)}function Sa(a){var b=w(a.gl,x+"shaders/selbox"),c=!1,d=!1,e=null,g=null,l=da(a.gl,6,2),j=D(a.gl,oa(0,0,1,1),2);a.canvas.bind("mousedown",function(b){c&&(show=d=!0,g=e=a.camera.percent(new vect(b.clientX,b.clientY)),l.update(v(e,g),0))});var h=function(){};this.select=function(a){h=a};$(document).bind("mouseup",function(){if(c&&d){var b=a.camera.project(a.camera.pixel(e)),j=a.camera.project(a.camera.pixel(g));if(b.x>j.x){var l=
b.x;b.x=j.x;j.x=l}b.y>j.y&&(l=b.y,b.y=j.y,j.y=l);d=!1;h(new J(b,j))}});$(document).bind("click",function(){c&&(show=!1)});$(document).bind("mousemove",function(b){c&&d&&(g=a.camera.percent(new vect(b.clientX,b.clientY)),l.update(v(e,g),0))});this.enable=function(){c=!0};this.disable=function(){c=!1};this.draw=function(a){a=a.gl;d&&(a.useProgram(b),b.data("pos",l),b.data("edge_in",j),a.drawArrays(a.TRIANGLES,0,l.numItems))}}function ua(a,b){for(;a>=b;)a-=b;for(;0>a;)a+=b;return a}function Ta(a,b,c,
d){this.current=a;this.upper=b;this.lower=c;this.index=d}function va(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1}function Z(a,b,c){if(void 0==b)throw"whoa";return 0==a[b+1].y-a[b].y?Math.min(a[b].x,a[b+1].x):a[b].x+(a[b+1].x-a[b].x)*((c-a[b].y)/(a[b+1].y-a[b].y))}function N(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return!1}function z(a,b,c){return new vect(Z(b,c,b[a].y),b[a].y)}function G(a,b){if(!b)throw"eek";a.push(b.x);a.push(b.y)}function O(a,b,c){if(!b||!c||3!=c.length+
b.length&&4!=c.length+b.length)throw"ahh";if(3==b.length+c.length){for(var d=0;d<b.length;d++)G(a,b[d]);for(d=0;d<c.length;d++)G(a,c[d])}else b[1].x<b[0].x&&(d=b[0],b[0]=b[1],b[1]=d),c[1].x<c[0].x&&(d=c[0],c[0]=c[1],c[1]=d),G(a,b[0]),G(a,b[1]),G(a,c[1]),G(a,c[0]),G(a,c[1]),G(a,b[0])}function Na(a){for(var b=[],c=0,d=[],e=0;e<a.length;e++){for(var g=0;g<a[e].length-1;g++){var l=ua(g+1,a[e].length-1),j=ua(g-1,a[e].length-1);b.push(new Ta(g+c,l+c,j+c,e));d.push(a[e][g])}d.push(a[e][0]);c+=a[e].length}b.sort(function(a,
b){return d[a.current].y-d[b.current].y});a=[];e=[];new vect(-200,0);new vect(200,0);c=0;c=[];j=[];for(g=0;g<b.length;g++){var h=b[g],l=va(a,h.lower),n=va(a,h.current),f,s;if(l&&!n)s=f=N(a,h.lower);else if(n&&!l)f=s=N(a,h.current);else if(l&&n)f=N(a,h.lower),s=N(a,h.current);else if(!l&&!n){a:{f=a;s=d;for(var k=d[h.current].x,m=d[h.current].y,p=0;p<f.length;p++){var q=Z(s,f[p],m);if(q>k||0==q-k&&s[f[p]].y>s[index].y){s=p;break a}}s=f.length}f=s}if(1<Math.abs(f-s)){for(l=0;l<a.length;l++);throw"Bad";
}k=vect.left(d[h.lower],d[h.current],d[h.upper]);m=Math.floor(Math.min(f,s)/2);!k&&!l&&!n?(O(j,e[m],[z(h.current,d,a[s-1]),z(h.current,d,a[s])]),e.splice(m,1,[z(h.current,d,a[s-1]),d[h.current]],[d[h.current],z(h.current,d,a[f])])):k&&!l&&!n?e.splice(m,0,[d[h.current]]):l&&!n?(O(j,e[m],[z(h.current,d,a[Math.max(f,s)-1]),d[h.current]]),e[m]=[z(h.current,d,a[Math.min(f,s)-1]),d[h.current]]):!l&&n?(O(j,e[m],[d[h.current],z(h.current,d,a[Math.min(s,f)+1])]),e[m]=[d[h.current],z(h.current,d,a[Math.max(s,
f)+1])]):!k&&l&&n?(O(j,e[m],[z(h.current,d,a[Math.min(f,s)-1]),d[h.current]]),O(j,e[m+1],[z(h.current,d,a[Math.max(f,s)+1]),d[h.current]]),e.splice(m,2,[z(h.current,d,a[Math.min(f,s)-1]),z(h.current,d,a[Math.max(f,s)+1])])):k&&(l&&n)&&(O(j,e[m],[d[h.current]]),e.splice(m,1));l&&!n?a[f]=h.current:n&&!l?a[s]=h.lower:l&&n?(a.splice(N(a,h.lower),1),a.splice(N(a,h.current),1)):!l&&!n&&(k?a.splice(f,0,h.lower,h.current):a.splice(f,0,h.current,h.lower));for(l=0;l<a.length-1;l++)if(Z(d,a[l],d[h.current].y)>
Z(d,a[l+1],d[h.current].y))throw console.log("Misplaced Sweep"),"Misplace!";}if(0<a.length)throw console.log(a),"Bad "+a.length;if(0<c.length)throw console.log(c),"Wrong";return j}function J(a,b){this.min=a.clone();this.max=b.clone();this.contains=function(c){return a.x<=c.x&&b.x>=c.x&&a.y<=c.y&&b.y>=c.y};this.x_in=function(c){return a.x<=c.x&&b.x>=c.x};this.x_left=function(b){return a.x>=b.x};this.x_right=function(a){return b.x<=a.x};this.y_in=function(c){return a.y<=c.y&&b.y>=c.y};this.y_left=function(b){return a.y>=
b.y};this.y_right=function(a){return b.y<=a.y};this.area=function(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)};this.height=function(){return this.max.y-this.min.y};this.width=function(){return this.max.x-this.min.x};this.vertex=function(a){switch(a){case 0:return this.min.clone();case 1:return new vect(this.max.x,this.min.y);case 2:return this.max.clone();case 3:return new vect(this.min.x,this.max.y);default:throw"Index out of bounds: "+a;}};this.intersects=function(a){for(var b=0;4>b;b++)for(var e=
0;4>e;e++)if(vect.intersects(this.vertex(b),this.vertex((b+1)%4),a.vertex(e),a.vertex((e+1)%4)))return!0;return this.contains(a.min)&&this.contains(a.max)&&this.contains(new vect(a.min.x,a.max.y))&&this.contains(new vect(a.max.x,a.min.y))||a.contains(this.min)&&a.contains(this.max)&&a.contains(new vect(this.min.x,this.max.y))&&a.contains(new vect(this.max.x,this.min.y))?!0:!1};this.union=function(a){this.min.x=Math.min(this.min.x,a.min.x);this.min.y=Math.min(this.min.y,a.min.y);this.max.x=Math.max(this.max.x,
a.max.x);this.max.y=Math.max(this.max.y,a.max.y)};this.centroid=function(){return new vect((this.max.x+this.min.x)/2,(this.max.y+this.min.y)/2)};this.clone=function(){return new J(a,b)}}function ha(a,b,c,d){this.data=a[d];this.right=this.left=null;b!=d&&(this.left=new ha(a,b,d-1,parseInt((b+(d-1))/2)));c!=d&&(this.right=new ha(a,d+1,c,parseInt((c+(d+1))/2)));this.subtree=[];for(d=b;d<=c;d++)this.subtree.push(a[d]);this.subtree.sort(function(a,b){return a.y-b.y});this.yrange=function(a,b,d){return a.y_in(this.subtree[b])&&
a.y_in(this.subtree[d])};this.subquery=function(a,b,d,c,h){if(this.yrange(b,d,c))for(b=d;b<=c;b++)a.push(this.subtree[b]);else b.y_in(this.subtree[h])&&a.push(this.subtree[h]),b.y_left(this.subtree[h])?h!=c&&this.subquery(a,b,h+1,c,parseInt((c+(h+1))/2)):(b.x_right(this.subtree[h])||h!=c&&this.subquery(a,b,h+1,c,parseInt((c+(h+1))/2)),h!=d&&this.subquery(a,b,d,h-1,parseInt((d+(h-1))/2)))};this.search=function(d,g){g.x_in(a[b])&&g.x_in(a[c])?this.subquery(d,g,0,this.subtree.length-1,parseInt((this.subtree.length-
1)/2)):(g.contains(this.data)&&d.push(this.data),g.x_left(this.data)?this.right&&this.right.search(d,g):g.x_right(this.data)?this.left&&this.left.search(d,g):(this.left&&this.left.search(d,g),this.right&&this.right.search(d,g)))}}function ia(a){a.sort(function(a,c){return a.x-c.x});0<a.length?this.root=new ha(a,0,a.length-1,parseInt((a.length-1)/2)):null==this.root;this.search=function(a){if(!this.root)return[];a=a.clone();var c=[];this.root.search(c,a);return c}}function wa(a){var b=new vect(Infinity,
Infinity),c=new vect(-Infinity,-Infinity);$.each(a,function(a,e){$.each(e,function(a,d){$.each(d,function(a,d){d[0]<b.x&&(b.x=d[0]);d[0]>c.x&&(c.x=d[0]);d[1]<b.y&&(b.y=d[1]);d[1]>c.y&&(c.y=d[1])})})});return new J(b,c)}function aa(a){a||(a={});this.id=M();this.type="Layer";var b={};if(a.style)throw"Not Implemeneted";this.style=function(a,b,d){var c;!a||"Engine"==a.type?(c=a,a=b,b=d):c=null;if(void 0===b)return y.getStyle(this,c,a);y.setStyle(this,c,a,b);return this};this.bounds=null;this.features=
function(){var a=[],d;for(d in b)a.push(b[d]);return new t(a)};var c={};this.properties=function(){var a=[],b;for(b in c)a.push(b);return a};this.numeric=function(){var a=[],b;for(b in c)c[b]&&a.push(b);return a};var d={};this.attr=function(a,b){if(2>arguments.length)return void 0!==d[a]?d[a]:null;d[a]=b};this.fixed=!1;this.append=function(a){if(this.fixed)throw"Layers are currently immutable once added to a map";var d=new Ua[a.type](a,this);b[d.id]=d;this.bounds?this.bounds.union(d.bounds):this.bounds=
d.bounds.clone();for(var e in a.attr)c[e]=void 0===c[e]?isNaN(a.attr[e])?!1:!0:!isNaN(a.attr[e])&&c[e]?!0:!1;dirty=!0};var e=null,g=null;this.mouseover=function(a){e=a};this.mouseout=function(a){g=a};var l={};this.update_move=function(a,b){if(e||g){var d=this.map_contains(a,b),c={};d&&d.each(function(a,b){c[b.id]=b});for(var f in l)!(f in c)&&g&&g(l[f]);for(f in c)!(f in l)&&e&&e(c[f]);l=c}};this.force_out=function(){for(var a in l)g&&g(l[a]);l={}}}function ja(a){A||(A=w(engine.gl,x+"shaders/grid"));
a||(a={});a.style||(a.style={});var b=a.lower,c=a.upper,d=a.rows,e=a.cols,g=(c.x-b.x)/e,l=(c.y-b.y)/d,j=new Float32Array(d*e),h=new Uint8Array(4*e*d),f=!1,r=new R(engine.gl,6);r.create("vert",2);r.create("screen",2);r.create("tex",2);var s=new vect(b.x,b.y),k=new vect(c.x,c.y),m=new vect(0,0),p=new vect(1,1),q=r.alloc(6);r.write("vert",v(s,k),q,6);r.write("screen",v(new vect(-1,-1),new vect(1,1)),q,6);r.write("tex",v(m,p),q,6);var B=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,B);gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindTexture(gl.TEXTURE_2D,null);this.lower=function(){return b.clone()};this.upper=function(){return c.clone()};this.rows=function(){return d};this.cols=function(){return e};this.centroid=function(a,d){return new vect(b.x+g*d+g/2,b.y+l*a+l/2)};this.get=function(a,b){return j[e*
a+b]};var Y=-Infinity,E=Infinity;this.qunatiles=function(a,b){b||(b=function(a,b){return a-b});for(var d=[],c=0;c<j.length;c++)d.push(j[c]);d.sort(b);for(var e=[-Infinity],c=1;c<a;c++){var g=parseInt(inc*c);e.push(d[g])}e.push(Infinity);return e};this.set=function(a,b,c){if(a>=d||b>=e)throw"Index Out of Bounds";j[e*a+b]=c;f=!0};this.raw_set=function(a,b){if(a>=d*e)throw"Index Out of Bounds: "+a;j[a]=b;f=!0};this.clear=function(a){for(var b=0;b<d*e;b++)j[b]=a};this.initialize=function(){};var t=null;
this.draw=function(b){t||(t=b.framebuffer());r.update();if(f){Y=-Infinity;E=Infinity;for(var c=0;c<d*e;c++){var g=j[c];g>Y&&(Y=g);g<E&&(E=g)}for(c=0;c<d*e;c++){var g=c,l=a.map(E,Y,j[c]);h[4*g]=parseInt(255*l.r);h[4*g+1]=parseInt(255*l.g);h[4*g+2]=parseInt(255*l.b);h[4*g+3]=parseInt(255*l.a)}gl.bindTexture(gl.TEXTURE_2D,B);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,e,d,0,gl.RGBA,gl.UNSIGNED_BYTE,h);gl.bindTexture(gl.TEXTURE_2D,null);f=!1}a.style.antialias&&t.activate({blend:!1});gl.useProgram(A);A.data("screen",
b.camera.mat3);A.data("pos",r.get("vert"));A.data("tex_in",r.get("tex"));A.data("sampler",B);c=vect.sub(b.camera.screen(k),b.camera.screen(s));A.data("width",c.x);A.data("height",-c.y);A.data("rows",d);A.data("cols",e);A.data("blur",a.blur);gl.drawArrays(gl.TRIANGLES,0,r.count());a.style.antialias&&(t.deactivate(),b.draw_blur(t.tex))}}function xa(a,b,c){var d,e,g,l=!1;this.id=M();var j=!1;this.initialize=function(h){d||(d=w(h.gl,x+"shaders/raster"));this.image=W(h.gl,a,function(){j=!0});e=D(h.gl,
v(new vect(0,1),new vect(1,0)),2);g=D(h.gl,v(b,c),2);l=!0};this.draw=function(a){var b=a.gl;l||this.initialize(a);j&&(b.useProgram(d),d.data("screen",a.camera.mat3),d.data("pos",g),d.data("tex_in",e),d.data("sampler",this.image),b.drawArrays(b.TRIANGLES,0,g.numItems))}}function ya(a){u||(u=w(x+"shaders/hillshade"));var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),d=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));
a=$(a).find("GroundOverlay Icon href").text();var e=!1,g=W(a,function(){e=!0});this.ready=function(){return e};var l=D(v(new vect(0,1),new vect(1,0)),2),j=D(v(c,d),2),h=315;this.draw=function(a){if(e){for(gl.useProgram(altitude_shader);1<=h;)h-=1;altitude_shader.data("azimuth",h);altitude_shader.data("altitude",Math.PI/4/(2*Math.PI));altitude_shader.data("screen",a.camera.mat3);altitude_shader.data("pos",j);altitude_shader.data("tex_in",l);altitude_shader.data("elevation",g);a=vect.sub(a.camera.screen(d),
a.camera.screen(c));altitude_shader.data("pix_w",1/a.x);altitude_shader.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,j.numItems);return h}}}function ya(a){u||(u=w(engine.gl,x+"shaders/hillshade"));var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),d=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var e=!1,g=W(engine.gl,a,function(){e=!0});this.ready=function(){return e};
var l=D(engine.gl,v(new vect(0,1),new vect(1,0)),2),j=D(engine.gl,v(c,d),2),h=315;this.initialize=function(){};this.draw=function(a){if(e){for(gl.useProgram(u);1<=h;)h-=1;u.data("azimuth",h);u.data("altitude",Math.PI/4/(2*Math.PI));u.data("screen",a.camera.mat3);u.data("pos",j);u.data("tex_in",l);u.data("elevation",g);a=vect.sub(a.camera.screen(d),a.camera.screen(c));u.data("pix_w",1/a.x);u.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,j.numItems);return h}}}function ba(a){function b(a){a||(a=
{});a.desaturate||(a.desaturate=0);a.darken||(a.darken=0);a.hue||(a.hue=0);a.hue_color||(a.hue_color=na(0,0,0,1));var b=a.url,d=a.min,e=a.rows,h=a.cols,j=a.cellsize;this.rows=e;this.cols=h;for(var f={},n={},r=function(b,c){var e=new vect(d.x+b*j,d.y+c*j),g=new vect(d.x+(b+1)*j,d.y+(c+1)*j),e={vert:v(e,g,a.z_index),tex:null,i:b,j:c,id:b+h*c,ready:!1,min:e,max:g};n[b][c]=e;f[e.id]=e},k=0;k<h;k++)n[k]={};this.size=function(a){var b=a.camera.screen(d);a=a.camera.screen(vect.add(d,new vect(j*h,j*e)));
b=vect.sub(a,b);b.y=Math.abs(b.y);return b};var m=!1;this.noexpire=function(a){m=a};this.cull=function(){if(!m){var b=(new Date).getTime(),d;for(d in q)if(b-q[d]>Va){var c=f[d];delete f[d];delete n[c.i][c.j];a.available.push(c.tex);c.tex=null;c.ready=!1;delete q[d]}}};var p=function(){var a=g.camera.project(new vect(g.canvas.offset().left,g.canvas.offset().top+g.canvas.height())),b=g.camera.project(new vect(g.canvas.offset().left+g.canvas.width(),g.canvas.offset().top)),c=Math.floor((a.x-d.x)/j),
e=Math.ceil((b.x-d.x)/j),a=Math.floor((a.y-d.y)/j),b=Math.ceil((b.y-d.y)/j);return{min_col:c,max_col:e,min_row:a,max_row:b}},q={};this.ready=function(){for(var a=p(),b=Math.max(0,a.min_col);b<Math.min(h,a.max_col);b++)for(var d=Math.max(0,a.min_row);d<Math.min(e,a.max_row);d++)if(!n[b][d]||!n[b][d].ready)return!1;return!0};var t=function(d,c){if(!n[d][c].tex){var e;if("file"==a.source)e=b+"/"+n[d][c].id+".png";else if("wms"==a.source){e={service:"wms",version:"1.1.0",request:"GetMap",layers:a.layer,
bbox:[n[d][c].min.x,n[d][c].min.y,n[d][c].max.x,n[d][c].max.y].join(),width:a.size,height:a.size,srs:"EPSG:4326",format:"image/png",transparent:"true"};var g=[],h;for(h in e)g.push(h+"="+e[h]);e=b+"?"+g.join("&")}n[d][c].tex=a.available.pop();n[d][c].tex||(n[d][c].tex=new ra(l));h=e;var j=n[d][c],f=new Image;f.crossOrigin="";f.onload=function(){j.tex&&(j.tex.image(f),j.ready=!0)};f.src=h}};this.fetch_all=function(){for(var a=(new Date).getTime(),b=0;b<h;b++)for(var d=0;d<e;d++)n[b][d]||r(b,d),n[b][d].tex||
t(b,d),q[n[b][d].id]=a};this.fetch=function(){for(var a=p(),b=(new Date).getTime(),d=Math.max(0,a.min_col-1);d<Math.min(h,a.max_col+1);d++)for(var c=Math.max(0,a.min_row-1);c<Math.min(e,a.max_row+1);c++)n[d][c]||r(d,c),n[d][c].tex||t(d,c),q[n[d][c].id]=b};var u=!1;this.initialize=function(a){if(u)throw"Not Implemented: Migrating Tile Layers to New Map";c||(c=w(a.gl,x+"shaders/tile"));u=!0};this.draw=function(b,d,g,j,f){u||this.initialize(b);b=function(){za++;g.update();c.data("pos",g.get("vert"));
c.data("tex_in",g.get("tex"));c.data("lookup_in",g.get("lookup"));c.data("desaturate",a.desaturate);c.data("darken",a.darken);c.data("hue",a.hue);c.data("hue_color",a.hue_color.array);l.drawArrays(l.TRIANGLES,0,6*j)};d=p();for(var r=(new Date).getTime(),k=Math.max(0,d.min_col);k<Math.min(h,d.max_col);k++)for(var m=Math.max(0,d.min_row);m<Math.min(e,d.max_row);m++)if(n[k][m]&&n[k][m].ready&&n[k][m].tex){g.write("vert",n[k][m].vert,6*j,6);g.write("tex",v(new vect(0,0),new vect(1,1)),6*j,6);g.repeat("lookup",
[j/S+1/(2*S)],6*j,6);q[n[k][m].id]=r;c.data("sampler"+j,n[k][m].tex);if(null==n[k][m].tex)throw"badness";j++;Aa++;j>=S&&(b(),j=0)}f&&b();return j}}var c=null,d=[],e=[],g=null,l=null;this.id=M();for(var j=0;j<a.levels;j++){var h=k(a);"file"==h.source&&(h.url+="/"+a.size*Math.pow(2,j+1));h.min=new vect(-180,-90);h.rows=Math.pow(2,j);h.cols=2*h.rows;h.cellsize=180/h.rows;h.z_index=1-ka-j/1E3;h.available=e;h=new b(h);d.push(h)}ka+=(a.levels+2)/1E3;var f=null,r=!1;this.initialize=function(a){g=a;c||(c=
w(g.gl,x+"shaders/tile"));l=g.gl;f=new R(g.gl,6*S);f.create("vert",3);f.create("tex",2);f.create("lookup",1);f.alloc(6*S);for(a=0;25>a;a++)e.push(new ra(g.gl));for(a=0;a<d.length;a++)d[a].initialize(g);d[0].fetch_all();d[0].noexpire(!0);r=!0};this.draw=function(b,e){r||initialize(b);l.useProgram(c);c.data("screen",b.camera.mat3);za=Aa=0;for(var g=Infinity,h=d[0],j,k=0;k<d.length;k++){var m=a.size*d[k].cols/d[k].size(b).x;1>m&&(m=1/m);m<g&&(g=m,h=d[k],j=k)}for(k=j;0<=k;k--)d[k].fetch();if(h.ready())h.draw(b,
e,f,0,!0);else{b.enableZ();g=0;for(k=j;0<=k;k--)g=d[k].draw(b,e,f,g,0==k);b.disableZ()}$.each(d,function(a,b){b.cull()})}}var x="",P=jQuery,Wa=function(a){if("string"===typeof a.data){var b=a.handler,c=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))){var e="keypress"!==a.type&&P.hotkeys.specialKeys[a.which],g=String.fromCharCode(a.which).toLowerCase(),l="",j={};a.altKey&&"alt"!==e&&(l+="alt+");a.ctrlKey&&
"ctrl"!==e&&(l+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==e)&&(l+="meta+");a.shiftKey&&"shift"!==e&&(l+="shift+");e?j[l+e]=!0:(j[l+g]=!0,j[l+P.hotkeys.shiftNums[g]]=!0,"shift+"===l&&(j[P.hotkeys.shiftNums[g]]=!0));e=0;for(g=c.length;e<g;e++)if(j[c[e]])return b.apply(this,arguments)}}}};P.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",
40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",
".":">","/":"?","\\":"|","[":"{","]":"}"}};P.each(["keydown","keyup","keypress"],function(){P.event.special[this]={add:Wa}});var H=jQuery,la=function(a){var b=a||window.event,c=[].slice.call(arguments,1),d=0,e=0,g=0;a=H.event.fix(b);a.type="mousewheel";b.wheelDelta&&(d=b.wheelDelta/120);b.detail&&(d=-b.detail/3);g=d;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(g=0,e=-1*d);void 0!==b.wheelDeltaY&&(g=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(e=-1*b.wheelDeltaX/120);c.unshift(a,d,e,g);return(H.event.dispatch||
H.event.handle).apply(this,c)},Q=["DOMMouseScroll","mousewheel"];if(H.event.fixHooks)for(var K=Q.length;K;)H.event.fixHooks[Q[--K]]=H.event.mouseHooks;H.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=Q.length;a;)this.addEventListener(Q[--a],la,!1);else this.onmousewheel=la},teardown:function(){if(this.removeEventListener)for(var a=Q.length;a;)this.removeEventListener(Q[--a],la,!1);else this.onmousewheel=null}};H.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",
a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});for(var Ba=0,K=["ms","moz","webkit","o"],T=0;T<K.length&&!window.requestAnimationFrame;++T)window.requestAnimationFrame=window[K[T]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[K[T]+"CancelAnimationFrame"]||window[K[T]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-Ba)),d=window.setTimeout(function(){a(b+
c)},c);Ba=b+c;return d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var X={x:0,y:0};$(document).mousemove(function(a){X.x=a.clientX;X.y=a.clientY});var Qa=!1,qa=0,y=new function(){this.styles={};this.derivedStyle=function(a,c,d,e){if(!d)throw"Undefined operation";var g;g=this.getStyle(a,d,e);null===g&&(g=this.getStyle(a,null,e),null===g&&(g=this.getStyle(c,d,e),null===g&&(g=this.getStyle(c,d,e),null===g&&(g=d.defaultStyle(a.type,e)))));return g};var a=
function(a,c){var d=c?c.id:"default";d in y.styles||(y.styles[d]={});a.id in y.styles[d]||(y.styles[d][a.id]={})};this.getStyle=function(b,c,d){a(b,c);b=this.styles[c?c.id:"default"][b.id][d];return void 0===b?null:b};this.setStyle=function(b,c,d,e){a(b,c);this.styles[c?c.id:"default"][b.id][d]=e;F.trigger(b,"style",[b,d])}},F=new function(){this.listeners={};this.manage=function(a){a.id in this.listeners||(this.listeners[a.id]={parents:[],callbacks:{}})};this.linkParent=function(a,b){this.listeners[b.id].parents.push(a.id)};
this.addEventHandler=function(a,b,c){this.listeners[a.id].callbacks[b]||(this.listeners[a.id].callbacks[b]=[]);this.listeners[a.id].callbacks[b].push(c)};this.moveMouse=function(){};this.clickMouse=function(){};this.mouseDown=function(){};this.trigger=function(a,b,c){a.id in this.listeners&&(b in this.listeners[a.id].callbacks&&$.each(this.listeners[a.id].callbacks[b],function(b,e){e.apply(a,c)}),$.each(this.listeners[a.id].parents,function(a,e){F.trigger(e,b,c)}))}},Ia=1024,Ja=oa(0,0,1,1),Ma=1024,
Ra=function(a,b){queryTypes={Point:Xa,Polygon:Ya};var c={};$.each(queryTypes,function(d,e){c[d]=new e(a,b,b.features().type(d))});this.boxSearch=function(a){var b=new t([]),g;for(g in c)var l=c[g].boxSearch(a),b=b.join(l);return b};this.pointSearch=function(a){var b=new t([]),g;for(g in c)var l=c[g].pointSearch(a),b=b.join(l);return b}},Xa=function(a,b,c){var d=[],e=0;c.each(function(c,g){var h=y.derivedStyle(g,b,a,"radius");h>e&&(e=h);$.each(g.geom,function(a,b){d.push({x:b[0],y:b[1],ref:g})})});
var g=new ia(d);this.boxSearch=function(a){a=g.search(a);var b=[];$.each(a,function(a,d){b.push(d.ref)});return new t(b)};this.pointSearch=function(d){for(var c=vect.add(d,new vect(-e,e)),h=vect.add(d,new vect(e,-e)),c=new J(a.camera.project(c),a.camera.project(h)),c=g.search(c),h=0;h<c.length;h++)for(var f=c[h].ref,k=y.derivedStyle(f,b,a,"radius"),h=0;h<f.geom.length;h++){var m=a.camera.screen(geom2vect(f.geom[h]));if(vect.dist(m,d)<k)return new t([f.ref])}return new t([])}},Ya=function(a,b){var c=
[];b.features().each(function(a,b){$.each(b.geom,function(a,d){$.each(d,function(a,d){$.each(d,function(a,d){c.push({ref:b,x:d[0],y:d[1]})})})})});var d=new ia(c);this.boxSearch=function(a){var c=d.search(a),l={};$.each(c,function(a,b){l[b.ref.id]=b.ref});b.features().each(function(b,d){for(var c=0;4>c;c++)d.contains(a.vertex(c))&&(l[d.id]=d)});var c=[],j;for(j in l)c.push(l[j]);return new t(c)};this.pointSearch=function(a){var d=[];b.feature().each(function(b,c){c.contains(a)&&d.push(c)});return new t(d)}},
ma=function(a){this.id=M();this.type="Feature";this.type=a.type;var b=a.attr;this.attr=function(a,d){if(void 0===d)return b[a];throw"Not Implemented";};this.geom=a.geom;this.geometry=function(){};this.style=function(a,b,e){var g;!a||"Engine"==a.type?(g=a,a=b,b=e):g=null;if(void 0===b)return y.getStyle(this,g,a);y.setStyle(this,g,a,b);return this}},M,Ca=1;M=function(){var a=Ca;Ca++;return a};var sa;sa=function(a,b){return new vect(a+1E-6*Math.random()-5E-7,b+1E-6*Math.random()-5E-7)};var Ua={Point:function(a,
b){ma.call(this,a,b);this.bounds=null;for(var c=0;c<this.geom.length;c++){var d=new vect(this.geom[c][0],this.geom[c][1]),d=new J(d.clone(),d.clone());this.bounds?this.bounds.union(d):this.bounds=d}this.map_contains=function(a,d){for(var c=y.derivedStyle(this,b,a,"radius"),f=0;f<this.geom.length;f++){var h=a.camera.screen(new vect(this.geom[f][0],this.geom[f][1]));if(vect.dist(h,d)<c)return!0}return!1}},Polygon:function(a,b){ma.call(this,a,b);this.bounds=wa(this.geom);this.map_contains=function(a,
b){return this.contains(a.camera.project(b))};this.contains=function(a){var b=0;if(this.bounds.contains(a)){b++;for(b=0;b<this.geom.length;b++){var e=0;$.each(this.geom[b],function(b,d){for(var f=0;f<d.length;f++){var h=(f+1)%d.length;if(0>(a.y-d[f][1])/(a.y-d[h][1])){var k=new vect(720,a.y),m=new vect(d[f][0],d[f][1]),h=new vect(d[h][0],d[h][1]);vect.intersects(a,k,m,h)&&e++}}});if(1==e%2)return!0}}return!1}},Line:function(a,b){ma.call(this,a,b);this.bounds=wa(this.geom);this.map_contains=function(){return!1}}},
A=null,t=function(a){var b=null;this.length=a.length;this.count=function(){return a.length};this.items=function(){return a};this.type=function(b){for(var c=[],g=0;g<a.length;g++)a[g].type==b&&c.push(a[g]);return new t(c)};this.join=function(b){for(var c=[],g=0;g<a.length;g++)c.push(a[g]);for(g=0;g<b.count();g++){var f=b.get(g);this.id(f.id)||c.push(f)}return new t(c)};this.attr=function(){throw"Not Implemented";};this.get=function(b){return a[b]};this.subset=function(b){for(var c=[],g=0;g<b.length;g++)c.push(a[b[g]]);
return new t(c)};this.id=function(d){if(!b){b={};for(var c=0;c<a.length;c++)b[a[c].id]=a[c]}return d in b?b[d]:null};this.each=function(b){for(var c=0;c<a.length;c++)b(c,a[c]);return this};var c={">":function(a,b){return a>b},"<":function(a,b){return a<b},"==":function(a,b){return a==b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=b}};this.select=function(b){if(b.match(/^\s*\*\s*$/))return new t(a);var e=b.match(/^\s*([^\s]+)\s*([=<>]+)\s*(([^\s])+)\s*$/);if(!e)throw"Bad Selector";
b=e[1];var g=e[2],f=null,j=null;isNaN(e[3])?j=e[3]:f=parseFloat(e[3]);new_elem=[];if(j)for(e=0;e<a.length;e++)c[g](a[e].attr(b),a[e].attr(j))&&new_elem.push(a[e]);else for(e=0;e<a.length;e++)c[g](a[e].attr(b),f)&&new_elem.push(a[e]);return new t(new_elem)};this.filter=function(b){for(var c=[],g=0;g<a.length;g++)b(a[g])&&c.push(a[g]);return new t(c)};this.quantile=function(b,c,g){var f=a.filter(function(a){return void 0!==a.attr(b)});f.sort(function(a,c){return a.attr(b)-c.attr(b)});var j=Math.round(c*
f.length/g);c=Math.round((c-1)*f.length/g);return new t(f.slice(c,j))};this.range=function(b){for(var c=Infinity,g=-Infinity,f=!1,j=0;j<a.length;j++){var h=a[j].attr(b);isNaN(h)||(f=!0,c>h&&(c=h),g<h&&(g=h))}return!f?null:{min:c,max:g}};this.style=function(b,c,g){var f,j,h;"Engine"==b.type?(f=b,j=c,h=g):(f=null,j=b,h=c);if(void 0===h){if(a[0])return a[0].style(f,j)}else return $.each(a,function(a,b){b.style(f,j,"function"==typeof h?h(b):Ea(h)?h[a]:h)}),this}},u=null,L=null,u=null,Va=1E3,ka=0,S=8,
Aa=0,za=0,Da=[];window.wiggle={Map:function(a,b){void 0===b&&(b={});f(b,{width:360,center:new vect(0,0)});ta.call(this,a,b);f(b,{base:"default","tile-server":"http://eland.ecohealthalliance.org/wigglemaps",min:new vect(-180,-90),max:new vect(180,90)});this.Renderers={Point:Ha,Polygon:La,Line:ga};this.styles={Point:{fill:new q(0.02,0.44,0.69,1),opacity:1,radius:5,stroke:"none","stroke-width":2},Polygon:{fill:new q(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new q(0.02,0.44,0.69,1),"stroke-opacity":1,
"stroke-width":0.75},Line:{stroke:new q(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":2},"default":{fill:new q(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new q(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":1}};var c=null;"default"==b.base||"nasa"==b.base?(c=k(b),m(c,{source:"file",url:b["tile-server"]+"/tiles/nasa_topo_bathy",levels:8,size:256}),c=new ba(c)):"ne"==b.base?(c=k(b),m(c,{source:"file",url:b["tile-server"]+"/tiles/NE1_HR_LC_SR_W_DR",levels:6,size:256}),c=new ba(c)):"ne1"==
b.base?(c=k(b),m(c,{source:"file",url:TILE_SERVER+"/tiles/NE1_HR_LC",levels:6,size:256}),c=new ba(c)):c=null;c&&(c.initialize(this),this.scene.push(c))},TimeSeries:function(a,b){void 0===b&&(b={});ta.call(this,a,b);f(b,{range:new J(new vect(0,0),new vect(1,1))});this.styles={"default":{fill:new q(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new q(0.02,0.44,0.69,1),"stroke-opacity":1,"stroke-width":2}};this.Renderers={"default":Oa}},layer:{Layer:aa,Grid:ja,Hillshade:ya,Elevation:function(a){L||(L=w(x+
"shaders/elevation"));var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),d=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var e=W(a),g=D(v(new vect(0,1),new vect(1,0)),2),f=D(v(c,d),2);this.draw=function(a,b,k){k||(gl.useProgram(L),L.data("screen",a.camera.mat3),L.data("pos",f),L.data("tex_in",g),L.data("elevation",e),vect.sub(a.camera.screen(d),a.camera.screen(c)),
gl.drawArrays(gl.TRIANGLES,0,f.numItems))}},Raster:xa},io:{Shapefile:function(a){var b=a.path;$.ajax({url:b+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(c){for(var d=[],e=100;e<c.length;)d.push(2*ca(c,e)),e+=8;$.ajax({url:b+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(b){for(var c=[],e=[],f=0;f<d.length;f++){var k=d[f];ca(b,k);ca(b,k+4);var m=k+8,p=C(b,m);if(0==p)console.log("NULL Shape");else if(1==p)p=U(b,m+4),m=U(b,m+12),c.push({type:"Point",attr:{},
geom:[[p,m]]});else if(5==p){for(var p=C(b,m+36),m=C(b,m+40),q=k+52,k=k+52+4*p,t=[],u=0;u<p;u++){var v=C(b,q+4*u),B;B=u+1<p?C(b,q+4*(u+1)):m;var x=k,y=[];for(B-=1;B>=v;B--){var z=U(b,x+16*B),A=U(b,x+16*B+8);y.push([z,A])}t.push(y)}e.push({type:"Polygon",attr:{},geom:[t]})}else throw"Not Implemented: "+p;}if(0<c.length){var w=new aa(a);$.each(c,function(a,b){w.append(b)});b=w}else 0<e.length?(w=new aa(a),$.each(e,function(a,b){w.append(b)}),b=w):b=void 0;a.success(b)}})}})},GeoJSON:function(a,b){void 0===
b&&(b={});for(var c=new aa(b),d=0;d<a.features.length;d++){var e=a.features[d];if("Feature"==e.type){"Point"==e.geometry.type&&c.append({type:"Point",geom:[e.geometry.coordinates],attr:e.properties});"MultiPoint"==e.geometry.type&&c.append({type:"Point",geom:e.geometry.coordinates,attr:e.properties});if("Polygon"==e.geometry.type){for(var g=e.geometry.coordinates,f=[],j=0;j<=g.length-1;j++){for(var h=[],k=g[j].length-1;0<=k;k--)h.push(g[j][k]);f.push(h)}c.append({type:"Polygon",geom:[f],attr:e.properties})}if("MultiPolygon"==
e.geometry.type){var m=[];$.each(e.geometry.coordinates,function(a,b){for(var c=[],d=0;d<=b.length-1;d++){for(var e=[],g=b[d].length-1;0<=g;g--)e.push(b[d][g]);c.push(e)}m.push(c)});c.append({type:"Polygon",geom:m,attr:e.properties})}"MultiLineString"==e.geometry.type&&$.each(e.geometry.coordinates,function(a,b){c.append({type:"Line",geom:[[b]],attr:e.properties})})}}return c},KML:function(a){var b=$(a).find("LatLonBox"),c=new vect(parseFloat(b.find("west").text()),parseFloat(b.find("south").text())),
b=new vect(parseFloat(b.find("east").text()),parseFloat(b.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();return new xa(x+a,c,b)},SparseGrid:function(a,b){var c=V(a,0),d=V(a,4),e=C(a,8),g=C(a,12),f=V(a,16),j={};for(key in b)j[key]=b[key];j.lower=new vect(c,d);j.upper=new vect(c+f*e,d+f*g);j.rows=g;j.cols=e;c=new ja(j);for(d=20;d<a.length;){for(var f=C(a,d),e=C(a,d+4),g=d+4,j=e,h=0;h<j;h++){var k=V(a,g+4*h);c.raw_set(f+h,k)}d+=8+4*e}return c},AsciiGrid:function(a,b){var c=a.split("\n"),
d=c.splice(0,6),e=parseInt(d[0].slice(14)),g=parseInt(d[1].slice(14)),f=parseFloat(d[2].slice(14)),j=parseFloat(d[3].slice(14)),h=parseFloat(d[4].slice(14)),d=d[5].slice(14),k={};for(key in b)k[key]=b[key];k.lower=new vect(f,j);k.upper=new vect(f+h*e,j+h*g);k.rows=g;k.cols=e;f=new ja(k);for(j=0;j<g;j++){h=c[j].split(" ");for(k=0;k<e;k++)h[k]==d?f.set(g-1-j,k,NaN):f.set(g-1-j,k,parseFloat(h[k]))}return f},WMS:function(a){a=k(a);for(var b=["url","layer"],c=0;c<b.length;c++){var d=b[c];if(!(d in a))throw"Key "+
d+" not found";}f(a,{levels:16,size:256});var b={source:"wms"},e;for(e in b)a[e]=b[e];return new ba(a)}},util:{fcolor:na,icolor:function(a,b,c,d){return new q(p(a/255,0,1),p(b/255,0,1),p(c/255,0,1),p(d/255,0,1))},Box:J,RangeTree:ia},widget:{Slider:function(a,b,c){var d=function(a){if(a>=c)throw"Slider index out of bounds";return b.x/(c-1)*a},e=function(d){return d<=a.x?0:d>=a.x+b.x?c-1:Math.round((d-a.x)/b.x*(c-1))};this.dom=$("<div></div>").addClass("slider-container").css("position","relative").css("left",
a.x).css("top",a.y).css("width",b.x).css("height",b.y);var f=!1,k=0,j=$("<div></div>").addClass("slider-box").css("position","relative").css("left",-10).css("height",b.y).css("width",20).mousedown(function(){f=!0});this.tick=function(){return k};this.count=function(){return c};var h=function(){};this.change=function(a){h=a};var m=function(){};this.release=function(a){m=a};this.dragging=function(){return f};this.dom.append(j);this.set=function(a){a!=k&&h(a);k=a;var b=d(a);j.css("left",b-10);m(a)};
$(document).bind("mouseup",function(){if(f){f=!1;var a=e(event.clientX);m(a)}});$(document).bind("mousemove",function(a){f&&(a=e(a.clientX),a!=k&&h(a),k=a,a=d(a),j.css("left",a-10))})}},ready:function(a){Da.push(a)}};$(document).ready(function(){$('script[src*="wigglemaps"]').each(function(a,b){var c=/wigglemaps(\.min)?\.js/;$(b).attr("src").match(c)&&(x=$(b).attr("src").replace(c,""))});$.each(Da,function(a,b){b()})})})();
