function vect(h,p,q){this.x=h;this.y=p;this.z=q?q:0;this.add=function(m){this.x+=m.x;this.y+=m.y;this.z+=m.z};this.sub=function(m){this.x-=m.x;this.y-=m.y;this.z-=m.z};this.scale=function(m){this.x*=m;this.y*=m;this.z*=m};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.normalize=function(){var m=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);0!=m&&(this.x/=m,this.y/=m,this.z/=m)};this.div=function(m){this.x/=m.x;this.y/=m.y;this.z/=m.z};this.floor=function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z)};this.zero=function(){return 0==this.x+this.y+this.z};this.dot=function(m){return this.x*m.x+this.y*m.y+this.z*m.z};this.cross=function(){throw"Need to reimplement";};this.rotate=function(m){var h=Math.cos(m);m=Math.sin(m);xp=h*this.x-m*this.y;yp=m*this.x+h*this.y;this.x=xp;this.y=yp;return this};this.clone=function(){return new vect(this.x,this.y,this.z)}}vect.scale=function(h,p){return new vect(h.x*p,h.y*p,h.z*p)};
vect.add=function(h,p){return new vect(h.x+p.x,h.y+p.y,h.z+p.z)};vect.sub=function(h,p){if(!h||!p)throw"Bad Vector";return new vect(h.x-p.x,h.y-p.y,h.z-p.z)};vect.dist=function(h,p){var q=p.x-h.x,m=p.y-h.y,s=p.z-h.z;return Math.sqrt(q*q+m*m+s*s)};vect.dir=function(h,p){var q=vect.sub(h,p);q.normalize();return q};vect.dot2d=function(h,p){return h.x*p.x+h.y*p.y};vect.cross=function(h,p){return h.x*p.y-h.y*p.x};
vect.left=function(h,p,q,m){m||(m=0);p=vect.sub(p,h);h=vect.sub(q,h);return vect.cross(p,h)>=-m};vect.intersects=function(h,p,q,m,s){s||(s=0);return vect.left(h,p,q,s)!=vect.left(h,p,m,s)&&vect.left(q,m,p,s)!=vect.left(q,m,h,s)};vect.intersect2dt=function(h,p,q,m){m=h.x*(m.y-q.y)+p.x*(q.y-m.y)+m.x*(p.y-h.y)+q.x*(h.y-p.y);return 0==m?Infinity:-(h.x*(q.y-p.y)+p.x*(h.y-q.y)+q.x*(p.y-h.y))/m};
vect.intersect2dpos=function(h,p,q,m){var s=h.x*(m.y-q.y)+p.x*(q.y-m.y)+m.x*(p.y-h.y)+q.x*(h.y-p.y);if(0==s)return Infinity;q=(h.x*(m.y-q.y)+q.x*(h.y-m.y)+m.x*(q.y-h.y))/s;p=vect.sub(p,h);p.scale(q);return vect.add(h,p)};vect.rotate=function(h,p){var q=Math.cos(p),m=Math.sin(p);xp=q*h.x-m*h.y;yp=m*h.x+q*h.y;return h=new vect(xp,yp,h.z)};
(function(){function h(a,e){for(var d in e)d in a||(a[d]=e[d])}function p(a){var e={};for(key in a)e[key]=a[key];return e}function q(a,e){for(key in e)a[key]=e[key]}function m(a,e,d){return Math.min(Math.max(a,e),d)}function s(a,e,d,b){1>=a&&1>=e&&1>=d&&1>=b?(this.r=a,this.g=e,this.b=d,this.a=b):(this.r=a/255,this.g=e/255,this.b=d/255,this.a=b/255);this.array=[this.r,this.g,this.b,this.a];this.vect=function(){return this.array};this.rgb=function(){return"rgb("+parseInt(255*this.r)+","+parseInt(255*
this.g)+","+parseInt(255*this.b)+")"}}function va(a,e,d,b){return new s(m(a,0,1),m(e,0,1),m(d,0,1),m(b,0,1))}function ga(a,e){return((a.charCodeAt(e)&255)<<24)+((a.charCodeAt(e+1)&255)<<16)+((a.charCodeAt(e+2)&255)<<8)+(a.charCodeAt(e+3)&255)}function F(a,e){return((a.charCodeAt(e+3)&255)<<24)+((a.charCodeAt(e+2)&255)<<16)+((a.charCodeAt(e+1)&255)<<8)+(a.charCodeAt(e)&255)}function Z(a,e){var d=a.charCodeAt(e)&255,b=a.charCodeAt(e+1)&255,c=a.charCodeAt(e+2)&255,f=a.charCodeAt(e+3)&255,k=a.charCodeAt(e+
4)&255,j=a.charCodeAt(e+5)&255,g=a.charCodeAt(e+6)&255,l=a.charCodeAt(e+7)&255,n=1-2*(l>>7),l=((l&127)<<4)+((g&240)>>4)-1023,d=(g&15)*Math.pow(2,48)+j*Math.pow(2,40)+k*Math.pow(2,32)+f*Math.pow(2,24)+c*Math.pow(2,16)+b*Math.pow(2,8)+d;return n*(1+d*Math.pow(2,-52))*Math.pow(2,l)}function aa(a,e){var d=a.charCodeAt(e)&255,b=a.charCodeAt(e+1)&255,c=a.charCodeAt(e+2)&255,f=a.charCodeAt(e+3)&255,k=1-2*(f>>7),f=((f&127)<<1)+((c&254)>>7)-127,d=(c&127)*Math.pow(2,16)+b*Math.pow(2,8)+d;return k*(1+d*Math.pow(2,
-23))*Math.pow(2,f)}function wa(a,e,d,b){return[a-d,e+b,a-d,e-b,a+d,e+b,a-d,e-b,a+d,e-b,a+d,e+b]}function u(a,e,d){return 2==arguments.length?[a.x,e.y,a.x,a.y,e.x,e.y,a.x,a.y,e.x,a.y,e.x,e.y]:[a.x,e.y,d,a.x,a.y,d,e.x,e.y,d,a.x,a.y,d,e.x,a.y,d,e.x,e.y,d]}function B(a,e){if(!a)return null;var d=a.createProgram(),b=xa(a,a.VERTEX_SHADER,e+"/vert.glsl"),c=xa(a,a.FRAGMENT_SHADER,e+"/frag.glsl");a.attachShader(d,b);a.attachShader(d,c);a.linkProgram(d);var f={},b=(b.source+c.source).match(/((uniform)|(attribute)) (\w+) (\w+)/mg),
c=0;a.useProgram(d);if(b){for(var k=0;k<b.length;k++){var j=b[k].split(" ");f[j[2]]={u:j[0],type:j[1],loc:null};if("uniform"==j[0])f[j[2]].loc=a.getUniformLocation(d,j[2]);else{var g=a.getAttribLocation(d,j[2]);f[j[2]].loc=g}"sampler2D"==j[1]&&(f[j[2]].tex=c,c++)}d.get=function(a){return f[a].loc};d.data=function(b,c){var d=f[b];if(!d)throw"Could not find shader variable "+b;if("uniform"==d.u)if("float"==d.type)a.uniform1f(d.loc,c);else if("vec2"==d.type)a.uniform2fv(d.loc,c);else if("ivec2"==d.type)a.uniform2iv(d.loc,
c);else if("vec3"==d.type)a.uniform3fv(d.loc,c);else if("ivec3"==d.type)a.uniform3iv(d.loc,c);else if("vec4"==d.type)a.uniform4fv(d.loc,c);else if("ivec4"==d.type)a.uniform4iv(d.loc,c);else if("bool"==d.type)a.uniform1i(d.loc,c);else if("mat4"==d.type)a.uniformMatrix4fv(d.loc,!1,c);else if("mat3"==d.type)a.uniformMatrix3fv(d.loc,!1,c);else if("sampler2D"==d.type)"texture"in c&&(c=c.texture()),a.activeTexture(a["TEXTURE"+d.tex]),a.bindTexture(a.TEXTURE_2D,c),a.uniform1i(d.loc,d.tex);else if("int"==
d.type)a.uniform1i(d.loc,c);else throw"Unsupported Type for Shader Helper: "+d.type;else if("attribute"==d.u)a.enableVertexAttribArray(d.loc),a.bindBuffer(a.ARRAY_BUFFER,c),a.vertexAttribPointer(d.loc,c.itemSize,a.FLOAT,!1,0,0);else throw"Type: "+d.u+" Recieved";}}return d}function xa(a,e,d){var b=a.createShader(e);$.ajax({async:!1,url:d,dataType:"text",success:function(c){a.shaderSource(b,c);a.compileShader(b);if(!a.getShaderParameter(b,a.COMPILE_STATUS))throw a.getShaderInfoLog(b);b.source=c},error:function(){console.log("Could not load "+
d)}});return b}function G(a,e,d){var b=a.createBuffer(),c=new Float32Array(e);a.bindBuffer(a.ARRAY_BUFFER,b);b.itemSize=d;b.numItems=e.length/d;a.bufferData(a.ARRAY_BUFFER,c,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return b}function ha(a,e,d){if(!a)return null;var b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);var c=new Float32Array(e*d);b.itemSize=d;b.numItems=e;b.update=function(c,d){var e=new Float32Array(c);a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferSubData(a.ARRAY_BUFFER,4*d,e);a.bindBuffer(a.ARRAY_BUFFER,
null)};a.bufferData(a.ARRAY_BUFFER,c,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);return b}function ba(a,e,d){var b=a.createTexture();b.id=ya;ya++;var c=new Image;c.onload=function(){a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,
a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);d&&d()};c.src=e;return b}function ia(a,e){var d=p(e);h(d,{mag_filter:a.LINEAR,min_filter:a.LINEAR,wrap_s:a.CLAMP_TO_EDGE,wrap_t:a.CLAMP_TO_EDGE,mipmap:!1});var b=a.createTexture(),c=null;this.image=function(e){c=e;a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d.mag_filter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d.min_filter);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_S,d.wrap_s);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrap_t);d.mipmap&&a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null)};this.texture=function(){return c?b:null}}function za(a,e,d){var b=a.style(d);null===b&&(b=e.style(d),null===b&&(b=Pa[a.type][d]));return b}function Qa(a,e){e||(e={});"center"in e||(e.center=new vect(0,0));"extents"in e||(e.extents=180);this.mat3=new Float32Array(9);var d=a.width()/a.height();this.mat3[0]=2/e.extents;this.mat3[4]=2*d/e.extents;
this.mat3[8]=1;this.mat3[6]=0;this.mat3[7]=0;this.level=1;this.project=function(b){b=new vect(2*(b.x-a.offset().left)/a.width()-1,-(2*(b.y-a.offset().top)/a.height()-1));b.x=b.x/this.mat3[0]-this.mat3[6]/this.mat3[0];b.y=b.y/this.mat3[4]-this.mat3[7]/this.mat3[4];return b};this.screen=function(b){b=new vect(b.x*this.mat3[0]+this.mat3[6],b.y*this.mat3[4]+this.mat3[7]);b.x=a.offset().left+a.width()*(b.x+1)/2;b.y=a.offset().top+a.height()*(-b.y+1)/2;return b};this.percent=function(b){return new vect(2*
((b.x-a.offset().left)/a.width())-1,-(2*((b.y-a.offset().top)/a.height())-1))};this.pixel=function(b){return new vect(a.offset().left+(b.x+1)/2*a.width(),a.offset().top+(-b.y+1)/2*a.height())};this.move=function(a){this.mat3[6]-=a.x*this.mat3[0];this.mat3[7]-=a.y*this.mat3[4]};this.position=function(a){if(!a)return new vect(-this.mat3[6]/this.mat3[0],-this.mat3[7]/this.mat3[4]);this.mat3[6]=-a.x*this.mat3[0];this.mat3[7]=-a.y*this.mat3[4]};this.position(e.center);this.extents=function(a){e.extents=
a;a=this.position();this.level=1;this.mat3[0]=2/e.extents;this.mat3[4]=2*d/e.extents;this.position(a)};this.zoom=function(a){var c=new vect(this.mat3[6]/this.mat3[0],this.mat3[7]/this.mat3[4]);this.mat3[0]*=a;this.mat3[4]*=a;this.mat3[6]=c.x*this.mat3[0];this.mat3[7]=c.y*this.mat3[4];this.level*=a};this.reset=function(){this.zoom(1/this.level)};this.reconfigure=function(){var b=this.position();this.mat3[4]/=d;d=a.width()/a.height();this.mat3[4]*=d;this.position(b)}}function Ra(a){var e=!1,d=new vect(0,
0),b=new vect(0,0),c=null,f=0;a.canvas.mousedown(function(a){d=new vect(a.clientX,a.clientY);e=!0});$(window).bind("mouseup",function(){e=!1});$(document).bind("keypress","+",function(){a.camera.zoom(1.1)});$(document).bind("keypress","-",function(){a.camera.zoom(10/11)});$(document).bind("keypress","0",function(){a.camera.reset()});a.canvas.bind("mousewheel",function(b,c){c*=0.5;0>c?(c=-1*c+1,c=1/c):c+=1;a.camera.zoom(c);b.preventDefault()});var k=!0;this.disable=function(){k=!1};this.enable=function(){k=
!0};this.update=function(j){b=new vect(N.x,N.y);if(e&&k){var g=vect.sub(a.camera.project(d),a.camera.project(b));a.camera.move(g);d=b;f=g.length()/j;c=g;c.normalize()}else 0.01<f&&c&&(a.camera.move(vect.scale(c,f*j)),f-=3*j*f)}}function Sa(a,e,d){d||(d={});h(d,{base:"default",background:new s(0,0,0,1),antialias:!0});var b=this;this.canvas=$("<canvas></canvas>").attr("id","viewer");a?($(a).append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height())):(a=window,
$("body").append(this.canvas),this.canvas.attr("width",$(a).width()),this.canvas.attr("height",$(a).height()),$(window).resize(function(){b.resize()}));this.resize=function(){b.canvas.attr("width",$(a).width());b.canvas.attr("height",$(a).height());c.viewport(0,0,b.canvas.width(),b.canvas.height());b.camera.reconfigure();for(var d=0;d<n.length;d++)n[d].resize()};var c;e=this.canvas;this.gl=c=gl=Ta?WebGLDebugUtils.makeDebugContext(e.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1}),
function(a,b){throw WebGLDebugUtils.glEnumToString(a)+" was caused by call to "+b;}):e.get(0).getContext("experimental-webgl",{alpha:!1,antialias:!0,premultipliedAlpha:!1});c.viewport(0,0,b.canvas.width(),b.canvas.height());c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA);c.enable(c.BLEND);x||(x=B(c,y+"shaders/blur"));Aa||(Aa=B(c,y+"shaders/light"));var f=new O(c,6);f.create("vert",2);f.create("tex",2);e=f.alloc(6);f.write("vert",u(new vect(-1,-1),new vect(1,1)),e,6);f.write("tex",u(new vect(0,0),new vect(1,
1)),e,6);f.update();this.scene=[];this.camera=new Qa(this.canvas,d);this.scroller=new Ra(this);this.pxW=1/this.canvas.attr("width");this.pxH=1/this.canvas.attr("height");this.sel=new Ua(this);this.select=function(a){a?(this.scroller.disable(),this.sel.enable()):(this.scroller.enable(),this.sel.disable())};var k=(new Date).getTime(),j=[];this.attr=function(a,b){"base"==a&&(d.base=b,l())};var g=null,l=function(){if("default"==d.base||"nasa"==d.base){var a=p(d);q(a,{source:"file",url:ka+"/tiles/nasa_topo_bathy",
levels:8,size:256});g=new da(a)}else"ne"==d.base?(a=p(d),q(a,{source:"file",url:ka+"/tiles/NE1_HR_LC_SR_W_DR",levels:6,size:256}),g=new da(a)):"ne1"==d.base?(a=p(d),q(a,{source:"file",url:ka+"/tiles/NE1_HR_LC",levels:6,size:256}),g=new da(a)):g=null;g&&g.initialize(b)};l();this.enable_z=function(){c.depthFunc(c.LEQUAL);c.enable(c.DEPTH_TEST)};this.disable_z=function(){c.disable(c.DEPTH_TEST)};var n=[],r=[null];this.framebuffer=function(){var a=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,
a);a.width=b.canvas.width();a.height=b.canvas.height();var d=c.createTexture();c.bindTexture(c.TEXTURE_2D,d);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a.width,a.height,0,c.RGBA,c.UNSIGNED_BYTE,null);var e=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,
e);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a.width,a.height);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d,0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null);var f={framebuffer:a,renderbuffer:e,tex:d,resize:function(){a.width=b.canvas.width();a.height=b.canvas.height();c.bindTexture(c.TEXTURE_2D,d);c.texImage2D(c.TEXTURE_2D,
0,c.RGBA,a.width,a.height,0,c.RGBA,c.UNSIGNED_BYTE,null);c.bindRenderbuffer(c.RENDERBUFFER,e);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a.width,a.height);c.bindTexture(c.TEXTURE_2D,null);c.bindRenderbuffer(c.RENDERBUFFER,null)},activate:function(d){d||(d={});h(d,{blend:!0,clear:!0});r.push(a);d.blend||c.disable(c.BLEND);c.bindFramebuffer(c.FRAMEBUFFER,a);c.viewport(0,0,b.canvas.width(),b.canvas.height());d.clear&&(c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT),c.clearDepth(0))},
deactivate:function(){var b=r.pop(),d=r[r.length-1];if(b!=a)throw"Non-nested use of framebuffers";c.bindFramebuffer(c.FRAMEBUFFER,d);c.enable(c.BLEND)}};n.push(f);return f};var m=this.framebuffer(),la=this.framebuffer();this.draw_blur=function(a){c.useProgram(x);la.activate({blend:!1});x.data("pos",f.get("vert"));x.data("tex_in",f.get("tex"));x.data("sampler",a);x.data("width",b.canvas.width());x.data("height",b.canvas.height());x.data("hor",!0);c.drawArrays(c.TRIANGLES,0,f.count());la.deactivate();
x.data("pos",f.get("vert"));x.data("tex_in",f.get("tex"));x.data("sampler",la.tex);x.data("width",b.canvas.width());x.data("height",b.canvas.height());x.data("hor",!1);c.drawArrays(c.TRIANGLES,0,f.count())};this.dirty=!0;var Ba=function(){var a=(new Date).getTime(),e=(a-k)/1E3;b.scroller.update(e);60<=j.length&&j.splice(0,1);j.push(e);for(var f=0,l=0;l<j.length;l++)f+=j[l];f/=j.length;$("#fps").text(Math.floor(1/f));k=a;c.clearColor(d.background.r,d.background.g,d.background.b,d.background.a);c.clear(c.COLOR_BUFFER_BIT);
c.clearDepth(0);a=!1;b.shade&&(a=b.shade.ready());a&&m.activate();g&&g.draw(b,e);for(l=0;l<b.scene.length;l++)b.scene[l].draw(b,e,!1);b.sel.draw(b,e);requestAnimationFrame(Ba)};this.read_pixel=function(a,d){c.bindFramebuffer(c.FRAMEBUFFER,b.framebuffer);var e=new Uint8Array(4),f=(a-b.canvas.position().left)/b.canvas.width(),k=(b.canvas.position().top+b.canvas.height()-d)/b.canvas.height();c.readPixels(parseInt(f*b.framebuffer.width),parseInt(k*b.framebuffer.height),1,1,c.RGBA,c.UNSIGNED_BYTE,e);c.bindFramebuffer(c.FRAMEBUFFER,
null);return e};$(document).mousemove(function(a){N.x=a.clientX;N.y=a.clientY});this.canvas.click(function(){});this.canvas.dblclick(function(){});var z=!1;this.canvas.mousedown(function(){z=!0});this.canvas.mouseup(function(){z=!1});this.canvas.mousemove(function(){if(!z){var a=new vect(N.x,N.y);$.each(b.scene,function(c,d){d.update_move&&d.update_move(b,a)})}});this.canvas.mouseout(function(){$.each(b.scene,function(a,c){c.force_out&&c.force_out(b)})});requestAnimationFrame(Ba)}function O(a,e){var d=
{},b;b=e?e:256;var c=0,f=function(a,b,c,d){a||console.log("ack");c||(c=0);d||(d=b.length);for(var e=0;e<d;e++)a[c+e]=b[e]};this.create=function(c,e){if(!e)throw"Length of buffer must be a positive integer";var f=new Float32Array(b*e),l=ha(a,b,e);d[c]={array:f,buffer:l,len:e,dirty:!1}};this.alloc=function(e){if(c+e>=b){for(var j=b;j<c+e;)j*=2;b=j;for(name in d){var g=new Float32Array(j*d[name].len),l=d[name].array,n=ha(a,b,d[name].len);f(g,l);d[name].array=g;d[name].buffer=n;d[name].dirty=!0}}j=c;
c+=e;return j};this.get=function(a){return d[a].buffer};this.write=function(a,b,c,e){f(d[a].array,b,c*d[a].len,e*d[a].len);d[a].dirty=!0};this.repeat=function(a,b,c,e){for(var n=0;n<e;n++)f(d[a].array,b,(c+n)*d[a].len,d[a].len);d[a].dirty=!0};this.count=function(){return c};this.data=function(a){return d[a].array};this.update=function(){for(name in d)d[name].dirty&&(d[name].buffer&&d[name].buffer.update(d[name].array,0),d[name].dirty=!1)}}function Ua(a){U||(U=B(a.gl,y+"shaders/selbox"));var e=!1,
d=!1,b=null,c=null,f=ha(a.gl,6,2),k=G(a.gl,wa(0,0,1,1),2);a.canvas.bind("mousedown",function(g){e&&(show=d=!0,c=b=a.camera.percent(new vect(g.clientX,g.clientY)),f.update(u(b,c),0))});var j=function(){};this.select=function(a){j=a};$(document).bind("mouseup",function(){if(e&&d){var f=a.camera.project(a.camera.pixel(b)),k=a.camera.project(a.camera.pixel(c));if(f.x>k.x){var n=f.x;f.x=k.x;k.x=n}f.y>k.y&&(n=f.y,f.y=k.y,k.y=n);d=!1;j(new V(f,k))}});$(document).bind("click",function(){e&&(show=!1)});$(document).bind("mousemove",
function(k){e&&d&&(c=a.camera.percent(new vect(k.clientX,k.clientY)),f.update(u(b,c),0))});this.enable=function(){e=!0};this.disable=function(){e=!1};this.draw=function(){d&&(gl.useProgram(U),U.data("pos",f),U.data("edge_in",k),gl.drawArrays(gl.TRIANGLES,0,f.numItems))}}function Ca(a,e){for(;a>=e;)a-=e;for(;0>a;)a+=e;return a}function Va(a,e,d,b){this.current=a;this.upper=e;this.lower=d;this.index=b}function Da(a,e){for(var d=0;d<a.length;d++)if(a[d]==e)return!0;return!1}function fa(a,e,d){if(void 0==
e)throw"whoa";return 0==a[e+1].y-a[e].y?Math.min(a[e].x,a[e+1].x):a[e].x+(a[e+1].x-a[e].x)*((d-a[e].y)/(a[e+1].y-a[e].y))}function P(a,e){for(var d=0;d<a.length;d++)if(a[d]==e)return d;return!1}function C(a,e,d){return new vect(fa(e,d,e[a].y),e[a].y)}function H(a,e){if(!e)throw"eek";a.push(e.x);a.push(e.y)}function Q(a,e,d){if(!e||!d||3!=d.length+e.length&&4!=d.length+e.length)throw"ahh";if(3==e.length+d.length){for(var b=0;b<e.length;b++)H(a,e[b]);for(b=0;b<d.length;b++)H(a,d[b])}else e[1].x<e[0].x&&
(b=e[0],e[0]=e[1],e[1]=b),d[1].x<d[0].x&&(b=d[0],d[0]=d[1],d[1]=b),H(a,e[0]),H(a,e[1]),H(a,d[1]),H(a,d[0]),H(a,d[1]),H(a,e[0])}function Wa(a){for(var e=[],d=0,b=[],c=0;c<a.length;c++){for(var f=0;f<a[c].length-1;f++){var k=Ca(f+1,a[c].length-1),j=Ca(f-1,a[c].length-1);e.push(new Va(f+d,k+d,j+d,c));b.push(a[c][f])}b.push(a[c][0]);d+=a[c].length}e.sort(function(a,c){return b[a.current].y-b[c.current].y});a=[];c=[];new vect(-200,0);new vect(200,0);d=0;d=[];j=[];for(f=0;f<e.length;f++){var g=e[f],k=Da(a,
g.lower),l=Da(a,g.current),n,r;if(k&&!l)r=n=P(a,g.lower);else if(l&&!k)n=r=P(a,g.current);else if(k&&l)n=P(a,g.lower),r=P(a,g.current);else if(!k&&!l){a:{n=a;r=b;for(var m=b[g.current].x,h=b[g.current].y,p=0;p<n.length;p++){var z=fa(r,n[p],h);if(z>m||0==z-m&&r[n[p]].y>r[index].y){r=p;break a}}r=n.length}n=r}if(1<Math.abs(n-r)){for(k=0;k<a.length;k++);throw"Bad";}m=vect.left(b[g.lower],b[g.current],b[g.upper]);h=Math.floor(Math.min(n,r)/2);!m&&!k&&!l?(Q(j,c[h],[C(g.current,b,a[r-1]),C(g.current,b,
a[r])]),c.splice(h,1,[C(g.current,b,a[r-1]),b[g.current]],[b[g.current],C(g.current,b,a[n])])):m&&!k&&!l?c.splice(h,0,[b[g.current]]):k&&!l?(Q(j,c[h],[C(g.current,b,a[Math.max(n,r)-1]),b[g.current]]),c[h]=[C(g.current,b,a[Math.min(n,r)-1]),b[g.current]]):!k&&l?(Q(j,c[h],[b[g.current],C(g.current,b,a[Math.min(r,n)+1])]),c[h]=[b[g.current],C(g.current,b,a[Math.max(r,n)+1])]):!m&&k&&l?(Q(j,c[h],[C(g.current,b,a[Math.min(n,r)-1]),b[g.current]]),Q(j,c[h+1],[C(g.current,b,a[Math.max(n,r)+1]),b[g.current]]),
c.splice(h,2,[C(g.current,b,a[Math.min(n,r)-1]),C(g.current,b,a[Math.max(n,r)+1])])):m&&(k&&l)&&(Q(j,c[h],[b[g.current]]),c.splice(h,1));k&&!l?a[n]=g.current:l&&!k?a[r]=g.lower:k&&l?(a.splice(P(a,g.lower),1),a.splice(P(a,g.current),1)):!k&&!l&&(m?a.splice(n,0,g.lower,g.current):a.splice(n,0,g.current,g.lower));for(k=0;k<a.length-1;k++)if(fa(b,a[k],b[g.current].y)>fa(b,a[k+1],b[g.current].y))throw console.log("Misplaced Sweep"),"Misplace!";}if(0<a.length)throw console.log(a),"Bad "+a.length;if(0<d.length)throw console.log(d),
"Wrong";return j}function V(a,e){this.min=a.clone();this.max=e.clone();this.contains=function(d){return a.x<=d.x&&e.x>=d.x&&a.y<=d.y&&e.y>=d.y};this.x_in=function(d){return a.x<=d.x&&e.x>=d.x};this.x_left=function(d){return a.x>=d.x};this.x_right=function(a){return e.x<=a.x};this.y_in=function(d){return a.y<=d.y&&e.y>=d.y};this.y_left=function(d){return a.y>=d.y};this.y_right=function(a){return e.y<=a.y};this.area=function(){return(this.max.x-this.min.x)*(this.max.y-this.min.y)};this.height=function(){return this.max.y-
this.min.y};this.width=function(){return this.max.x-this.min.x};this.vertex=function(a){switch(a){case 0:return this.min.clone();case 1:return new vect(this.max.x,this.min.y);case 2:return this.max.clone();case 3:return new vect(this.min.x,this.max.y);default:throw"Index out of bounds: "+a;}};this.intersects=function(a){for(var b=0;4>b;b++)for(var c=0;4>c;c++)if(vect.intersects(this.vertex(b),this.vertex((b+1)%4),a.vertex(c),a.vertex((c+1)%4)))return!0;return this.contains(a.min)&&this.contains(a.max)&&
this.contains(new vect(a.min.x,a.max.y))&&this.contains(new vect(a.max.x,a.min.y))||a.contains(this.min)&&a.contains(this.max)&&a.contains(new vect(this.min.x,this.max.y))&&a.contains(new vect(this.max.x,this.min.y))?!0:!1};this.union=function(a){this.min.x=Math.min(this.min.x,a.min.x);this.min.y=Math.min(this.min.y,a.min.y);this.max.x=Math.max(this.max.x,a.max.x);this.max.y=Math.max(this.max.y,a.max.y)};this.centroid=function(){return new vect((this.max.x+this.min.x)/2,(this.max.y+this.min.y)/2)};
this.clone=function(){return new V(a,e)}}function ma(a,e,d,b){this.data=a[b];this.right=this.left=null;e!=b&&(this.left=new ma(a,e,b-1,parseInt((e+(b-1))/2)));d!=b&&(this.right=new ma(a,b+1,d,parseInt((d+(b+1))/2)));this.subtree=[];for(b=e;b<=d;b++)this.subtree.push(a[b]);this.subtree.sort(function(a,b){return a.y-b.y});this.yrange=function(a,b,d){return a.y_in(this.subtree[b])&&a.y_in(this.subtree[d])};this.subquery=function(a,b,d,e,g){if(this.yrange(b,d,e))for(b=d;b<=e;b++)a.push(this.subtree[b]);
else b.y_in(this.subtree[g])&&a.push(this.subtree[g]),b.y_left(this.subtree[g])?g!=e&&this.subquery(a,b,g+1,e,parseInt((e+(g+1))/2)):(b.x_right(this.subtree[g])||g!=e&&this.subquery(a,b,g+1,e,parseInt((e+(g+1))/2)),g!=d&&this.subquery(a,b,d,g-1,parseInt((d+(g-1))/2)))};this.search=function(b,f){f.x_in(a[e])&&f.x_in(a[d])?this.subquery(b,f,0,this.subtree.length-1,parseInt((this.subtree.length-1)/2)):(f.contains(this.data)&&b.push(this.data),f.x_left(this.data)?this.right&&this.right.search(b,f):f.x_right(this.data)?
this.left&&this.left.search(b,f):(this.left&&this.left.search(b,f),this.right&&this.right.search(b,f)))}}function Ea(a){a.sort(function(a,d){return a.x-d.x});0<a.length?this.root=new ma(a,0,a.length-1,parseInt((a.length-1)/2)):null==this.root;this.search=function(a){if(!this.root)return[];a=a.clone();var d=[];this.root.search(d,a);return d}}function na(){this.views=[];this.update=function(a){for(var e=0;e<views.length;e++)this.views[e].update(a)};this.view_factory=function(){throw"Not Implemented";
};this.create=function(a){a=this.view_factory(a);this.views.push(a);return a}}function oa(a,e){this.style_map={};this.update=function(d){var b=za(a,e,d);if(null===b)throw"Style property does not exist";this.style_map[d](b)};this.update_all=function(){for(var a in this.style_map)this.update(a)}}function Fa(a,e){na.call(this,a,e);E||(E=B(a.gl,y+"shaders/line"));var d=new O(a.gl,1024);d.create("vert",2);d.create("norm",2);d.create("color",3);d.create("alpha",1);var b=function(a){oa.call(this,a,e);var b=
d.count(),k=0;this.style_map={stroke:function(a){d.repeat("color",a.array,b,k)},"stroke-opacity":function(a){d.repeat("alpha",[a],b,k)}};$.each(a.geom,function(a,b){for(a=0;a<b.length;a++)k+=6*b[a].length,Xa(d,b[a])});this.update_all()};this.view_factory=function(a){return new b(a,e)};this.draw=function(){d.update();gl.useProgram(E);E.data("screen",a.camera.mat3);E.data("pos",d.get("vert"));E.data("norm",d.get("norm"));E.data("color_in",d.get("color"));E.data("alpha_in",d.get("alpha"));E.data("px_w",
2/a.canvas.width());E.data("px_h",2/a.canvas.height());gl.drawArrays(gl.TRIANGLES,0,d.count())}}function Ga(a){var e={},d={},b=!1,c={},f={},k=!1;if(a.style)for(var j in a.style)c[j]=a.style[j];this.style=function(a,d){if(2>arguments.length)return void 0!==c[a]?c[a]:null;c[a]=d;if(b)for(var f in e)e[f].update(a)};this.bounds=null;this.features=function(){var a=[],b;for(b in f)a.push(f[b]);return new t(a)};this.search=function(a){k&&this.update();var b=new t([]),c;for(c in d)var e=d[c].search(a),b=
b.join(e);return b};this.map_contains=function(a,b){k&&this.update();var c=new t([]),e;for(e in d)var f=d[e].map_contains(a,b),c=c.join(f);return c};this.append=function(a){a=new W[a.type].geometry(a,this);f[a.id]=a;this.bounds?this.bounds.union(a.bounds):this.bounds=a.bounds.clone();b&&a.initialize(e[a.type]);k=!0};var g=null,l=null;this.mouseover=function(a){g=a};this.mouseout=function(a){l=a};var n={};this.update_move=function(a,b){if(g||l){var c=this.map_contains(a,b),d={};c&&c.each(function(a,
b){d[b.id]=b});for(var e in n)!(e in d)&&l&&l(n[e]);for(e in d)!(e in n)&&g&&g(d[e]);n=d}};this.force_out=function(){for(var a in n)l&&l(n[a]);n={}};this.initialize=function(a){for(var c in W)e[c]=new W[c].renderer(a,this);b=!0;for(var d in f)f[d].initialize(e[f[d].type])};this.update=function(){var a=this.features(),b;for(b in W)d[b]=new W[b].collection(a.type(b).items());k=!1};this.draw=function(){k&&this.update();if(!b)throw"Layer has not yet been initialized";for(var a in e)e[a].draw()}}function Ha(a){var e=
new vect(Infinity,Infinity),d=new vect(-Infinity,-Infinity);$.each(a,function(a,c){$.each(c,function(a,b){$.each(b,function(a,b){b[0]<e.x&&(e.x=b[0]);b[0]>d.x&&(d.x=b[0]);b[1]<e.y&&(e.y=b[1]);b[1]>d.y&&(d.y=b[1])})})});return new V(e,d)}function Xa(a,e){for(var d=a.alloc(6*e.length),b=0,c=function(){if(e[b]){var a=new vect(e[b][0],e[b][1]);b++;return a}return null},f=[],k=[],j=function(a,b,c,d){d?(a[c]=-b.x,a[c+1]=-b.y):(a[c]=b.x,a[c+1]=b.y)},g=function(a,b,c,d){j(a,b,0,!1);j(a,c,2,!1);j(a,b,4,d);
j(a,c,6,d);j(a,b,8,d);j(a,c,10,!1)},l=c(),n=c(),h=c(),m=vect.dir(n,l).rotate(pa/2),p,q=d;n;)p=h?vect.dir(h,l).rotate(pa/2):vect.dir(n,l).rotate(pa/2),g(f,l,n,!1),g(k,m,p,!0),a.write("vert",f,q,6),a.write("norm",k,q,6),q+=6,l=n,n=h,h=c(),m=p;return d}function qa(a){D||(D=B(engine.gl,y+"shaders/grid"));a||(a={});a.style||(a.style={});var e=a.lower,d=a.upper,b=a.rows,c=a.cols,f=(d.x-e.x)/c,k=(d.y-e.y)/b,j=new Float32Array(b*c),g=new Uint8Array(4*c*b),l=!1,n=new O(engine.gl,6);n.create("vert",2);n.create("screen",
2);n.create("tex",2);var h=new vect(e.x,e.y),m=new vect(d.x,d.y),p=new vect(0,0),q=new vect(1,1),z=n.alloc(6);n.write("vert",u(h,m),z,6);n.write("screen",u(new vect(-1,-1),new vect(1,1)),z,6);n.write("tex",u(p,q),z,6);var ja=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,ja);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindTexture(gl.TEXTURE_2D,null);this.lower=function(){return e.clone()};this.upper=function(){return d.clone()};this.rows=function(){return b};this.cols=function(){return c};this.centroid=function(a,b){return new vect(e.x+f*b+f/2,e.y+k*a+k/2)};this.get=function(a,b){return j[c*a+b]};var ca=-Infinity,ea=Infinity;this.qunatiles=function(a,b){b||(b=function(a,b){return a-b});for(var c=[],d=0;d<j.length;d++)c.push(j[d]);c.sort(b);for(var e=[-Infinity],d=1;d<a;d++){var f=
parseInt(inc*d);e.push(c[f])}e.push(Infinity);return e};this.set=function(a,d,e){if(a>=b||d>=c)throw"Index Out of Bounds";j[c*a+d]=e;l=!0};this.raw_set=function(a,d){if(a>=b*c)throw"Index Out of Bounds: "+a;j[a]=d;l=!0};this.clear=function(a){for(var d=0;d<b*c;d++)j[d]=a};this.initialize=function(){};var T=null;this.draw=function(d){T||(T=d.framebuffer());n.update();if(l){ca=-Infinity;ea=Infinity;for(var e=0;e<b*c;e++){var f=j[e];f>ca&&(ca=f);f<ea&&(ea=f)}for(e=0;e<b*c;e++){var f=e,k=a.map(ea,ca,
j[e]);g[4*f]=parseInt(255*k.r);g[4*f+1]=parseInt(255*k.g);g[4*f+2]=parseInt(255*k.b);g[4*f+3]=parseInt(255*k.a)}gl.bindTexture(gl.TEXTURE_2D,ja);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,c,b,0,gl.RGBA,gl.UNSIGNED_BYTE,g);gl.bindTexture(gl.TEXTURE_2D,null);l=!1}a.style.antialias&&T.activate({blend:!1});gl.useProgram(D);D.data("screen",d.camera.mat3);D.data("pos",n.get("vert"));D.data("tex_in",n.get("tex"));D.data("sampler",ja);e=vect.sub(d.camera.screen(m),d.camera.screen(h));D.data("width",e.x);D.data("height",
-e.y);D.data("rows",b);D.data("cols",c);D.data("blur",a.blur);gl.drawArrays(gl.TRIANGLES,0,n.count());a.style.antialias&&(T.deactivate(),d.draw_blur(T.tex))}}function Ya(a,e,d){J||(J=B(y+"shaders/raster"));this.image=ba(a);var b=G(u(new vect(0,1),new vect(1,0)),2),c=G(u(e,d),2);this.draw=function(a,d,e){e||(gl.useProgram(J),J.data("screen",a.camera.mat3),J.data("pos",c),J.data("tex_in",b),J.data("sampler",this.image),gl.drawArrays(gl.TRIANGLES,0,c.numItems))}}function ra(a){v||(v=B(y+"shaders/hillshade"));
var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),parseFloat(e.find("south").text())),b=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var c=!1,f=ba(a,function(){c=!0});this.ready=function(){return c};var k=G(u(new vect(0,1),new vect(1,0)),2),j=G(u(d,b),2),g=315;this.draw=function(a){if(c){for(gl.useProgram(altitude_shader);1<=g;)g-=1;altitude_shader.data("azimuth",g);altitude_shader.data("altitude",
Math.PI/4/(2*Math.PI));altitude_shader.data("screen",a.camera.mat3);altitude_shader.data("pos",j);altitude_shader.data("tex_in",k);altitude_shader.data("elevation",f);a=vect.sub(a.camera.screen(b),a.camera.screen(d));altitude_shader.data("pix_w",1/a.x);altitude_shader.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,j.numItems);return g}}}function ra(a){v||(v=B(engine.gl,y+"shaders/hillshade"));var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),parseFloat(e.find("south").text())),
b=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var c=!1,f=ba(engine.gl,a,function(){c=!0});this.ready=function(){return c};var k=G(engine.gl,u(new vect(0,1),new vect(1,0)),2),j=G(engine.gl,u(d,b),2),g=315;this.initialize=function(){};this.draw=function(a){if(c){for(gl.useProgram(v);1<=g;)g-=1;v.data("azimuth",g);v.data("altitude",Math.PI/4/(2*Math.PI));v.data("screen",a.camera.mat3);v.data("pos",j);v.data("tex_in",k);
v.data("elevation",f);a=vect.sub(a.camera.screen(b),a.camera.screen(d));v.data("pix_w",1/a.x);v.data("pix_h",1/a.y);gl.drawArrays(gl.TRIANGLES,0,j.numItems);return g}}}function da(a){for(var e=[],d=[],b=0;b<a.levels;b++){var c=p(a);"file"==c.source&&(c.url+="/"+a.size*Math.pow(2,b+1));c.min=new vect(-180,-90);c.rows=Math.pow(2,b);c.cols=2*c.rows;c.cellsize=180/c.rows;c.z_index=1-sa-b/1E3;c.available=d;c=new Za(c);e.push(c)}sa+=(a.levels+2)/1E3;var f=null;this.initialize=function(a){A||(A=B(a.gl,y+
"shaders/tile"));f=new O(a.gl,6*X);f.create("vert",3);f.create("tex",2);f.create("lookup",1);f.alloc(6*X);for(var b=0;25>b;b++)d.push(new ia(a.gl));for(b=0;b<e.length;b++)e[b].initialize(a);e[0].fetch_all();e[0].noexpire(!0)};this.draw=function(b,c){gl.useProgram(A);A.data("screen",b.camera.mat3);Ia=Ja=0;for(var d=Infinity,l=e[0],n,h=0;h<e.length;h++){var m=a.size*e[h].cols/e[h].size(b).x;1>m&&(m=1/m);m<d&&(d=m,l=e[h],n=h)}for(h=n;0<=h;h--)e[h].fetch();if(l.ready())l.draw(b,c,f,0,!0);else{b.enable_z();
d=0;for(h=n;0<=h;h--)d=e[h].draw(b,c,f,d,0==h);b.disable_z()}$.each(e,function(a,b){b.cull()})}}function Za(a){a||(a={});a.desaturate||(a.desaturate=0);a.darken||(a.darken=0);a.hue||(a.hue=0);a.hue_color||(a.hue_color=va(0,0,0,1));if(!a.available){a.available=[];for(var e=0;8>e;e++)a.available.push(new ia(d))}var d=null,b=a.url,c=a.min,f=a.rows,k=a.cols,j=a.cellsize;this.rows=f;this.cols=k;for(var g={},l={},n=function(b,d){var e=new vect(c.x+b*j,c.y+d*j),f=new vect(c.x+(b+1)*j,c.y+(d+1)*j),e={vert:u(e,
f,a.z_index),tex:null,i:b,j:d,id:b+k*d,ready:!1,min:e,max:f};l[b][d]=e;g[e.id]=e},e=0;e<k;e++)l[e]={};this.size=function(a){var b=a.camera.screen(c);a=a.camera.screen(vect.add(c,new vect(j*k,j*f)));b=vect.sub(a,b);b.y=Math.abs(b.y);return b};var h=!1;this.noexpire=function(a){h=a};this.cull=function(){if(!h){var b=(new Date).getTime(),c;for(c in p)if(b-p[c]>$a){var d=g[c];delete g[c];delete l[d.i][d.j];a.available.push(d.tex);d.tex=null;d.ready=!1;delete p[c]}}};var m=function(){var a=engine.camera.project(new vect(engine.canvas.offset().left,
engine.canvas.offset().top+engine.canvas.height())),b=engine.camera.project(new vect(engine.canvas.offset().left+engine.canvas.width(),engine.canvas.offset().top)),d=Math.floor((a.x-c.x)/j),e=Math.ceil((b.x-c.x)/j),a=Math.floor((a.y-c.y)/j),b=Math.ceil((b.y-c.y)/j);return{min_col:d,max_col:e,min_row:a,max_row:b}},p={};this.ready=function(){for(var a=m(),b=Math.max(0,a.min_col);b<Math.min(k,a.max_col);b++)for(var c=Math.max(0,a.min_row);c<Math.min(f,a.max_row);c++)if(!l[b][c]||!l[b][c].ready)return!1;
return!0};var q=function(c,e){if(!l[c][e].tex){var f;if("file"==a.source)f=b+"/"+l[c][e].id+".png";else if("wms"==a.source){f={service:"wms",version:"1.1.0",request:"GetMap",layers:a.layer,bbox:[l[c][e].min.x,l[c][e].min.y,l[c][e].max.x,l[c][e].max.y].join(),width:a.size,height:a.size,srs:"EPSG:4326",format:"image/png",transparent:"true"};var k=[],g;for(g in f)k.push(g+"="+f[g]);f=b+"?"+k.join("&")}l[c][e].tex=a.available.pop();l[c][e].tex||(l[c][e].tex=new ia(d));g=f;var j=l[c][e],n=new Image;n.crossOrigin=
"";n.onload=function(){j.tex&&(j.tex.image(n),j.ready=!0)};n.src=g}};this.fetch_all=function(){for(var a=(new Date).getTime(),b=0;b<k;b++)for(var c=0;c<f;c++)l[b][c]||n(b,c),l[b][c].tex||q(b,c),p[l[b][c].id]=a};this.fetch=function(){for(var a=m(),b=(new Date).getTime(),c=Math.max(0,a.min_col-1);c<Math.min(k,a.max_col+1);c++)for(var d=Math.max(0,a.min_row-1);d<Math.min(f,a.max_row+1);d++)l[c][d]||n(c,d),l[c][d].tex||q(c,d),p[l[c][d].id]=b};var z=!1;this.initialize=function(a){if(z)throw"Not Implemented: Migrating Tile Layers to New Map";
A||(A=B(a.gl,y+"shaders/tile"));d=a.gl;z=!0};this.draw=function(b,c,e,g,j){z||this.initialize(b);b=function(){Ia++;e.update();A.data("pos",e.get("vert"));A.data("tex_in",e.get("tex"));A.data("lookup_in",e.get("lookup"));A.data("desaturate",a.desaturate);A.data("darken",a.darken);A.data("hue",a.hue);A.data("hue_color",a.hue_color.array);d.drawArrays(d.TRIANGLES,0,6*g)};c=m();for(var n=(new Date).getTime(),h=Math.max(0,c.min_col);h<Math.min(k,c.max_col);h++)for(var r=Math.max(0,c.min_row);r<Math.min(f,
c.max_row);r++)if(l[h][r]&&l[h][r].ready&&l[h][r].tex){e.write("vert",l[h][r].vert,6*g,6);e.write("tex",u(new vect(0,0),new vect(1,1)),6*g,6);e.repeat("lookup",[g/X+1/(2*X)],6*g,6);p[l[h][r].id]=n;A.data("sampler"+g,l[h][r].tex);if(null==l[h][r].tex)throw"badness";g++;Ja++;g>=X&&(b(),g=0)}j&&b();return g}}var y="",R=jQuery,ab=function(a){if("string"===typeof a.data){var e=a.handler,d=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||
"text"===a.target.type))){var c="keypress"!==a.type&&R.hotkeys.specialKeys[a.which],f=String.fromCharCode(a.which).toLowerCase(),k="",j={};a.altKey&&"alt"!==c&&(k+="alt+");a.ctrlKey&&"ctrl"!==c&&(k+="ctrl+");a.metaKey&&(!a.ctrlKey&&"meta"!==c)&&(k+="meta+");a.shiftKey&&"shift"!==c&&(k+="shift+");c?j[k+c]=!0:(j[k+f]=!0,j[k+R.hotkeys.shiftNums[f]]=!0,"shift+"===k&&(j[R.hotkeys.shiftNums[f]]=!0));c=0;for(f=d.length;c<f;c++)if(j[d[c]])return e.apply(this,arguments)}}}};R.hotkeys={version:"0.8",specialKeys:{8:"backspace",
9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",
191:"/",219:"[",220:"\\",221:"]",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"}};R.each(["keydown","keyup","keypress"],function(){R.event.special[this]={add:ab}});var I=jQuery,ta=function(a){var e=a||window.event,d=[].slice.call(arguments,1),b=0,c=0,f=0;a=I.event.fix(e);a.type="mousewheel";e.wheelDelta&&(b=e.wheelDelta/120);e.detail&&(b=-e.detail/3);f=b;void 0!==
e.axis&&e.axis===e.HORIZONTAL_AXIS&&(f=0,c=-1*b);void 0!==e.wheelDeltaY&&(f=e.wheelDeltaY/120);void 0!==e.wheelDeltaX&&(c=-1*e.wheelDeltaX/120);d.unshift(a,b,c,f);return(I.event.dispatch||I.event.handle).apply(this,d)},S=["DOMMouseScroll","mousewheel"];if(I.event.fixHooks)for(var K=S.length;K;)I.event.fixHooks[S[--K]]=I.event.mouseHooks;I.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=S.length;a;)this.addEventListener(S[--a],ta,!1);else this.onmousewheel=ta},teardown:function(){if(this.removeEventListener)for(var a=
S.length;a;)this.removeEventListener(S[--a],ta,!1);else this.onmousewheel=null}};I.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});for(var Ka=0,K=["ms","moz","webkit","o"],Y=0;Y<K.length&&!window.requestAnimationFrame;++Y)window.requestAnimationFrame=window[K[Y]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[K[Y]+"CancelAnimationFrame"]||window[K[Y]+"CancelRequestAnimationFrame"];
window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var e=(new Date).getTime(),d=Math.max(0,16-(e-Ka)),b=window.setTimeout(function(){a(e+d)},d);Ka=e+d;return b});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});var pa=3.14159265,Ta=!1,ya=0,Pa={Point:{fill:new s(0.02,0.44,0.69,1),opacity:1,radius:5,stroke:"none","stroke-width":2},Polygon:{fill:new s(0.02,0.44,0.69,1),"fill-opacity":0.5,stroke:new s(0.02,0.44,0.69,1),"stroke-opacity":1},Line:{stroke:new s(0.02,
0.44,0.69,1),"stroke-opacity":1}},ka="http://eland.ecohealthalliance.org/wigglemaps",N={x:0,y:0},x=null,Aa=null,U=null,w=null,bb=wa(0,0,1,1),E=null,L=null,W={Point:{geometry:function(a,e){ua.call(this,a,e);this.bounds=null;for(var d=0;d<this.geom.length;d++){var b=new vect(this.geom[d][0],this.geom[d][1]),b=new V(b.clone(),b.clone());this.bounds?this.bounds.union(b):this.bounds=b}this.map_contains=function(a,b){for(var d=this.compute("radius"),e=0;e<this.geom.length;e++){var g=a.camera.screen(new vect(this.geom[e][0],
this.geom[e][1]));if(vect.dist(g,b)<d)return!0}return!1}},renderer:function(a,e){na.call(this,a,e);w||(w=B(a.gl,y+"shaders/point"));var d=10,b=new O(a.gl,1024);b.create("vert",2);b.create("unit",2);b.create("stroke_width",1);b.create("rad",1);b.create("fill_color",3);b.create("fill",1);b.create("stroke_color",3);b.create("stroke",1);b.create("alpha",1);var c=function(a){oa.call(this,a,e);var c,j;this.style_map={fill:function(a){"none"==a?b.repeat("fill",[-0.75],c,j):(b.repeat("fill",[0.75],c,j),b.repeat("fill_color",
a.array,c,j))},opacity:function(a){b.repeat("alpha",[a],c,j)},radius:function(a){a>d&&(d=a);b.repeat("rad",[a],c,j)},stroke:function(a){"none"==a?b.repeat("stroke",[-0.75],c,j):(b.repeat("stroke",[0.75],c,j),b.repeat("stroke_color",a.array,c,j))},"stroke-width":function(a){b.repeat("stroke_width",[a],c,j)}};a=a.geom;j=6*a.length;c=b.alloc(j);$.each(a,function(a,d){b.repeat("vert",d,c+6*a,6);b.write("unit",bb,c+6*a,6)});this.update_all()};this.view_factory=function(a){return new c(a,e)};this.draw=
function(){b.update();gl.useProgram(w);w.data("screen",a.camera.mat3);w.data("pos",b.get("vert"));w.data("circle_in",b.get("unit"));w.data("color_in",b.get("fill_color"));w.data("stroke_color_in",b.get("stroke_color"));w.data("alpha_in",b.get("alpha"));w.data("fill_in",b.get("fill"));w.data("stroke_in",b.get("stroke"));w.data("aspect",a.canvas.width()/a.canvas.height());w.data("pix_w",2/a.canvas.width());w.data("rad",b.get("rad"));w.data("stroke_width_in",b.get("stroke_width"));w.data("max_rad",d);
gl.drawArrays(gl.TRIANGLES,0,b.count())}},collection:function(a){var e=[],d=0;$.each(a,function(a,b){var k=b.compute("radius");k>d&&(d=k);$.each(b.geom,function(a,c){e.push({x:c[0],y:c[1],ref:b})})});var b=new Ea(e);this.search=function(a){a=b.search(a);var d=[];$.each(a,function(a,b){d.push(b.ref)});return new t(d)};this.map_contains=function(a,e){for(var k=vect.add(e,new vect(-d,d)),j=vect.add(e,new vect(d,-d)),k=new V(a.camera.project(k),a.camera.project(j)),k=b.search(k),j=0;j<k.length;j++){var g=
k[j];if(g.ref.map_contains(a,e))return new t([g.ref])}return new t([])}}},Polygon:{geometry:function(a,e){ua.call(this,a,e);this.bounds=Ha(this.geom);this.map_contains=function(a,b){return this.contains(a.camera.project(b))};this.contains=function(a){var b=0;if(this.bounds.contains(a)){b++;for(b=0;b<this.geom.length;b++){var c=0;$.each(this.geom[b],function(b,e){for(var j=0;j<e.length;j++){var g=(j+1)%e.length;if(0>(a.y-e[j][1])/(a.y-e[g][1])){var l=new vect(720,a.y),n=new vect(e[j][0],e[j][1]),g=
new vect(e[g][0],e[g][1]);vect.intersects(a,l,n,g)&&c++}}});if(1==c%2)return!0}}return!1}},renderer:function(a,e){na.call(this,a,e);L||(L=B(a.gl,y+"shaders/poly"));var d=new Fa(a,e),b=new O(a.gl,1024);b.create("vert",2);b.create("color",3);b.create("alpha",1);var c=function(a){oa.call(this,a,e);d.create(a);var c,j;this.style_map={fill:function(a){b.repeat("color",a.array,c,j)},"fill-opacity":function(a){b.repeat("alpha",[a],c,j)}};a=a.geom;var g=[];j=0;$.each(a,function(a,b){for(var c,d=0;100>d;)try{for(var e=
b,f=[],k=0;k<e.length;k++){for(var l=[],h=1;h<e[k].length;h++)l.push(La(e[k][h][0],e[k][h][1]));l.push(f[0]);f.push(l)}c=Wa(f);break}catch(m){d++}if(100==d)throw"Rendering Polygon Failed";j+=c.length/2;g.push(c)});var l=c=b.alloc(j);$.each(g,function(a,c){var d=c.length/2;b.write("vert",c,l,d);l+=d});this.update_all()};this.view_factory=function(a){return new c(a,e)};this.draw=function(){b.update();gl.useProgram(L);L.data("screen",a.camera.mat3);L.data("pos",b.get("vert"));L.data("color_in",b.get("color"));
L.data("alpha_in",b.get("alpha"));gl.drawArrays(gl.TRIANGLES,0,b.count());d.draw()}},collection:function(a){for(var e=[],d=0;d<a.length;d++)$.each(a[d].geom,function(b,c){$.each(c,function(b,c){$.each(c,function(b,c){e.push({ref:a[d],x:c[0],y:c[1]})})})});tree=new Ea(e);this.search=function(b){var c=tree.search(b),d={};$.each(c,function(a,b){d[b.ref.id]=b.ref});for(c=0;c<a.length;c++)for(var e=0;4>e;e++)a[c].contains(b.vertex(e))&&(d[a[c].id]=a[c]);b=[];for(var j in d)b.push(d[j]);return new t(b)};
this.map_contains=function(a,c){return this.contains(a.camera.project(c))};this.contains=function(b){for(var c=[],d=0;d<a.length;d++)a[d].contains(b)&&c.push(a[d]);return new t(c)}}},Line:{geometry:function(a,e){ua.call(this,a,e);this.bounds=Ha(this.geom);this.map_contains=function(){return!1}},renderer:Fa,collection:function(){this.search=function(){return new t([])};this.map_contains=function(){return new t([])};this.contains=function(){return new t([])}}}},ua=function(a,e){var d={},b=null;this.id=
Ma();this.type=a.type;var c=a.attr;this.attr=function(a,b){if(2>arguments.length)return c[a]};this.geom=a.geom;this.geometry=function(){};this.initialize=function(a){b=a.create(this);b.update_all()};this.compute=function(a){return za(this,e,a)};this.style=function(a,c,e){if(2>arguments.length)return void 0!==d[a]?d[a]:null;d[a]=c;b&&b.update(a)}},Ma,Na=1;Ma=function(){var a=Na;Na++;return a};var La;La=function(a,e){return new vect(a+1E-6*Math.random()-5E-7,e+1E-6*Math.random()-5E-7)};var D=null,t=
function(a){var e=null;this.length=a.length;this.count=function(){return a.length};this.items=function(){return a};this.type=function(b){for(var c=[],d=0;d<a.length;d++)a[d].type==b&&c.push(a[d]);return new t(c)};this.join=function(b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);for(d=0;d<b.count();d++){var e=b.get(d);this.id(e.id)||c.push(e)}return new t(c)};this.attr=function(){throw"Not Implemented";};this.get=function(b){return a[b]};this.subset=function(b){for(var c=[],d=0;d<b.length;d++)c.push(a[b[d]]);
return new t(c)};this.id=function(b){if(!e){e={};for(var c=0;c<a.length;c++)e[a[c].id]=a[c]}return b in e?e[b]:null};this.each=function(b){for(var c=0;c<a.length;c++)b(c,a[c]);return this};var d={">":function(a,c){return a>c},"<":function(a,c){return a<c},"==":function(a,c){return a==c},">=":function(a,c){return a>=c},"<=":function(a,c){return a<=c}};this.select=function(b){if(b.match(/^\s*\*\s*$/))return new t(a);var c=b.match(/^\s*([^\s]+)\s*([=<>]+)\s*(([^\s])+)\s*$/);if(!c)throw"Bad Selector";
b=c[1];var e=c[2],k=null,j=null;isNaN(c[3])?j=c[3]:k=parseFloat(c[3]);new_elem=[];if(j)for(c=0;c<a.length;c++)d[e](a[c].attr(b),a[c].attr(j))&&new_elem.push(a[c]);else for(c=0;c<a.length;c++)d[e](a[c].attr(b),k)&&new_elem.push(a[c]);return new t(new_elem)};this.filter=function(b){for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return new t(c)};this.quantile=function(b,c,d){a.sort(function(a,c){return a.attr(b)-c.attr(b)});var e=Math.round(c*this.length/d);c=Math.round((c-1)*this.length/d);return new t(a.slice(c,
e))};this.range=function(b){for(var c=Infinity,d=-Infinity,e=0;e<a.length;e++)c>a[e].attr(b)&&(c=a[e].attr(b)),d<a[e].attr(b)&&(d=a[e].attr(b));return{min:c,max:d}};this.style=function(b,c){if(1==arguments.length){var d=[];$.each(a,function(a,c){d.push(c.style(b))});return d}if("function"==typeof c)$.each(a,function(a,d){d.style(b,c(d))});else{var e;a:if(null==c||void 0==c.length)e=!1;else{for(e=0;e<c.length;e++)if(!(e in c)){e=!1;break a}e=!0}e?$.each(a,function(a,d){d.style(b,c[a])}):$.each(a,function(a,
d){d.style(b,c)})}return this}},J=null,v=null,M=null,v=null,$a=1E3,sa=0,X=8,Ja=0,Ia=0,A=null,Oa=[];window.wiggle={Map:function(a,e){this.center=function(a,c){engine.camera.position(new vect(a,c))};this.vcenter=function(a){this.center(a.x,a.y)};this.extents=function(a){engine.camera.extents(a)};this.append=function(a){a.initialize(engine);engine.scene.push(a)};this.remove=function(a){for(var c=0;c<engine.scene.length;c++)if(engine.scene[c]==a)return engine.scene.splice(c,1),!0;return!1};this.shade=
function(a){a=new ra(a);engine.shade=a};this.select=function(a){a?(engine.sel.select(a),engine.select(!0)):engine.select(!1)};this.resize=function(){engine.resize()};this.attr=function(a,c){engine.attr(a,c)};this.png=function(){var a=engine.canvas.get(0).toDataURL();$.ajax({url:"../server/export.png",type:"POST",data:a})};this.width=function(){return engine.canvas.innerWidth()};this.height=function(){return engine.canvas.innerHeight()};var d=null;this.click=function(a){d=a};engine=new Sa(a,this,e);
engine.canvas.click(function(a){d&&(a=new vect(a.pageX,a.pageY),a=engine.camera.project(a),d(a))})},layer:{Layer:Ga,Grid:qa,Hillshade:ra,Elevation:function(a){M||(M=B(y+"shaders/elevation"));var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),parseFloat(e.find("south").text())),b=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();var c=ba(a),f=G(u(new vect(0,1),new vect(1,0)),2),k=G(u(d,b),2);this.draw=
function(a,e,l){l||(gl.useProgram(M),M.data("screen",a.camera.mat3),M.data("pos",k),M.data("tex_in",f),M.data("elevation",c),vect.sub(a.camera.screen(b),a.camera.screen(d)),gl.drawArrays(gl.TRIANGLES,0,k.numItems))}}},io:{Shapefile:function(a){var e=a.path;$.ajax({url:e+".shx",mimeType:"text/plain; charset=x-user-defined",success:function(d){for(var b=[],c=100;c<d.length;)b.push(2*ga(d,c)),c+=8;$.ajax({url:e+".shp",mimeType:"text/plain; charset=x-user-defined",success:function(c){for(var d=[],e=[],
g=0;g<b.length;g++){var l=b[g];ga(c,l);ga(c,l+4);var h=l+8,m=F(c,h);if(0==m)console.log("NULL Shape");else if(1==m)m=Z(c,h+4),h=Z(c,h+12),d.push({attr:{},geom:[[m,h]]});else if(5==m){for(var m=F(c,h+36),h=F(c,h+40),p=l+52,l=l+52+4*m,q=[],s=0;s<m;s++){var z=F(c,p+4*s),t;t=s+1<m?F(c,p+4*(s+1)):h;var u=l,w=[];for(t-=1;t>=z;t--){var x=Z(c,u+16*t),y=Z(c,u+16*t+8);w.push([x,y])}q.push(w)}e.push({attr:{},geom:[q]})}else throw"Not Implemented: "+m;}if(0<d.length){var v=new PointLayer(d.length);$.each(d,function(a,
b){v.append(b)});c=v}else 0<e.length?(v=new PolygonLayer(a),$.each(e,function(a,b){for(var c=0;100>c;)try{v.append(b),c=101}catch(d){c++}100==c&&console.log("rendering polygon failed")}),c=v):c=void 0;a.success(c)}})}})},GeoJSON:function(a,e){void 0===e&&(e={});for(var d=new Ga(e),b=0;b<a.features.length;b++){var c=a.features[b];if("Feature"==c.type){"Point"==c.geometry.type&&d.append({type:"Point",geom:[c.geometry.coordinates],attr:c.properties});"MultiPoint"==c.geometry.type&&d.append({type:"Point",
geom:c.geometry.coordinates,attr:c.properties});if("Polygon"==c.geometry.type){for(var f=c.geometry.coordinates,k=[],j=0;j<=f.length-1;j++){for(var g=[],h=f[j].length-1;0<=h;h--)g.push(f[j][h]);k.push(g)}d.append({type:"Polygon",geom:[k],attr:c.properties})}if("MultiPolygon"==c.geometry.type){var n=[];$.each(c.geometry.coordinates,function(a,c){for(var b=[],d=0;d<=c.length-1;d++){for(var e=[],f=c[d].length-1;0<=f;f--)e.push(c[d][f]);b.push(e)}n.push(b)});d.append({type:"Polygon",geom:n,attr:c.properties})}"MultiLineString"==
c.geometry.type&&$.each(c.geometry.coordinates,function(a,b){d.append({type:"Line",geom:[[b]],attr:c.properties})})}}return d},KML:function(a){var e=$(a).find("LatLonBox"),d=new vect(parseFloat(e.find("west").text()),parseFloat(e.find("south").text())),e=new vect(parseFloat(e.find("east").text()),parseFloat(e.find("north").text()));a=$(a).find("GroundOverlay Icon href").text();return new Ya(y+a,d,e)},SparseGrid:function(a,e){var d=aa(a,0),b=aa(a,4),c=F(a,8),f=F(a,12),k=aa(a,16),j={};for(key in e)j[key]=
e[key];j.lower=new vect(d,b);j.upper=new vect(d+k*c,b+k*f);j.rows=f;j.cols=c;d=new qa(j);for(b=20;b<a.length;){for(var k=F(a,b),c=F(a,b+4),f=b+4,j=c,g=0;g<j;g++){var h=aa(a,f+4*g);d.raw_set(k+g,h)}b+=8+4*c}return d},AsciiGrid:function(a,e){var d=a.split("\n"),b=d.splice(0,6),c=parseInt(b[0].slice(14)),f=parseInt(b[1].slice(14)),k=parseFloat(b[2].slice(14)),j=parseFloat(b[3].slice(14)),g=parseFloat(b[4].slice(14)),b=b[5].slice(14),h={};for(key in e)h[key]=e[key];h.lower=new vect(k,j);h.upper=new vect(k+
g*c,j+g*f);h.rows=f;h.cols=c;k=new qa(h);for(j=0;j<f;j++){g=d[j].split(" ");for(h=0;h<c;h++)g[h]==b?k.set(f-1-j,h,NaN):k.set(f-1-j,h,parseFloat(g[h]))}return k},WMS:function(a){a=p(a);for(var e=["url","layer"],d=0;d<e.length;d++){var b=e[d];if(!(b in a))throw"Key "+b+" not found";}h(a,{levels:16,size:256});var e={source:"wms"},c;for(c in e)a[c]=e[c];return new da(a)}},util:{fcolor:va,icolor:function(a,e,d,b){return new s(m(a/255,0,1),m(e/255,0,1),m(d/255,0,1),m(b/255,0,1))}},widget:{Slider:function(a,
e,d){var b=function(a){if(a>=d)throw"Slider index out of bounds";return e.x/(d-1)*a},c=function(b){return b<=a.x?0:b>=a.x+e.x?d-1:Math.round((b-a.x)/e.x*(d-1))};this.dom=$("<div></div>").addClass("slider-container").css("position","relative").css("left",a.x).css("top",a.y).css("width",e.x).css("height",e.y);var f=!1,h=0,j=$("<div></div>").addClass("slider-box").css("position","relative").css("left",-10).css("height",e.y).css("width",20).mousedown(function(){f=!0});this.tick=function(){return h};this.count=
function(){return d};var g=function(){};this.change=function(a){g=a};var l=function(){};this.release=function(a){l=a};this.dragging=function(){return f};this.dom.append(j);this.set=function(a){a!=h&&g(a);h=a;var c=b(a);j.css("left",c-10);l(a)};$(document).bind("mouseup",function(){if(f){f=!1;var a=c(event.clientX);l(a)}});$(document).bind("mousemove",function(a){f&&(a=c(a.clientX),a!=h&&g(a),h=a,a=b(a),j.css("left",a-10))})}},ready:function(a){Oa.push(a)}};$(document).ready(function(){$('script[src*="wigglemaps"]').each(function(a,
e){var d=/wigglemaps(\.min)?\.js/;$(e).attr("src").match(d)&&(y=$(e).attr("src").replace(d,""))});$.each(Oa,function(a,e){e()})})})();
