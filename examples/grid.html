<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Map</title>
    <script type="text/javascript" src="../js/jquery-1.7.min.js"></script>
    <script type="text/javascript" src="../js/jquery.hotkeys.js"></script>
    <script type="text/javascript" src="../js/jquery.mousewheel.js"></script>

    <script type="text/javascript" src="../webgl_maps.js"></script>
    <script type="text/javascript" src="../js/geojson.js"></script>
    <script type="text/javascript" src="../js/ascii.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/screen.css" />
    <script type="text/javascript">
    $ (document).ready (function () {
	var map = new Map (null, {
	    //base: null,
	    desaturate: 1.0,
	    darken: .25,
	    hue: .1,
	    hue_color: fcolor (0, 0, 1, 1),
	    //background: new Color (150, 150, 150, 255)
	    background: new Color (10, 10, 10, 255),
	    center: new vect (0, 0),
	    extents: 360,
	});
	
	$.ajax ({
	    url: 'data/countries.json',
	    dataType: 'json',
     	    async: false,			
	    success: function (data) {
		br_pop = GeoJSON (data, {
		    style: {
			stroke: fcolor (.2, .2, .2, 1.0),
			'fill-opacity': 0.0
		    }
		});
		map.append(br_pop);
	    }
	});

	/*var ramp = [
	    new Color (0, 0, 0, 0),
	    new Color (189, 0, 38, 128),
	    new Color (240, 59, 32, 128),
	    new Color (253, 141, 60, 200),
	    new Color (254, 178, 76, 200),
	    new Color (254, 217, 118, 255),
	    new Color (255, 255, 178, 255),
	    new Color (255, 255, 255, 255),
	];*/

	var ramp = [
	    new Color (0, 0, 0, 0),
	    new Color (128, 0, 38, 64),
	    new Color (189, 0, 38, 64),
	    new Color (227, 26, 28, 128),
	    new Color (252, 78, 42, 128),
	    new Color (253, 141, 60, 200),
	    new Color (254, 178, 76, 200),
	    new Color (254, 217, 118, 255),
	    new Color (255, 237, 160, 255),
	    new Color (255, 255, 204, 255),
	    new Color (255, 255, 255, 255),
	];
	
	$.ajax ({
	    url: 'data/glds10ag15.asc',
	    dataType: 'text',
	    success: function (data) {
		var MAX = .65;
		var MIN = .1;
		world_pop = AsciiGrid (data, {
		    ramp: ramp,
		    map: function (min, max, val) {
			if (isNaN (val))
			    return 0;
			var lval = Math.log (val + 1);
			var lmin = Math.log (min + 1);
			var lmax = Math.log (max + 1);
			var tol = (lmax - lmin) * .05;
			var p = (lval - (lmin - tol)) / (lmax - lmin + 2 * tol);
			if (p > MAX)
			    return ramp.length - 1;
			if (p < MIN)
			    return 0;
			var i = Math.floor (((p - MIN) / (MAX - MIN)) * (ramp.length - 2)) + 1; 
			return i;
		    },
		    blur: true
		});
		map.append (world_pop);
	    }	
	});
    });
</script>

  </head>
  <body>
  </body>
</html>
